{"version":3,"file":"main.47f0645f3cfcdf3d.js","mappings":"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","names":["AdminDashboardService","constructor","playerService","matchService","leagueService","messageService","noteService","this","essentialDataCache$","BehaviorSubject","secondaryDataCache","Map","lastEssentialUpdate","lastSecondaryUpdate","CACHE_DURATION","SECONDARY_CACHE_DURATION","getEssentialData","forceRefresh","now","Date","value","asObservable","pipe","filter","data","loadEssentialDataFromServer","tap","next","catchError","error","of","getEmptyDashboardData","shareReplay","getSecondaryData","type","lastUpdate","get","hasValidCache","has","loadSecondaryDataFromServer","set","forkJoin","players","getAdminPlayers","matches","getAdminMatches","currentLeague","getAdminCurrentLeague","map","response","league","allLeagues","getAdminAllLeagues","notes","getAdminNotes","messages","getAdminMessages","messagesList","Array","isArray","stats","totalPlayers","length","totalMatches","totalMatchesLeft","m","isCompleted","totalMessagesLeft","isRead","isFromAdmin","invalidateCache","delete","clear","getCurrentEssentialData","updateMessageCount","count","current","i0","i1","i2","i3","i4","i5","factory","ɵfac","providedIn","AuthService","http","router","baseUrl","environment","apiUrl","isLoggedInSubject","hasToken","isLoggedIn$","userRole","token","localStorage","getItem","getRoleFromToken","login","email","password","post","success","setItem","navigate","playerLogin","phoneNumber","extractedRole","register","firstName","lastName","resetPassword","newPassword","logout","removeItem","getRole","JSON","parse","atob","split","role","CacheService","cache","DEFAULT_TTL","PLAYER_TTL","LEAGUE_TTL","RANKINGS_TTL","loadFromLocalStorage","key","ttl","item","timestamp","saveToLocalStorage","remove","cacheRequest","request","cached","cachePlayerRequest","cacheLeagueRequest","cacheRankingsRequest","cacheAllLeaguesRequest","createdOn","sortedData","sort","a","b","dateA","getTime","invalidatePattern","pattern","keys","includes","getNextPlayerUpdateTime","getFullYear","getMonth","getDate","getHours","getLastUpdateTime","isCacheExpired","getCacheExpiryTime","shouldRefreshRankings","shouldRefreshCurrentLeague","cacheData","from","entries","stringify","LeagueService","cacheService","resetLeague","LeagueId","startLeague","dto","GetCurrentLeague","GetAllLeaguesRank","DeleteLeague","leagueId","createGroupsAndMatches","startKnockoutStage","startSemiFinals","startFinal","getLastLeaguesRankUpdateTime","getLastCurrentLeagueUpdateTime","isRankingsCacheExpired","isCurrentLeagueCacheExpired","getNextRankingsUpdateTime","getNextCurrentLeagueUpdateTime","forceRefreshRankings","forceRefreshCurrentLeague","MatchService","getMatches","updateMatch","matchId","winnerId","refreshPlayers","resetMatch","getLastMatchesUpdateTime","MessageService","sendMessage","message","Content","getMessages","toggleMarkMessage","messageId","marked","Marked","toggleDeleteMessage","getPlayerMessages","sendAdminReply","playerId","NoteService","sendNote","getNotes","toggleMarHide","noteId","DeleteNote","PlayerService","rankingSubject","ranking$","getrank","getPlayers","addPlayer","fullName","deletePlayer","refreshRanking","subscribe","getNextUpdateTime","getLastRankingUpdateTime","getLastPlayersUpdateTime","SharedModule","imports","CommonModule","FormsModule","production","routes","path","redirectTo","pathMatch","loadChildren","__webpack_require__","e","then","bind","PlayerModule","title","AuthModule","Promise","all","AdminModule","canActivate","authGuard","route","state","authService","inject","AppRoutingModule","RouterModule","forRoot","TitleStrategyService","defaultTitle","console","log","setTitle","setupTitleUpdates","events","event","NavigationEnd","setTimeout","updateTitle","currentRoute","getCurrentRoute","snapshot","newTitle","routerState","root","firstChild","currentActivatedRoute","$event","_r3","ctx_r2","onButtonMouseDown","ctx_r4","onButtonTouchStart","ctx_r5","toggleInboxOverlay","ctx_r0","buttonPosition","x","y","isDragging","chat_r9","unreadCount","_r13","$implicit","ctx_r12","selectChat","FloatingInboxComponent_div_1_div_10_div_8_div_10_Template","playerFullName","lastMessage","lastMessageDate","_r15","ctx_r14","refreshMessages","FloatingInboxComponent_div_1_div_10_div_8_Template","ctx_r6","playerChats","_r22","message_r18","ctx_r20","markAsRead","id","FloatingInboxComponent_div_1_div_11_div_8_div_7_Template","_c0","_c1","content","sentAt","_r24","ctx_r23","goBack","FloatingInboxComponent_div_1_div_11_div_8_Template","ctx_r25","replyText","ctx_r26","sendReply","selectedChat","ctx_r27","ctx_r7","trackByMessageId","_r29","ctx_r28","closeInboxOverlay","stopPropagation","ctx_r31","FloatingInboxComponent_div_1_div_10_Template","FloatingInboxComponent_div_1_div_11_Template","ctx_r1","FloatingInboxComponent","toastr","cdr","adminDashboardService","isAdmin","showInboxOverlay","dragOffset","hasMovedDuringDrag","selectedPlayerId","navbarHeight","ngOnInit","checkAdminStatus","setInitialButtonPosition","loadAdminMessages","ngOnDestroy","document","body","style","cursor","classList","updateStatusSubscription","unsubscribe","refreshSubscription","removeEventListener","onGlobalMouseMove","onGlobalMouseUp","warn","fixInboxComponentForOverlay","inboxElement","querySelector","querySelectorAll","forEach","el","marginTop","top","savedPosition","parsedPosition","margin","buttonSize","maxX","window","innerWidth","maxY","innerHeight","Math","max","clientX","clientY","preventDefault","add","touch","touches","requestAnimationFrame","newY","oldX","oldY","finalX","min","finalY","abs","saveButtonPosition","onGlobalTouchMove","onGlobalTouchEnd","onWindowResize","onEscapeKey","loadFromServer","loadFromCache","groupedMessages","groupMessagesBySender","err","chat","loadChatMessages","scrollToBottom","playerMessages","msg","senderId","scrollToTop","messagesContainer","scrollTop","scrollHeight","chatMap","push","senderFullName","values","trim","detectChanges","index","selectors","hostBindings","rf","ctx","FloatingInboxComponent_div_0_Template","FloatingInboxComponent_div_1_Template","closeMenu","ctx_r16","_r18","ctx_r17","note_r20","NavbarComponent_div_48_div_2_Template","ctx_r11","getNavbarOnlyHeight","NavbarComponent","navbarHeightChange","EventEmitter","isLoggedIn","isMenuOpen","navbarOnlyHeight","loggedIn","ngAfterViewInit","calculateNavbarHeight","navbarOnly","nativeElement","offsetHeight","totalHeight","emit","n","isHidden","toggleMenu","onResize","viewQuery","NavbarComponent_a_7_Template","NavbarComponent_a_8_Template","NavbarComponent_a_9_Template","NavbarComponent_a_10_Template","NavbarComponent_a_25_Template","NavbarComponent_ng_container_26_Template","NavbarComponent_a_27_Template","NavbarComponent_ng_container_46_Template","NavbarComponent_a_47_Template","NavbarComponent_div_48_Template","_c2","AppComponent","titleStrategy","onNavbarHeightChange","height","decls","vars","consts","template","AuthInterceptor","spinner","intercept","req","show","clonedReq","clone","setHeaders","Authorization","handle","finalize","hide","CacheInterceptor","method","shouldCache","url","cachedResponse","HttpResponse","some","cacheableUrl","AppModule","bootstrap","provide","HTTP_INTERCEPTORS","useClass","multi","NgxSpinnerModule","Title","BrowserModule","HttpClientModule","NoopAnimationsModule","ToastrModule","timeOut","positionClass","preventDuplicates","__NgCli_bootstrap_1","bootstrapModule","catch"],"sourceRoot":"webpack:///","sources":["./src/app/core/services/admin-dashboard.service.ts","./src/app/core/services/auth.service.ts","./src/app/core/services/cache.service.ts","./src/app/core/services/league.service.ts","./src/app/core/services/match.service.ts","./src/app/core/services/message.service.ts","./src/app/core/services/note.service.ts","./src/app/core/services/player.service.ts","./src/app/shared/shared.module.ts","./src/environments/environment.ts","./src/app/app-routing.module.ts","./src/app/core/guards/auth.guard.ts","./src/app/core/services/title-strategy.service.ts","./src/app/shared/floating-inbox/floating-inbox.component.html","./src/app/shared/floating-inbox/floating-inbox.component.ts","./src/app/navbar/navbar.component.html","./src/app/navbar/navbar.component.ts","./src/app/app.component.ts","./src/app/app.component.html","./src/app/interceptors/auth-interceptor.service.ts","./src/app/core/interceptors/cache-interceptor.service.ts","./src/app/app.module.ts","./src/main.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { Observable, BehaviorSubject, forkJoin, of } from 'rxjs';\r\nimport { map, tap, catchError, shareReplay, filter } from 'rxjs/operators';\r\nimport { PlayerService } from './player.service';\r\nimport { MatchService } from './match.service';\r\nimport { LeagueService } from './league.service';\r\nimport { MessageService } from './message.service';\r\nimport { NoteService } from './note.service';\r\nimport {\r\n  Player,\r\n  Match,\r\n  League,\r\n  AllLeagueRank,\r\n  Note,\r\n  Message,\r\n} from '../../models/interfaces';\r\n\r\nexport interface AdminDashboardData {\r\n  players: Player[];\r\n  matches: Match[];\r\n  currentLeague: League | null;\r\n  allLeagues: AllLeagueRank[];\r\n  notes: Note[];\r\n  messages: Message[];\r\n  stats: {\r\n    totalPlayers: number;\r\n    totalMatches: number;\r\n    totalMatchesLeft: number;\r\n    totalMessagesLeft: number;\r\n  };\r\n}\r\n\r\nexport interface AdminSecondaryData {\r\n  allLeagues: AllLeagueRank[];\r\n  notes: Note[];\r\n  messages: Message[];\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class AdminDashboardService {\r\n  private essentialDataCache$ = new BehaviorSubject<AdminDashboardData | null>(\r\n    null\r\n  );\r\n  private secondaryDataCache = new Map<string, any>();\r\n  private lastEssentialUpdate = 0;\r\n  private lastSecondaryUpdate = new Map<string, number>();\r\n  private readonly CACHE_DURATION = 900000; // 15 minutes\r\n  private readonly SECONDARY_CACHE_DURATION = 900000; // 15 minutes (same as main cache)\r\n\r\n  constructor(\r\n    private playerService: PlayerService,\r\n    private matchService: MatchService,\r\n    private leagueService: LeagueService,\r\n    private messageService: MessageService,\r\n    private noteService: NoteService\r\n  ) {}\r\n\r\n  /**\r\n   * Get essential dashboard data with smart caching\r\n   */\r\n  getEssentialData(forceRefresh = false): Observable<AdminDashboardData> {\r\n    const now = Date.now();\r\n    const hasValidCache =\r\n      this.essentialDataCache$.value &&\r\n      now - this.lastEssentialUpdate < this.CACHE_DURATION;\r\n\r\n    if (!forceRefresh && hasValidCache) {\r\n      return this.essentialDataCache$\r\n        .asObservable()\r\n        .pipe(filter((data): data is AdminDashboardData => data !== null));\r\n    }\r\n\r\n    return this.loadEssentialDataFromServer().pipe(\r\n      tap((data) => {\r\n        this.essentialDataCache$.next(data);\r\n        this.lastEssentialUpdate = now;\r\n      }),\r\n      catchError((error) => {\r\n        // Return cached data if available, otherwise empty state\r\n        return of(\r\n          this.essentialDataCache$.value || this.getEmptyDashboardData()\r\n        );\r\n      }),\r\n      shareReplay(1)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get secondary data with smart caching\r\n   */\r\n  getSecondaryData(\r\n    type: 'leagues' | 'notes' | 'messages',\r\n    forceRefresh = false\r\n  ): Observable<any> {\r\n    const now = Date.now();\r\n    const lastUpdate = this.lastSecondaryUpdate.get(type) || 0;\r\n    const hasValidCache =\r\n      this.secondaryDataCache.has(type) &&\r\n      now - lastUpdate < this.SECONDARY_CACHE_DURATION;\r\n\r\n    if (!forceRefresh && hasValidCache) {\r\n      return of(this.secondaryDataCache.get(type));\r\n    }\r\n\r\n    return this.loadSecondaryDataFromServer(type).pipe(\r\n      tap((data) => {\r\n        this.secondaryDataCache.set(type, data);\r\n        this.lastSecondaryUpdate.set(type, now);\r\n      }),\r\n      catchError((error) => {\r\n        // Return cached data if available\r\n        return of(this.secondaryDataCache.get(type) || []);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Load essential data from server using parallel requests\r\n   */\r\n  private loadEssentialDataFromServer(): Observable<AdminDashboardData> {\r\n    return forkJoin({\r\n      players: this.playerService.getAdminPlayers(),\r\n      matches: this.matchService.getAdminMatches(),\r\n      currentLeague: this.leagueService.getAdminCurrentLeague().pipe(\r\n        map((response) => response.league),\r\n        catchError(() => of(null))\r\n      ),\r\n      allLeagues: this.leagueService\r\n        .getAdminAllLeagues()\r\n        .pipe(catchError(() => of([]))),\r\n      notes: this.noteService.getAdminNotes().pipe(\r\n        map((response) => response.notes),\r\n        catchError(() => of([]))\r\n      ),\r\n      messages: this.messageService.getAdminMessages().pipe(\r\n        map((response) => response.messages || []),\r\n        catchError(() => of([]))\r\n      ),\r\n    }).pipe(\r\n      map(\r\n        ({ players, matches, currentLeague, allLeagues, notes, messages }) => {\r\n          const messagesList = Array.isArray(messages) ? messages : [];\r\n          return {\r\n            players: players as Player[],\r\n            matches: matches as Match[],\r\n            currentLeague,\r\n            allLeagues: allLeagues as AllLeagueRank[],\r\n            notes: notes as Note[],\r\n            messages: messagesList as Message[],\r\n            stats: {\r\n              totalPlayers: players.length,\r\n              totalMatches: matches.length,\r\n              totalMatchesLeft: matches.filter((m) => !m.isCompleted).length,\r\n              totalMessagesLeft: messagesList.filter(\r\n                (m: any) => !m.isRead && !m.isFromAdmin\r\n              ).length,\r\n            },\r\n          };\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Load secondary data from server\r\n   */\r\n  private loadSecondaryDataFromServer(type: string): Observable<any> {\r\n    switch (type) {\r\n      case 'leagues':\r\n        return this.leagueService.getAdminAllLeagues();\r\n      case 'notes':\r\n        return this.noteService\r\n          .getAdminNotes()\r\n          .pipe(map((response) => response.notes));\r\n      case 'messages':\r\n        return this.messageService\r\n          .getAdminMessages()\r\n          .pipe(map((response) => response.messages || []));\r\n      default:\r\n        return of([]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update cached data after mutations\r\n   */\r\n  invalidateCache(\r\n    type: 'essential' | 'leagues' | 'notes' | 'messages' | 'all'\r\n  ): void {\r\n    switch (type) {\r\n      case 'essential':\r\n        this.lastEssentialUpdate = 0;\r\n        break;\r\n      case 'leagues':\r\n      case 'notes':\r\n      case 'messages':\r\n        this.lastSecondaryUpdate.set(type, 0);\r\n        this.secondaryDataCache.delete(type);\r\n        break;\r\n      case 'all':\r\n        this.lastEssentialUpdate = 0;\r\n        this.lastSecondaryUpdate.clear();\r\n        this.secondaryDataCache.clear();\r\n        break;\r\n    }\r\n  }\r\n\r\n  // ✅ تم حذف Background refresh تماماً - مالوش لازمة أصلاً\r\n\r\n  /**\r\n   * Get current cached essential data\r\n   */\r\n  getCurrentEssentialData(): AdminDashboardData | null {\r\n    return this.essentialDataCache$.value;\r\n  }\r\n\r\n  /**\r\n   * Update message count in stats\r\n   */\r\n  updateMessageCount(count: number): void {\r\n    const current = this.essentialDataCache$.value;\r\n    if (current) {\r\n      current.stats.totalMessagesLeft = count;\r\n      this.essentialDataCache$.next(current);\r\n    }\r\n  }\r\n\r\n  private getEmptyDashboardData(): AdminDashboardData {\r\n    return {\r\n      players: [],\r\n      matches: [],\r\n      currentLeague: null,\r\n      allLeagues: [],\r\n      notes: [],\r\n      messages: [],\r\n      stats: {\r\n        totalPlayers: 0,\r\n        totalMatches: 0,\r\n        totalMatchesLeft: 0,\r\n        totalMessagesLeft: 0,\r\n      },\r\n    };\r\n  }\r\n}\r\n","import { environment } from './../../../environments/environment';\r\nimport { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { BehaviorSubject, Observable, tap } from 'rxjs';\r\nimport { Router } from '@angular/router';\r\nimport { CommonResponse, LoginResponse } from 'src/app/models/interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class AuthService {\r\n  private baseUrl = environment.apiUrl;\r\n  private isLoggedInSubject = new BehaviorSubject<boolean>(this.hasToken());\r\n  isLoggedIn$ = this.isLoggedInSubject.asObservable();\r\n  private userRole: string | null = null;\r\n\r\n  constructor(private http: HttpClient, private router: Router) {\r\n    const token = localStorage.getItem('token');\r\n    if (token) {\r\n      this.userRole = this.getRoleFromToken(token);\r\n      this.isLoggedInSubject.next(true);\r\n    }\r\n  }\r\n\r\n  login(email: string, password: string): Observable<any> {\r\n    return this.http\r\n      .post<any>(`${this.baseUrl}/auth/login`, {\r\n        email,\r\n        password,\r\n      })\r\n      .pipe(\r\n        tap((response) => {\r\n          if (response.success) {\r\n            localStorage.setItem('token', response.token);\r\n            localStorage.setItem('userRole', response.userRole || 'Admin');\r\n            this.userRole = response.userRole || 'Admin';\r\n            this.isLoggedInSubject.next(true);\r\n            this.router.navigate(['/admin']);\r\n          }\r\n        })\r\n      );\r\n  }\r\n\r\n  playerLogin(\r\n    phoneNumber: string,\r\n    password: string\r\n  ): Observable<LoginResponse> {\r\n    return this.http\r\n      .post<LoginResponse>(`${this.baseUrl}/auth/player-login`, {\r\n        phoneNumber,\r\n        password,\r\n      })\r\n      .pipe(\r\n        tap((response) => {\r\n          if (response.success && response.token) {\r\n            localStorage.setItem('token', response.token);\r\n            const extractedRole = this.getRoleFromToken(response.token);\r\n            this.userRole = extractedRole || 'Player';\r\n            localStorage.setItem('userRole', this.userRole);\r\n\r\n            this.isLoggedInSubject.next(true);\r\n            this.router.navigate(['/player']);\r\n          }\r\n        })\r\n      );\r\n  }\r\n\r\n  register(\r\n    phoneNumber: string,\r\n    password: string,\r\n    firstName: string,\r\n    lastName: string\r\n  ): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/auth/register-player`,\r\n      { phoneNumber, password, firstName, lastName }\r\n    );\r\n  }\r\n\r\n  resetPassword(\r\n    phoneNumber: string,\r\n    newPassword: string\r\n  ): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/auth/reset-password`,\r\n      { phoneNumber, newPassword }\r\n    );\r\n  }\r\n\r\n  logout(): void {\r\n    localStorage.removeItem('token');\r\n    this.userRole = null;\r\n    this.isLoggedInSubject.next(false);\r\n    this.router.navigate(['/player']);\r\n  }\r\n\r\n  getRole(): string | null {\r\n    return this.userRole;\r\n  }\r\n\r\n  private hasToken(): boolean {\r\n    return !!localStorage.getItem('token');\r\n  }\r\n\r\n  private getRoleFromToken(token: string): string | null {\r\n    try {\r\n      const payload = JSON.parse(atob(token.split('.')[1]));\r\n      const role = payload['role'] || null;\r\n      return role;\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\nimport { tap, catchError } from 'rxjs/operators';\r\n\r\ninterface CacheItem<T> {\r\n  data: T;\r\n  timestamp: number;\r\n  ttl: number; // Time to live in milliseconds\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class CacheService {\r\n  private cache = new Map<string, CacheItem<any>>();\r\n  private readonly DEFAULT_TTL = 5 * 60 * 1000; // 5 minutes default\r\n  private readonly PLAYER_TTL = 30 * 60 * 1000; // 30 minutes for player data\r\n  private readonly LEAGUE_TTL = 30 * 60 * 1000; // 30 minutes for league data\r\n  private readonly RANKINGS_TTL = 30 * 60 * 1000; // 30 minutes for rankings data\r\n\r\n  constructor() {\r\n    this.loadFromLocalStorage();\r\n  }\r\n\r\n  set<T>(key: string, data: T, ttl: number = this.DEFAULT_TTL): void {\r\n    const item = {\r\n      data,\r\n      timestamp: Date.now(),\r\n      ttl,\r\n    };\r\n\r\n    this.cache.set(key, item);\r\n    this.saveToLocalStorage();\r\n  }\r\n\r\n  get<T>(key: string): T | null {\r\n    const item = this.cache.get(key);\r\n    if (!item) return null;\r\n\r\n    const isExpired = Date.now() - item.timestamp > item.ttl;\r\n    if (isExpired) {\r\n      this.cache.delete(key);\r\n      this.saveToLocalStorage();\r\n      return null;\r\n    }\r\n\r\n    return item.data;\r\n  }\r\n\r\n  has(key: string): boolean {\r\n    return this.get(key) !== null;\r\n  }\r\n\r\n  clear(): void {\r\n    this.cache.clear();\r\n    this.saveToLocalStorage();\r\n  }\r\n\r\n  remove(key: string): void {\r\n    this.cache.delete(key);\r\n    this.saveToLocalStorage();\r\n  }\r\n\r\n  // Helper method to cache HTTP requests\r\n  cacheRequest<T>(\r\n    key: string,\r\n    request: Observable<T>,\r\n    ttl: number = this.DEFAULT_TTL\r\n  ): Observable<T> {\r\n    const cached = this.get<T>(key);\r\n    if (cached) {\r\n      return of(cached);\r\n    }\r\n\r\n    return request.pipe(\r\n      tap((data) => this.set(key, data, ttl)),\r\n      catchError((error) => {\r\n        throw error;\r\n      })\r\n    );\r\n  }\r\n\r\n  // Cache player data with 30 minutes TTL\r\n  cachePlayerRequest<T>(key: string, request: Observable<T>): Observable<T> {\r\n    return this.cacheRequest(key, request, this.PLAYER_TTL);\r\n  }\r\n\r\n  // Cache league data with 30 minutes TTL\r\n  cacheLeagueRequest<T>(key: string, request: Observable<T>): Observable<T> {\r\n    return this.cacheRequest(key, request, this.LEAGUE_TTL);\r\n  }\r\n\r\n  // Cache rankings data with 30 minutes TTL\r\n  cacheRankingsRequest<T>(key: string, request: Observable<T>): Observable<T> {\r\n    return this.cacheRequest(key, request, this.RANKINGS_TTL);\r\n  }\r\n\r\n  // Cache all-leagues data with 30 minutes TTL and sort by creation date (newest first)\r\n  cacheAllLeaguesRequest<T>(\r\n    key: string,\r\n    request: Observable<T>\r\n  ): Observable<T> {\r\n    const cached = this.get<T>(key);\r\n    if (cached) {\r\n      return of(cached);\r\n    }\r\n\r\n    return request.pipe(\r\n      tap((data: any) => {\r\n        // Sort leagues by createdOn date (newest first) if it's an array\r\n        if (Array.isArray(data) && data.length > 0 && data[0].createdOn) {\r\n          const sortedData = [...data].sort((a, b) => {\r\n            const dateA = new Date(a.createdOn).getTime();\r\n            const dateB = new Date(b.createdOn).getTime();\r\n            return dateB - dateA; // Descending order (newest first)\r\n          });\r\n          this.set(key, sortedData, this.RANKINGS_TTL);\r\n        } else {\r\n          this.set(key, data, this.RANKINGS_TTL);\r\n        }\r\n      }),\r\n      catchError((error) => {\r\n        throw error;\r\n      })\r\n    );\r\n  }\r\n\r\n  // Invalidate cache for specific patterns\r\n  invalidatePattern(pattern: string): void {\r\n    for (const key of this.cache.keys()) {\r\n      if (key.includes(pattern)) {\r\n        this.cache.delete(key);\r\n      }\r\n    }\r\n    this.saveToLocalStorage();\r\n  }\r\n\r\n  // Get next update time for player data (every hour)\r\n  getNextPlayerUpdateTime(): Date {\r\n    const now = new Date();\r\n    const nextHour = new Date(\r\n      now.getFullYear(),\r\n      now.getMonth(),\r\n      now.getDate(),\r\n      now.getHours() + 1,\r\n      0,\r\n      0,\r\n      0\r\n    );\r\n    return nextHour;\r\n  }\r\n\r\n  // Get last update time for a specific key\r\n  getLastUpdateTime(key: string): Date | null {\r\n    const item = this.cache.get(key);\r\n    return item ? new Date(item.timestamp) : null;\r\n  }\r\n\r\n  // Check if cache is expired for a specific key\r\n  isCacheExpired(key: string): boolean {\r\n    const item = this.cache.get(key);\r\n    if (!item) return true;\r\n    return Date.now() - item.timestamp > item.ttl;\r\n  }\r\n\r\n  // Get cache expiry time for a specific key\r\n  getCacheExpiryTime(key: string): Date | null {\r\n    const item = this.cache.get(key);\r\n    if (!item) return null;\r\n    return new Date(item.timestamp + item.ttl);\r\n  }\r\n\r\n  // Force refresh cache for a specific key\r\n  forceRefresh<T>(\r\n    key: string,\r\n    request: Observable<T>,\r\n    ttl: number = this.DEFAULT_TTL\r\n  ): Observable<T> {\r\n    this.remove(key);\r\n    return this.cacheRequest(key, request, ttl);\r\n  }\r\n\r\n  // Check if cache should be refreshed based on current time (every 30 minutes)\r\n  shouldRefreshRankings(): boolean {\r\n    const lastUpdate = this.getLastUpdateTime('all-leagues-rank');\r\n    if (!lastUpdate) return true;\r\n\r\n    const minutesSinceUpdate =\r\n      (Date.now() - lastUpdate.getTime()) / (60 * 1000);\r\n    return minutesSinceUpdate >= 30;\r\n  }\r\n\r\n  // Check if current league cache should be refreshed\r\n  shouldRefreshCurrentLeague(): boolean {\r\n    const lastUpdate = this.getLastUpdateTime('current-league');\r\n    if (!lastUpdate) return true;\r\n\r\n    const minutesSinceUpdate =\r\n      (Date.now() - lastUpdate.getTime()) / (60 * 1000);\r\n    return minutesSinceUpdate >= 30;\r\n  }\r\n\r\n  private saveToLocalStorage(): void {\r\n    try {\r\n      const cacheData = Array.from(this.cache.entries());\r\n      localStorage.setItem('app_cache', JSON.stringify(cacheData));\r\n    } catch (error) {\r\n      // Silent error handling\r\n    }\r\n  }\r\n\r\n  private loadFromLocalStorage(): void {\r\n    try {\r\n      const cacheData = localStorage.getItem('app_cache');\r\n      if (cacheData) {\r\n        const entries = JSON.parse(cacheData);\r\n        this.cache = new Map(entries);\r\n\r\n        // Clean expired items\r\n        for (const [key, item] of this.cache.entries()) {\r\n          if (Date.now() - item.timestamp > item.ttl) {\r\n            this.cache.delete(key);\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      // Silent error handling\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { environment } from './../../../environments/environment';\r\nimport {\r\n  AllLeagueRank,\r\n  CommonResponse,\r\n  LeagueResponse,\r\n  StartLeagueDto,\r\n} from 'src/app/models/interfaces';\r\nimport { CacheService } from './cache.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class LeagueService {\r\n  private baseUrl = environment.apiUrl;\r\n\r\n  constructor(private http: HttpClient, private cacheService: CacheService) {}\r\n\r\n  resetLeague(LeagueId: number): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/league/reset/${LeagueId}`,\r\n      {}\r\n    );\r\n  }\r\n\r\n  startLeague(dto: StartLeagueDto): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(`${this.baseUrl}/league/start`, dto);\r\n  }\r\n\r\n  GetCurrentLeague(forceRefresh: boolean = false): Observable<LeagueResponse> {\r\n    const request = this.http.get<LeagueResponse>(\r\n      `${this.baseUrl}/league/getCurrentLeague`\r\n    );\r\n\r\n    if (forceRefresh || this.cacheService.shouldRefreshCurrentLeague()) {\r\n      return this.cacheService.forceRefresh(\r\n        'current-league',\r\n        request,\r\n        30 * 60 * 1000\r\n      );\r\n    }\r\n\r\n    return this.cacheService.cachePlayerRequest('current-league', request);\r\n  }\r\n\r\n  // Admin-specific method for current league without cache\r\n  getAdminCurrentLeague(): Observable<LeagueResponse> {\r\n    return this.http.get<LeagueResponse>(\r\n      `${this.baseUrl}/league/getCurrentLeague`\r\n    );\r\n  }\r\n\r\n  GetAllLeaguesRank(\r\n    forceRefresh: boolean = false\r\n  ): Observable<AllLeagueRank[]> {\r\n    const request = this.http.get<AllLeagueRank[]>(\r\n      `${this.baseUrl}/player/players/all`\r\n    );\r\n\r\n    if (forceRefresh || this.cacheService.shouldRefreshRankings()) {\r\n      return this.cacheService.forceRefresh(\r\n        'all-leagues-rank',\r\n        request,\r\n        30 * 60 * 1000\r\n      );\r\n    }\r\n\r\n    return this.cacheService.cacheAllLeaguesRequest(\r\n      'all-leagues-rank',\r\n      request\r\n    );\r\n  }\r\n\r\n  // Admin-specific method with 30-minute cache\r\n  getAdminAllLeagues(): Observable<AllLeagueRank[]> {\r\n    return this.http.get<AllLeagueRank[]>(`${this.baseUrl}/player/players/all`);\r\n  }\r\n\r\n  DeleteLeague(leagueId: number): Observable<CommonResponse> {\r\n    return this.http.delete<CommonResponse>(\r\n      `${this.baseUrl}/league/delete/${leagueId}`\r\n    );\r\n  }\r\n\r\n  createGroupsAndMatches(leagueId: number): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/league/${leagueId}/create-groups`,\r\n      {}\r\n    );\r\n  }\r\n\r\n  startKnockoutStage(leagueId: number): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/league/${leagueId}/start-knockouts`,\r\n      {}\r\n    );\r\n  }\r\n\r\n  startSemiFinals(leagueId: number): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/league/${leagueId}/start-semifinals`,\r\n      {}\r\n    );\r\n  }\r\n\r\n  startFinal(leagueId: number): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/league/${leagueId}/start-final`,\r\n      {}\r\n    );\r\n  }\r\n\r\n  // Get last update time for leagues rank\r\n  getLastLeaguesRankUpdateTime(): Date | null {\r\n    return this.cacheService.getLastUpdateTime('all-leagues-rank');\r\n  }\r\n\r\n  // Get last update time for current league\r\n  getLastCurrentLeagueUpdateTime(): Date | null {\r\n    return this.cacheService.getLastUpdateTime('current-league');\r\n  }\r\n\r\n  // Check if rankings cache is expired\r\n  isRankingsCacheExpired(): boolean {\r\n    return this.cacheService.isCacheExpired('all-leagues-rank');\r\n  }\r\n\r\n  // Check if current league cache is expired\r\n  isCurrentLeagueCacheExpired(): boolean {\r\n    return this.cacheService.isCacheExpired('current-league');\r\n  }\r\n\r\n  // Get next rankings update time\r\n  getNextRankingsUpdateTime(): Date | null {\r\n    return this.cacheService.getCacheExpiryTime('all-leagues-rank');\r\n  }\r\n\r\n  // Get next current league update time\r\n  getNextCurrentLeagueUpdateTime(): Date | null {\r\n    return this.cacheService.getCacheExpiryTime('current-league');\r\n  }\r\n\r\n  // Force refresh rankings data\r\n  forceRefreshRankings(): Observable<AllLeagueRank[]> {\r\n    return this.GetAllLeaguesRank(true);\r\n  }\r\n\r\n  // Force refresh current league data\r\n  forceRefreshCurrentLeague(): Observable<LeagueResponse> {\r\n    return this.GetCurrentLeague(true);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, tap } from 'rxjs';\r\nimport { environment } from './../../../environments/environment';\r\nimport { Match, ResultResponse } from 'src/app/models/interfaces';\r\nimport { PlayerService } from './player.service';\r\nimport { CacheService } from './cache.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class MatchService {\r\n  private baseUrl = environment.apiUrl;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private playerService: PlayerService,\r\n    private cacheService: CacheService\r\n  ) {}\r\n\r\n  getMatches(): Observable<Match[]> {\r\n    return this.cacheService.cachePlayerRequest(\r\n      'current-matches',\r\n      this.http.get<Match[]>(`${this.baseUrl}/match`)\r\n    );\r\n  }\r\n\r\n  // Admin-specific method - now same as regular method\r\n  getAdminMatches(): Observable<Match[]> {\r\n    return this.http.get<Match[]>(`${this.baseUrl}/match`);\r\n  }\r\n\r\n  updateMatch(\r\n    matchId: number,\r\n    winnerId: number | null\r\n  ): Observable<ResultResponse> {\r\n    return this.http\r\n      .post<ResultResponse>(`${this.baseUrl}/match/${matchId}/result`, {\r\n        winnerId,\r\n      })\r\n      .pipe(\r\n        tap(() => {\r\n          this.playerService.refreshPlayers();\r\n        })\r\n      );\r\n  }\r\n\r\n  resetMatch(matchId: number): Observable<ResultResponse> {\r\n    return this.http\r\n      .delete<ResultResponse>(`${this.baseUrl}/match/reset/${matchId}`)\r\n      .pipe(\r\n        tap(() => {\r\n          this.playerService.refreshPlayers();\r\n        })\r\n      );\r\n  }\r\n\r\n  // Get last update time for current matches\r\n  getLastMatchesUpdateTime(): Date | null {\r\n    return this.cacheService.getLastUpdateTime('current-matches');\r\n  }\r\n}\r\n","import { environment } from './../../../environments/environment';\r\nimport { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { CommonResponse, MessagesResponse } from 'src/app/models/interfaces';\r\nimport { CacheService } from './cache.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class MessageService {\r\n  private baseUrl = environment.apiUrl;\r\n\r\n  constructor(private http: HttpClient, private cacheService: CacheService) {}\r\n\r\n  sendMessage(message: string): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(`${this.baseUrl}/Message/send`, {\r\n      Content: message,\r\n    });\r\n  }\r\n\r\n  getMessages(): Observable<MessagesResponse> {\r\n    return this.http.get<MessagesResponse>(`${this.baseUrl}/Message/inbox`);\r\n  }\r\n\r\n  // Admin-specific method - now loads fresh data immediately without caching\r\n  getAdminMessages(): Observable<MessagesResponse> {\r\n    return this.http.get<MessagesResponse>(`${this.baseUrl}/Message/inbox`);\r\n  }\r\n\r\n  toggleMarkMessage(\r\n    messageId: number,\r\n    marked: boolean\r\n  ): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/Message/mark/${messageId}`,\r\n      { Marked: marked }\r\n    );\r\n  }\r\n\r\n  toggleDeleteMessage(\r\n    messageId: number,\r\n    marked: boolean\r\n  ): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/Message/delete/${messageId}`,\r\n      { Marked: marked }\r\n    );\r\n  }\r\n\r\n  getPlayerMessages(): Observable<MessagesResponse> {\r\n    return this.http.get<MessagesResponse>(\r\n      `${this.baseUrl}/Message/my-messages`\r\n    );\r\n  }\r\n\r\n  sendAdminReply(\r\n    playerId: string,\r\n    message: string\r\n  ): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/Message/reply/${playerId}`,\r\n      { Content: message }\r\n    );\r\n  }\r\n}\r\n","import { environment } from './../../../environments/environment';\r\nimport { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { CommonResponse, NoteResponse } from 'src/app/models/interfaces';\r\nimport { CacheService } from './cache.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class NoteService {\r\n  private baseUrl = environment.apiUrl;\r\n\r\n  constructor(private http: HttpClient, private cacheService: CacheService) {}\r\n\r\n  sendNote(message: string): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(`${this.baseUrl}/note/write`, {\r\n      Content: message,\r\n    });\r\n  }\r\n\r\n  getNotes(): Observable<NoteResponse> {\r\n    return this.http.get<NoteResponse>(`${this.baseUrl}/note/notes`);\r\n  }\r\n\r\n  // Admin-specific method with 30-minute cache\r\n  getAdminNotes(): Observable<NoteResponse> {\r\n    return this.http.get<NoteResponse>(`${this.baseUrl}/note/notes`);\r\n  }\r\n\r\n  toggleMarHide(noteId: number, marked: boolean): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/note/hide/${noteId}`,\r\n      { Marked: marked }\r\n    );\r\n  }\r\n\r\n  DeleteNote(noteId: number, marked: boolean): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/note/delete/${noteId}`,\r\n      { Marked: marked }\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { BehaviorSubject, Observable, tap } from 'rxjs';\r\nimport { environment } from 'src/environments/environment';\r\nimport { CommonResponse } from 'src/app/models/interfaces';\r\nimport { CacheService } from './cache.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class PlayerService {\r\n  private baseUrl = environment.apiUrl;\r\n\r\n  private rankingSubject = new BehaviorSubject<[]>([]);\r\n  ranking$ = this.rankingSubject.asObservable();\r\n\r\n  constructor(private http: HttpClient, private cacheService: CacheService) {}\r\n\r\n  getrank(): Observable<[]> {\r\n    return this.cacheService.cachePlayerRequest(\r\n      'player-ranking',\r\n      this.http\r\n        .get<[]>(`${this.baseUrl}/player/ranking`)\r\n        .pipe(tap((data) => this.rankingSubject.next(data)))\r\n    );\r\n  }\r\n\r\n  getPlayers(): Observable<[]> {\r\n    return this.cacheService.cachePlayerRequest(\r\n      'players-list',\r\n      this.http\r\n        .get<[]>(`${this.baseUrl}/player`)\r\n        .pipe(tap((data) => this.rankingSubject.next(data)))\r\n    );\r\n  }\r\n\r\n  // Admin-specific method with 30-minute cache\r\n  getAdminPlayers(): Observable<[]> {\r\n    return this.http\r\n      .get<[]>(`${this.baseUrl}/player`)\r\n      .pipe(tap((data) => this.rankingSubject.next(data)));\r\n  }\r\n\r\n  addPlayer(fullName: string): Observable<CommonResponse> {\r\n    return this.http\r\n      .post<CommonResponse>(`${this.baseUrl}/player`, { fullName })\r\n      .pipe(\r\n        tap(() => {\r\n          this.cacheService.invalidatePattern('player');\r\n          this.refreshPlayers();\r\n        })\r\n      );\r\n  }\r\n\r\n  deletePlayer(playerId: number): Observable<CommonResponse> {\r\n    return this.http\r\n      .delete<CommonResponse>(`${this.baseUrl}/player/${playerId}`)\r\n      .pipe(\r\n        tap(() => {\r\n          this.cacheService.invalidatePattern('player');\r\n          this.refreshPlayers();\r\n        })\r\n      );\r\n  }\r\n\r\n  refreshRanking() {\r\n    this.cacheService.remove('player-ranking');\r\n    this.http.get<[]>(`${this.baseUrl}/player/ranking`).subscribe((data) => {\r\n      this.rankingSubject.next(data);\r\n    });\r\n  }\r\n\r\n  refreshPlayers() {\r\n    this.cacheService.remove('players-list');\r\n    this.http.get<[]>(`${this.baseUrl}/player`).subscribe((data) => {\r\n      this.rankingSubject.next(data);\r\n    });\r\n  }\r\n\r\n  // Get next update time\r\n  getNextUpdateTime(): Date {\r\n    return this.cacheService.getNextPlayerUpdateTime();\r\n  }\r\n\r\n  // Get last update time for ranking\r\n  getLastRankingUpdateTime(): Date | null {\r\n    return this.cacheService.getLastUpdateTime('player-ranking');\r\n  }\r\n\r\n  // Get last update time for players list\r\n  getLastPlayersUpdateTime(): Date | null {\r\n    return this.cacheService.getLastUpdateTime('players-list');\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { InboxComponent } from '../admin/inbox/inbox.component';\r\nimport { FloatingInboxComponent } from './floating-inbox/floating-inbox.component';\r\nimport { MessageService } from '../core/services/message.service';\r\nimport { AdminDashboardService } from '../core/services/admin-dashboard.service';\r\n\r\n@NgModule({\r\n  declarations: [InboxComponent, FloatingInboxComponent],\r\n  imports: [CommonModule, FormsModule],\r\n  exports: [InboxComponent, FloatingInboxComponent],\r\n  providers: [MessageService, AdminDashboardService],\r\n})\r\nexport class SharedModule {}\r\n","var api = 'https://yugiapp.runasp.net/api';\r\n\r\n// api = 'https://localhost:7144/api';\r\n\r\nexport const environment = {\r\n  production: false,\r\n\r\n  apiUrl: api,\r\n};\r\n","import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { authGuard } from './core/guards/auth.guard';\r\n\r\nconst routes: Routes = [\r\n  { path: '', redirectTo: 'player', pathMatch: 'full' },\r\n  {\r\n    path: 'player',\r\n    loadChildren: () =>\r\n      import('./player/player.module').then((m) => m.PlayerModule),\r\n    data: { title: 'Players' },\r\n  },\r\n  {\r\n    path: 'auth',\r\n    loadChildren: () => import('./auth/auth.module').then((m) => m.AuthModule),\r\n    data: { title: 'Auth' },\r\n  },\r\n  {\r\n    path: 'admin',\r\n    loadChildren: () =>\r\n      import('./admin/admin.module').then((m) => m.AdminModule),\r\n    canActivate: [authGuard],\r\n    data: { title: 'Admin' },\r\n  },\r\n  { path: '**', redirectTo: 'player' },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forRoot(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class AppRoutingModule {}\r\n","import { CanActivateFn } from '@angular/router';\r\nimport { inject } from '@angular/core';\r\nimport { AuthService } from '../services/auth.service';\r\n\r\nexport const authGuard: CanActivateFn = (route, state) => {\r\n  const authService = inject(AuthService);\r\n  const token = localStorage.getItem('token');\r\n  \r\n  return !!token;\r\n};\r\n","import { Injectable } from '@angular/core';\r\nimport { Title } from '@angular/platform-browser';\r\nimport { Router, NavigationEnd, ActivatedRoute } from '@angular/router';\r\nimport { filter } from 'rxjs/operators';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class TitleStrategyService {\r\n  private readonly defaultTitle = 'Yugi-Oh Tournament';\r\n\r\n  constructor(private title: Title, private router: Router) {\r\n    console.log('TitleStrategyService initialized');\r\n    // Set initial title\r\n    this.title.setTitle(this.defaultTitle);\r\n    this.setupTitleUpdates();\r\n  }\r\n\r\n  private setupTitleUpdates(): void {\r\n    console.log('Setting up title updates');\r\n    this.router.events\r\n      .pipe(filter((event) => event instanceof NavigationEnd))\r\n      .subscribe((event) => {\r\n        console.log('NavigationEnd event:', event);\r\n        // Add a small delay to ensure route data is available\r\n        setTimeout(() => {\r\n          this.updateTitle();\r\n        }, 50);\r\n      });\r\n  }\r\n\r\n  private updateTitle(): void {\r\n    console.log('Updating title...');\r\n    const currentRoute = this.getCurrentRoute();\r\n    console.log('Current route:', currentRoute);\r\n    console.log('Current route data:', currentRoute?.snapshot?.data);\r\n\r\n    if (currentRoute?.snapshot?.data?.['title']) {\r\n      const newTitle = currentRoute.snapshot.data['title'];\r\n      console.log('Setting title to:', newTitle);\r\n      this.title.setTitle(newTitle);\r\n    } else {\r\n      console.log('Setting default title:', this.defaultTitle);\r\n      this.title.setTitle(this.defaultTitle);\r\n    }\r\n  }\r\n\r\n  private getCurrentRoute(): any {\r\n    let route = this.router.routerState.root;\r\n\r\n    // Navigate through all child routes to find the deepest one\r\n    while (route.firstChild) {\r\n      route = route.firstChild;\r\n    }\r\n\r\n    // Also check the current activated route for additional data\r\n    let currentActivatedRoute = this.router.routerState.root;\r\n    while (currentActivatedRoute.firstChild) {\r\n      currentActivatedRoute = currentActivatedRoute.firstChild;\r\n    }\r\n\r\n    console.log('Final route:', route);\r\n    console.log('Current activated route:', currentActivatedRoute);\r\n\r\n    // Try to get title from the deepest route first\r\n    if (route?.snapshot?.data?.['title']) {\r\n      return route;\r\n    }\r\n\r\n    // If no title in deepest route, check the activated route\r\n    if (currentActivatedRoute?.snapshot?.data?.['title']) {\r\n      return currentActivatedRoute;\r\n    }\r\n\r\n    // If still no title, return the deepest route\r\n    return route;\r\n  }\r\n\r\n  setTitle(title: string): void {\r\n    if (title) {\r\n      const newTitle = title;\r\n      console.log('Manual title set to:', newTitle);\r\n      this.title.setTitle(newTitle);\r\n    } else {\r\n      console.log('Setting default title:', this.defaultTitle);\r\n      this.title.setTitle(this.defaultTitle);\r\n    }\r\n  }\r\n}\r\n","<!-- Floating Admin Inbox Button (Draggable) -->\r\n<div\r\n  *ngIf=\"isAdmin\"\r\n  class=\"fixed z-50 cursor-pointer select-none\"\r\n  [style.left.px]=\"buttonPosition.x\"\r\n  [style.top.px]=\"buttonPosition.y\"\r\n  [class.dragging]=\"isDragging\"\r\n  (mousedown)=\"onButtonMouseDown($event)\"\r\n  (touchstart)=\"onButtonTouchStart($event)\"\r\n  (click)=\"toggleInboxOverlay()\"\r\n>\r\n  <div\r\n    class=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center hover:scale-110 floating-button relative group border-2 border-blue-400\"\r\n    [class.shadow-2xl]=\"isDragging\"\r\n  >\r\n    <i class=\"fa-solid fa-comments text-lg text-white\"></i>\r\n\r\n    <!-- Tooltip -->\r\n    <div\r\n      class=\"absolute bottom-full right-0 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap pointer-events-none tooltip\"\r\n    >\r\n      Admin Inbox (Drag to move)\r\n      <div\r\n        class=\"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"\r\n      ></div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<!-- Inbox Component Overlay -->\r\n<div\r\n  *ngIf=\"isAdmin && showInboxOverlay\"\r\n  class=\"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center pt-[50px] sm:p-4\"\r\n  (click)=\"closeInboxOverlay()\"\r\n>\r\n  <div\r\n    class=\"bg-gray-900 rounded-lg shadow-2xl overflow-hidden overlay-enter\"\r\n    (click)=\"$event.stopPropagation()\"\r\n    style=\"\r\n      min-width: 320px;\r\n      min-height: 500px;\r\n      max-width: 90vw;\r\n      max-height: 90vh;\r\n    \"\r\n  >\r\n    <!-- Overlay Header -->\r\n    <div\r\n      class=\"bg-gray-800 p-4 border-b border-gray-600 flex items-center justify-between\"\r\n    >\r\n      <div class=\"flex items-center\">\r\n        <i class=\"fa-solid fa-inbox text-white mr-3 text-xl\"></i>\r\n        <h2 class=\"text-xl font-bold text-white\">Admin Inbox</h2>\r\n      </div>\r\n      <button\r\n        (click)=\"closeInboxOverlay()\"\r\n        class=\"text-gray-400 hover:text-white transition-colors p-2 rounded-lg hover:bg-gray-700\"\r\n        title=\"Close\"\r\n      >\r\n        <i class=\"fa-solid fa-times text-xl\"></i>\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Inbox Component Container -->\r\n    <div class=\"h-full overflow-hidden\">\r\n      <!-- Chat List View -->\r\n      <div *ngIf=\"!selectedChat\" class=\"h-full flex flex-col\">\r\n        <!-- Header with refresh button -->\r\n        <div\r\n          class=\"bg-gray-700 p-3 border-b border-gray-600 flex justify-between items-center\"\r\n        >\r\n          <h3 class=\"text-white font-semibold\">المحادثات</h3>\r\n          <button\r\n            (click)=\"refreshMessages()\"\r\n            class=\"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors\"\r\n            title=\"تحديث\"\r\n          >\r\n            <i class=\"fa-solid fa-refresh mr-1\"></i>\r\n            تحديث\r\n          </button>\r\n        </div>\r\n\r\n        <!-- Chat List with Scroll -->\r\n        <div class=\"flex-1 overflow-y-auto p-2 max-h-96\">\r\n          <div\r\n            *ngFor=\"let chat of playerChats\"\r\n            (click)=\"selectChat(chat)\"\r\n            class=\"bg-gray-800 hover:bg-gray-700 rounded-lg p-3 mb-2 cursor-pointer transition-colors border-l-4 border-transparent hover:border-blue-500\"\r\n          >\r\n            <div class=\"flex justify-between items-start\">\r\n              <div class=\"flex-1\">\r\n                <h4 class=\"text-white font-medium text-sm\">\r\n                  {{ chat.playerFullName }}\r\n                </h4>\r\n                <p class=\"text-gray-300 text-xs mt-1 truncate\">\r\n                  {{ chat.lastMessage }}\r\n                </p>\r\n                <p class=\"text-gray-400 text-xs mt-1\">\r\n                  {{ chat.lastMessageDate | date : \"short\" }}\r\n                </p>\r\n              </div>\r\n              <div\r\n                *ngIf=\"chat.unreadCount > 0\"\r\n                class=\"bg-red-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center\"\r\n              >\r\n                {{ chat.unreadCount }}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Chat View -->\r\n      <div *ngIf=\"selectedChat\" class=\"h-full flex flex-col\">\r\n        <!-- Chat Header -->\r\n        <div class=\"bg-gray-700 px-2 border-b border-gray-600 flex items-center\">\r\n          <button\r\n            (click)=\"goBack()\"\r\n            class=\"text-gray-400 hover:text-white mr-3 transition-colors\"\r\n            title=\"رجوع\"\r\n          >\r\n            <i class=\"fa-solid fa-arrow-left text-lg\"></i>\r\n          </button>\r\n          <h3 class=\"text-white text-sm font-semibold\">\r\n            {{ selectedChat.playerFullName }}\r\n          </h3>\r\n        </div>\r\n\r\n        <!-- Messages Container with Scroll -->\r\n        <div\r\n          class=\"flex-1 overflow-y-auto p-3 space-y-3 max-h-80 flex flex-col-reverse\"\r\n          #messagesContainer\r\n        >\r\n          <div\r\n            *ngFor=\"\r\n              let message of selectedChat.messages;\r\n              trackBy: trackByMessageId\r\n            \"\r\n            class=\"mb-4\"\r\n            [ngClass]=\"{\r\n              'text-right': !message.isFromAdmin,\r\n              'text-left': message.isFromAdmin\r\n            }\"\r\n          >\r\n            <div\r\n              class=\"inline-block p-3 rounded-lg max-w-xs\"\r\n              [ngClass]=\"{\r\n                'bg-green-700': !message.isFromAdmin,\r\n                'bg-gray-700': message.isFromAdmin\r\n              }\"\r\n            >\r\n              <p class=\"text-white text-sm\">{{ message.content }}</p>\r\n              <p class=\"text-xs mt-1 text-gray-300\">\r\n                {{ message.sentAt | date : \"MMM d, y, hh:mm a\" }}\r\n              </p>\r\n\r\n              <!-- Message Actions (only mark as read for admin messages) -->\r\n              <div\r\n                *ngIf=\"message.isFromAdmin && !message.isRead\"\r\n                class=\"flex justify-end items-center mt-2\"\r\n              >\r\n                <button\r\n                  (click)=\"markAsRead(message.id)\"\r\n                  class=\"text-green-400 hover:text-green-300 text-xs transition-colors\"\r\n                  title=\"تحديد كمقروءة\"\r\n                >\r\n                  <i class=\"fa-solid fa-check mr-1\"></i>\r\n                  تحديد كمقروءة\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Fixed Reply Input at Bottom -->\r\n        <div class=\"bg-gray-700 p-3 border-t border-gray-600\">\r\n          <div class=\"flex items-center space-x-2 rtl:space-x-reverse\">\r\n            <input\r\n              type=\"text\"\r\n              [(ngModel)]=\"replyText\"\r\n              placeholder=\"اكتب ردك هنا...\"\r\n              class=\"flex-1 bg-gray-600 text-white text-sm px-3 py-2 rounded border border-gray-500 focus:border-blue-500 focus:outline-none\"\r\n              (keyup.enter)=\"sendReply(selectedChat.playerId)\"\r\n            />\r\n            <button\r\n              (click)=\"sendReply(selectedChat.playerId)\"\r\n              class=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm transition-colors\"\r\n              title=\"إرسال\"\r\n            >\r\n              <i class=\"fa-solid fa-paper-plane mr-1\"></i>\r\n              إرسال\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n","import { Component, OnInit, OnDestroy, HostListener } from '@angular/core';\r\nimport { AuthService } from '../../core/services/auth.service';\r\nimport { MessageService } from '../../core/services/message.service';\r\nimport { AdminDashboardService } from '../../core/services/admin-dashboard.service';\r\nimport { ToastrService } from 'ngx-toastr';\r\nimport { ChangeDetectorRef } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\ninterface PlayerChat {\r\n  playerId: string;\r\n  playerFullName: string;\r\n  lastMessage: string;\r\n  lastMessageDate: string;\r\n  unreadCount: number;\r\n  messages: any[];\r\n}\r\n\r\n@Component({\r\n  selector: 'app-floating-inbox',\r\n  templateUrl: './floating-inbox.component.html',\r\n  styleUrls: ['./floating-inbox.component.css'],\r\n})\r\nexport class FloatingInboxComponent implements OnInit, OnDestroy {\r\n  // Floating button properties\r\n  isAdmin = false;\r\n  showInboxOverlay = false;\r\n  buttonPosition = { x: 20, y: 100 };\r\n  isDragging = false;\r\n  dragOffset = { x: 0, y: 0 };\r\n  hasMovedDuringDrag = false;\r\n  unreadCount = 0;\r\n\r\n  // Inbox properties\r\n  playerChats: PlayerChat[] = [];\r\n  selectedPlayerId: string | null = null;\r\n  selectedChat: PlayerChat | null = null;\r\n  replyText = ''; // New property for single reply input\r\n  navbarHeight = 60;\r\n\r\n  private updateStatusSubscription?: Subscription;\r\n  private refreshSubscription?: Subscription;\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private messageService: MessageService,\r\n    private toastr: ToastrService,\r\n    private cdr: ChangeDetectorRef,\r\n    private adminDashboardService: AdminDashboardService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.checkAdminStatus();\r\n    this.setInitialButtonPosition();\r\n    if (this.isAdmin) {\r\n      this.loadAdminMessages();\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.isDragging = false;\r\n    this.showInboxOverlay = false;\r\n    document.body.style.cursor = 'default';\r\n    document.body.classList.remove('dragging');\r\n\r\n    if (this.updateStatusSubscription) {\r\n      this.updateStatusSubscription.unsubscribe();\r\n    }\r\n    if (this.refreshSubscription) {\r\n      this.refreshSubscription.unsubscribe();\r\n    }\r\n\r\n    document.removeEventListener(\r\n      'mousemove',\r\n      this.onGlobalMouseMove.bind(this)\r\n    );\r\n    document.removeEventListener('mouseup', this.onGlobalMouseUp.bind(this));\r\n  }\r\n\r\n  checkAdminStatus(): void {\r\n    try {\r\n      const role = this.authService.getRole();\r\n      this.isAdmin = role === 'Admin';\r\n    } catch (error) {\r\n      console.warn('Error checking admin status:', error);\r\n      this.isAdmin = false;\r\n    }\r\n  }\r\n\r\n  toggleInboxOverlay(): void {\r\n    if (!this.isDragging && !this.hasMovedDuringDrag) {\r\n      this.showInboxOverlay = !this.showInboxOverlay;\r\n\r\n      if (this.showInboxOverlay) {\r\n        this.loadAdminMessages();\r\n        setTimeout(() => {\r\n          this.fixInboxComponentForOverlay();\r\n        }, 100);\r\n      }\r\n    }\r\n  }\r\n\r\n  closeInboxOverlay(): void {\r\n    this.showInboxOverlay = false;\r\n  }\r\n\r\n  fixInboxComponentForOverlay(): void {\r\n    const inboxElement = document.querySelector(\r\n      '.overlay-enter app-floating-inbox'\r\n    );\r\n    if (inboxElement) {\r\n      const elementsWithMarginTop = inboxElement.querySelectorAll(\r\n        '[style*=\"margin-top\"]'\r\n      );\r\n      elementsWithMarginTop.forEach((el: any) => {\r\n        el.style.marginTop = '0px';\r\n      });\r\n\r\n      const elementsWithTop = inboxElement.querySelectorAll('[style*=\"top\"]');\r\n      elementsWithTop.forEach((el: any) => {\r\n        el.style.top = '0px';\r\n      });\r\n    }\r\n  }\r\n\r\n  setInitialButtonPosition(): void {\r\n    const savedPosition = localStorage.getItem('floatingInboxButtonPosition');\r\n\r\n    if (savedPosition) {\r\n      try {\r\n        const parsedPosition = JSON.parse(savedPosition);\r\n        const margin = 24;\r\n        const buttonSize = 48;\r\n        const maxX = window.innerWidth - buttonSize - margin;\r\n        const maxY = window.innerHeight - buttonSize - margin;\r\n\r\n        if (\r\n          parsedPosition.x >= margin &&\r\n          parsedPosition.x <= maxX &&\r\n          parsedPosition.y >= margin &&\r\n          parsedPosition.y <= maxY\r\n        ) {\r\n          this.buttonPosition = parsedPosition;\r\n          return;\r\n        }\r\n      } catch (error) {\r\n        console.warn('Error parsing saved button position:', error);\r\n      }\r\n    }\r\n\r\n    const margin = 24;\r\n    const buttonSize = 48;\r\n    const maxX = window.innerWidth - buttonSize - margin;\r\n    const maxY = window.innerHeight - buttonSize - margin;\r\n\r\n    this.buttonPosition = {\r\n      x: Math.max(margin, maxX),\r\n      y: Math.max(margin, maxY),\r\n    };\r\n  }\r\n\r\n  // Dragging functionality\r\n  onButtonMouseDown(event: MouseEvent): void {\r\n    this.isDragging = true;\r\n    this.hasMovedDuringDrag = false;\r\n    this.dragOffset = {\r\n      x: event.clientX - this.buttonPosition.x,\r\n      y: event.clientY - this.buttonPosition.y,\r\n    };\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    document.body.style.cursor = 'grabbing';\r\n    document.body.classList.add('dragging');\r\n  }\r\n\r\n  onButtonTouchStart(event: TouchEvent): void {\r\n    this.isDragging = true;\r\n    this.hasMovedDuringDrag = false;\r\n\r\n    const touch = event.touches[0];\r\n    this.dragOffset = {\r\n      x: touch.clientX - this.buttonPosition.x,\r\n      y: touch.clientY - this.buttonPosition.y,\r\n    };\r\n\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    document.body.style.cursor = 'grabbing';\r\n    document.body.classList.add('dragging');\r\n  }\r\n\r\n  @HostListener('document:mousemove', ['$event'])\r\n  onGlobalMouseMove(event: MouseEvent): void {\r\n    if (this.isDragging) {\r\n      requestAnimationFrame(() => {\r\n        const newX = event.clientX - this.dragOffset.x;\r\n        const newY = event.clientY - this.dragOffset.y;\r\n\r\n        const oldX = this.buttonPosition.x;\r\n        const oldY = this.buttonPosition.y;\r\n\r\n        const margin = 24;\r\n        const buttonSize = 48;\r\n        const maxX = window.innerWidth - buttonSize - margin;\r\n        const maxY = window.innerHeight - buttonSize - margin;\r\n\r\n        const finalX = Math.max(margin, Math.min(newX, maxX));\r\n        const finalY = Math.max(margin, Math.min(newY, maxY));\r\n\r\n        if (Math.abs(finalX - oldX) > 5 || Math.abs(finalY - oldY) > 5) {\r\n          this.hasMovedDuringDrag = true;\r\n        }\r\n\r\n        this.buttonPosition = {\r\n          x: finalX,\r\n          y: finalY,\r\n        };\r\n\r\n        this.saveButtonPosition();\r\n      });\r\n    }\r\n  }\r\n\r\n  @HostListener('document:touchmove', ['$event'])\r\n  onGlobalTouchMove(event: TouchEvent): void {\r\n    if (this.isDragging) {\r\n      requestAnimationFrame(() => {\r\n        const touch = event.touches[0];\r\n        const newX = touch.clientX - this.dragOffset.x;\r\n        const newY = touch.clientY - this.dragOffset.y;\r\n\r\n        const oldX = this.buttonPosition.x;\r\n        const oldY = this.buttonPosition.y;\r\n\r\n        const margin = 24;\r\n        const buttonSize = 48;\r\n        const maxX = window.innerWidth - buttonSize - margin;\r\n        const maxY = window.innerHeight - buttonSize - margin;\r\n\r\n        const finalX = Math.max(margin, Math.min(newX, maxX));\r\n        const finalY = Math.max(margin, Math.min(newY, maxY));\r\n\r\n        if (Math.abs(finalX - oldX) > 5 || Math.abs(finalY - oldY) > 5) {\r\n          this.hasMovedDuringDrag = true;\r\n        }\r\n\r\n        this.buttonPosition = {\r\n          x: finalX,\r\n          y: finalY,\r\n        };\r\n\r\n        this.saveButtonPosition();\r\n      });\r\n    }\r\n  }\r\n\r\n  @HostListener('document:mouseup')\r\n  onGlobalMouseUp(): void {\r\n    if (this.isDragging) {\r\n      this.isDragging = false;\r\n      document.body.style.cursor = 'default';\r\n      document.body.classList.remove('dragging');\r\n\r\n      setTimeout(() => {\r\n        this.hasMovedDuringDrag = false;\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  @HostListener('document:touchend')\r\n  onGlobalTouchEnd(): void {\r\n    if (this.isDragging) {\r\n      this.isDragging = false;\r\n      document.body.style.cursor = 'default';\r\n      document.body.classList.remove('dragging');\r\n\r\n      setTimeout(() => {\r\n        this.hasMovedDuringDrag = false;\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  @HostListener('window:resize')\r\n  onWindowResize(): void {\r\n    const margin = 24;\r\n    const buttonSize = 48;\r\n    const maxX = window.innerWidth - buttonSize - margin;\r\n    const maxY = window.innerHeight - buttonSize - margin;\r\n\r\n    this.buttonPosition = {\r\n      x: Math.max(margin, Math.min(this.buttonPosition.x, maxX)),\r\n      y: Math.max(margin, Math.min(this.buttonPosition.y, maxY)),\r\n    };\r\n  }\r\n\r\n  @HostListener('document:keydown.escape')\r\n  onEscapeKey(): void {\r\n    if (this.showInboxOverlay) {\r\n      this.showInboxOverlay = false;\r\n    }\r\n  }\r\n\r\n  private saveButtonPosition(): void {\r\n    try {\r\n      localStorage.setItem(\r\n        'floatingInboxButtonPosition',\r\n        JSON.stringify(this.buttonPosition)\r\n      );\r\n    } catch (error) {\r\n      console.warn('Error saving button position to localStorage:', error);\r\n    }\r\n  }\r\n\r\n  // Inbox functionality\r\n  private loadAdminMessages(): void {\r\n    this.loadFromServer();\r\n  }\r\n\r\n  private loadFromCache(): void {\r\n    this.loadFromServer();\r\n  }\r\n\r\n  private loadFromServer(): void {\r\n    this.adminDashboardService.getSecondaryData('messages').subscribe({\r\n      next: (messages) => {\r\n        if (messages && messages.length > 0) {\r\n          const groupedMessages = this.groupMessagesBySender(messages);\r\n          this.playerChats = groupedMessages.sort(\r\n            (a, b) =>\r\n              new Date(b.lastMessageDate).getTime() -\r\n              new Date(a.lastMessageDate).getTime()\r\n          );\r\n        } else {\r\n          this.toastr.error('لا يوجد رسائل');\r\n        }\r\n      },\r\n      error: (err) => {\r\n        this.toastr.error(err.message);\r\n      },\r\n    });\r\n  }\r\n\r\n  refreshMessages(): void {\r\n    this.messageService.getAdminMessages().subscribe({\r\n      next: (response) => {\r\n        if (response && response.messages) {\r\n          const groupedMessages = this.groupMessagesBySender(response.messages);\r\n          this.playerChats = groupedMessages.sort(\r\n            (a, b) =>\r\n              new Date(b.lastMessageDate).getTime() -\r\n              new Date(a.lastMessageDate).getTime()\r\n          );\r\n        } else {\r\n          this.toastr.error('لا يوجد رسائل');\r\n        }\r\n      },\r\n      error: (err) => {\r\n        this.toastr.error(err.message);\r\n      },\r\n    });\r\n  }\r\n\r\n  selectChat(chat: PlayerChat): void {\r\n    this.selectedChat = chat;\r\n    this.selectedPlayerId = chat.playerId;\r\n    this.loadChatMessages(chat.playerId);\r\n\r\n    // Scroll to bottom after selecting chat\r\n    setTimeout(() => {\r\n      this.scrollToBottom();\r\n    }, 100);\r\n  }\r\n\r\n  private loadChatMessages(playerId: string): void {\r\n    // Load chat messages for specific player\r\n    this.messageService.getAdminMessages().subscribe({\r\n      next: (response) => {\r\n        if (response && response.messages) {\r\n          const playerMessages = response.messages.filter(\r\n            (msg: any) => msg.senderId === playerId\r\n          );\r\n\r\n          // Sort messages by date (newest first) so they appear from bottom\r\n          playerMessages.sort(\r\n            (a: any, b: any) =>\r\n              new Date(b.sentAt).getTime() - new Date(a.sentAt).getTime()\r\n          );\r\n\r\n          this.selectedChat!.messages = playerMessages;\r\n\r\n          // Scroll to bottom after messages load to show latest message\r\n          setTimeout(() => {\r\n            this.scrollToBottom();\r\n          }, 100);\r\n        }\r\n      },\r\n      error: (err) => {\r\n        this.toastr.error(err.message);\r\n      },\r\n    });\r\n  }\r\n\r\n  private scrollToTop(): void {\r\n    const messagesContainer = document.querySelector('#messagesContainer');\r\n    if (messagesContainer) {\r\n      messagesContainer.scrollTop = 0;\r\n    }\r\n  }\r\n\r\n  private scrollToBottom(): void {\r\n    const messagesContainer = document.querySelector('#messagesContainer');\r\n    if (messagesContainer) {\r\n      messagesContainer.scrollTop = messagesContainer.scrollHeight;\r\n    }\r\n  }\r\n\r\n  private groupMessagesBySender(messages: any[]): PlayerChat[] {\r\n    const chatMap = new Map<string, PlayerChat>();\r\n\r\n    messages.forEach((message) => {\r\n      const senderId = message.senderId;\r\n      if (!chatMap.has(senderId)) {\r\n        chatMap.set(senderId, {\r\n          playerId: senderId,\r\n          playerFullName: message.senderFullName,\r\n          lastMessage: message.content,\r\n          lastMessageDate: message.sentAt,\r\n          unreadCount: message.isRead ? 0 : 1,\r\n          messages: [message],\r\n        });\r\n      } else {\r\n        const chat = chatMap.get(senderId)!;\r\n        chat.messages.push(message);\r\n\r\n        if (new Date(message.sentAt) > new Date(chat.lastMessageDate)) {\r\n          chat.lastMessage = message.content;\r\n          chat.lastMessageDate = message.sentAt;\r\n        }\r\n\r\n        if (!message.isRead) {\r\n          chat.unreadCount++;\r\n        }\r\n      }\r\n    });\r\n\r\n    return Array.from(chatMap.values());\r\n  }\r\n\r\n  sendReply(playerId: string): void {\r\n    if (!this.replyText || this.replyText.trim() === '') {\r\n      this.toastr.error('يرجى كتابة رد');\r\n      return;\r\n    }\r\n\r\n    this.messageService.sendAdminReply(playerId, this.replyText).subscribe({\r\n      next: (response: any) => {\r\n        if (response.success) {\r\n          this.toastr.success('تم إرسال الرد بنجاح');\r\n          this.replyText = ''; // Clear the input\r\n          this.loadAdminMessages();\r\n          this.cdr.detectChanges();\r\n\r\n          // Scroll to bottom after sending reply\r\n          setTimeout(() => {\r\n            this.scrollToBottom();\r\n          }, 100);\r\n        } else {\r\n          this.toastr.error(response.message || 'فشل في إرسال الرد');\r\n        }\r\n      },\r\n      error: (err: any) => {\r\n        this.toastr.error(err.message || 'فشل في إرسال الرد');\r\n      },\r\n    });\r\n  }\r\n\r\n  markAsRead(messageId: number): void {\r\n    this.messageService.toggleMarkMessage(messageId, true).subscribe({\r\n      next: (response: any) => {\r\n        if (response.success) {\r\n          this.loadAdminMessages();\r\n          this.cdr.detectChanges();\r\n        }\r\n      },\r\n      error: (err: any) => {\r\n        console.error('Error marking message as read:', err);\r\n      },\r\n    });\r\n  }\r\n\r\n  goBack(): void {\r\n    this.selectedChat = null;\r\n    this.selectedPlayerId = null;\r\n  }\r\n\r\n  trackByMessageId(index: number, message: any): number {\r\n    return message.id;\r\n  }\r\n}\r\n","<div\r\n  #navbarContainer\r\n  class=\"fixed top-0 left-0 w-full z-50 bg-black backdrop-blur-sm transition-all duration-300\"\r\n>\r\n  <nav #navbarOnly>\r\n    <div\r\n      class=\"container mx-auto flex flex-col md:flex-row md:items-center md:justify-between p-2\"\r\n    >\r\n      <!-- Row with 3 sections: logo | menu | auth -->\r\n      <div class=\"w-full flex items-center justify-between md:gap-4\">\r\n        <!-- Left: Logo + Send Message (mobile) -->\r\n        <div class=\"flex items-center gap-4\">\r\n          <a\r\n            class=\"text-xl font-bold bg-gradient-to-r from-indigo-400 to-cyan-400 text-transparent bg-clip-text\"\r\n            *ngIf=\"!isAdmin\"\r\n          >\r\n            YuGi Tournament\r\n          </a>\r\n          <a\r\n            *ngIf=\"isAdmin\"\r\n            routerLink=\"/admin/players\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2 font-bold\"\r\n          >\r\n            Admin Dashboard\r\n          </a>\r\n          <a\r\n            *ngIf=\"isAdmin\"\r\n            routerLink=\"/admin/friendlies\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2 font-bold\"\r\n          >\r\n            Friendlies\r\n          </a>\r\n\r\n          <!-- Send Message (small screen only) -->\r\n          <a\r\n            *ngIf=\"isLoggedIn && !isAdmin\"\r\n            routerLink=\"/player/inbox\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"md:hidden font-bold text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2 cursor-pointer\"\r\n          >\r\n            Inbox\r\n          </a>\r\n        </div>\r\n\r\n        <!-- Center: Navigation links -->\r\n        <div class=\"hidden md:flex justify-center space-x-2 font-bold\">\r\n          <a\r\n            routerLink=\"/player/friendlies\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n          >\r\n            🎮 Friendlies\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/teams\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n          >\r\n            👥 Teams\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/forbidden\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n          >\r\n            Forbidden Cards\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/allLeagues\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n          >\r\n            All Leagues\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/league-table\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n          >\r\n            League Table\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/ranking\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n          >\r\n            Ranking\r\n          </a>\r\n        </div>\r\n\r\n        <!-- Right: Auth Buttons -->\r\n        <div class=\"hidden md:flex justify-end items-center space-x-4\">\r\n          <!-- Send Message (only on large screens) -->\r\n          <a\r\n            *ngIf=\"isLoggedIn && !isAdmin\"\r\n            routerLink=\"/player/inbox\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white font-bold hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2 cursor-pointer\"\r\n          >\r\n            Inbox\r\n          </a>\r\n\r\n          <ng-container *ngIf=\"!isLoggedIn\">\r\n            <a\r\n              routerLink=\"/auth/login\"\r\n              routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n              class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            >\r\n              Login\r\n            </a>\r\n            <a\r\n              routerLink=\"/auth/register\"\r\n              routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n              class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            >\r\n              Register\r\n            </a>\r\n          </ng-container>\r\n\r\n          <a\r\n            *ngIf=\"isLoggedIn\"\r\n            (click)=\"logout()\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2 cursor-pointer\"\r\n          >\r\n            Logout\r\n          </a>\r\n        </div>\r\n\r\n        <!-- Hamburger Button (small screen only) -->\r\n        <div class=\"md:hidden\">\r\n          <button (click)=\"toggleMenu()\" class=\"text-white ml-2\">\r\n            <svg\r\n              xmlns=\"http://www.w3.org/2000/svg\"\r\n              class=\"h-6 w-6\"\r\n              fill=\"none\"\r\n              viewBox=\"0 0 24 24\"\r\n              stroke=\"currentColor\"\r\n              stroke-width=\"2\"\r\n            >\r\n              <path\r\n                stroke-linecap=\"round\"\r\n                stroke-linejoin=\"round\"\r\n                d=\"M4 6h16M4 12h16M4 18h16\"\r\n              />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Mobile Menu (below full row) -->\r\n      <div\r\n        class=\"w-full mt-4 md:hidden\"\r\n        [ngClass]=\"{ block: isMenuOpen, hidden: !isMenuOpen }\"\r\n      >\r\n        <div class=\"flex flex-col space-y-2 font-bold text-center\">\r\n          <a\r\n            routerLink=\"/player/friendlies\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            (click)=\"closeMenu()\"\r\n          >\r\n            🎮 Friendlies\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/teams\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            (click)=\"closeMenu()\"\r\n          >\r\n            👥 Teams\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/forbidden\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            (click)=\"closeMenu()\"\r\n          >\r\n            Forbidden Cards\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/allLeagues\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            (click)=\"closeMenu()\"\r\n          >\r\n            All Leagues\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/league-table\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            (click)=\"closeMenu()\"\r\n          >\r\n            League Table\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/ranking\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            (click)=\"closeMenu()\"\r\n          >\r\n            Ranking\r\n          </a>\r\n\r\n          <ng-container *ngIf=\"!isLoggedIn\">\r\n            <a\r\n              routerLink=\"/auth/login\"\r\n              class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n              (click)=\"closeMenu()\"\r\n            >\r\n              Login\r\n            </a>\r\n            <a\r\n              routerLink=\"/auth/register\"\r\n              class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n              (click)=\"closeMenu()\"\r\n            >\r\n              Register\r\n            </a>\r\n          </ng-container>\r\n\r\n          <a\r\n            *ngIf=\"isLoggedIn\"\r\n            (click)=\"logout(); closeMenu()\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2 cursor-pointer\"\r\n          >\r\n            Logout\r\n          </a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n</div>\r\n\r\n<!-- Notes Section - خارج النافبار الثابت -->\r\n<div\r\n  class=\"fixed w-full z-40 bg-black/10 backdrop-blur-sm\"\r\n  [style.top.px]=\"getNavbarOnlyHeight()\"\r\n  *ngIf=\"notes.length > 0\"\r\n>\r\n  <div class=\"min-h-[30px] w-full\">\r\n    <div *ngFor=\"let note of notes\" class=\"py-1\">\r\n      <h4 class=\"text-center text-[16px] text-white font-bold\">\r\n        {{ note.content }}\r\n      </h4>\r\n    </div>\r\n  </div>\r\n</div>\r\n","import {\r\n  Component,\r\n  HostListener,\r\n  OnInit,\r\n  ViewChild,\r\n  ElementRef,\r\n  AfterViewInit,\r\n  Output,\r\n  EventEmitter,\r\n} from '@angular/core';\r\nimport { AuthService } from '../../app/core/services/auth.service';\r\nimport { Router } from '@angular/router';\r\nimport { ToastrService } from 'ngx-toastr';\r\nimport { NoteService } from '../core/services/note.service';\r\nimport { Note } from '../models/interfaces';\r\n\r\n@Component({\r\n  selector: 'app-navbar',\r\n  templateUrl: './navbar.component.html',\r\n  styleUrls: ['./navbar.component.css'],\r\n})\r\nexport class NavbarComponent implements OnInit, AfterViewInit {\r\n  @ViewChild('navbarContainer', { static: false }) navbarContainer!: ElementRef;\r\n  @ViewChild('navbarOnly', { static: false }) navbarOnly!: ElementRef;\r\n  @Output() navbarHeightChange = new EventEmitter<number>();\r\n\r\n  isLoggedIn = false;\r\n  isAdmin = false;\r\n  notes: Note[] = [];\r\n  isMenuOpen = false;\r\n  navbarHeight = 80; // default height\r\n  navbarOnlyHeight = 60; // navbar without notes\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private router: Router,\r\n    private toastr: ToastrService,\r\n    private noteService: NoteService\r\n  ) {\r\n    this.authService.isLoggedIn$.subscribe((loggedIn) => {\r\n      this.isLoggedIn = loggedIn;\r\n      const role = this.authService.getRole();\r\n      this.isAdmin = role === 'Admin';\r\n    });\r\n  }\r\n  ngOnInit(): void {\r\n    this.getNotes();\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.calculateNavbarHeight();\r\n  }\r\n\r\n  calculateNavbarHeight(): void {\r\n    setTimeout(() => {\r\n      // Calculate navbar only height\r\n      if (this.navbarOnly) {\r\n        this.navbarOnlyHeight = this.navbarOnly.nativeElement.offsetHeight;\r\n      }\r\n\r\n      // Calculate total height including notes\r\n      const notesHeight = this.notes.length * 32; // approximate height per note\r\n      const totalHeight = this.navbarOnlyHeight + notesHeight;\r\n      this.navbarHeight = totalHeight;\r\n      this.navbarHeightChange.emit(totalHeight);\r\n    }, 150);\r\n  }\r\n\r\n  getNavbarOnlyHeight(): number {\r\n    return this.navbarOnlyHeight;\r\n  }\r\n\r\n  logout() {\r\n    this.authService.logout();\r\n    this.toastr.success('تم تسجيل الخروج بنجاح');\r\n    this.router.navigate(['/player']);\r\n  }\r\n\r\n  getNotes(): void {\r\n    this.noteService.getNotes().subscribe((response) => {\r\n      // Handle if response.notes is wrapped in an object or not an array\r\n      const notes = Array.isArray(response.notes)\r\n        ? response.notes\r\n        : (response.notes as any)?.data || [];\r\n      this.notes = notes.filter((n: Note) => n.isHidden == false);\r\n      // Recalculate height after notes change\r\n      setTimeout(() => this.calculateNavbarHeight(), 50);\r\n    });\r\n  }\r\n  toggleMenu() {\r\n    this.isMenuOpen = !this.isMenuOpen;\r\n  }\r\n\r\n  closeMenu() {\r\n    this.isMenuOpen = false;\r\n  }\r\n\r\n  @HostListener('window:resize', ['$event'])\r\n  onResize(event: any) {\r\n    this.calculateNavbarHeight();\r\n  }\r\n}\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { TitleStrategyService } from './core/services/title-strategy.service';\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.css'],\r\n})\r\nexport class AppComponent implements OnInit, OnDestroy {\r\n  title = 'Yugi-Oh Tournament';\r\n  navbarHeight = 80; // default height\r\n\r\n  constructor(\r\n    private titleStrategy: TitleStrategyService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    // Initialize title strategy with a small delay to ensure router is ready\r\n    setTimeout(() => {\r\n      this.titleStrategy.setTitle('');\r\n    }, 100);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    // Clean up\r\n  }\r\n\r\n  onNavbarHeightChange(height: number): void {\r\n    this.navbarHeight = height;\r\n  }\r\n}\r\n","<app-navbar (navbarHeightChange)=\"onNavbarHeightChange($event)\"></app-navbar>\r\n<div\r\n  [style.margin-top.px]=\"navbarHeight\"\r\n  [style.min-height]=\"'calc(100vh - ' + navbarHeight + 'px)'\"\r\n  class=\"relative\"\r\n>\r\n  <router-outlet></router-outlet>\r\n</div>\r\n\r\n<!-- Floating Inbox Component -->\r\n<app-floating-inbox></app-floating-inbox>\r\n\r\n<ngx-spinner\r\n  bdColor=\"rgba(0, 0, 0, 1)\"\r\n  size=\"medium\"\r\n  color=\"#fff\"\r\n  type=\"square-jelly-box\"\r\n  [fullScreen]=\"true\"\r\n  ><p style=\"color: white\">Loading...</p></ngx-spinner\r\n>\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  HttpInterceptor,\r\n  HttpRequest,\r\n  HttpHandler,\r\n  HttpEvent,\r\n} from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { finalize } from 'rxjs/operators';\r\nimport { NgxSpinnerService } from 'ngx-spinner';\r\n\r\n@Injectable()\r\nexport class AuthInterceptor implements HttpInterceptor {\r\n  constructor(private spinner: NgxSpinnerService) {}\r\n\r\n  intercept(\r\n    req: HttpRequest<any>,\r\n    next: HttpHandler\r\n  ): Observable<HttpEvent<any>> {\r\n    this.spinner.show();\r\n\r\n    const token = localStorage.getItem('token');\r\n    let clonedReq = req;\r\n\r\n    if (token) {\r\n      clonedReq = req.clone({\r\n        setHeaders: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n    }\r\n\r\n    return next.handle(clonedReq).pipe(\r\n      finalize(() => {\r\n        this.spinner.hide();\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  HttpInterceptor,\r\n  HttpRequest,\r\n  HttpHandler,\r\n  HttpEvent,\r\n  HttpResponse,\r\n} from '@angular/common/http';\r\nimport { Observable, of } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { CacheService } from '../services/cache.service';\r\n\r\n@Injectable()\r\nexport class CacheInterceptor implements HttpInterceptor {\r\n  constructor(private cacheService: CacheService) {}\r\n\r\n  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\r\n\r\n    \r\n    // Check if this is a GET request and should be cached\r\n    if (request.method === 'GET' && this.shouldCache(request.url)) {\r\n      const cachedResponse = this.cacheService.get(request.url);\r\n      if (cachedResponse) {\r\n        return of(new HttpResponse({ body: cachedResponse }));\r\n      }\r\n    }\r\n    \r\n    return next.handle(request);\r\n  }\r\n\r\n  private shouldCache(url: string): boolean {\r\n    // Add URLs that should be cached\r\n    const cacheableUrls = [\r\n      '/player/ranking',\r\n      '/player',\r\n      '/match',\r\n      '/Message/inbox',\r\n      '/note/notes',\r\n      '/player/players/all',\r\n      '/league/getCurrentLeague'\r\n    ];\r\n    \r\n    return cacheableUrls.some(cacheableUrl => url.includes(cacheableUrl));\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { BrowserModule, Title } from '@angular/platform-browser';\r\nimport { AppRoutingModule } from './app-routing.module';\r\nimport { AppComponent } from './app.component';\r\nimport { HTTP_INTERCEPTORS, HttpClientModule } from '@angular/common/http';\r\nimport { ToastrModule } from 'ngx-toastr';\r\nimport { NoopAnimationsModule } from '@angular/platform-browser/animations';\r\nimport { NavbarComponent } from './navbar/navbar.component';\r\nimport { AuthInterceptor } from './interceptors/auth-interceptor.service';\r\nimport { CacheInterceptor } from './core/interceptors/cache-interceptor.service';\r\nimport { NgxSpinnerModule } from 'ngx-spinner';\r\nimport { TitleStrategyService } from './core/services/title-strategy.service';\r\nimport { SharedModule } from './shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [AppComponent, NavbarComponent],\r\n  imports: [\r\n    BrowserModule,\r\n    AppRoutingModule,\r\n    HttpClientModule,\r\n    NoopAnimationsModule,\r\n    ToastrModule.forRoot({\r\n      timeOut: 3000,\r\n      positionClass: 'toast-top-right',\r\n      preventDuplicates: true,\r\n    }),\r\n    NgxSpinnerModule.forRoot({ type: 'square-jelly-box' }),\r\n    SharedModule,\r\n  ],\r\n  providers: [\r\n    { provide: HTTP_INTERCEPTORS, useClass: AuthInterceptor, multi: true },\r\n    { provide: HTTP_INTERCEPTORS, useClass: CacheInterceptor, multi: true },\r\n    NgxSpinnerModule,\r\n    Title,\r\n    TitleStrategyService,\r\n  ],\r\n  bootstrap: [AppComponent],\r\n})\r\nexport class AppModule {}\r\n","import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\n\r\nimport { AppModule } from './app/app.module';\r\n\r\nplatformBrowserDynamic()\r\n  .bootstrapModule(AppModule)\r\n  .catch((err) => {});\r\n"],"x_google_ignoreList":[]}