{"version":3,"file":"main.85bf79f399cbae6c.js","mappings":"+QAyCO,IAAMA,EAAqB,MAA5B,MAAOA,EAUXC,YACUC,EACAC,EACAC,EACAC,EACAC,GAJAC,KAAAL,gBACAK,KAAAJ,eACAI,KAAAH,gBACAG,KAAAF,iBACAE,KAAAD,cAdFC,KAAAC,oBAAsB,IAAIC,IAChC,MAEMF,KAAAG,mBAAqB,IAAIC,IACzBJ,KAAAK,oBAAsB,EACtBL,KAAAM,oBAAsB,IAAIF,IACjBJ,KAAAO,eAAiB,IACjBP,KAAAQ,yBAA2B,GAQzC,CAKHC,iBAAiBC,GAAe,GAC9B,MAAMC,EAAMC,KAAKD,MAKjB,OAAKD,GAHHV,KAAKC,oBAAoBY,OACzBF,EAAMX,KAAKK,oBAAsBL,KAAKO,eAG/BP,KAAKC,oBACTa,eACAC,QAAKC,KAAQC,GAA8C,OAATA,IAGhDjB,KAAKkB,8BAA8BH,QACxCI,KAAKF,IACHjB,KAAKC,oBAAoBmB,KAAKH,GAC9BjB,KAAKK,oBAAsBM,KAC5B,EACDU,KAAYC,MAEHC,MACLvB,KAAKC,oBAAoBY,OAASb,KAAKwB,2BAE1C,EACDC,KAAY,GAEhB,CAKAC,iBACEC,EACAjB,GAAe,GAEf,MAAMC,EAAMC,KAAKD,MACXiB,EAAa5B,KAAKM,oBAAoBuB,IAAIF,IAAS,EACnDG,EACJ9B,KAAKG,mBAAmB4B,IAAIJ,IAC5BhB,EAAMiB,EAAa5B,KAAKQ,yBAE1B,OAAKE,GAAgBoB,KACZP,MAAGvB,KAAKG,mBAAmB0B,IAAIF,IAGjC3B,KAAKgC,4BAA4BL,GAAMZ,QAC5CI,KAAKF,IACHjB,KAAKG,mBAAmB8B,IAAIN,EAAMV,GAClCjB,KAAKM,oBAAoB2B,IAAIN,EAAMhB,EAAG,IACvC,EACDU,KAAYC,MAEHC,MAAGvB,KAAKG,mBAAmB0B,IAAIF,IAAS,KAGrD,CAKQT,8BACN,SAAOgB,KAAS,CACdC,QAASnC,KAAKL,cAAcyC,kBAC5BC,QAASrC,KAAKJ,aAAa0C,kBAC3BC,cAAevC,KAAKH,cAAc2C,wBAAwBzB,QACxD0B,KAAKC,GAAaA,EAASC,SAAM,EACjCtB,KAAW,OAAME,MAAG,QAEtBqB,WAAY5C,KAAKH,cACdgD,qBACA9B,QAAKM,KAAW,OAAME,MAAG,MAC5BuB,MAAO9C,KAAKD,YAAYgD,gBAAgBhC,QACtC0B,KAAKC,GAAaA,EAASI,QAAK,EAChCzB,KAAW,OAAME,MAAG,MAEtByB,SAAUhD,KAAKF,eAAemD,mBAAmBlC,QAC/C0B,KAAKC,GAAaA,EAASM,UAAY,KAAE,EACzC3B,KAAW,OAAME,MAAG,QAErBR,QACD0B,KACE,EAAGN,UAASE,UAASE,gBAAeK,aAAYE,QAAOE,eACrD,MAAME,EAAeC,MAAMC,QAAQJ,GAAYA,EAAW,GAC1D,MAAO,CACLb,QAASA,EACTE,QAASA,EACTE,gBACAK,WAAYA,EACZE,MAAOA,EACPE,SAAUE,EACVG,MAAO,CACLC,aAAcnB,EAAQoB,OACtBC,aAAcnB,EAAQkB,OACtBE,iBAAkBpB,EAAQrB,OAAQ0C,IAAOA,EAAEC,aAAaJ,OACxDK,kBAAmBV,EAAalC,OAC7B0C,IAAYA,EAAEG,SAAWH,EAAEI,aAC5BP,WAMd,CAKQvB,4BAA4BL,GAClC,OAAQA,GACN,IAAK,UACH,OAAO3B,KAAKH,cAAcgD,qBAC5B,IAAK,QACH,OAAO7C,KAAKD,YACTgD,gBACAhC,QAAK0B,KAAKC,GAAaA,EAASI,QACrC,IAAK,WACH,OAAO9C,KAAKF,eACTmD,mBACAlC,QAAK0B,KAAKC,GAAaA,EAASM,UAAY,KACjD,QACE,SAAOzB,MAAG,IAEhB,CAKAwC,gBACEpC,GAEA,OAAQA,GACN,IAAK,YACH3B,KAAKK,oBAAsB,EAC3B,MACF,IAAK,UACL,IAAK,QACL,IAAK,WACHL,KAAKM,oBAAoB2B,IAAIN,EAAM,GACnC3B,KAAKG,mBAAmB6D,OAAOrC,GAC/B,MACF,IAAK,MACH3B,KAAKK,oBAAsB,EAC3BL,KAAKM,oBAAoB2D,QACzBjE,KAAKG,mBAAmB8D,QAG9B,CAOAC,0BACE,OAAOlE,KAAKC,oBAAoBY,KAClC,CAKAsD,mBAAmBC,GACjB,MAAMC,EAAUrE,KAAKC,oBAAoBY,MACrCwD,IACFA,EAAQhB,MAAMO,kBAAoBQ,EAClCpE,KAAKC,oBAAoBmB,KAAKiD,GAElC,CAEQ7C,wBACN,MAAO,CACLW,QAAS,GACTE,QAAS,GACTE,cAAe,KACfK,WAAY,GACZE,MAAO,GACPE,SAAU,GACVK,MAAO,CACLC,aAAc,EACdE,aAAc,EACdC,iBAAkB,EAClBG,kBAAmB,GAGzB,iDA3MWnE,GAAqB6E,MAAAC,KAAAD,MAAAE,KAAAF,MAAAG,KAAAH,MAAAI,KAAAJ,MAAAK,KAAA,sCAArBlF,EAAqBmF,QAArBnF,EAAqBoF,UAAAC,WAFpB,QAAM,SAEPrF,CAAqB,sGC/B3B,IAAMsF,EAAW,MAAlB,MAAOA,EAMXrF,YAAoBsF,EAA0BC,GAA1BjF,KAAAgF,OAA0BhF,KAAAiF,SALtCjF,KAAAkF,QAAUC,IAAYC,OACtBpF,KAAAqF,kBAAoB,IAAInF,IAAyBF,KAAKsF,YAC9DtF,KAAAuF,YAAcvF,KAAKqF,kBAAkBvE,eAC7Bd,KAAAwF,SAA0B,KAGhC,MAAMC,EAAQC,aAAaC,QAAQ,SAC/BF,IACFzF,KAAKwF,SAAWxF,KAAK4F,iBAAiBH,GACtCzF,KAAKqF,kBAAkBjE,MAAK,GAEhC,CAEAyE,MAAMC,EAAeC,GACnB,OAAO/F,KAAKgF,KACTgB,KAAU,GAAGhG,KAAKkF,qBAAsB,CACvCY,QACAC,aAEDhF,QACCI,KAAKuB,IACCA,EAASuD,UACXP,aAAaQ,QAAQ,QAASxD,EAAS+C,OACvCC,aAAaQ,QAAQ,WAAYxD,EAAS8C,UAAY,SACtDxF,KAAKwF,SAAW9C,EAAS8C,UAAY,QACrCxF,KAAKqF,kBAAkBjE,MAAK,GAC5BpB,KAAKiF,OAAOkB,SAAS,CAAC,WAAS,GAIzC,CAEAC,YACEC,EACAN,GAEA,OAAO/F,KAAKgF,KACTgB,KAAoB,GAAGhG,KAAKkF,4BAA6B,CACxDmB,cACAN,aAEDhF,QACCI,KAAKuB,IACH,GAAIA,EAASuD,SAAWvD,EAAS+C,MAAO,CACtCC,aAAaQ,QAAQ,QAASxD,EAAS+C,OACvC,MAAMa,EAAgBtG,KAAK4F,iBAAiBlD,EAAS+C,OACrDzF,KAAKwF,SAAWc,GAAiB,SACjCZ,aAAaQ,QAAQ,WAAYlG,KAAKwF,UAEtCxF,KAAKqF,kBAAkBjE,MAAK,GAC5BpB,KAAKiF,OAAOkB,SAAS,CAAC,eAIhC,CAEAI,SACEF,EACAN,EACAS,EACAC,GAEA,OAAOzG,KAAKgF,KAAKgB,KACf,GAAGhG,KAAKkF,+BACR,CAAEmB,cAAaN,WAAUS,YAAWC,YAExC,CAEAC,cACEL,EACAM,GAEA,OAAO3G,KAAKgF,KAAKgB,KACf,GAAGhG,KAAKkF,8BACR,CAAEmB,cAAaM,eAEnB,CAEAC,SACElB,aAAamB,WAAW,SACxB7G,KAAKwF,SAAW,KAChBxF,KAAKqF,kBAAkBjE,MAAK,GAC5BpB,KAAKiF,OAAOkB,SAAS,CAAC,WACxB,CAEAW,UACE,OAAO9G,KAAKwF,QACd,CAEQF,WACN,QAASI,aAAaC,QAAQ,QAChC,CAEQC,iBAAiBH,GACvB,IAGE,OAFgBsB,KAAKC,MAAMC,KAAKxB,EAAMyB,MAAM,KAAK,KAC5BC,MAAW,WAGhC,OAAO,KAEX,iDAtGWpC,GAAWT,MAAAC,MAAAD,MAAAE,MAAA,sCAAXO,EAAWH,QAAXG,EAAWF,UAAAC,WAFV,QAAM,SAEPC,CAAW,kFCGjB,IAAMqC,EAAY,MAAnB,MAAOA,EAOX1H,cANQM,KAAAqH,MAAQ,IAAIjH,IACHJ,KAAAsH,YAAc,IACdtH,KAAAuH,WAAa,KACbvH,KAAAwH,WAAa,KACbxH,KAAAyH,aAAe,KAG9BzH,KAAK0H,sBACP,CAEAzF,IAAO0F,EAAa1G,EAAS2G,EAAc5H,KAAKsH,aAC9C,MAAMO,EAAO,CACX5G,OACA6G,UAAWlH,KAAKD,MAChBiH,OAGF5H,KAAKqH,MAAMpF,IAAI0F,EAAKE,GACpB7H,KAAK+H,oBACP,CAEAlG,IAAO8F,GACL,MAAME,EAAO7H,KAAKqH,MAAMxF,IAAI8F,GAC5B,OAAKE,EAEajH,KAAKD,MAAQkH,EAAKC,UAAYD,EAAKD,KAEnD5H,KAAKqH,MAAMrD,OAAO2D,GAClB3H,KAAK+H,qBACE,MAGFF,EAAK5G,KATM,IAUpB,CAEAc,IAAI4F,GACF,OAAyB,OAAlB3H,KAAK6B,IAAI8F,EAClB,CAEA1D,QACEjE,KAAKqH,MAAMpD,QACXjE,KAAK+H,oBACP,CAEAC,OAAOL,GACL3H,KAAKqH,MAAMrD,OAAO2D,GAClB3H,KAAK+H,oBACP,CAGAE,aACEN,EACAO,EACAN,EAAc5H,KAAKsH,aAEnB,MAAMa,EAASnI,KAAK6B,IAAO8F,GAC3B,OAAIQ,KACK5G,MAAG4G,GAGLD,EAAQnH,QACbI,KAAKF,GAASjB,KAAKiC,IAAI0F,EAAK1G,EAAM2G,KAAI,EACtCvG,KAAYC,IACV,MAAMA,IAGZ,CAGA8G,mBAAsBT,EAAaO,GACjC,OAAOlI,KAAKiI,aAAaN,EAAKO,EAASlI,KAAKuH,WAC9C,CAGAc,mBAAsBV,EAAaO,GACjC,OAAOlI,KAAKiI,aAAaN,EAAKO,EAASlI,KAAKwH,WAC9C,CAGAc,qBAAwBX,EAAaO,GACnC,OAAOlI,KAAKiI,aAAaN,EAAKO,EAASlI,KAAKyH,aAC9C,CAGAc,uBACEZ,EACAO,GAEA,MAAMC,EAASnI,KAAK6B,IAAO8F,GAC3B,OAAIQ,KACK5G,MAAG4G,GAGLD,EAAQnH,QACbI,KAAKF,IAEH,GAAIkC,MAAMC,QAAQnC,IAASA,EAAKsC,OAAS,GAAKtC,EAAK,GAAGuH,UAAW,CAC/D,MAAMC,EAAa,IAAIxH,GAAMyH,KAAK,CAACC,EAAGC,KACpC,MAAMC,EAAQ,IAAIjI,KAAK+H,EAAEH,WAAWM,UAEpC,OADc,IAAIlI,KAAKgI,EAAEJ,WAAWM,UACrBD,IAEjB7I,KAAKiC,IAAI0F,EAAKc,EAAYzI,KAAKyH,mBAE/BzH,KAAKiC,IAAI0F,EAAK1G,EAAMjB,KAAKyH,aAAY,IAExC,EACDpG,KAAYC,IACV,MAAMA,IAGZ,CAGAyH,kBAAkBC,GAChB,UAAWrB,KAAO3H,KAAKqH,MAAM4B,OACvBtB,EAAIuB,SAASF,IACfhJ,KAAKqH,MAAMrD,OAAO2D,GAGtB3H,KAAK+H,oBACP,CAGAoB,0BACE,MAAMxI,EAAM,IAAIC,KAUhB,OATiB,IAAIA,KACnBD,EAAIyI,cACJzI,EAAI0I,WACJ1I,EAAI2I,UACJ3I,EAAI4I,WAAa,EACjB,EACA,EACA,EAGJ,CAGAC,kBAAkB7B,GAChB,MAAME,EAAO7H,KAAKqH,MAAMxF,IAAI8F,GAC5B,OAAOE,EAAO,IAAIjH,KAAKiH,EAAKC,WAAa,IAC3C,CAGA2B,eAAe9B,GACb,MAAME,EAAO7H,KAAKqH,MAAMxF,IAAI8F,GAC5B,OAAKE,GACEjH,KAAKD,MAAQkH,EAAKC,UAAYD,EAAKD,GAC5C,CAGA8B,mBAAmB/B,GACjB,MAAME,EAAO7H,KAAKqH,MAAMxF,IAAI8F,GAC5B,OAAKE,EACE,IAAIjH,KAAKiH,EAAKC,UAAYD,EAAKD,KADpB,IAEpB,CAGAlH,aACEiH,EACAO,EACAN,EAAc5H,KAAKsH,aAEnB,OAAAtH,KAAKgI,OAAOL,GACL3H,KAAKiI,aAAaN,EAAKO,EAASN,EACzC,CAGA+B,wBACE,MAAM/H,EAAa5B,KAAKwJ,kBAAkB,oBAC1C,OAAK5H,IAGFhB,KAAKD,MAAQiB,EAAWkH,WAAO,KACL,EAC/B,CAGAc,6BACE,MAAMhI,EAAa5B,KAAKwJ,kBAAkB,kBAC1C,OAAK5H,IAGFhB,KAAKD,MAAQiB,EAAWkH,WAAO,KACL,EAC/B,CAEQf,qBACN,IACE,MAAM8B,EAAY1G,MAAM2G,KAAK9J,KAAKqH,MAAM0C,WACxCrE,aAAaQ,QAAQ,YAAaa,KAAKiD,UAAUH,UAEjD,CAEJ,CAEQnC,uBACN,IACE,MAAMmC,EAAYnE,aAAaC,QAAQ,aACvC,GAAIkE,EAAW,CACb,MAAME,EAAUhD,KAAKC,MAAM6C,GAC3B7J,KAAKqH,MAAQ,IAAIjH,IAAI2J,GAGrB,UAAYpC,EAAKE,KAAS7H,KAAKqH,MAAM0C,UAC/BnJ,KAAKD,MAAQkH,EAAKC,UAAYD,EAAKD,KACrC5H,KAAKqH,MAAMrD,OAAO2D,UAKxB,CAEJ,iDAvNWP,EAAY,sCAAZA,EAAYxC,QAAZwC,EAAYvC,UAAAC,WAFX,QAAM,SAEPsC,CAAY,kFCElB,IAAM6C,EAAa,MAApB,MAAOA,EAGXvK,YAAoBsF,EAA0BkF,GAA1BlK,KAAAgF,OAA0BhF,KAAAkK,eAFtClK,KAAAkF,QAAUC,IAAYC,MAE6C,CAE3E+E,YAAYC,GACV,OAAOpK,KAAKgF,KAAKgB,KACf,GAAGhG,KAAKkF,wBAAwBkF,IAChC,GAEJ,CAEAC,YAAYC,GACV,OAAOtK,KAAKgF,KAAKgB,KAAqB,GAAGhG,KAAKkF,uBAAwBoF,EACxE,CAEAC,iBAAiB7J,GAAwB,GACvC,MAAMwH,EAAUlI,KAAKgF,KAAKnD,IACxB,GAAG7B,KAAKkF,mCAGV,OAAIxE,GAAgBV,KAAKkK,aAAaN,6BAC7B5J,KAAKkK,aAAaxJ,aACvB,iBACAwH,EACA,MAIGlI,KAAKkK,aAAa9B,mBAAmB,iBAAkBF,EAChE,CAGA1F,wBACE,OAAOxC,KAAKgF,KAAKnD,IACf,GAAG7B,KAAKkF,kCAEZ,CAEAsF,kBACE9J,GAAwB,GAExB,MAAMwH,EAAUlI,KAAKgF,KAAKnD,IACxB,GAAG7B,KAAKkF,8BAGV,OAAIxE,GAAgBV,KAAKkK,aAAaP,wBAC7B3J,KAAKkK,aAAaxJ,aACvB,mBACAwH,EACA,MAIGlI,KAAKkK,aAAa3B,uBACvB,mBACAL,EAEJ,CAGArF,qBACE,OAAO7C,KAAKgF,KAAKnD,IAAqB,GAAG7B,KAAKkF,6BAChD,CAEAuF,aAAaC,GACX,OAAO1K,KAAKgF,KAAKhB,OACf,GAAGhE,KAAKkF,yBAAyBwF,IAErC,CAEAC,uBAAuBD,GACrB,OAAO1K,KAAKgF,KAAKgB,KACf,GAAGhG,KAAKkF,kBAAkBwF,kBAC1B,GAEJ,CAEAE,mBAAmBF,GACjB,OAAO1K,KAAKgF,KAAKgB,KACf,GAAGhG,KAAKkF,kBAAkBwF,oBAC1B,GAEJ,CAEAG,gBAAgBH,GACd,OAAO1K,KAAKgF,KAAKgB,KACf,GAAGhG,KAAKkF,kBAAkBwF,qBAC1B,GAEJ,CAEAI,WAAWJ,GACT,OAAO1K,KAAKgF,KAAKgB,KACf,GAAGhG,KAAKkF,kBAAkBwF,gBAC1B,GAEJ,CAGAK,+BACE,OAAO/K,KAAKkK,aAAaV,kBAAkB,mBAC7C,CAGAwB,iCACE,OAAOhL,KAAKkK,aAAaV,kBAAkB,iBAC7C,CAGAyB,yBACE,OAAOjL,KAAKkK,aAAaT,eAAe,mBAC1C,CAGAyB,8BACE,OAAOlL,KAAKkK,aAAaT,eAAe,iBAC1C,CAGA0B,4BACE,OAAOnL,KAAKkK,aAAaR,mBAAmB,mBAC9C,CAGA0B,iCACE,OAAOpL,KAAKkK,aAAaR,mBAAmB,iBAC9C,CAGA2B,uBACE,OAAOrL,KAAKwK,mBAAkB,EAChC,CAGAc,4BACE,OAAOtL,KAAKuK,kBAAiB,EAC/B,iDAzIWN,GAAa3F,MAAAC,MAAAD,MAAAE,KAAA,sCAAbyF,EAAarF,QAAbqF,EAAapF,UAAAC,WAFZ,QAAM,SAEPmF,CAAa,sGCJnB,IAAMsB,EAAY,MAAnB,MAAOA,EAGX7L,YACUsF,EACArF,EACAuK,GAFAlK,KAAAgF,OACAhF,KAAAL,gBACAK,KAAAkK,eALFlK,KAAAkF,QAAUC,IAAYC,MAM3B,CAEHoG,aACE,OAAOxL,KAAKkK,aAAa9B,mBACvB,kBACApI,KAAKgF,KAAKnD,IAAa,GAAG7B,KAAKkF,iBAEnC,CAGA5C,kBACE,OAAOtC,KAAKgF,KAAKnD,IAAa,GAAG7B,KAAKkF,gBACxC,CAEAuG,YACEC,EACAC,GAEA,OAAO3L,KAAKgF,KACTgB,KAAqB,GAAGhG,KAAKkF,iBAAiBwG,WAAkB,CAC/DC,aAED5K,QACCI,KAAI,KACFnB,KAAKL,cAAciM,gBAAc,GAGzC,CAEAC,WAAWH,GACT,OAAO1L,KAAKgF,KACThB,OAAuB,GAAGhE,KAAKkF,uBAAuBwG,KACtD3K,QACCI,KAAI,KACFnB,KAAKL,cAAciM,gBAAc,GAGzC,CAGAE,2BACE,OAAO9L,KAAKkK,aAAaV,kBAAkB,kBAC7C,iDAjDW+B,GAAYjH,MAAAC,MAAAD,MAAAE,KAAAF,MAAAG,KAAA,sCAAZ8G,EAAY3G,QAAZ2G,EAAY1G,UAAAC,WAFX,QAAM,SAEPyG,CAAY,kFCDlB,IAAMQ,EAAc,MAArB,MAAOA,EAGXrM,YAAoBsF,EAA0BkF,GAA1BlK,KAAAgF,OAA0BhF,KAAAkK,eAFtClK,KAAAkF,QAAUC,IAAYC,MAE6C,CAE3E4G,YAAYC,GACV,OAAOjM,KAAKgF,KAAKgB,KAAqB,GAAGhG,KAAKkF,uBAAwB,CACpEgH,QAASD,GAEb,CAEAE,cACE,OAAOnM,KAAKgF,KAAKnD,IAAsB,GAAG7B,KAAKkF,wBACjD,CAGAjC,mBACE,OAAOjD,KAAKgF,KAAKnD,IAAsB,GAAG7B,KAAKkF,wBACjD,CAEAkH,kBACEC,EACAC,GAEA,OAAOtM,KAAKgF,KAAKgB,KACf,GAAGhG,KAAKkF,wBAAwBmH,IAChC,CAAEE,OAAQD,GAEd,CAEAE,oBACEH,EACAC,GAEA,OAAOtM,KAAKgF,KAAKgB,KACf,GAAGhG,KAAKkF,0BAA0BmH,IAClC,CAAEE,OAAQD,GAEd,CAEAG,oBACE,OAAOzM,KAAKgF,KAAKnD,IACf,GAAG7B,KAAKkF,8BAEZ,CAEAwH,eACEC,EACAV,GAEA,OAAOjM,KAAKgF,KAAKgB,KACf,GAAGhG,KAAKkF,yBAAyByH,IACjC,CAAET,QAASD,GAEf,iDAtDWF,GAAczH,MAAAC,MAAAD,MAAAE,KAAA,sCAAduH,EAAcnH,QAAdmH,EAAclH,UAAAC,WAFb,QAAM,SAEPiH,CAAc,kFCApB,IAAMa,EAAW,MAAlB,MAAOA,EAGXlN,YAAoBsF,EAA0BkF,GAA1BlK,KAAAgF,OAA0BhF,KAAAkK,eAFtClK,KAAAkF,QAAUC,IAAYC,MAE6C,CAE3EyH,SAASZ,GACP,OAAOjM,KAAKgF,KAAKgB,KAAqB,GAAGhG,KAAKkF,qBAAsB,CAClEgH,QAASD,GAEb,CAEAa,WACE,OAAO9M,KAAKgF,KAAKnD,IAAkB,GAAG7B,KAAKkF,qBAC7C,CAGAnC,gBACE,OAAO/C,KAAKgF,KAAKnD,IAAkB,GAAG7B,KAAKkF,qBAC7C,CAEA6H,cAAcC,EAAgBV,GAC5B,OAAOtM,KAAKgF,KAAKgB,KACf,GAAGhG,KAAKkF,qBAAqB8H,IAC7B,CAAET,OAAQD,GAEd,CAEAW,WAAWD,EAAgBV,GACzB,OAAOtM,KAAKgF,KAAKgB,KACf,GAAGhG,KAAKkF,uBAAuB8H,IAC/B,CAAET,OAAQD,GAEd,iDAhCWM,GAAWtI,MAAAC,MAAAD,MAAAE,KAAA,sCAAXoI,EAAWhI,QAAXgI,EAAW/H,UAAAC,WAFV,QAAM,SAEP8H,CAAW,sGCAjB,IAAMM,EAAa,MAApB,MAAOA,EAMXxN,YAAoBsF,EAA0BkF,GAA1BlK,KAAAgF,OAA0BhF,KAAAkK,eALtClK,KAAAkF,QAAUC,IAAYC,OAEtBpF,KAAAmN,eAAiB,IAAIjN,IAAoB,IACjDF,KAAAoN,SAAWpN,KAAKmN,eAAerM,cAE4C,CAE3EuM,UACE,OAAOrN,KAAKkK,aAAa9B,mBACvB,iBACApI,KAAKgF,KACFnD,IAAQ,GAAG7B,KAAKkF,0BAChBnE,QAAKI,KAAKF,GAASjB,KAAKmN,eAAe/L,KAAKH,KAEnD,CAEAqM,aACE,OAAOtN,KAAKkK,aAAa9B,mBACvB,eACApI,KAAKgF,KACFnD,IAAQ,GAAG7B,KAAKkF,kBAChBnE,QAAKI,KAAKF,GAASjB,KAAKmN,eAAe/L,KAAKH,KAEnD,CAGAmB,kBACE,OAAOpC,KAAKgF,KACTnD,IAAQ,GAAG7B,KAAKkF,kBAChBnE,QAAKI,KAAKF,GAASjB,KAAKmN,eAAe/L,KAAKH,IACjD,CAEAsM,UAAUC,GACR,OAAOxN,KAAKgF,KACTgB,KAAqB,GAAGhG,KAAKkF,iBAAkB,CAAEsI,aACjDzM,QACCI,KAAI,KACFnB,KAAKkK,aAAanB,kBAAkB,UACpC/I,KAAK4L,gBAAc,GAG3B,CAEA6B,aAAad,GACX,OAAO3M,KAAKgF,KACThB,OAAuB,GAAGhE,KAAKkF,kBAAkByH,KACjD5L,QACCI,KAAI,KACFnB,KAAKkK,aAAanB,kBAAkB,UACpC/I,KAAK4L,gBAAc,GAG3B,CAEA8B,iBACE1N,KAAKkK,aAAalC,OAAO,kBACzBhI,KAAKgF,KAAKnD,IAAQ,GAAG7B,KAAKkF,0BAA0ByI,UAAW1M,IAC7DjB,KAAKmN,eAAe/L,KAAKH,EAAI,EAEjC,CAEA2K,iBACE5L,KAAKkK,aAAalC,OAAO,gBACzBhI,KAAKgF,KAAKnD,IAAQ,GAAG7B,KAAKkF,kBAAkByI,UAAW1M,IACrDjB,KAAKmN,eAAe/L,KAAKH,EAAI,EAEjC,CAGA2M,oBACE,OAAO5N,KAAKkK,aAAaf,yBAC3B,CAGA0E,2BACE,OAAO7N,KAAKkK,aAAaV,kBAAkB,iBAC7C,CAGAsE,2BACE,OAAO9N,KAAKkK,aAAaV,kBAAkB,eAC7C,iDAlFW0D,GAAa5I,MAAAC,MAAAD,MAAAE,KAAA,sCAAb0I,EAAatI,QAAbsI,EAAarI,UAAAC,WAFZ,QAAM,SAEPoI,CAAa,2FCInB,IAAMa,EAAY,MAAnB,MAAOA,oDAAY,mCAAZA,GAAY,wCAFZ,CAAChC,IAAgBtM,KAAsBuO,QAAA,CAFxCC,KAAcC,OAAW,SAIxBH,CAAY,sCCVlB,MAAM5I,EAAc,CACzBgJ,YAAY,EAEZ/I,OAPQ,6FCIV,MAAMgJ,EAAiB,CACrB,CAAEC,KAAM,GAAIC,WAAY,SAAUC,UAAW,QAC7C,CACEF,KAAM,SACNG,aAAcA,IACZC,EAAAC,EAAA,KAAAC,KAAAF,EAAAG,KAAAH,EAAA,OAAiCE,KAAMjL,GAAMA,EAAEmL,cACjD5N,KAAM,CAAE6N,MAAO,YAEjB,CACET,KAAM,OACNG,aAAcA,IAAMC,EAAAC,EAAA,KAAAC,KAAAF,EAAAG,KAAAH,EAAA,MAA6BE,KAAMjL,GAAMA,EAAEqL,YAC/D9N,KAAM,CAAE6N,MAAO,SAEjB,CACET,KAAM,QACNG,aAAcA,IACZQ,QAAAC,IAAA,CAAAR,EAAAC,EAAA,KAAAD,EAAAC,EAAA,OAAAC,KAAAF,EAAAG,KAAAH,EAAA,OAA+BE,KAAMjL,GAAMA,EAAEwL,aAC/CC,YAAa,CCjBuBC,CAACC,EAAOC,MACxCC,EAAcC,OAAOzK,OACbW,aAAaC,QAAQ,WDgBjC1E,KAAM,CAAE6N,MAAO,UAEjB,CAAET,KAAM,KAAMC,WAAY,WAOrB,IAAMmB,EAAgB,MAAvB,MAAOA,oDAAgB,mCAAhBA,GAAgB,uCAHjBC,KAAaC,QAAQvB,GACrBsB,OAAY,SAEXD,CAAgB,mBEvBtB,IAAMG,EAAoB,MAA3B,MAAOA,EAGXlQ,YAAoBoP,EAAsB7J,GAAtBjF,KAAA8O,QAAsB9O,KAAAiF,SAFzBjF,KAAA6P,aAAe,qBAI9B7P,KAAK8O,MAAMgB,SAAS9P,KAAK6P,cACzB7P,KAAK+P,mBACP,CAEQA,oBACN/P,KAAKiF,OAAO+K,OACTjP,QAAKC,KAAQiP,GAAUA,aAAiBC,OACxCvC,UAAWsC,IAEVE,WAAW,KACTnQ,KAAKoQ,aAAW,EACf,GAAE,EAEX,CAEQA,cACN,MAAMC,EAAerQ,KAAKsQ,kBAIxBtQ,KAAK8O,MAAMgB,SAFTO,GAAcE,UAAUtP,MAAO6N,MAChBuB,EAAaE,SAAStP,KAAK6N,MAGxB9O,KAAK6P,aAE7B,CAEQS,kBACN,IAAIjB,EAAQrP,KAAKiF,OAAOuL,YAAYC,KAGpC,KAAOpB,EAAMqB,YACXrB,EAAQA,EAAMqB,WAIhB,IAAIC,EAAwB3Q,KAAKiF,OAAOuL,YAAYC,KACpD,KAAOE,EAAsBD,YAC3BC,EAAwBA,EAAsBD,WAIhD,OAAIrB,GAAOkB,UAAUtP,MAAO6N,MACnBO,EAILsB,GAAuBJ,UAAUtP,MAAO6N,MACnC6B,EAIFtB,CACT,CAEAS,SAAShB,GAGL9O,KAAK8O,MAAMgB,SAFThB,GAIkB9O,KAAK6P,aAE7B,iDAlEWD,GAAoBtL,MAAAC,MAAAD,MAAAE,MAAA,sCAApBoL,EAAoBhL,QAApBgL,EAAoB/K,UAAAC,WAFnB,QAAM,SAEP8K,CAAoB,0ICPjCtL,MAAA,WAMEA,MAAA,qBAAAsM,GAAAtM,MAAAuM,GAAA,MAAAC,EAAAxM,QAAA,OAAaA,MAAAwM,EAAAC,kBAAAH,GAAyB,EAAtCtM,CAAuC,sBAAAsM,GAAAtM,MAAAuM,GAAA,MAAAG,EAAA1M,QAAA,OACzBA,MAAA0M,EAAAC,mBAAAL,GAA0B,EADxCtM,CAAuC,oBAAAsM,GAAAtM,MAAAuM,GAAA,MAAAK,EAAA5M,QAAA,OAE3BA,MAAA4M,EAAAC,iBAAAP,GAAwB,GAEpCtM,MAAA,WAGEA,MAAA,iBAAAsM,GAAAtM,MAAAuM,GAAA,MAAAO,EAAA9M,QAAA,OAASA,MAAA8M,EAAAC,cAAAT,GAAqB,GAE9BtM,MAAA,SAGAA,MAAA,WAGEA,MAAA,kCACAA,MAAA,WAGFA,oCAtBFA,MAAA,OAAAgN,EAAAC,eAAAC,EAAA,KAAAlN,CAAkC,MAAAgN,EAAAC,eAAAE,EAAA,MAElCnN,MAAA,WAAAgN,EAAAI,YAOEpN,MAAA,GAAAA,MAAA,aAAAgN,EAAAI,sCA4EUpN,MAAA,YAIEA,MAAA,GACFA,wCADEA,MAAA,GAAAA,MAAA,IAAAqN,EAAAC,YAAA,8CArBNtN,MAAA,YAEEA,MAAA,yBAAAqN,EAAArN,MAAAuN,GAAAC,UAAAC,EAAAzN,MAAA,UAASA,MAAAyN,EAAAC,WAAAL,GAAgB,GAGzBrN,MAAA,WAAAA,CAA8C,WAA9CA,CAA8C,WAGxCA,MAAA,GACFA,QACAA,MAAA,UACEA,MAAA,GACFA,QACAA,MAAA,UACEA,MAAA,mBACFA,UAEFA,MAAA,GAAA2N,EAAA,cAMF3N,sCAfMA,MAAA,GAAAA,MAAA,IAAAqN,EAAAO,eAAA,KAGA5N,MAAA,GAAAA,MAAA,IAAAqN,EAAAQ,YAAA,KAGA7N,MAAA,GAAAA,MAAA,IAAAA,MAAA,IAAAqN,EAAAS,gBAAA,cAID9N,MAAA,GAAAA,MAAA,OAAAqN,EAAAC,YAAA,6BAvBXtN,MAAA,WAAAA,CAAwD,YAKpDA,MAAA,EAAA+N,EAAA,eAyBF/N,iCAxBqBA,MAAA,GAAAA,MAAA,UAAAgO,EAAAC,sDA4EfjO,MAAA,WAAAA,CAGC,eAEGA,MAAA,mBAAAA,MAAAkO,GAAA,MAAAC,EAAAnO,QAAAwN,UAAAY,EAAApO,MAAA,UAASA,MAAAoO,EAAAC,WAAAF,EAAAG,IAAsB,GAI/BtO,MAAA,UACAA,MAAA,aAA+BA,MAAA,+EAAaA,4JApCpDA,MAAA,WAAAA,CAUC,WAVDA,CAUC,UASKA,MAAA,GACFA,QACAA,MAAA,UACEA,MAAA,mBACFA,QAGAA,MAAA,EAAAuO,EAAA,cAaFvO,oCAjCAA,MAAA,UAAAA,MAAA,EAAAwO,GAAAL,EAAA3O,YAAA2O,EAAA3O,cAOEQ,MAAA,GAAAA,MAAA,UAAAA,MAAA,GAAAyO,GAAAN,EAAA3O,YAAA2O,EAAA3O,cAMEQ,MAAA,GAAAA,MAAA,IAAAmO,EAAAO,QAAA,KAGA1O,MAAA,GAAAA,MAAA,IAAAA,MAAA,IAAAmO,EAAAQ,OAAA,0BAKC3O,MAAA,GAAAA,MAAA,OAAAmO,EAAA3O,cAAA2O,EAAA5O,iDAjDXS,MAAA,WAAAA,CAAuD,WAAvDA,CAAuD,eAMjDA,MAAA,mBAAAA,MAAA4O,GAAA,MAAAC,EAAA7O,MAAA,UAASA,MAAA6O,EAAAC,SAAQ,GAIjB9O,MAAA,UACFA,QACAA,MAAA,WACEA,MAAA,GACFA,UAIFA,MAAA,eAIEA,MAAA,EAAA+O,EAAA,eAyCF/O,QAGAA,MAAA,WAAAA,CAAsD,YAAtDA,CAAsD,eAIhDA,MAAA,yBAAAsM,GAAAtM,MAAA4O,GAAA,MAAAI,EAAAhP,MAAA,UAAAA,MAAAgP,EAAAC,UAAA3C,EAAA,EAAAtM,CAAuB,yBAAAA,MAAA4O,GAAA,MAAAM,EAAAlP,MAAA,UAGRA,MAAAkP,EAAAC,UAAAD,EAAAE,aAAA/G,UAAgC,GALjDrI,QAUAA,MAAA,gBACEA,MAAA,mBAAAA,MAAA4O,GAAA,MAAAS,EAAArP,MAAA,UAASA,MAAAqP,EAAAF,UAAAE,EAAAD,aAAA/G,UAAgC,GAIzCrI,MAAA,WACAA,MAAA,cAA+BA,MAAA,qCAAKA,yCAvEtCA,MAAA,GAAAA,MAAA,IAAAsP,EAAAF,aAAAxB,eAAA,KAW6B5N,MAAA,GAAAA,MAAA,UAAAsP,EAAAF,aAAA1Q,SAAAsB,CACb,eAAAsP,EAAAC,kBA6CdvP,MAAA,GAAAA,MAAA,UAAAsP,EAAAL,oDA5IdjP,MAAA,WAGEA,MAAA,mBAAAA,MAAAwP,GAAA,MAAAC,EAAAzP,QAAA,OAASA,MAAAyP,EAAAC,oBAAmB,GAE5B1P,MAAA,WAEEA,MAAA,iBAAAsM,GAAA,OAASA,EAAAqD,iBAAwB,GAIjC3P,MAAA,UAAAA,CAEC,WACkDA,MAAA,iBAAWA,QAE5DA,MAAA,eACEA,MAAA,mBAAAA,MAAAwP,GAAA,MAAAI,EAAA5P,QAAA,OAASA,MAAA4P,EAAAC,kBAAiB,GAI1B7P,MAAA,UACAA,MAAA,aAA+BA,MAAA,oCAAKA,UAEtCA,MAAA,eACEA,MAAA,mBAAAA,MAAAwP,GAAA,MAAAM,EAAA9P,QAAA,OAASA,MAAA8P,EAAAJ,oBAAmB,GAI5B1P,MAAA,WACFA,UAIFA,MAAA,aAEEA,MAAA,GAAA+P,EAAA,cAkCA/P,MAAA,GAAAgQ,EAAA,eAyFFhQ,oCA3HQA,MAAA,IAAAA,MAAA,QAAAiQ,EAAAb,cAkCApP,MAAA,GAAAA,MAAA,OAAAiQ,EAAAb,eCtEL,IAAMc,EAAsB,MAA7B,MAAOA,EAoCX9U,YACU6P,EACAzP,EACA2U,EACAC,EACAC,GAJA3U,KAAAuP,cACAvP,KAAAF,iBACAE,KAAAyU,SACAzU,KAAA0U,MACA1U,KAAA2U,wBArCV3U,KAAA4U,SAAU,EACV5U,KAAA6U,kBAAmB,EACnB7U,KAAAuR,eAAiB,CAAEC,EAAG,GAAIC,EAAG,KAC7BzR,KAAA0R,YAAa,EACb1R,KAAA8U,WAAa,CAAEtD,EAAG,EAAGC,EAAG,GACxBzR,KAAA+U,oBAAqB,EACrB/U,KAAA4R,YAAc,EACd5R,KAAAgV,UAAW,EAGXhV,KAAAuS,YAA4B,GAC5BvS,KAAAiV,iBAAkC,KAClCjV,KAAA0T,aAAkC,KAClC1T,KAAAuT,UAAY,GACZvT,KAAAkV,aAAe,GAOPlV,KAAAmV,sBAAuB,EAGdnV,KAAAoV,UAAY,qBACZpV,KAAAO,eAAiB,KAC1BP,KAAAqV,eAA+B,GAC/BrV,KAAAsV,gBAA0B,CAW/B,CAEHC,WACEvV,KAAKwV,mBACLxV,KAAKyV,2BACLzV,KAAK0V,qBAED1V,KAAK4U,SAEP5U,KAAK2V,mBAET,CAEAC,kBACE,CAGFC,qBAGI7V,KAAKmV,sBACLnV,KAAK0T,cACL1T,KAAK8V,mBAGL3F,WAAW,KACTnQ,KAAK+V,iBAEL/V,KAAKmV,sBAAuB,GAC3B,IAEP,CAEAa,cACEhW,KAAK0R,YAAa,EAClB1R,KAAK6U,kBAAmB,EACxBoB,SAASC,KAAKC,MAAMC,OAAS,UAC7BH,SAASC,KAAKG,UAAUrO,OAAO,YAE3BhI,KAAKsW,0BACPtW,KAAKsW,yBAAyBC,cAE5BvW,KAAKwW,qBACPxW,KAAKwW,oBAAoBD,cAG3BN,SAASQ,oBACP,YACAzW,KAAK0W,kBAAkB9H,KAAK5O,OAE9BiW,SAASQ,oBAAoB,UAAWzW,KAAK2W,gBAAgB/H,KAAK5O,MACpE,CAEAwV,mBACE,IACE,MAAMrO,EAAOnH,KAAKuP,YAAYzI,UAC9B9G,KAAK4U,QAAmB,UAATzN,QACR7F,GACPsV,QAAQC,KAAK,+BAAgCvV,GAC7CtB,KAAK4U,SAAU,EAEnB,CAEAkC,qBAEE9W,KAAK6U,kBAAoB7U,KAAK6U,iBAE1B7U,KAAK6U,mBACP7U,KAAK2V,oBACLxF,WAAW,KACTnQ,KAAK+W,6BAA2B,EAC/B,KAEP,CAEA1F,cAAcpB,IAIPjQ,KAAK0R,aAAe1R,KAAKgV,UAC5BhV,KAAK8W,oBAET,CAEQpB,qBAGN1V,KAAKgV,SACH,iEAAiEgC,KAC/DC,UAAUC,YAEZ,iBAAkBC,QAClBF,UAAUG,eAAiB,CAC/B,CAEApD,oBACEhU,KAAK6U,kBAAmB,CAC1B,CAEAkC,8BACE,MAAMM,EAAepB,SAASqB,cAC5B,qCAEED,IAC4BA,EAAaE,iBACzC,yBAEoBC,QAASC,IAC7BA,EAAGtB,MAAMuB,UAAY,QAGCL,EAAaE,iBAAiB,kBACtCC,QAASC,IACvBA,EAAGtB,MAAMwB,IAAM,QAGrB,CAEAlC,2BACE,MAAMmC,EAAgBlS,aAAaC,QAAQ,+BAE3C,GAAIiS,EACF,IACE,MAAMC,EAAiB9Q,KAAKC,MAAM4Q,GAC5BE,EAAS,GACTC,EAAa,GACbC,EAAOb,OAAOc,WAAaF,EAAaD,EACxCI,EAAOf,OAAOgB,YAAcJ,EAAaD,EAE/C,GACED,EAAerG,GAAKsG,GACpBD,EAAerG,GAAKwG,GACpBH,EAAepG,GAAKqG,GACpBD,EAAepG,GAAKyG,EAGpB,YADAlY,KAAKuR,eAAiBsG,SAGjBvW,GACPsV,QAAQC,KAAK,uCAAwCvV,GAIzD,MAEM0W,EAAOb,OAAOc,WADD,GADJ,GAGTC,EAAOf,OAAOgB,YAFD,GADJ,GAKfnY,KAAKuR,eAAiB,CACpBC,EAAG4G,KAAKC,IANK,GAMOL,GACpBvG,EAAG2G,KAAKC,IAPK,GAOOH,GAExB,CAGAnH,kBAAkBd,GAEhBjQ,KAAK0R,YAAa,EAClB1R,KAAK+U,oBAAqB,EAC1B/U,KAAK8U,WAAa,CAChBtD,EAAGvB,EAAMqI,QAAUtY,KAAKuR,eAAeC,EACvCC,EAAGxB,EAAMsI,QAAUvY,KAAKuR,eAAeE,GAEzCxB,EAAMuI,iBACNvI,EAAMgE,kBACNgC,SAASC,KAAKC,MAAMC,OAAS,WAC7BH,SAASC,KAAKG,UAAUoC,IAAI,WAC9B,CAEAxH,mBAAmBhB,GAEjBjQ,KAAK0R,YAAa,EAClB1R,KAAK+U,oBAAqB,EAE1B,MAAM2D,EAAQzI,EAAM0I,QAAQ,GAC5B3Y,KAAK8U,WAAa,CAChBtD,EAAGkH,EAAMJ,QAAUtY,KAAKuR,eAAeC,EACvCC,EAAGiH,EAAMH,QAAUvY,KAAKuR,eAAeE,GAKzCxB,EAAMgE,kBACNgC,SAASC,KAAKC,MAAMC,OAAS,WAC7BH,SAASC,KAAKG,UAAUoC,IAAI,WAC9B,CAEAtH,iBAAiBlB,GACXjQ,KAAK0R,aAAe1R,KAAK+U,qBAK3B9E,EAAMuI,iBACNvI,EAAMgE,kBACNjU,KAAK8W,sBAGP9W,KAAK0R,YAAa,EAClBuE,SAASC,KAAKC,MAAMC,OAAS,UAC7BH,SAASC,KAAKG,UAAUrO,OAAO,YAG/BhI,KAAK+U,oBAAqB,CAC5B,CAGA2B,kBAAkBzG,GACZjQ,KAAK0R,YACPkH,sBAAsB,KACpB,MACMC,EAAO5I,EAAMsI,QAAUvY,KAAK8U,WAAWrD,EAEvCqH,EAAO9Y,KAAKuR,eAAeC,EAC3BuH,EAAO/Y,KAAKuR,eAAeE,EAI3BuG,EAAOb,OAAOc,WADD,GADJ,GAGTC,EAAOf,OAAOgB,YAFD,GADJ,GAKTa,EAASZ,KAAKC,IALL,GAKiBD,KAAKa,IAXxBhJ,EAAMqI,QAAUtY,KAAK8U,WAAWtD,EAWEwG,IACzCkB,EAASd,KAAKC,IANL,GAMiBD,KAAKa,IAAIJ,EAAMX,KAE3CE,KAAKe,IAAIH,EAASF,GAAQ,GAAKV,KAAKe,IAAID,EAASH,GAAQ,KAC3D/Y,KAAK+U,oBAAqB,GAG5B/U,KAAKuR,eAAiB,CACpBC,EAAGwH,EACHvH,EAAGyH,GAGLlZ,KAAKoZ,oBAAkB,EAG7B,CAGAC,kBAAkBpJ,GACZjQ,KAAK0R,YACPkH,sBAAsB,KACpB,MAAMF,EAAQzI,EAAM0I,QAAQ,GAEtBE,EAAOH,EAAMH,QAAUvY,KAAK8U,WAAWrD,EAEvCqH,EAAO9Y,KAAKuR,eAAeC,EAC3BuH,EAAO/Y,KAAKuR,eAAeE,EAI3BuG,EAAOb,OAAOc,WADD,GADJ,GAGTC,EAAOf,OAAOgB,YAFD,GADJ,GAKTa,EAASZ,KAAKC,IALL,GAKiBD,KAAKa,IAXxBP,EAAMJ,QAAUtY,KAAK8U,WAAWtD,EAWEwG,IACzCkB,EAASd,KAAKC,IANL,GAMiBD,KAAKa,IAAIJ,EAAMX,KAE3CE,KAAKe,IAAIH,EAASF,GAAQ,GAAKV,KAAKe,IAAID,EAASH,GAAQ,KAC3D/Y,KAAK+U,oBAAqB,GAG5B/U,KAAKuR,eAAiB,CACpBC,EAAGwH,EACHvH,EAAGyH,GAGLlZ,KAAKoZ,oBAAkB,EAG7B,CAGAzC,kBACM3W,KAAK0R,aACP1R,KAAK0R,YAAa,EAClBuE,SAASC,KAAKC,MAAMC,OAAS,UAC7BH,SAASC,KAAKG,UAAUrO,OAAO,YAE/BmI,WAAW,KACTnQ,KAAK+U,oBAAqB,GACzB,KAEP,CAGAuE,iBAAiBrJ,GAGbjQ,KAAK0R,aACHzB,EAAMsJ,QAAoBC,QAAQ,sBAEpCxZ,KAAK0R,YAAa,EAClBuE,SAASC,KAAKC,MAAMC,OAAS,UAC7BH,SAASC,KAAKG,UAAUrO,OAAO,YAE/BmI,WAAW,KACTnQ,KAAK+U,oBAAqB,GACzB,KAEP,CAGA0E,iBAGE,MAAMzB,EAAOb,OAAOc,WAAaF,GAAaD,GACxCI,EAAOf,OAAOgB,YAAcJ,GAAaD,GAE/C9X,KAAKuR,eAAiB,CACpBC,EAAG4G,KAAKC,IAAIP,GAAQM,KAAKa,IAAIjZ,KAAKuR,eAAeC,EAAGwG,IACpDvG,EAAG2G,KAAKC,IAAIP,GAAQM,KAAKa,IAAIjZ,KAAKuR,eAAeE,EAAGyG,IAExD,CAGAwB,cACM1Z,KAAK6U,mBACP7U,KAAK6U,kBAAmB,EAE5B,CAEQuE,qBACN,IACE1T,aAAaQ,QACX,8BACAa,KAAKiD,UAAUhK,KAAKuR,uBAEfjQ,GACPsV,QAAQC,KAAK,gDAAiDvV,GAElE,CAGQqY,YAAY3W,GAClB,IACE,MAAM6G,EAAY,CAChB7G,SAAUA,EACV8E,UAAWlH,KAAKD,OAElB+E,aAAaQ,QAAQlG,KAAKoV,UAAWrO,KAAKiD,UAAUH,IACpD7J,KAAKqV,eAAiBrS,EACtBhD,KAAKsV,gBAAkB1U,KAAKD,YACrBW,GACPsV,QAAQC,KAAK,kCAAmCvV,GAEpD,CAEQsY,gBACN,IACE,MAAMC,EAAanU,aAAaC,QAAQ3F,KAAKoV,WAC7C,IAAKyE,EAAY,OAAO,KAExB,MAAMC,EAAS/S,KAAKC,MAAM6S,GAI1B,OAHiBjZ,KAAKD,MAAQmZ,EAAOhS,UAGtB9H,KAAKO,gBAClBP,KAAKqV,eAAiByE,EAAO9W,SAC7BhD,KAAKsV,gBAAkBwE,EAAOhS,UACvBgS,EAAO9W,WAIhB0C,aAAamB,WAAW7G,KAAKoV,WACtB,YACA9T,GACPsV,eAAQC,KAAK,qCAAsCvV,GACnDoE,aAAamB,WAAW7G,KAAKoV,WACtB,KAEX,CAEQ2E,eACN,OACE/Z,KAAKqV,eAAe9R,OAAS,GAC7B3C,KAAKD,MAAQX,KAAKsV,gBAAkBtV,KAAKO,cAE7C,CAGAyZ,iBACE,GAAmC,IAA/Bha,KAAKqV,eAAe9R,OACtB,MAAO,CAAE0W,SAAS,EAAOrY,WAAY,KAAMsY,IAAK,GAGlD,MAAMA,EAAMtZ,KAAKD,MAAQX,KAAKsV,gBAG9B,MAAO,CACL2E,QAHcC,EAAMla,KAAKO,eAIzBqB,WAAY,IAAIhB,KAAKZ,KAAKsV,iBAC1B4E,IAAK9B,KAAK+B,MAAMD,EAAM,IAAO,IAEjC,CAGAE,aACE,IACE1U,aAAamB,WAAW7G,KAAKoV,WAC7BpV,KAAKqV,eAAiB,GACtBrV,KAAKsV,gBAAkB,QAChBhU,GACPsV,QAAQC,KAAK,wBAAyBvV,GAE1C,CAGQ+Y,uBAAuBC,GACF,IAAvBA,EAAY/W,SAGhB+W,EAAY9C,QAAS+C,IACnB,MAAMC,EAAexa,KAAKqV,eAAeoF,KACtCC,GAASA,EAAK/N,WAAa4N,EAAWI,UAGrCH,EAEoBA,EAAaxX,SAAS4X,KACzCC,GAAQA,EAAIjI,KAAO2H,EAAW3H,MAK/B4H,EAAaxX,SAAS8X,KAAKP,GAIzB,IAAI3Z,KAAK2Z,EAAWtH,QAAU,IAAIrS,KAAK4Z,EAAapI,mBAEpDoI,EAAarI,YAAcoI,EAAWvH,QACtCwH,EAAapI,gBAAkBmI,EAAWtH,SAIvCsH,EAAW1W,SAAW0W,EAAWzW,aACpC0W,EAAa5I,eAajB5R,KAAKqV,eAAeyF,KARQ,CAC1BnO,SAAU4N,EAAWI,SACrBzI,eAAgBqI,EAAWQ,eAC3B5I,YAAaoI,EAAWvH,QACxBZ,gBAAiBmI,EAAWtH,OAC5BrB,YAAc2I,EAAW1W,QAAW0W,EAAWzW,YAAkB,EAAJ,EAC7Dd,SAAU,CAACuX,OAOjBva,KAAKqV,eAAe3M,KAClB,CAACC,EAAGC,IACF,IAAIhI,KAAKgI,EAAEwJ,iBAAiBtJ,UAC5B,IAAIlI,KAAK+H,EAAEyJ,iBAAiBtJ,WAIhC9I,KAAK2Z,YAAY3Z,KAAKqV,gBAGtBrV,KAAKuS,YAAc,IAAIvS,KAAKqV,gBAC9B,CAGQM,oBAEN3V,KAAKgb,gBAAe,EACtB,CAEQA,eAAeC,GAA+B,GACpDjb,KAAK2U,sBAAsBjT,iBAAiB,YAAYiM,UAAU,CAChEvM,KAAO4B,IACL,GAAIA,GAAYA,EAASO,OAAS,EAAG,CACnC,MAAM2X,EAAkBlb,KAAKmb,sBAAsBnY,GAGnDhD,KAAKuS,YAAc2I,EAAgBxS,KACjC,CAACC,EAAGC,IACF,IAAIhI,KAAKgI,EAAEwJ,iBAAiBtJ,UAC5B,IAAIlI,KAAK+H,EAAEyJ,iBAAiBtJ,WAIhC9I,KAAK2Z,YAAY3Z,KAAKuS,kBAMtBvS,KAAKyU,OAAOnT,MAAM,wEAClBtB,KAAKuS,YAAc,GACnBvS,KAAK2Z,YAAY,GAAE,EAGvBrY,MAAQ8Z,IACNpb,KAAKyU,OAAOnT,MAAM8Z,EAAInP,SACtBjM,KAAKuS,YAAc,GACnBvS,KAAK2Z,YAAY,GAAE,GAGzB,CAEAxF,kBAEEnU,KAAKF,eAAemD,mBAAmB0K,UAAU,CAC/CvM,KAAOsB,IACL,GAAIA,GAAYA,EAASM,SAAU,CACjC,MAAMkY,EAAkBlb,KAAKmb,sBAAsBzY,EAASM,UAG5DhD,KAAKuS,YAAc2I,EAAgBxS,KACjC,CAACC,EAAGC,IACF,IAAIhI,KAAKgI,EAAEwJ,iBAAiBtJ,UAC5B,IAAIlI,KAAK+H,EAAEyJ,iBAAiBtJ,WAIhC9I,KAAK2Z,YAAY3Z,KAAKuS,aAGtBvS,KAAK0U,IAAI2G,qBAETrb,KAAKyU,OAAOnT,MAAM,uEAAe,EAGrCA,MAAQ8Z,IACNpb,KAAKyU,OAAOnT,MAAM8Z,EAAInP,SAAW,4GAAsB,GAG7D,CAEA+F,WAAW0I,GACT1a,KAAK0T,aAAegH,EACpB1a,KAAKiV,iBAAmByF,EAAK/N,SAGzB3M,KAAK0T,cAAgB1T,KAAK0T,aAAa1Q,WAEzChD,KAAKsb,yBAAyBZ,EAAK/N,UAGnC3M,KAAKmV,sBAAuB,EAEhC,CAEQoG,iBAAiB5O,GAEvB,GAAI3M,KAAKqV,eAAe9R,OAAS,EAAG,CAClC,MAAMiY,EACJxb,KAAKqV,eAAeoF,KAAMC,GAASA,EAAK/N,WAAaA,IACjD3J,UAAY,GAEdhD,KAAK0T,eACP1T,KAAK0T,aAAa1Q,SAAWwY,EAG7Bxb,KAAKsb,yBAAyB3O,GAG9BwD,WAAW,KACTnQ,KAAK+V,gBAAc,EAClB,WAIL/V,KAAKgb,gBAAe,EAExB,CAGQM,yBAAyB3O,GAC/B,IAAK3M,KAAK0T,aAAc,OAExB,MAAM+H,EAAiBzb,KAAK0T,aAAa1Q,SAAShC,OAC/C6Z,IAASA,EAAI/W,cAAgB+W,EAAIhX,QAGhC4X,EAAelY,OAAS,GAE1BkY,EAAejE,QAASvL,IACtBjM,KAAKF,eAAesM,kBAAkBH,EAAQ2G,IAAI,GAAMjF,UAAU,CAChEvM,KAAOsB,IACL,GAAIA,EAASuD,QAAS,CAEpBgG,EAAQpI,QAAS,EAGjB,MAAM6X,EAAa1b,KAAKuS,YAAYkI,KACjCkB,GAAMA,EAAEhP,WAAaA,GAEpB+O,IACFA,EAAW9J,YAAcwG,KAAKC,IAC5B,EACAqD,EAAW9J,YAAc,IAK7B5R,KAAK2Z,YAAY3Z,KAAKuS,aAGtBvS,KAAK0U,IAAI2G,kBAGb/Z,MAAQ8Z,IACNxE,QAAQtV,MAAM,iCAAkC8Z,EAAG,GAEtD,EAGP,CAEQQ,cACN,MAAM9F,EAAoBG,SAASqB,cAAc,sBAC7CxB,IACFA,EAAkB+F,UAAY,EAElC,CAEQ9F,iBACF/V,KAAK8V,mBAAqB9V,KAAK8V,kBAAkBgG,gBAEnD9b,KAAK8V,kBAAkBgG,cAAcD,UACnC7b,KAAK8V,kBAAkBgG,cAAcC,aAE3C,CAEQZ,sBAAsBnY,GAC5B,MAAMgZ,EAAU,IAAI5b,IAEpB4C,SAASwU,QAASvL,IAChB,MAAM0O,EAAW1O,EAAQ0O,SACzB,GAAKqB,EAAQja,IAAI4Y,GASV,CACL,MAAMD,EAAOsB,EAAQna,IAAI8Y,GACzBD,EAAK1X,SAAS8X,KAAK7O,GAEf,IAAIrL,KAAKqL,EAAQgH,QAAU,IAAIrS,KAAK8Z,EAAKtI,mBAC3CsI,EAAKvI,YAAclG,EAAQ+G,QAC3B0H,EAAKtI,gBAAkBnG,EAAQgH,QAG5BhH,EAAQpI,QACX6W,EAAK9I,mBAlBPoK,EAAQ/Z,IAAI0Y,EAAU,CACpBhO,SAAUgO,EACVzI,eAAgBjG,EAAQ8O,eACxB5I,YAAalG,EAAQ+G,QACrBZ,gBAAiBnG,EAAQgH,OACzBrB,YAAa3F,EAAQpI,OAAS,EAAI,EAClCb,SAAU,CAACiJ,OAkBjB9I,MAAM2G,KAAKkS,EAAQC,UAAUzE,QAASkD,IACpCA,EAAK1X,SAAS0F,KACZ,CAACC,EAAGC,IAAM,IAAIhI,KAAK+H,EAAEsK,QAAQnK,UAAY,IAAIlI,KAAKgI,EAAEqK,QAAQnK,UAAS,GAIlE3F,MAAM2G,KAAKkS,EAAQC,SAC5B,CAEAxI,UAAU9G,GACR,IAAK3M,KAAKuT,WAAuC,KAA1BvT,KAAKuT,UAAU2I,OAEpC,YADAlc,KAAKyU,OAAOnT,MAAM,wEAIpB,MAAM6a,EAAenc,KAAKuT,UAC1BvT,KAAKuT,UAAY,GAEjBvT,KAAKF,eAAe4M,eAAeC,EAAUwP,GAAcxO,UAAU,CACnEvM,KAAOsB,IACL,GAAIA,EAASuD,SAKX,GAJAjG,KAAKyU,OAAOxO,QAAQ,uGAIhBjG,KAAK0T,aAAc,CACrB,MAAM0I,EAAW,CACfxJ,GAAIlQ,EAAS2J,WAAazL,KAAKD,MAC/BqS,QAASmJ,EACTlJ,YAAYrS,MAAOyb,cACnBvY,aAAa,EACbD,QAAQ,EACR8W,SAAU,QACVI,eAAgB,SAIlB/a,KAAK0T,aAAa1Q,SAAS8X,KAAKsB,GAGhC,MAAMV,EAAa1b,KAAKuS,YAAYkI,KACjCkB,GAAMA,EAAEhP,WAAaA,GAEpB+O,IACFA,EAAWvJ,YAAcgK,EACzBT,EAAWtJ,gBAAkBgK,EAASnJ,OAGtCjT,KAAKuS,YAAY7J,KACf,CAACC,EAAGC,IACF,IAAIhI,KAAKgI,EAAEwJ,iBAAiBtJ,UAC5B,IAAIlI,KAAK+H,EAAEyJ,iBAAiBtJ,YAKlC9I,KAAK2Z,YAAY3Z,KAAKuS,aAGtBvS,KAAK0U,IAAI2G,gBAGTlL,WAAW,KACTnQ,KAAK+V,gBAAc,EAClB,WAGL/V,KAAKyU,OAAOnT,MAAMoB,EAASuJ,SAAW,0FAAmB,EAG7D3K,MAAQ8Z,IACNpb,KAAKyU,OAAOnT,MAAM8Z,EAAInP,SAAW,0FAAmB,GAG1D,CAEA0G,WAAWtG,GACTrM,KAAKF,eAAesM,kBAAkBC,GAAW,GAAMsB,UAAU,CAC/DvM,KAAOsB,IACL,GAAIA,EAASuD,QAAS,CAEpB,GAAIjG,KAAK0T,aAAc,CACrB,MAAMzH,EAAUjM,KAAK0T,aAAa1Q,SAASyX,KACxCI,GAAQA,EAAIjI,KAAOvG,GAEtB,GAAIJ,EAAS,CACXA,EAAQpI,QAAS,EAGjB,MAAM6X,EAAa1b,KAAKuS,YAAYkI,KACjCkB,GAAMA,EAAEhP,WAAa3M,KAAK0T,cAAc/G,UAEvC+O,IACFA,EAAW9J,YAAcwG,KAAKC,IAC5B,EACAqD,EAAW9J,YAAc,IAK7B5R,KAAK2Z,YAAY3Z,KAAKuS,cAI1BvS,KAAK0U,IAAI2G,kBAGb/Z,MAAQ8Z,IACNxE,QAAQtV,MAAM,iCAAkC8Z,EAAG,GAGzD,CAEAhI,SACEpT,KAAK0T,aAAe,KACpB1T,KAAKiV,iBAAmB,IAC1B,CAEApB,iBAAiByI,EAAerQ,GAC9B,OAAOA,EAAQ2G,EACjB,iDAvzBW4B,GAAsBlQ,MAAAC,KAAAD,MAAAE,KAAAF,MAAAG,MAAAH,mBAAAI,KAAA,oCAAtB8P,EAAsB+H,UAAA,yBAAAC,UAAA,SAAAC,EAAAC,MAAA,EAAAD,gJAAtBC,EAAAhG,kBAAA9F,EACZ,KAAAtM,OAAA,qBAAAsM,GAAA,OADY8L,EAAArD,kBAAAzI,EACZ,KAAAtM,OAAA,4BADYoY,EAAA/F,iBAAiB,KAAArS,OAAA,oBAAAsM,GAAA,OAAjB8L,EAAApD,iBAAA1I,EACb,KAAAtM,OAAA,2BADaoY,EAAAjD,gBAAgB,KAAAnV,OAAA,mCAAhBoY,EAAAhD,aAAa,KAAApV,+iJD9B1BA,MAAA,EAAAqY,EAAA,aA8BArY,MAAA,EAAAsY,EAAA,qBA7BGtY,MAAA,OAAAoY,EAAA9H,SA8BAtQ,MAAA,GAAAA,MAAA,OAAAoY,EAAA9H,SAAA8H,EAAA7H,6+GCDUL,CAAsB,sFCnBzBlQ,MAAA,UAIEA,MAAA,uBACFA,+BACAA,MAAA,UAMEA,MAAA,iBACFA,+BACAA,MAAA,UAMEA,MAAA,kBACFA,+BACAA,MAAA,UAMEA,MAAA,aACFA,+BAGAA,MAAA,UAMEA,MAAA,aACFA,+BAoDAA,MAAA,UAMEA,MAAA,aACFA,gCAEAA,MAAA,GACEA,MAAA,UAKEA,MAAA,aACFA,QACAA,MAAA,UAKEA,MAAA,gBACFA,QACFA,kDAEAA,MAAA,UAEEA,MAAA,mBAAAA,MAAAuN,GAAA,MAAAE,EAAAzN,QAAA,OAASA,MAAAyN,EAAAnL,SAAQ,GAGjBtC,MAAA,cACFA,kDA+EAA,MAAA,GACEA,MAAA,UAGEA,MAAA,mBAAAA,MAAAuY,GAAA,MAAAC,EAAAxY,QAAA,OAASA,MAAAwY,EAAAC,YAAW,GAEpBzY,MAAA,aACFA,QACAA,MAAA,UAGEA,MAAA,mBAAAA,MAAAuY,GAAA,MAAAG,EAAA1Y,QAAA,OAASA,MAAA0Y,EAAAD,YAAW,GAEpBzY,MAAA,gBACFA,QACFA,kDAEAA,MAAA,UAEEA,MAAA,mBAAAA,MAAA2Y,GAAA,MAAAC,EAAA5Y,QAAS4Y,SAAAtW,SAAUtC,MAAA4Y,EAAAH,YAAW,GAG9BzY,MAAA,cACFA,mCAcNA,MAAA,WAAAA,CAA6C,WAEzCA,MAAA,GACFA,oCADEA,MAAA,GAAAA,MAAA,IAAA6Y,EAAAnK,QAAA,gCARR1O,MAAA,WAAAA,CAIC,YAEGA,MAAA,EAAA8Y,GAAA,cAKF9Y,gCATAA,MAAA,MAAA+Y,EAAAC,sBAAA,MAIwBhZ,MAAA,GAAAA,MAAA,UAAA+Y,EAAAva,yDCtOnB,IAAMya,GAAe,MAAtB,MAAOA,EAYX7d,YACU6P,EACAtK,EACAwP,EACA1U,GAHAC,KAAAuP,cACAvP,KAAAiF,SACAjF,KAAAyU,SACAzU,KAAAD,cAbAC,KAAAwd,mBAAqB,IAAIC,MAEnCzd,KAAA0d,YAAa,EACb1d,KAAA4U,SAAU,EACV5U,KAAA8C,MAAgB,GAChB9C,KAAA2d,YAAa,EACb3d,KAAAkV,aAAe,GACflV,KAAA4d,iBAAmB,GAQjB5d,KAAKuP,YAAYhK,YAAYoI,UAAWkQ,IACtC7d,KAAK0d,WAAaG,EAClB,MAAM1W,EAAOnH,KAAKuP,YAAYzI,UAC9B9G,KAAK4U,QAAmB,UAATzN,CAAS,EAE5B,CACAoO,WACEvV,KAAK8M,UACP,CAEA8I,kBACE5V,KAAK8d,uBACP,CAEAA,wBACE3N,WAAW,KAELnQ,KAAK+d,aACP/d,KAAK4d,iBAAmB5d,KAAK+d,WAAWjC,cAAckC,cAIxD,MACMC,EAAcje,KAAK4d,iBADe,GAApB5d,KAAK8C,MAAMS,OAE/BvD,KAAKkV,aAAe+I,EACpBje,KAAKwd,mBAAmBU,KAAKD,EAAW,EACvC,IACL,CAEAX,sBACE,OAAOtd,KAAK4d,gBACd,CAEAhX,SACE5G,KAAKuP,YAAY3I,SACjB5G,KAAKyU,OAAOxO,QAAQ,mHACpBjG,KAAKiF,OAAOkB,SAAS,CAAC,WACxB,CAEA2G,WACE9M,KAAKD,YAAY+M,WAAWa,UAAWjL,IAErC,MAAMI,EAAQK,MAAMC,QAAQV,EAASI,OACjCJ,EAASI,MACRJ,EAASI,OAAe7B,MAAQ,GACrCjB,KAAK8C,MAAQA,EAAM9B,OAAQmd,GAA0B,GAAdA,EAAEC,UAEzCjO,WAAW,IAAMnQ,KAAK8d,wBAAyB,GAAE,EAErD,CACAO,aACEre,KAAK2d,YAAc3d,KAAK2d,UAC1B,CAEAZ,YACE/c,KAAK2d,YAAa,CACpB,CAGAW,SAASrO,GACPjQ,KAAK8d,uBACP,iDA/EWP,GAAejZ,MAAAC,KAAAD,MAAAE,MAAAF,MAAAG,MAAAH,MAAAI,KAAA,oCAAf6Y,EAAehB,UAAA,iBAAAC,UAAA,SAAAC,EAAAC,MAAA,EAAAD,iMAAfC,EAAA4B,SAAA1N,EAAgB,KAAAtM,ukODrB7BA,MAAA,YAAAA,CAGC,eAHDA,CAGC,UAHDA,CAGC,UAHDA,CAGC,WASSA,MAAA,EAAAia,EAAA,WAMAja,MAAA,EAAAka,EAAA,WAQAla,MAAA,EAAAma,EAAA,WAQAna,MAAA,GAAAoa,EAAA,WAUApa,MAAA,GAAAqa,EAAA,YAQFra,QAGAA,MAAA,YAAAA,CAA+D,WAM3DA,MAAA,6BACFA,QACAA,MAAA,WAKEA,MAAA,wBACFA,QACAA,MAAA,WAKEA,MAAA,wBACFA,QACAA,MAAA,WAKEA,MAAA,oBACFA,QACAA,MAAA,WAKEA,MAAA,qBACFA,QACAA,MAAA,WAKEA,MAAA,gBACFA,UAIFA,MAAA,aAEEA,MAAA,GAAAsa,EAAA,YASAta,MAAA,GAAAua,GAAA,uBAiBAva,MAAA,GAAAwa,GAAA,YAOFxa,QAGAA,MAAA,YAAAA,CAAuB,gBACbA,MAAA,0BAASoY,EAAA2B,YAAY,GAC3B/Z,cAAA,aAQEA,MAAA,cAKFA,cAMNA,cAAA,YAAAA,CAGC,YAHDA,CAGC,WAMKA,MAAA,0BAASoY,EAAAK,WAAW,GAEpBzY,MAAA,6BACFA,QACAA,MAAA,WAIEA,MAAA,0BAASoY,EAAAK,WAAW,GAEpBzY,MAAA,wBACFA,QACAA,MAAA,WAIEA,MAAA,0BAASoY,EAAAK,WAAW,GAEpBzY,MAAA,wBACFA,QACAA,MAAA,WAIEA,MAAA,0BAASoY,EAAAK,WAAW,GAEpBzY,MAAA,oBACFA,QACAA,MAAA,WAIEA,MAAA,0BAASoY,EAAAK,WAAW,GAEpBzY,MAAA,qBACFA,QACAA,MAAA,WAIEA,MAAA,0BAASoY,EAAAK,WAAW,GAEpBzY,MAAA,gBACFA,QAEAA,MAAA,GAAAya,GAAA,uBAiBAza,MAAA,GAAA0a,GAAA,YAOF1a,gBAORA,MAAA,GAAA2a,GAAA,qBAvOa3a,MAAA,GAAAA,MAAA,QAAAoY,EAAA9H,SAKAtQ,MAAA,GAAAA,MAAA,OAAAoY,EAAA9H,SAQAtQ,MAAA,GAAAA,MAAA,OAAAoY,EAAA9H,SAQAtQ,MAAA,GAAAA,MAAA,OAAAoY,EAAA9H,SAUAtQ,MAAA,GAAAA,MAAA,OAAAoY,EAAAgB,aAAAhB,EAAA9H,SA2DAtQ,MAAA,IAAAA,MAAA,OAAAoY,EAAAgB,aAAAhB,EAAA9H,SAQYtQ,MAAA,GAAAA,MAAA,QAAAoY,EAAAgB,YAkBZpZ,MAAA,GAAAA,MAAA,OAAAoY,EAAAgB,YAgCLpZ,MAAA,GAAAA,MAAA,UAAAA,MAAA,GAAAyO,GAAA2J,EAAAiB,YAAAjB,EAAAiB,aAoDiBrZ,MAAA,IAAAA,MAAA,QAAAoY,EAAAgB,YAkBZpZ,MAAA,GAAAA,MAAA,OAAAoY,EAAAgB,YAgBVpZ,MAAA,GAAAA,MAAA,OAAAoY,EAAA5Z,MAAAS,OAAA,2nJCnOUga,CAAe,KCbf2B,GAAY,MAAnB,MAAOA,EAIXxf,YACUyf,GAAAnf,KAAAmf,gBAJVnf,KAAA8O,MAAQ,qBACR9O,KAAAkV,aAAe,EAIZ,CAEHK,WAEEpF,WAAW,KACTnQ,KAAKmf,cAAcrP,SAAS,GAAE,EAC7B,IACL,CAEAkG,cACE,CAGFoJ,qBAAqBC,GACnBrf,KAAKkV,aAAemK,CACtB,iDArBWH,GAAY5a,MAAAC,GAAA,oCAAZ2a,EAAY3C,UAAA,eAAA+C,MAAA,EAAAC,KAAA,EAAAC,OAAA,qKAAAC,SAAA,SAAAhD,EAAAC,GAAA,EAAAD,ICRzBnY,MAAA,kBAAYA,MAAA,8BAAAsM,GAAA,OAAsB8L,EAAA0C,qBAAAxO,EAA4B,GAAEtM,QAChEA,MAAA,WAKEA,MAAA,mBACFA,QAGAA,MAAA,wBAEAA,MAAA,kBAAAA,CAMG,SAAwBA,MAAA,gBAAUA,iBAhBnCA,MAAA,GAAAA,MAAA,aAAAoY,EAAAxH,aAAA,KAAA5Q,CAAoC,6BAAAoY,EAAAxH,aAAA,OAepC5Q,MAAA,GAAAA,MAAA,2DDTW4a,CAAY,yCEIlB,IAAMQ,GAAe,MAAtB,MAAOA,EACXhgB,YAAoBigB,GAAA3f,KAAA2f,SAA6B,CAEjDC,UACEC,EACAze,GAEApB,KAAK2f,QAAQG,OAEb,MAAMra,EAAQC,aAAaC,QAAQ,SACnC,IAAIoa,EAAYF,EAEhB,OAAIpa,IACFsa,EAAYF,EAAIG,MAAM,CACpBC,WAAY,CACVC,cAAe,UAAUza,QAKxBrE,EAAK+e,OAAOJ,GAAWhf,QAC5Bqf,MAAS,KACPpgB,KAAK2f,QAAQU,MAAI,GAGvB,iDAzBWX,GAAepb,MAAAC,MAAA,sCAAfmb,EAAe9a,QAAf8a,EAAe7a,WAAA,SAAf6a,CAAe,+BCCrB,IAAMY,GAAgB,MAAvB,MAAOA,EACX5gB,YAAoBwK,GAAAlK,KAAAkK,cAA6B,CAEjD0V,UAAU1X,EAA2B9G,GAInC,GAAuB,QAAnB8G,EAAQqY,QAAoBvgB,KAAKwgB,YAAYtY,EAAQuY,KAAM,CAC7D,MAAMC,EAAiB1gB,KAAKkK,aAAarI,IAAIqG,EAAQuY,KACrD,GAAIC,EACF,SAAOnf,OAAG,IAAIof,KAAa,CAAEzK,KAAMwK,KAIvC,OAAOtf,EAAK+e,OAAOjY,EACrB,CAEQsY,YAAYC,GAYlB,MAVsB,CACpB,kBACA,UACA,SACA,iBACA,cACA,sBACA,4BAGmB7F,KAAKgG,GAAgBH,EAAIvX,SAAS0X,GACzD,iDA9BWN,GAAgBhc,MAAAC,MAAA,sCAAhB+b,EAAgB1b,QAAhB0b,EAAgBzb,WAAA,SAAhByb,CAAgB,oBCyBtB,IAAMO,GAAS,MAAhB,MAAOA,oDAAS,mCAATA,EAASC,UAAA,CAFR5B,KAAY,wCAPb,CACT,CAAE6B,QAASC,KAAmBC,SAAUvB,GAAiBwB,OAAO,GAChE,CAAEH,QAASC,KAAmBC,SAAUX,GAAkBY,OAAO,GACjEC,KACAC,KACAxR,GACD5B,QAAA,CAlBCqT,KACA5R,EACA6R,KACAC,MACAC,KAAa7R,QAAQ,CACnB8R,QAAS,IACTC,cAAe,kBACfC,mBAAmB,IAErBR,KAAiBxR,QAAQ,CAAEhO,KAAM,qBACjCoM,OAAY,SAWH8S,CAAS,KClCtBe,OACGC,gBAAgBhB,IAChBiB,MAAO1G","names":["AdminDashboardService","constructor","playerService","matchService","leagueService","messageService","noteService","this","essentialDataCache$","BehaviorSubject","secondaryDataCache","Map","lastEssentialUpdate","lastSecondaryUpdate","CACHE_DURATION","SECONDARY_CACHE_DURATION","getEssentialData","forceRefresh","now","Date","value","asObservable","pipe","filter","data","loadEssentialDataFromServer","tap","next","catchError","error","of","getEmptyDashboardData","shareReplay","getSecondaryData","type","lastUpdate","get","hasValidCache","has","loadSecondaryDataFromServer","set","forkJoin","players","getAdminPlayers","matches","getAdminMatches","currentLeague","getAdminCurrentLeague","map","response","league","allLeagues","getAdminAllLeagues","notes","getAdminNotes","messages","getAdminMessages","messagesList","Array","isArray","stats","totalPlayers","length","totalMatches","totalMatchesLeft","m","isCompleted","totalMessagesLeft","isRead","isFromAdmin","invalidateCache","delete","clear","getCurrentEssentialData","updateMessageCount","count","current","i0","i1","i2","i3","i4","i5","factory","ɵfac","providedIn","AuthService","http","router","baseUrl","environment","apiUrl","isLoggedInSubject","hasToken","isLoggedIn$","userRole","token","localStorage","getItem","getRoleFromToken","login","email","password","post","success","setItem","navigate","playerLogin","phoneNumber","extractedRole","register","firstName","lastName","resetPassword","newPassword","logout","removeItem","getRole","JSON","parse","atob","split","role","CacheService","cache","DEFAULT_TTL","PLAYER_TTL","LEAGUE_TTL","RANKINGS_TTL","loadFromLocalStorage","key","ttl","item","timestamp","saveToLocalStorage","remove","cacheRequest","request","cached","cachePlayerRequest","cacheLeagueRequest","cacheRankingsRequest","cacheAllLeaguesRequest","createdOn","sortedData","sort","a","b","dateA","getTime","invalidatePattern","pattern","keys","includes","getNextPlayerUpdateTime","getFullYear","getMonth","getDate","getHours","getLastUpdateTime","isCacheExpired","getCacheExpiryTime","shouldRefreshRankings","shouldRefreshCurrentLeague","cacheData","from","entries","stringify","LeagueService","cacheService","resetLeague","LeagueId","startLeague","dto","GetCurrentLeague","GetAllLeaguesRank","DeleteLeague","leagueId","createGroupsAndMatches","startKnockoutStage","startSemiFinals","startFinal","getLastLeaguesRankUpdateTime","getLastCurrentLeagueUpdateTime","isRankingsCacheExpired","isCurrentLeagueCacheExpired","getNextRankingsUpdateTime","getNextCurrentLeagueUpdateTime","forceRefreshRankings","forceRefreshCurrentLeague","MatchService","getMatches","updateMatch","matchId","winnerId","refreshPlayers","resetMatch","getLastMatchesUpdateTime","MessageService","sendMessage","message","Content","getMessages","toggleMarkMessage","messageId","marked","Marked","toggleDeleteMessage","getPlayerMessages","sendAdminReply","playerId","NoteService","sendNote","getNotes","toggleMarHide","noteId","DeleteNote","PlayerService","rankingSubject","ranking$","getrank","getPlayers","addPlayer","fullName","deletePlayer","refreshRanking","subscribe","getNextUpdateTime","getLastRankingUpdateTime","getLastPlayersUpdateTime","SharedModule","imports","CommonModule","FormsModule","production","routes","path","redirectTo","pathMatch","loadChildren","__webpack_require__","e","then","bind","PlayerModule","title","AuthModule","Promise","all","AdminModule","canActivate","authGuard","route","state","authService","inject","AppRoutingModule","RouterModule","forRoot","TitleStrategyService","defaultTitle","setTitle","setupTitleUpdates","events","event","NavigationEnd","setTimeout","updateTitle","currentRoute","getCurrentRoute","snapshot","routerState","root","firstChild","currentActivatedRoute","$event","_r3","ctx_r2","onButtonMouseDown","ctx_r4","onButtonTouchStart","ctx_r5","onButtonTouchEnd","ctx_r6","onButtonClick","ctx_r0","buttonPosition","x","y","isDragging","chat_r10","unreadCount","_r14","$implicit","ctx_r13","selectChat","FloatingInboxComponent_div_1_div_12_div_2_div_10_Template","playerFullName","lastMessage","lastMessageDate","FloatingInboxComponent_div_1_div_12_div_2_Template","ctx_r7","playerChats","_r21","message_r17","ctx_r19","markAsRead","id","FloatingInboxComponent_div_1_div_13_div_8_div_7_Template","_c1","_c2","content","sentAt","_r23","ctx_r22","goBack","FloatingInboxComponent_div_1_div_13_div_8_Template","ctx_r24","replyText","ctx_r25","sendReply","selectedChat","ctx_r26","ctx_r8","trackByMessageId","_r28","ctx_r27","closeInboxOverlay","stopPropagation","ctx_r30","refreshMessages","ctx_r31","FloatingInboxComponent_div_1_div_12_Template","FloatingInboxComponent_div_1_div_13_Template","ctx_r1","FloatingInboxComponent","toastr","cdr","adminDashboardService","isAdmin","showInboxOverlay","dragOffset","hasMovedDuringDrag","isMobile","selectedPlayerId","navbarHeight","shouldScrollToBottom","CACHE_KEY","cachedMessages","lastCacheUpdate","ngOnInit","checkAdminStatus","setInitialButtonPosition","detectMobileDevice","loadAdminMessages","ngAfterViewInit","ngAfterViewChecked","messagesContainer","scrollToBottom","ngOnDestroy","document","body","style","cursor","classList","updateStatusSubscription","unsubscribe","refreshSubscription","removeEventListener","onGlobalMouseMove","onGlobalMouseUp","console","warn","toggleInboxOverlay","fixInboxComponentForOverlay","test","navigator","userAgent","window","maxTouchPoints","inboxElement","querySelector","querySelectorAll","forEach","el","marginTop","top","savedPosition","parsedPosition","margin","buttonSize","maxX","innerWidth","maxY","innerHeight","Math","max","clientX","clientY","preventDefault","add","touch","touches","requestAnimationFrame","newY","oldX","oldY","finalX","min","finalY","abs","saveButtonPosition","onGlobalTouchMove","onGlobalTouchEnd","target","closest","onWindowResize","onEscapeKey","saveToCache","loadFromCache","cachedData","parsed","isCacheValid","getCacheStatus","isValid","age","floor","clearCache","updateCacheWithNewData","newMessages","newMessage","existingChat","find","chat","senderId","some","msg","push","senderFullName","loadFromServer","isBackgroundRefresh","groupedMessages","groupMessagesBySender","err","detectChanges","markUnreadMessagesAsRead","loadChatMessages","playerMessages","unreadMessages","chatInList","c","scrollToTop","scrollTop","nativeElement","scrollHeight","chatMap","values","trim","replyContent","newReply","toISOString","index","selectors","viewQuery","rf","ctx","FloatingInboxComponent_div_0_Template","FloatingInboxComponent_div_1_Template","_r16","ctx_r15","closeMenu","ctx_r17","_r19","ctx_r18","note_r21","NavbarComponent_div_49_div_2_Template","ctx_r12","getNavbarOnlyHeight","NavbarComponent","navbarHeightChange","EventEmitter","isLoggedIn","isMenuOpen","navbarOnlyHeight","loggedIn","calculateNavbarHeight","navbarOnly","offsetHeight","totalHeight","emit","n","isHidden","toggleMenu","onResize","NavbarComponent_a_7_Template","NavbarComponent_a_8_Template","NavbarComponent_a_9_Template","NavbarComponent_a_10_Template","NavbarComponent_a_11_Template","NavbarComponent_a_26_Template","NavbarComponent_ng_container_27_Template","NavbarComponent_a_28_Template","NavbarComponent_ng_container_47_Template","NavbarComponent_a_48_Template","NavbarComponent_div_49_Template","AppComponent","titleStrategy","onNavbarHeightChange","height","decls","vars","consts","template","AuthInterceptor","spinner","intercept","req","show","clonedReq","clone","setHeaders","Authorization","handle","finalize","hide","CacheInterceptor","method","shouldCache","url","cachedResponse","HttpResponse","cacheableUrl","AppModule","bootstrap","provide","HTTP_INTERCEPTORS","useClass","multi","NgxSpinnerModule","Title","BrowserModule","HttpClientModule","NoopAnimationsModule","ToastrModule","timeOut","positionClass","preventDuplicates","__NgCli_bootstrap_1","bootstrapModule","catch"],"sourceRoot":"webpack:///","sources":["./src/app/core/services/admin-dashboard.service.ts","./src/app/core/services/auth.service.ts","./src/app/core/services/cache.service.ts","./src/app/core/services/league.service.ts","./src/app/core/services/match.service.ts","./src/app/core/services/message.service.ts","./src/app/core/services/note.service.ts","./src/app/core/services/player.service.ts","./src/app/shared/shared.module.ts","./src/environments/environment.ts","./src/app/app-routing.module.ts","./src/app/core/guards/auth.guard.ts","./src/app/core/services/title-strategy.service.ts","./src/app/shared/floating-inbox/floating-inbox.component.html","./src/app/shared/floating-inbox/floating-inbox.component.ts","./src/app/navbar/navbar.component.html","./src/app/navbar/navbar.component.ts","./src/app/app.component.ts","./src/app/app.component.html","./src/app/interceptors/auth-interceptor.service.ts","./src/app/core/interceptors/cache-interceptor.service.ts","./src/app/app.module.ts","./src/main.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { Observable, BehaviorSubject, forkJoin, of } from 'rxjs';\r\nimport { map, tap, catchError, shareReplay, filter } from 'rxjs/operators';\r\nimport { PlayerService } from './player.service';\r\nimport { MatchService } from './match.service';\r\nimport { LeagueService } from './league.service';\r\nimport { MessageService } from './message.service';\r\nimport { NoteService } from './note.service';\r\nimport {\r\n  Player,\r\n  Match,\r\n  League,\r\n  AllLeagueRank,\r\n  Note,\r\n  Message,\r\n} from '../../models/interfaces';\r\n\r\nexport interface AdminDashboardData {\r\n  players: Player[];\r\n  matches: Match[];\r\n  currentLeague: League | null;\r\n  allLeagues: AllLeagueRank[];\r\n  notes: Note[];\r\n  messages: Message[];\r\n  stats: {\r\n    totalPlayers: number;\r\n    totalMatches: number;\r\n    totalMatchesLeft: number;\r\n    totalMessagesLeft: number;\r\n  };\r\n}\r\n\r\nexport interface AdminSecondaryData {\r\n  allLeagues: AllLeagueRank[];\r\n  notes: Note[];\r\n  messages: Message[];\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class AdminDashboardService {\r\n  private essentialDataCache$ = new BehaviorSubject<AdminDashboardData | null>(\r\n    null\r\n  );\r\n  private secondaryDataCache = new Map<string, any>();\r\n  private lastEssentialUpdate = 0;\r\n  private lastSecondaryUpdate = new Map<string, number>();\r\n  private readonly CACHE_DURATION = 900000; // 15 minutes\r\n  private readonly SECONDARY_CACHE_DURATION = 900000; // 15 minutes (same as main cache)\r\n\r\n  constructor(\r\n    private playerService: PlayerService,\r\n    private matchService: MatchService,\r\n    private leagueService: LeagueService,\r\n    private messageService: MessageService,\r\n    private noteService: NoteService\r\n  ) {}\r\n\r\n  /**\r\n   * Get essential dashboard data with smart caching\r\n   */\r\n  getEssentialData(forceRefresh = false): Observable<AdminDashboardData> {\r\n    const now = Date.now();\r\n    const hasValidCache =\r\n      this.essentialDataCache$.value &&\r\n      now - this.lastEssentialUpdate < this.CACHE_DURATION;\r\n\r\n    if (!forceRefresh && hasValidCache) {\r\n      return this.essentialDataCache$\r\n        .asObservable()\r\n        .pipe(filter((data): data is AdminDashboardData => data !== null));\r\n    }\r\n\r\n    return this.loadEssentialDataFromServer().pipe(\r\n      tap((data) => {\r\n        this.essentialDataCache$.next(data);\r\n        this.lastEssentialUpdate = now;\r\n      }),\r\n      catchError((error) => {\r\n        // Return cached data if available, otherwise empty state\r\n        return of(\r\n          this.essentialDataCache$.value || this.getEmptyDashboardData()\r\n        );\r\n      }),\r\n      shareReplay(1)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get secondary data with smart caching\r\n   */\r\n  getSecondaryData(\r\n    type: 'leagues' | 'notes' | 'messages',\r\n    forceRefresh = false\r\n  ): Observable<any> {\r\n    const now = Date.now();\r\n    const lastUpdate = this.lastSecondaryUpdate.get(type) || 0;\r\n    const hasValidCache =\r\n      this.secondaryDataCache.has(type) &&\r\n      now - lastUpdate < this.SECONDARY_CACHE_DURATION;\r\n\r\n    if (!forceRefresh && hasValidCache) {\r\n      return of(this.secondaryDataCache.get(type));\r\n    }\r\n\r\n    return this.loadSecondaryDataFromServer(type).pipe(\r\n      tap((data) => {\r\n        this.secondaryDataCache.set(type, data);\r\n        this.lastSecondaryUpdate.set(type, now);\r\n      }),\r\n      catchError((error) => {\r\n        // Return cached data if available\r\n        return of(this.secondaryDataCache.get(type) || []);\r\n      })\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Load essential data from server using parallel requests\r\n   */\r\n  private loadEssentialDataFromServer(): Observable<AdminDashboardData> {\r\n    return forkJoin({\r\n      players: this.playerService.getAdminPlayers(),\r\n      matches: this.matchService.getAdminMatches(),\r\n      currentLeague: this.leagueService.getAdminCurrentLeague().pipe(\r\n        map((response) => response.league),\r\n        catchError(() => of(null))\r\n      ),\r\n      allLeagues: this.leagueService\r\n        .getAdminAllLeagues()\r\n        .pipe(catchError(() => of([]))),\r\n      notes: this.noteService.getAdminNotes().pipe(\r\n        map((response) => response.notes),\r\n        catchError(() => of([]))\r\n      ),\r\n      messages: this.messageService.getAdminMessages().pipe(\r\n        map((response) => response.messages || []),\r\n        catchError(() => of([]))\r\n      ),\r\n    }).pipe(\r\n      map(\r\n        ({ players, matches, currentLeague, allLeagues, notes, messages }) => {\r\n          const messagesList = Array.isArray(messages) ? messages : [];\r\n          return {\r\n            players: players as Player[],\r\n            matches: matches as Match[],\r\n            currentLeague,\r\n            allLeagues: allLeagues as AllLeagueRank[],\r\n            notes: notes as Note[],\r\n            messages: messagesList as Message[],\r\n            stats: {\r\n              totalPlayers: players.length,\r\n              totalMatches: matches.length,\r\n              totalMatchesLeft: matches.filter((m) => !m.isCompleted).length,\r\n              totalMessagesLeft: messagesList.filter(\r\n                (m: any) => !m.isRead && !m.isFromAdmin\r\n              ).length,\r\n            },\r\n          };\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Load secondary data from server\r\n   */\r\n  private loadSecondaryDataFromServer(type: string): Observable<any> {\r\n    switch (type) {\r\n      case 'leagues':\r\n        return this.leagueService.getAdminAllLeagues();\r\n      case 'notes':\r\n        return this.noteService\r\n          .getAdminNotes()\r\n          .pipe(map((response) => response.notes));\r\n      case 'messages':\r\n        return this.messageService\r\n          .getAdminMessages()\r\n          .pipe(map((response) => response.messages || []));\r\n      default:\r\n        return of([]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update cached data after mutations\r\n   */\r\n  invalidateCache(\r\n    type: 'essential' | 'leagues' | 'notes' | 'messages' | 'all'\r\n  ): void {\r\n    switch (type) {\r\n      case 'essential':\r\n        this.lastEssentialUpdate = 0;\r\n        break;\r\n      case 'leagues':\r\n      case 'notes':\r\n      case 'messages':\r\n        this.lastSecondaryUpdate.set(type, 0);\r\n        this.secondaryDataCache.delete(type);\r\n        break;\r\n      case 'all':\r\n        this.lastEssentialUpdate = 0;\r\n        this.lastSecondaryUpdate.clear();\r\n        this.secondaryDataCache.clear();\r\n        break;\r\n    }\r\n  }\r\n\r\n  // ✅ تم حذف Background refresh تماماً - مالوش لازمة أصلاً\r\n\r\n  /**\r\n   * Get current cached essential data\r\n   */\r\n  getCurrentEssentialData(): AdminDashboardData | null {\r\n    return this.essentialDataCache$.value;\r\n  }\r\n\r\n  /**\r\n   * Update message count in stats\r\n   */\r\n  updateMessageCount(count: number): void {\r\n    const current = this.essentialDataCache$.value;\r\n    if (current) {\r\n      current.stats.totalMessagesLeft = count;\r\n      this.essentialDataCache$.next(current);\r\n    }\r\n  }\r\n\r\n  private getEmptyDashboardData(): AdminDashboardData {\r\n    return {\r\n      players: [],\r\n      matches: [],\r\n      currentLeague: null,\r\n      allLeagues: [],\r\n      notes: [],\r\n      messages: [],\r\n      stats: {\r\n        totalPlayers: 0,\r\n        totalMatches: 0,\r\n        totalMatchesLeft: 0,\r\n        totalMessagesLeft: 0,\r\n      },\r\n    };\r\n  }\r\n}\r\n","import { environment } from './../../../environments/environment';\r\nimport { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { BehaviorSubject, Observable, tap } from 'rxjs';\r\nimport { Router } from '@angular/router';\r\nimport { CommonResponse, LoginResponse } from 'src/app/models/interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class AuthService {\r\n  private baseUrl = environment.apiUrl;\r\n  private isLoggedInSubject = new BehaviorSubject<boolean>(this.hasToken());\r\n  isLoggedIn$ = this.isLoggedInSubject.asObservable();\r\n  private userRole: string | null = null;\r\n\r\n  constructor(private http: HttpClient, private router: Router) {\r\n    const token = localStorage.getItem('token');\r\n    if (token) {\r\n      this.userRole = this.getRoleFromToken(token);\r\n      this.isLoggedInSubject.next(true);\r\n    }\r\n  }\r\n\r\n  login(email: string, password: string): Observable<any> {\r\n    return this.http\r\n      .post<any>(`${this.baseUrl}/auth/login`, {\r\n        email,\r\n        password,\r\n      })\r\n      .pipe(\r\n        tap((response) => {\r\n          if (response.success) {\r\n            localStorage.setItem('token', response.token);\r\n            localStorage.setItem('userRole', response.userRole || 'Admin');\r\n            this.userRole = response.userRole || 'Admin';\r\n            this.isLoggedInSubject.next(true);\r\n            this.router.navigate(['/admin']);\r\n          }\r\n        })\r\n      );\r\n  }\r\n\r\n  playerLogin(\r\n    phoneNumber: string,\r\n    password: string\r\n  ): Observable<LoginResponse> {\r\n    return this.http\r\n      .post<LoginResponse>(`${this.baseUrl}/auth/player-login`, {\r\n        phoneNumber,\r\n        password,\r\n      })\r\n      .pipe(\r\n        tap((response) => {\r\n          if (response.success && response.token) {\r\n            localStorage.setItem('token', response.token);\r\n            const extractedRole = this.getRoleFromToken(response.token);\r\n            this.userRole = extractedRole || 'Player';\r\n            localStorage.setItem('userRole', this.userRole);\r\n\r\n            this.isLoggedInSubject.next(true);\r\n            this.router.navigate(['/player']);\r\n          }\r\n        })\r\n      );\r\n  }\r\n\r\n  register(\r\n    phoneNumber: string,\r\n    password: string,\r\n    firstName: string,\r\n    lastName: string\r\n  ): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/auth/register-player`,\r\n      { phoneNumber, password, firstName, lastName }\r\n    );\r\n  }\r\n\r\n  resetPassword(\r\n    phoneNumber: string,\r\n    newPassword: string\r\n  ): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/auth/reset-password`,\r\n      { phoneNumber, newPassword }\r\n    );\r\n  }\r\n\r\n  logout(): void {\r\n    localStorage.removeItem('token');\r\n    this.userRole = null;\r\n    this.isLoggedInSubject.next(false);\r\n    this.router.navigate(['/player']);\r\n  }\r\n\r\n  getRole(): string | null {\r\n    return this.userRole;\r\n  }\r\n\r\n  private hasToken(): boolean {\r\n    return !!localStorage.getItem('token');\r\n  }\r\n\r\n  private getRoleFromToken(token: string): string | null {\r\n    try {\r\n      const payload = JSON.parse(atob(token.split('.')[1]));\r\n      const role = payload['role'] || null;\r\n      return role;\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\nimport { tap, catchError } from 'rxjs/operators';\r\n\r\ninterface CacheItem<T> {\r\n  data: T;\r\n  timestamp: number;\r\n  ttl: number; // Time to live in milliseconds\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class CacheService {\r\n  private cache = new Map<string, CacheItem<any>>();\r\n  private readonly DEFAULT_TTL = 5 * 60 * 1000; // 5 minutes default\r\n  private readonly PLAYER_TTL = 30 * 60 * 1000; // 30 minutes for player data\r\n  private readonly LEAGUE_TTL = 30 * 60 * 1000; // 30 minutes for league data\r\n  private readonly RANKINGS_TTL = 30 * 60 * 1000; // 30 minutes for rankings data\r\n\r\n  constructor() {\r\n    this.loadFromLocalStorage();\r\n  }\r\n\r\n  set<T>(key: string, data: T, ttl: number = this.DEFAULT_TTL): void {\r\n    const item = {\r\n      data,\r\n      timestamp: Date.now(),\r\n      ttl,\r\n    };\r\n\r\n    this.cache.set(key, item);\r\n    this.saveToLocalStorage();\r\n  }\r\n\r\n  get<T>(key: string): T | null {\r\n    const item = this.cache.get(key);\r\n    if (!item) return null;\r\n\r\n    const isExpired = Date.now() - item.timestamp > item.ttl;\r\n    if (isExpired) {\r\n      this.cache.delete(key);\r\n      this.saveToLocalStorage();\r\n      return null;\r\n    }\r\n\r\n    return item.data;\r\n  }\r\n\r\n  has(key: string): boolean {\r\n    return this.get(key) !== null;\r\n  }\r\n\r\n  clear(): void {\r\n    this.cache.clear();\r\n    this.saveToLocalStorage();\r\n  }\r\n\r\n  remove(key: string): void {\r\n    this.cache.delete(key);\r\n    this.saveToLocalStorage();\r\n  }\r\n\r\n  // Helper method to cache HTTP requests\r\n  cacheRequest<T>(\r\n    key: string,\r\n    request: Observable<T>,\r\n    ttl: number = this.DEFAULT_TTL\r\n  ): Observable<T> {\r\n    const cached = this.get<T>(key);\r\n    if (cached) {\r\n      return of(cached);\r\n    }\r\n\r\n    return request.pipe(\r\n      tap((data) => this.set(key, data, ttl)),\r\n      catchError((error) => {\r\n        throw error;\r\n      })\r\n    );\r\n  }\r\n\r\n  // Cache player data with 30 minutes TTL\r\n  cachePlayerRequest<T>(key: string, request: Observable<T>): Observable<T> {\r\n    return this.cacheRequest(key, request, this.PLAYER_TTL);\r\n  }\r\n\r\n  // Cache league data with 30 minutes TTL\r\n  cacheLeagueRequest<T>(key: string, request: Observable<T>): Observable<T> {\r\n    return this.cacheRequest(key, request, this.LEAGUE_TTL);\r\n  }\r\n\r\n  // Cache rankings data with 30 minutes TTL\r\n  cacheRankingsRequest<T>(key: string, request: Observable<T>): Observable<T> {\r\n    return this.cacheRequest(key, request, this.RANKINGS_TTL);\r\n  }\r\n\r\n  // Cache all-leagues data with 30 minutes TTL and sort by creation date (newest first)\r\n  cacheAllLeaguesRequest<T>(\r\n    key: string,\r\n    request: Observable<T>\r\n  ): Observable<T> {\r\n    const cached = this.get<T>(key);\r\n    if (cached) {\r\n      return of(cached);\r\n    }\r\n\r\n    return request.pipe(\r\n      tap((data: any) => {\r\n        // Sort leagues by createdOn date (newest first) if it's an array\r\n        if (Array.isArray(data) && data.length > 0 && data[0].createdOn) {\r\n          const sortedData = [...data].sort((a, b) => {\r\n            const dateA = new Date(a.createdOn).getTime();\r\n            const dateB = new Date(b.createdOn).getTime();\r\n            return dateB - dateA; // Descending order (newest first)\r\n          });\r\n          this.set(key, sortedData, this.RANKINGS_TTL);\r\n        } else {\r\n          this.set(key, data, this.RANKINGS_TTL);\r\n        }\r\n      }),\r\n      catchError((error) => {\r\n        throw error;\r\n      })\r\n    );\r\n  }\r\n\r\n  // Invalidate cache for specific patterns\r\n  invalidatePattern(pattern: string): void {\r\n    for (const key of this.cache.keys()) {\r\n      if (key.includes(pattern)) {\r\n        this.cache.delete(key);\r\n      }\r\n    }\r\n    this.saveToLocalStorage();\r\n  }\r\n\r\n  // Get next update time for player data (every hour)\r\n  getNextPlayerUpdateTime(): Date {\r\n    const now = new Date();\r\n    const nextHour = new Date(\r\n      now.getFullYear(),\r\n      now.getMonth(),\r\n      now.getDate(),\r\n      now.getHours() + 1,\r\n      0,\r\n      0,\r\n      0\r\n    );\r\n    return nextHour;\r\n  }\r\n\r\n  // Get last update time for a specific key\r\n  getLastUpdateTime(key: string): Date | null {\r\n    const item = this.cache.get(key);\r\n    return item ? new Date(item.timestamp) : null;\r\n  }\r\n\r\n  // Check if cache is expired for a specific key\r\n  isCacheExpired(key: string): boolean {\r\n    const item = this.cache.get(key);\r\n    if (!item) return true;\r\n    return Date.now() - item.timestamp > item.ttl;\r\n  }\r\n\r\n  // Get cache expiry time for a specific key\r\n  getCacheExpiryTime(key: string): Date | null {\r\n    const item = this.cache.get(key);\r\n    if (!item) return null;\r\n    return new Date(item.timestamp + item.ttl);\r\n  }\r\n\r\n  // Force refresh cache for a specific key\r\n  forceRefresh<T>(\r\n    key: string,\r\n    request: Observable<T>,\r\n    ttl: number = this.DEFAULT_TTL\r\n  ): Observable<T> {\r\n    this.remove(key);\r\n    return this.cacheRequest(key, request, ttl);\r\n  }\r\n\r\n  // Check if cache should be refreshed based on current time (every 30 minutes)\r\n  shouldRefreshRankings(): boolean {\r\n    const lastUpdate = this.getLastUpdateTime('all-leagues-rank');\r\n    if (!lastUpdate) return true;\r\n\r\n    const minutesSinceUpdate =\r\n      (Date.now() - lastUpdate.getTime()) / (60 * 1000);\r\n    return minutesSinceUpdate >= 30;\r\n  }\r\n\r\n  // Check if current league cache should be refreshed\r\n  shouldRefreshCurrentLeague(): boolean {\r\n    const lastUpdate = this.getLastUpdateTime('current-league');\r\n    if (!lastUpdate) return true;\r\n\r\n    const minutesSinceUpdate =\r\n      (Date.now() - lastUpdate.getTime()) / (60 * 1000);\r\n    return minutesSinceUpdate >= 30;\r\n  }\r\n\r\n  private saveToLocalStorage(): void {\r\n    try {\r\n      const cacheData = Array.from(this.cache.entries());\r\n      localStorage.setItem('app_cache', JSON.stringify(cacheData));\r\n    } catch (error) {\r\n      // Silent error handling\r\n    }\r\n  }\r\n\r\n  private loadFromLocalStorage(): void {\r\n    try {\r\n      const cacheData = localStorage.getItem('app_cache');\r\n      if (cacheData) {\r\n        const entries = JSON.parse(cacheData);\r\n        this.cache = new Map(entries);\r\n\r\n        // Clean expired items\r\n        for (const [key, item] of this.cache.entries()) {\r\n          if (Date.now() - item.timestamp > item.ttl) {\r\n            this.cache.delete(key);\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      // Silent error handling\r\n    }\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { environment } from './../../../environments/environment';\r\nimport {\r\n  AllLeagueRank,\r\n  CommonResponse,\r\n  LeagueResponse,\r\n  StartLeagueDto,\r\n} from 'src/app/models/interfaces';\r\nimport { CacheService } from './cache.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class LeagueService {\r\n  private baseUrl = environment.apiUrl;\r\n\r\n  constructor(private http: HttpClient, private cacheService: CacheService) {}\r\n\r\n  resetLeague(LeagueId: number): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/league/reset/${LeagueId}`,\r\n      {}\r\n    );\r\n  }\r\n\r\n  startLeague(dto: StartLeagueDto): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(`${this.baseUrl}/league/start`, dto);\r\n  }\r\n\r\n  GetCurrentLeague(forceRefresh: boolean = false): Observable<LeagueResponse> {\r\n    const request = this.http.get<LeagueResponse>(\r\n      `${this.baseUrl}/league/getCurrentLeague`\r\n    );\r\n\r\n    if (forceRefresh || this.cacheService.shouldRefreshCurrentLeague()) {\r\n      return this.cacheService.forceRefresh(\r\n        'current-league',\r\n        request,\r\n        30 * 60 * 1000\r\n      );\r\n    }\r\n\r\n    return this.cacheService.cachePlayerRequest('current-league', request);\r\n  }\r\n\r\n  // Admin-specific method for current league without cache\r\n  getAdminCurrentLeague(): Observable<LeagueResponse> {\r\n    return this.http.get<LeagueResponse>(\r\n      `${this.baseUrl}/league/getCurrentLeague`\r\n    );\r\n  }\r\n\r\n  GetAllLeaguesRank(\r\n    forceRefresh: boolean = false\r\n  ): Observable<AllLeagueRank[]> {\r\n    const request = this.http.get<AllLeagueRank[]>(\r\n      `${this.baseUrl}/player/players/all`\r\n    );\r\n\r\n    if (forceRefresh || this.cacheService.shouldRefreshRankings()) {\r\n      return this.cacheService.forceRefresh(\r\n        'all-leagues-rank',\r\n        request,\r\n        30 * 60 * 1000\r\n      );\r\n    }\r\n\r\n    return this.cacheService.cacheAllLeaguesRequest(\r\n      'all-leagues-rank',\r\n      request\r\n    );\r\n  }\r\n\r\n  // Admin-specific method with 30-minute cache\r\n  getAdminAllLeagues(): Observable<AllLeagueRank[]> {\r\n    return this.http.get<AllLeagueRank[]>(`${this.baseUrl}/player/players/all`);\r\n  }\r\n\r\n  DeleteLeague(leagueId: number): Observable<CommonResponse> {\r\n    return this.http.delete<CommonResponse>(\r\n      `${this.baseUrl}/league/delete/${leagueId}`\r\n    );\r\n  }\r\n\r\n  createGroupsAndMatches(leagueId: number): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/league/${leagueId}/create-groups`,\r\n      {}\r\n    );\r\n  }\r\n\r\n  startKnockoutStage(leagueId: number): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/league/${leagueId}/start-knockouts`,\r\n      {}\r\n    );\r\n  }\r\n\r\n  startSemiFinals(leagueId: number): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/league/${leagueId}/start-semifinals`,\r\n      {}\r\n    );\r\n  }\r\n\r\n  startFinal(leagueId: number): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/league/${leagueId}/start-final`,\r\n      {}\r\n    );\r\n  }\r\n\r\n  // Get last update time for leagues rank\r\n  getLastLeaguesRankUpdateTime(): Date | null {\r\n    return this.cacheService.getLastUpdateTime('all-leagues-rank');\r\n  }\r\n\r\n  // Get last update time for current league\r\n  getLastCurrentLeagueUpdateTime(): Date | null {\r\n    return this.cacheService.getLastUpdateTime('current-league');\r\n  }\r\n\r\n  // Check if rankings cache is expired\r\n  isRankingsCacheExpired(): boolean {\r\n    return this.cacheService.isCacheExpired('all-leagues-rank');\r\n  }\r\n\r\n  // Check if current league cache is expired\r\n  isCurrentLeagueCacheExpired(): boolean {\r\n    return this.cacheService.isCacheExpired('current-league');\r\n  }\r\n\r\n  // Get next rankings update time\r\n  getNextRankingsUpdateTime(): Date | null {\r\n    return this.cacheService.getCacheExpiryTime('all-leagues-rank');\r\n  }\r\n\r\n  // Get next current league update time\r\n  getNextCurrentLeagueUpdateTime(): Date | null {\r\n    return this.cacheService.getCacheExpiryTime('current-league');\r\n  }\r\n\r\n  // Force refresh rankings data\r\n  forceRefreshRankings(): Observable<AllLeagueRank[]> {\r\n    return this.GetAllLeaguesRank(true);\r\n  }\r\n\r\n  // Force refresh current league data\r\n  forceRefreshCurrentLeague(): Observable<LeagueResponse> {\r\n    return this.GetCurrentLeague(true);\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable, tap } from 'rxjs';\r\nimport { environment } from './../../../environments/environment';\r\nimport { Match, ResultResponse } from 'src/app/models/interfaces';\r\nimport { PlayerService } from './player.service';\r\nimport { CacheService } from './cache.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class MatchService {\r\n  private baseUrl = environment.apiUrl;\r\n\r\n  constructor(\r\n    private http: HttpClient,\r\n    private playerService: PlayerService,\r\n    private cacheService: CacheService\r\n  ) {}\r\n\r\n  getMatches(): Observable<Match[]> {\r\n    return this.cacheService.cachePlayerRequest(\r\n      'current-matches',\r\n      this.http.get<Match[]>(`${this.baseUrl}/match`)\r\n    );\r\n  }\r\n\r\n  // Admin-specific method - now same as regular method\r\n  getAdminMatches(): Observable<Match[]> {\r\n    return this.http.get<Match[]>(`${this.baseUrl}/match`);\r\n  }\r\n\r\n  updateMatch(\r\n    matchId: number,\r\n    winnerId: number | null\r\n  ): Observable<ResultResponse> {\r\n    return this.http\r\n      .post<ResultResponse>(`${this.baseUrl}/match/${matchId}/result`, {\r\n        winnerId,\r\n      })\r\n      .pipe(\r\n        tap(() => {\r\n          this.playerService.refreshPlayers();\r\n        })\r\n      );\r\n  }\r\n\r\n  resetMatch(matchId: number): Observable<ResultResponse> {\r\n    return this.http\r\n      .delete<ResultResponse>(`${this.baseUrl}/match/reset/${matchId}`)\r\n      .pipe(\r\n        tap(() => {\r\n          this.playerService.refreshPlayers();\r\n        })\r\n      );\r\n  }\r\n\r\n  // Get last update time for current matches\r\n  getLastMatchesUpdateTime(): Date | null {\r\n    return this.cacheService.getLastUpdateTime('current-matches');\r\n  }\r\n}\r\n","import { environment } from './../../../environments/environment';\r\nimport { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { CommonResponse, MessagesResponse } from 'src/app/models/interfaces';\r\nimport { CacheService } from './cache.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class MessageService {\r\n  private baseUrl = environment.apiUrl;\r\n\r\n  constructor(private http: HttpClient, private cacheService: CacheService) {}\r\n\r\n  sendMessage(message: string): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(`${this.baseUrl}/Message/send`, {\r\n      Content: message,\r\n    });\r\n  }\r\n\r\n  getMessages(): Observable<MessagesResponse> {\r\n    return this.http.get<MessagesResponse>(`${this.baseUrl}/Message/inbox`);\r\n  }\r\n\r\n  // Admin-specific method - now loads fresh data immediately without caching\r\n  getAdminMessages(): Observable<MessagesResponse> {\r\n    return this.http.get<MessagesResponse>(`${this.baseUrl}/Message/inbox`);\r\n  }\r\n\r\n  toggleMarkMessage(\r\n    messageId: number,\r\n    marked: boolean\r\n  ): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/Message/mark/${messageId}`,\r\n      { Marked: marked }\r\n    );\r\n  }\r\n\r\n  toggleDeleteMessage(\r\n    messageId: number,\r\n    marked: boolean\r\n  ): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/Message/delete/${messageId}`,\r\n      { Marked: marked }\r\n    );\r\n  }\r\n\r\n  getPlayerMessages(): Observable<MessagesResponse> {\r\n    return this.http.get<MessagesResponse>(\r\n      `${this.baseUrl}/Message/my-messages`\r\n    );\r\n  }\r\n\r\n  sendAdminReply(\r\n    playerId: string,\r\n    message: string\r\n  ): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/Message/reply/${playerId}`,\r\n      { Content: message }\r\n    );\r\n  }\r\n}\r\n","import { environment } from './../../../environments/environment';\r\nimport { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { CommonResponse, NoteResponse } from 'src/app/models/interfaces';\r\nimport { CacheService } from './cache.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class NoteService {\r\n  private baseUrl = environment.apiUrl;\r\n\r\n  constructor(private http: HttpClient, private cacheService: CacheService) {}\r\n\r\n  sendNote(message: string): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(`${this.baseUrl}/note/write`, {\r\n      Content: message,\r\n    });\r\n  }\r\n\r\n  getNotes(): Observable<NoteResponse> {\r\n    return this.http.get<NoteResponse>(`${this.baseUrl}/note/notes`);\r\n  }\r\n\r\n  // Admin-specific method with 30-minute cache\r\n  getAdminNotes(): Observable<NoteResponse> {\r\n    return this.http.get<NoteResponse>(`${this.baseUrl}/note/notes`);\r\n  }\r\n\r\n  toggleMarHide(noteId: number, marked: boolean): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/note/hide/${noteId}`,\r\n      { Marked: marked }\r\n    );\r\n  }\r\n\r\n  DeleteNote(noteId: number, marked: boolean): Observable<CommonResponse> {\r\n    return this.http.post<CommonResponse>(\r\n      `${this.baseUrl}/note/delete/${noteId}`,\r\n      { Marked: marked }\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { BehaviorSubject, Observable, tap } from 'rxjs';\r\nimport { environment } from 'src/environments/environment';\r\nimport { CommonResponse } from 'src/app/models/interfaces';\r\nimport { CacheService } from './cache.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class PlayerService {\r\n  private baseUrl = environment.apiUrl;\r\n\r\n  private rankingSubject = new BehaviorSubject<[]>([]);\r\n  ranking$ = this.rankingSubject.asObservable();\r\n\r\n  constructor(private http: HttpClient, private cacheService: CacheService) {}\r\n\r\n  getrank(): Observable<[]> {\r\n    return this.cacheService.cachePlayerRequest(\r\n      'player-ranking',\r\n      this.http\r\n        .get<[]>(`${this.baseUrl}/player/ranking`)\r\n        .pipe(tap((data) => this.rankingSubject.next(data)))\r\n    );\r\n  }\r\n\r\n  getPlayers(): Observable<[]> {\r\n    return this.cacheService.cachePlayerRequest(\r\n      'players-list',\r\n      this.http\r\n        .get<[]>(`${this.baseUrl}/player`)\r\n        .pipe(tap((data) => this.rankingSubject.next(data)))\r\n    );\r\n  }\r\n\r\n  // Admin-specific method with 30-minute cache\r\n  getAdminPlayers(): Observable<[]> {\r\n    return this.http\r\n      .get<[]>(`${this.baseUrl}/player`)\r\n      .pipe(tap((data) => this.rankingSubject.next(data)));\r\n  }\r\n\r\n  addPlayer(fullName: string): Observable<CommonResponse> {\r\n    return this.http\r\n      .post<CommonResponse>(`${this.baseUrl}/player`, { fullName })\r\n      .pipe(\r\n        tap(() => {\r\n          this.cacheService.invalidatePattern('player');\r\n          this.refreshPlayers();\r\n        })\r\n      );\r\n  }\r\n\r\n  deletePlayer(playerId: number): Observable<CommonResponse> {\r\n    return this.http\r\n      .delete<CommonResponse>(`${this.baseUrl}/player/${playerId}`)\r\n      .pipe(\r\n        tap(() => {\r\n          this.cacheService.invalidatePattern('player');\r\n          this.refreshPlayers();\r\n        })\r\n      );\r\n  }\r\n\r\n  refreshRanking() {\r\n    this.cacheService.remove('player-ranking');\r\n    this.http.get<[]>(`${this.baseUrl}/player/ranking`).subscribe((data) => {\r\n      this.rankingSubject.next(data);\r\n    });\r\n  }\r\n\r\n  refreshPlayers() {\r\n    this.cacheService.remove('players-list');\r\n    this.http.get<[]>(`${this.baseUrl}/player`).subscribe((data) => {\r\n      this.rankingSubject.next(data);\r\n    });\r\n  }\r\n\r\n  // Get next update time\r\n  getNextUpdateTime(): Date {\r\n    return this.cacheService.getNextPlayerUpdateTime();\r\n  }\r\n\r\n  // Get last update time for ranking\r\n  getLastRankingUpdateTime(): Date | null {\r\n    return this.cacheService.getLastUpdateTime('player-ranking');\r\n  }\r\n\r\n  // Get last update time for players list\r\n  getLastPlayersUpdateTime(): Date | null {\r\n    return this.cacheService.getLastUpdateTime('players-list');\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { InboxComponent } from '../admin/inbox/inbox.component';\r\nimport { FloatingInboxComponent } from './floating-inbox/floating-inbox.component';\r\nimport { MessageService } from '../core/services/message.service';\r\nimport { AdminDashboardService } from '../core/services/admin-dashboard.service';\r\n\r\n@NgModule({\r\n  declarations: [InboxComponent, FloatingInboxComponent],\r\n  imports: [CommonModule, FormsModule],\r\n  exports: [InboxComponent, FloatingInboxComponent],\r\n  providers: [MessageService, AdminDashboardService],\r\n})\r\nexport class SharedModule {}\r\n","var api = 'https://yugiapp.runasp.net/api';\r\n\r\n// api = 'https://localhost:7144/api';\r\n\r\nexport const environment = {\r\n  production: false,\r\n\r\n  apiUrl: api,\r\n};\r\n","import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { authGuard } from './core/guards/auth.guard';\r\n\r\nconst routes: Routes = [\r\n  { path: '', redirectTo: 'player', pathMatch: 'full' },\r\n  {\r\n    path: 'player',\r\n    loadChildren: () =>\r\n      import('./player/player.module').then((m) => m.PlayerModule),\r\n    data: { title: 'Players' },\r\n  },\r\n  {\r\n    path: 'auth',\r\n    loadChildren: () => import('./auth/auth.module').then((m) => m.AuthModule),\r\n    data: { title: 'Auth' },\r\n  },\r\n  {\r\n    path: 'admin',\r\n    loadChildren: () =>\r\n      import('./admin/admin.module').then((m) => m.AdminModule),\r\n    canActivate: [authGuard],\r\n    data: { title: 'Admin' },\r\n  },\r\n  { path: '**', redirectTo: 'player' },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forRoot(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class AppRoutingModule {}\r\n","import { CanActivateFn } from '@angular/router';\r\nimport { inject } from '@angular/core';\r\nimport { AuthService } from '../services/auth.service';\r\n\r\nexport const authGuard: CanActivateFn = (route, state) => {\r\n  const authService = inject(AuthService);\r\n  const token = localStorage.getItem('token');\r\n  \r\n  return !!token;\r\n};\r\n","import { Injectable } from '@angular/core';\r\nimport { Title } from '@angular/platform-browser';\r\nimport { Router, NavigationEnd, ActivatedRoute } from '@angular/router';\r\nimport { filter } from 'rxjs/operators';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class TitleStrategyService {\r\n  private readonly defaultTitle = 'Yugi-Oh Tournament';\r\n\r\n  constructor(private title: Title, private router: Router) {\r\n    // Set initial title\r\n    this.title.setTitle(this.defaultTitle);\r\n    this.setupTitleUpdates();\r\n  }\r\n\r\n  private setupTitleUpdates(): void {\r\n    this.router.events\r\n      .pipe(filter((event) => event instanceof NavigationEnd))\r\n      .subscribe((event) => {\r\n        // Add a small delay to ensure route data is available\r\n        setTimeout(() => {\r\n          this.updateTitle();\r\n        }, 50);\r\n      });\r\n  }\r\n\r\n  private updateTitle(): void {\r\n    const currentRoute = this.getCurrentRoute();\r\n\r\n    if (currentRoute?.snapshot?.data?.['title']) {\r\n      const newTitle = currentRoute.snapshot.data['title'];\r\n      this.title.setTitle(newTitle);\r\n    } else {\r\n      this.title.setTitle(this.defaultTitle);\r\n    }\r\n  }\r\n\r\n  private getCurrentRoute(): any {\r\n    let route = this.router.routerState.root;\r\n\r\n    // Navigate through all child routes to find the deepest one\r\n    while (route.firstChild) {\r\n      route = route.firstChild;\r\n    }\r\n\r\n    // Also check the current activated route for additional data\r\n    let currentActivatedRoute = this.router.routerState.root;\r\n    while (currentActivatedRoute.firstChild) {\r\n      currentActivatedRoute = currentActivatedRoute.firstChild;\r\n    }\r\n\r\n    // Try to get title from the deepest route first\r\n    if (route?.snapshot?.data?.['title']) {\r\n      return route;\r\n    }\r\n\r\n    // If no title in deepest route, check the activated route\r\n    if (currentActivatedRoute?.snapshot?.data?.['title']) {\r\n      return currentActivatedRoute;\r\n    }\r\n\r\n    // If still no title, return the deepest route\r\n    return route;\r\n  }\r\n\r\n  setTitle(title: string): void {\r\n    if (title) {\r\n      const newTitle = title;\r\n      this.title.setTitle(newTitle);\r\n    } else {\r\n      this.title.setTitle(this.defaultTitle);\r\n    }\r\n  }\r\n}\r\n","<!-- Floating Admin Inbox Button (Draggable) -->\r\n<div\r\n  *ngIf=\"isAdmin\"\r\n  class=\"fixed z-50 cursor-pointer select-none\"\r\n  [style.left.px]=\"buttonPosition.x\"\r\n  [style.top.px]=\"buttonPosition.y\"\r\n  [class.dragging]=\"isDragging\"\r\n  (mousedown)=\"onButtonMouseDown($event)\"\r\n  (touchstart)=\"onButtonTouchStart($event)\"\r\n  (touchend)=\"onButtonTouchEnd($event)\"\r\n>\r\n  <div\r\n    class=\"w-12 h-12 md:w-12 md:h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center hover:scale-110 floating-button relative group border-2 border-blue-400\"\r\n    [class.shadow-2xl]=\"isDragging\"\r\n    (click)=\"onButtonClick($event)\"\r\n  >\r\n    <i class=\"fa-solid fa-comments text-lg text-white\"></i>\r\n\r\n    <!-- Tooltip -->\r\n    <div\r\n      class=\"absolute bottom-full right-0 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap pointer-events-none tooltip\"\r\n    >\r\n      Admin Inbox (Drag to move)\r\n      <div\r\n        class=\"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800\"\r\n      ></div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<!-- Inbox Component Overlay -->\r\n<div\r\n  *ngIf=\"isAdmin && showInboxOverlay\"\r\n  class=\"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center pt-[50px] sm:p-4 md:p-4\"\r\n  (click)=\"closeInboxOverlay()\"\r\n>\r\n  <div\r\n    class=\"bg-gray-900 rounded-lg shadow-2xl overflow-hidden overlay-enter w-[80%] h-[75vh] md:w-auto md:h-auto\"\r\n    (click)=\"$event.stopPropagation()\"\r\n\r\n  >\r\n    <!-- Overlay Header -->\r\n    <div\r\n      class=\"bg-gray-800 p-2 border-b border-gray-600 flex items-center justify-between\"\r\n    >\r\n      <h2 class=\"text-xl p-0 m-0 font-bold text-white\">Admin Inbox</h2>\r\n\r\n      <button\r\n        (click)=\"refreshMessages()\"\r\n        class=\"bg-blue-600 hover:bg-blue-700 text-white py-2 rounded text-sm transition-colors active:bg-blue-800 min-w-[80px]\"\r\n        title=\"تحديث\"\r\n      >\r\n        <i class=\"fa-solid fa-refresh mr-1\"></i>\r\n        <span class=\"hidden sm:inline\">تحديث</span>\r\n      </button>\r\n      <button\r\n        (click)=\"closeInboxOverlay()\"\r\n        class=\"text-gray-400 hover:text-white transition-colors  rounded-lg hover:bg-gray-700 active:bg-gray-600\"\r\n        title=\"Close\"\r\n      >\r\n        <i class=\"fa-solid fa-times text-xl\"></i>\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Inbox Component Container -->\r\n    <div class=\"h-full overflow-hidden\">\r\n      <!-- Chat List View -->\r\n      <div *ngIf=\"!selectedChat\" class=\"h-full flex flex-col\">\r\n\r\n\r\n        <!-- Chat List with Scroll -->\r\n        <div class=\"flex-1 overflow-y-auto p-2 max-h-96\">\r\n          <div\r\n            *ngFor=\"let chat of playerChats\"\r\n            (click)=\"selectChat(chat)\"\r\n            class=\"bg-gray-800 hover:bg-gray-700 rounded-lg p-3 mb-2 cursor-pointer transition-colors border-l-4 border-transparent hover:border-blue-500 active:bg-gray-600\"\r\n          >\r\n            <div class=\"flex justify-between items-start\">\r\n              <div class=\"flex-1 min-w-0\">\r\n                <h4 class=\"text-white font-medium text-sm truncate\">\r\n                  {{ chat.playerFullName }}\r\n                </h4>\r\n                <p class=\"text-gray-300 text-xs mt-1 truncate\">\r\n                  {{ chat.lastMessage }}\r\n                </p>\r\n                <p class=\"text-gray-400 text-xs mt-1\">\r\n                  {{ chat.lastMessageDate | date : \"short\" }}\r\n                </p>\r\n              </div>\r\n              <div\r\n                *ngIf=\"chat.unreadCount > 0\"\r\n                class=\"bg-red-500 text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center flex-shrink-0 ml-2\"\r\n              >\r\n                {{ chat.unreadCount }}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Chat View -->\r\n      <div *ngIf=\"selectedChat\" class=\"h-full flex flex-col\">\r\n        <!-- Chat Header -->\r\n        <div\r\n          class=\"bg-gray-700 px-2 border-b border-gray-600 flex items-center\"\r\n        >\r\n          <button\r\n            (click)=\"goBack()\"\r\n            class=\"text-gray-400 hover:text-white mr-3 transition-colors p-2 rounded active:bg-gray-600\"\r\n            title=\"رجوع\"\r\n          >\r\n            <i class=\"fa-solid fa-arrow-left text-lg\"></i>\r\n          </button>\r\n          <h3 class=\"text-white text-sm p-0 m-0 font-semibold truncate flex-1\">\r\n            {{ selectedChat.playerFullName }}\r\n          </h3>\r\n        </div>\r\n\r\n        <!-- Messages Container with Scroll -->\r\n        <div\r\n          #messagesContainer\r\n          class=\"flex-1 overflow-y-auto p-3 space-y-3 max-h-80\"\r\n        >\r\n          <div\r\n            *ngFor=\"\r\n              let message of selectedChat.messages;\r\n              trackBy: trackByMessageId\r\n            \"\r\n            class=\"mb-4\"\r\n            [ngClass]=\"{\r\n              'text-right': !message.isFromAdmin,\r\n              'text-left': message.isFromAdmin\r\n            }\"\r\n          >\r\n            <div\r\n              class=\"inline-block p-3 rounded-lg max-w-[85%] md:max-w-xs\"\r\n              [ngClass]=\"{\r\n                'bg-green-700': !message.isFromAdmin,\r\n                'bg-gray-700': message.isFromAdmin\r\n              }\"\r\n            >\r\n              <p class=\"text-white text-sm break-words\">\r\n                {{ message.content }}\r\n              </p>\r\n              <p class=\"text-xs mt-1 text-gray-300\">\r\n                {{ message.sentAt | date : \"MMM d, y, hh:mm a\" }}\r\n              </p>\r\n\r\n              <!-- Message Actions (only mark as read for admin messages) -->\r\n              <div\r\n                *ngIf=\"message.isFromAdmin && !message.isRead\"\r\n                class=\"flex justify-end items-center mt-2\"\r\n              >\r\n                <button\r\n                  (click)=\"markAsRead(message.id)\"\r\n                  class=\"text-green-400 hover:text-green-300 text-xs transition-colors p-1 rounded active:bg-green-800\"\r\n                  title=\"تحديد كمقروءة\"\r\n                >\r\n                  <i class=\"fa-solid fa-check mr-1\"></i>\r\n                  <span class=\"hidden sm:inline\">تحديد كمقروءة</span>\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Fixed Reply Input at Bottom -->\r\n        <div class=\"bg-gray-700 p-3 border-t border-gray-600\">\r\n          <div class=\"flex items-center space-x-2 rtl:space-x-reverse\">\r\n            <input\r\n              type=\"text\"\r\n              [(ngModel)]=\"replyText\"\r\n              placeholder=\"اكتب ردك هنا...\"\r\n              class=\"flex-1 bg-gray-600 text-white text-sm px-3 py-2 md:py-2 rounded border border-gray-500 focus:border-blue-500 focus:outline-none\"\r\n              (keyup.enter)=\"sendReply(selectedChat.playerId)\"\r\n              autocomplete=\"off\"\r\n              autocorrect=\"off\"\r\n              autocapitalize=\"off\"\r\n            />\r\n            <button\r\n              (click)=\"sendReply(selectedChat.playerId)\"\r\n              class=\"bg-blue-600 hover:bg-blue-700 text-white px-3 md:px-4 py-2 md:py-2 rounded text-sm transition-colors min-w-[60px] md:min-w-[80px]\"\r\n              title=\"إرسال\"\r\n            >\r\n              <i class=\"fa-solid fa-paper-plane mr-1\"></i>\r\n              <span class=\"hidden sm:inline\">إرسال</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n","import {\r\n  Component,\r\n  OnInit,\r\n  OnDestroy,\r\n  HostListener,\r\n  ViewChild,\r\n  ElementRef,\r\n  AfterViewInit,\r\n  AfterViewChecked,\r\n} from '@angular/core';\r\nimport { AuthService } from '../../core/services/auth.service';\r\nimport { MessageService } from '../../core/services/message.service';\r\nimport { AdminDashboardService } from '../../core/services/admin-dashboard.service';\r\nimport { ToastrService } from 'ngx-toastr';\r\nimport { ChangeDetectorRef } from '@angular/core';\r\nimport { Subscription } from 'rxjs';\r\n\r\ninterface PlayerChat {\r\n  playerId: string;\r\n  playerFullName: string;\r\n  lastMessage: string;\r\n  lastMessageDate: string;\r\n  unreadCount: number;\r\n  messages: any[];\r\n}\r\n\r\n@Component({\r\n  selector: 'app-floating-inbox',\r\n  templateUrl: './floating-inbox.component.html',\r\n  styleUrls: ['./floating-inbox.component.css'],\r\n})\r\nexport class FloatingInboxComponent\r\n  implements OnInit, OnDestroy, AfterViewInit, AfterViewChecked\r\n{\r\n  // Floating button properties\r\n  isAdmin = false;\r\n  showInboxOverlay = false;\r\n  buttonPosition = { x: 20, y: 100 };\r\n  isDragging = false;\r\n  dragOffset = { x: 0, y: 0 };\r\n  hasMovedDuringDrag = false;\r\n  unreadCount = 0;\r\n  isMobile = false;\r\n\r\n  // Inbox properties\r\n  playerChats: PlayerChat[] = [];\r\n  selectedPlayerId: string | null = null;\r\n  selectedChat: PlayerChat | null = null;\r\n  replyText = ''; // New property for single reply input\r\n  navbarHeight = 60;\r\n\r\n  // ViewChild for messages container\r\n  @ViewChild('messagesContainer')\r\n  messagesContainer!: ElementRef<HTMLDivElement>;\r\n\r\n  // Flag to control initial scroll\r\n  private shouldScrollToBottom = false;\r\n\r\n  // Cache management\r\n  private readonly CACHE_KEY = 'adminMessagesCache';\r\n  private readonly CACHE_DURATION = 30 * 60 * 1000; // 30 minutes in milliseconds\r\n  private cachedMessages: PlayerChat[] = [];\r\n  private lastCacheUpdate: number = 0;\r\n\r\n  private updateStatusSubscription?: Subscription;\r\n  private refreshSubscription?: Subscription;\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private messageService: MessageService,\r\n    private toastr: ToastrService,\r\n    private cdr: ChangeDetectorRef,\r\n    private adminDashboardService: AdminDashboardService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.checkAdminStatus();\r\n    this.setInitialButtonPosition();\r\n    this.detectMobileDevice();\r\n\r\n    if (this.isAdmin) {\r\n      // Load fresh data from server (like inbox.component)\r\n      this.loadAdminMessages();\r\n    }\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    // View is initialized, can now access ViewChild elements\r\n  }\r\n\r\n  ngAfterViewChecked(): void {\r\n    // Only scroll to bottom if flag is set (first time opening chat)\r\n    if (\r\n      this.shouldScrollToBottom &&\r\n      this.selectedChat &&\r\n      this.messagesContainer\r\n    ) {\r\n      // Small delay to ensure DOM is fully updated\r\n      setTimeout(() => {\r\n        this.scrollToBottom();\r\n        // Reset flag after scrolling\r\n        this.shouldScrollToBottom = false;\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.isDragging = false;\r\n    this.showInboxOverlay = false;\r\n    document.body.style.cursor = 'default';\r\n    document.body.classList.remove('dragging');\r\n\r\n    if (this.updateStatusSubscription) {\r\n      this.updateStatusSubscription.unsubscribe();\r\n    }\r\n    if (this.refreshSubscription) {\r\n      this.refreshSubscription.unsubscribe();\r\n    }\r\n\r\n    document.removeEventListener(\r\n      'mousemove',\r\n      this.onGlobalMouseMove.bind(this)\r\n    );\r\n    document.removeEventListener('mouseup', this.onGlobalMouseUp.bind(this));\r\n  }\r\n\r\n  checkAdminStatus(): void {\r\n    try {\r\n      const role = this.authService.getRole();\r\n      this.isAdmin = role === 'Admin';\r\n    } catch (error) {\r\n      console.warn('Error checking admin status:', error);\r\n      this.isAdmin = false;\r\n    }\r\n  }\r\n\r\n  toggleInboxOverlay(): void {\r\n    // Always toggle the overlay when clicked\r\n    this.showInboxOverlay = !this.showInboxOverlay;\r\n\r\n    if (this.showInboxOverlay) {\r\n      this.loadAdminMessages();\r\n      setTimeout(() => {\r\n        this.fixInboxComponentForOverlay();\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  onButtonClick(event: Event): void {\r\n    // Handle click events (mainly for desktop)\r\n    // Prevent this from firing if we're dragging or on mobile\r\n    // This prevents conflicts with touch events on mobile\r\n    if (!this.isDragging && !this.isMobile) {\r\n      this.toggleInboxOverlay();\r\n    }\r\n  }\r\n\r\n  private detectMobileDevice(): void {\r\n    // Check if device is mobile using multiple detection methods\r\n    // This ensures accurate mobile detection for touch event handling\r\n    this.isMobile =\r\n      /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\r\n        navigator.userAgent\r\n      ) ||\r\n      'ontouchstart' in window ||\r\n      navigator.maxTouchPoints > 0;\r\n  }\r\n\r\n  closeInboxOverlay(): void {\r\n    this.showInboxOverlay = false;\r\n  }\r\n\r\n  fixInboxComponentForOverlay(): void {\r\n    const inboxElement = document.querySelector(\r\n      '.overlay-enter app-floating-inbox'\r\n    );\r\n    if (inboxElement) {\r\n      const elementsWithMarginTop = inboxElement.querySelectorAll(\r\n        '[style*=\"margin-top\"]'\r\n      );\r\n      elementsWithMarginTop.forEach((el: any) => {\r\n        el.style.marginTop = '0px';\r\n      });\r\n\r\n      const elementsWithTop = inboxElement.querySelectorAll('[style*=\"top\"]');\r\n      elementsWithTop.forEach((el: any) => {\r\n        el.style.top = '0px';\r\n      });\r\n    }\r\n  }\r\n\r\n  setInitialButtonPosition(): void {\r\n    const savedPosition = localStorage.getItem('floatingInboxButtonPosition');\r\n\r\n    if (savedPosition) {\r\n      try {\r\n        const parsedPosition = JSON.parse(savedPosition);\r\n        const margin = 24;\r\n        const buttonSize = 48;\r\n        const maxX = window.innerWidth - buttonSize - margin;\r\n        const maxY = window.innerHeight - buttonSize - margin;\r\n\r\n        if (\r\n          parsedPosition.x >= margin &&\r\n          parsedPosition.x <= maxX &&\r\n          parsedPosition.y >= margin &&\r\n          parsedPosition.y <= maxY\r\n        ) {\r\n          this.buttonPosition = parsedPosition;\r\n          return;\r\n        }\r\n      } catch (error) {\r\n        console.warn('Error parsing saved button position:', error);\r\n      }\r\n    }\r\n\r\n    const margin = 24;\r\n    const buttonSize = 48;\r\n    const maxX = window.innerWidth - buttonSize - margin;\r\n    const maxY = window.innerHeight - buttonSize - margin;\r\n\r\n    this.buttonPosition = {\r\n      x: Math.max(margin, maxX),\r\n      y: Math.max(margin, maxY),\r\n    };\r\n  }\r\n\r\n  // Dragging functionality\r\n  onButtonMouseDown(event: MouseEvent): void {\r\n    // Start dragging and reset movement flag for mouse events\r\n    this.isDragging = true;\r\n    this.hasMovedDuringDrag = false;\r\n    this.dragOffset = {\r\n      x: event.clientX - this.buttonPosition.x,\r\n      y: event.clientY - this.buttonPosition.y,\r\n    };\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    document.body.style.cursor = 'grabbing';\r\n    document.body.classList.add('dragging');\r\n  }\r\n\r\n  onButtonTouchStart(event: TouchEvent): void {\r\n    // Start dragging and reset movement flag for touch events\r\n    this.isDragging = true;\r\n    this.hasMovedDuringDrag = false;\r\n\r\n    const touch = event.touches[0];\r\n    this.dragOffset = {\r\n      x: touch.clientX - this.buttonPosition.x,\r\n      y: touch.clientY - this.buttonPosition.y,\r\n    };\r\n\r\n    // Don't prevent default on touch start to allow proper touch handling\r\n    // This ensures touch events work correctly on mobile\r\n    event.stopPropagation();\r\n    document.body.style.cursor = 'grabbing';\r\n    document.body.classList.add('dragging');\r\n  }\r\n\r\n  onButtonTouchEnd(event: TouchEvent): void {\r\n    if (this.isDragging && !this.hasMovedDuringDrag) {\r\n      // If no significant movement occurred, treat as a tap/click\r\n      // For mobile, we need to explicitly call toggleInboxOverlay\r\n      // But prevent the click event from also firing\r\n      // This ensures the modal opens on mobile touch\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      this.toggleInboxOverlay();\r\n    }\r\n\r\n    this.isDragging = false;\r\n    document.body.style.cursor = 'default';\r\n    document.body.classList.remove('dragging');\r\n\r\n    // Reset the flag immediately to prevent conflicts\r\n    this.hasMovedDuringDrag = false;\r\n  }\r\n\r\n  @HostListener('document:mousemove', ['$event'])\r\n  onGlobalMouseMove(event: MouseEvent): void {\r\n    if (this.isDragging) {\r\n      requestAnimationFrame(() => {\r\n        const newX = event.clientX - this.dragOffset.x;\r\n        const newY = event.clientY - this.dragOffset.y;\r\n\r\n        const oldX = this.buttonPosition.x;\r\n        const oldY = this.buttonPosition.y;\r\n\r\n        const margin = 24;\r\n        const buttonSize = 48;\r\n        const maxX = window.innerWidth - buttonSize - margin;\r\n        const maxY = window.innerHeight - buttonSize - margin;\r\n\r\n        const finalX = Math.max(margin, Math.min(newX, maxX));\r\n        const finalY = Math.max(margin, Math.min(newY, maxY));\r\n\r\n        if (Math.abs(finalX - oldX) > 5 || Math.abs(finalY - oldY) > 5) {\r\n          this.hasMovedDuringDrag = true;\r\n        }\r\n\r\n        this.buttonPosition = {\r\n          x: finalX,\r\n          y: finalY,\r\n        };\r\n\r\n        this.saveButtonPosition();\r\n      });\r\n    }\r\n  }\r\n\r\n  @HostListener('document:touchmove', ['$event'])\r\n  onGlobalTouchMove(event: TouchEvent): void {\r\n    if (this.isDragging) {\r\n      requestAnimationFrame(() => {\r\n        const touch = event.touches[0];\r\n        const newX = touch.clientX - this.dragOffset.x;\r\n        const newY = touch.clientY - this.dragOffset.y;\r\n\r\n        const oldX = this.buttonPosition.x;\r\n        const oldY = this.buttonPosition.y;\r\n\r\n        const margin = 24;\r\n        const buttonSize = 48;\r\n        const maxX = window.innerWidth - buttonSize - margin;\r\n        const maxY = window.innerHeight - buttonSize - margin;\r\n\r\n        const finalX = Math.max(margin, Math.min(newX, maxX));\r\n        const finalY = Math.max(margin, Math.min(newY, maxY));\r\n\r\n        if (Math.abs(finalX - oldX) > 5 || Math.abs(finalY - oldY) > 5) {\r\n          this.hasMovedDuringDrag = true;\r\n        }\r\n\r\n        this.buttonPosition = {\r\n          x: finalX,\r\n          y: finalY,\r\n        };\r\n\r\n        this.saveButtonPosition();\r\n      });\r\n    }\r\n  }\r\n\r\n  @HostListener('document:mouseup')\r\n  onGlobalMouseUp(): void {\r\n    if (this.isDragging) {\r\n      this.isDragging = false;\r\n      document.body.style.cursor = 'default';\r\n      document.body.classList.remove('dragging');\r\n\r\n      setTimeout(() => {\r\n        this.hasMovedDuringDrag = false;\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  @HostListener('document:touchend', ['$event'])\r\n  onGlobalTouchEnd(event: TouchEvent): void {\r\n    // Only handle global touch end if we're not handling button touch end\r\n    if (\r\n      this.isDragging &&\r\n      !(event.target as Element)?.closest('.floating-button')\r\n    ) {\r\n      this.isDragging = false;\r\n      document.body.style.cursor = 'default';\r\n      document.body.classList.remove('dragging');\r\n\r\n      setTimeout(() => {\r\n        this.hasMovedDuringDrag = false;\r\n      }, 100);\r\n    }\r\n  }\r\n\r\n  @HostListener('window:resize')\r\n  onWindowResize(): void {\r\n    const margin = 24;\r\n    const buttonSize = 48;\r\n    const maxX = window.innerWidth - buttonSize - margin;\r\n    const maxY = window.innerHeight - buttonSize - margin;\r\n\r\n    this.buttonPosition = {\r\n      x: Math.max(margin, Math.min(this.buttonPosition.x, maxX)),\r\n      y: Math.max(margin, Math.min(this.buttonPosition.y, maxY)),\r\n    };\r\n  }\r\n\r\n  @HostListener('document:keydown.escape')\r\n  onEscapeKey(): void {\r\n    if (this.showInboxOverlay) {\r\n      this.showInboxOverlay = false;\r\n    }\r\n  }\r\n\r\n  private saveButtonPosition(): void {\r\n    try {\r\n      localStorage.setItem(\r\n        'floatingInboxButtonPosition',\r\n        JSON.stringify(this.buttonPosition)\r\n      );\r\n    } catch (error) {\r\n      console.warn('Error saving button position to localStorage:', error);\r\n    }\r\n  }\r\n\r\n  // Cache management methods\r\n  private saveToCache(messages: PlayerChat[]): void {\r\n    try {\r\n      const cacheData = {\r\n        messages: messages,\r\n        timestamp: Date.now(),\r\n      };\r\n      localStorage.setItem(this.CACHE_KEY, JSON.stringify(cacheData));\r\n      this.cachedMessages = messages;\r\n      this.lastCacheUpdate = Date.now();\r\n    } catch (error) {\r\n      console.warn('Error saving messages to cache:', error);\r\n    }\r\n  }\r\n\r\n  private loadFromCache(): PlayerChat[] | null {\r\n    try {\r\n      const cachedData = localStorage.getItem(this.CACHE_KEY);\r\n      if (!cachedData) return null;\r\n\r\n      const parsed = JSON.parse(cachedData);\r\n      const cacheAge = Date.now() - parsed.timestamp;\r\n\r\n      // Check if cache is still valid (less than 30 minutes old)\r\n      if (cacheAge < this.CACHE_DURATION) {\r\n        this.cachedMessages = parsed.messages;\r\n        this.lastCacheUpdate = parsed.timestamp;\r\n        return parsed.messages;\r\n      }\r\n\r\n      // Cache expired, remove it\r\n      localStorage.removeItem(this.CACHE_KEY);\r\n      return null;\r\n    } catch (error) {\r\n      console.warn('Error loading messages from cache:', error);\r\n      localStorage.removeItem(this.CACHE_KEY);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private isCacheValid(): boolean {\r\n    return (\r\n      this.cachedMessages.length > 0 &&\r\n      Date.now() - this.lastCacheUpdate < this.CACHE_DURATION\r\n    );\r\n  }\r\n\r\n  // Public method to get cache status\r\n  getCacheStatus(): { isValid: boolean; lastUpdate: Date | null; age: number } {\r\n    if (this.cachedMessages.length === 0) {\r\n      return { isValid: false, lastUpdate: null, age: 0 };\r\n    }\r\n\r\n    const age = Date.now() - this.lastCacheUpdate;\r\n    const isValid = age < this.CACHE_DURATION;\r\n\r\n    return {\r\n      isValid,\r\n      lastUpdate: new Date(this.lastCacheUpdate),\r\n      age: Math.floor(age / 1000 / 60), // Age in minutes\r\n    };\r\n  }\r\n\r\n  // Method to clear cache manually\r\n  clearCache(): void {\r\n    try {\r\n      localStorage.removeItem(this.CACHE_KEY);\r\n      this.cachedMessages = [];\r\n      this.lastCacheUpdate = 0;\r\n    } catch (error) {\r\n      console.warn('Error clearing cache:', error);\r\n    }\r\n  }\r\n\r\n  // Method to update cache with new data\r\n  private updateCacheWithNewData(newMessages: any[]): void {\r\n    if (newMessages.length === 0) return;\r\n\r\n    // Update existing chat messages\r\n    newMessages.forEach((newMessage) => {\r\n      const existingChat = this.cachedMessages.find(\r\n        (chat) => chat.playerId === newMessage.senderId\r\n      );\r\n\r\n      if (existingChat) {\r\n        // Check if message already exists\r\n        const messageExists = existingChat.messages.some(\r\n          (msg) => msg.id === newMessage.id\r\n        );\r\n\r\n        if (!messageExists) {\r\n          // Add new message\r\n          existingChat.messages.push(newMessage);\r\n\r\n          // Update last message and date\r\n          if (\r\n            new Date(newMessage.sentAt) > new Date(existingChat.lastMessageDate)\r\n          ) {\r\n            existingChat.lastMessage = newMessage.content;\r\n            existingChat.lastMessageDate = newMessage.sentAt;\r\n          }\r\n\r\n          // Update unread count\r\n          if (!newMessage.isRead && !newMessage.isFromAdmin) {\r\n            existingChat.unreadCount++;\r\n          }\r\n        }\r\n      } else {\r\n        // Create new chat\r\n        const newChat: PlayerChat = {\r\n          playerId: newMessage.senderId,\r\n          playerFullName: newMessage.senderFullName,\r\n          lastMessage: newMessage.content,\r\n          lastMessageDate: newMessage.sentAt,\r\n          unreadCount: !newMessage.isRead && !newMessage.isFromAdmin ? 1 : 0,\r\n          messages: [newMessage],\r\n        };\r\n        this.cachedMessages.push(newChat);\r\n      }\r\n    });\r\n\r\n    // Sort chats by last message date\r\n    this.cachedMessages.sort(\r\n      (a, b) =>\r\n        new Date(b.lastMessageDate).getTime() -\r\n        new Date(a.lastMessageDate).getTime()\r\n    );\r\n\r\n    // Save updated cache\r\n    this.saveToCache(this.cachedMessages);\r\n\r\n    // Update UI\r\n    this.playerChats = [...this.cachedMessages];\r\n  }\r\n\r\n  // Inbox functionality\r\n  private loadAdminMessages(): void {\r\n    // Always load fresh data from server (like inbox.component)\r\n    this.loadFromServer(false);\r\n  }\r\n\r\n  private loadFromServer(isBackgroundRefresh: boolean = false): void {\r\n    this.adminDashboardService.getSecondaryData('messages').subscribe({\r\n      next: (messages) => {\r\n        if (messages && messages.length > 0) {\r\n          const groupedMessages = this.groupMessagesBySender(messages);\r\n\r\n          // Always update playerChats (like inbox.component)\r\n          this.playerChats = groupedMessages.sort(\r\n            (a, b) =>\r\n              new Date(b.lastMessageDate).getTime() -\r\n              new Date(a.lastMessageDate).getTime()\r\n          );\r\n\r\n          // Save to cache for offline use\r\n          this.saveToCache(this.playerChats);\r\n\r\n          if (!isBackgroundRefresh) {\r\n            // this.toastr.success('تم تحديث الرسائل بنجاح');\r\n          }\r\n        } else {\r\n          this.toastr.error('لا يوجد رسائل');\r\n          this.playerChats = []; // Clear chats if no messages\r\n          this.saveToCache([]); // Save empty cache\r\n        }\r\n      },\r\n      error: (err) => {\r\n        this.toastr.error(err.message);\r\n        this.playerChats = []; // Clear chats on error\r\n        this.saveToCache([]); // Save empty cache on error\r\n      },\r\n    });\r\n  }\r\n\r\n  refreshMessages(): void {\r\n    // Force refresh from server and update cache\r\n    this.messageService.getAdminMessages().subscribe({\r\n      next: (response) => {\r\n        if (response && response.messages) {\r\n          const groupedMessages = this.groupMessagesBySender(response.messages);\r\n\r\n          // Update playerChats\r\n          this.playerChats = groupedMessages.sort(\r\n            (a, b) =>\r\n              new Date(b.lastMessageDate).getTime() -\r\n              new Date(a.lastMessageDate).getTime()\r\n          );\r\n\r\n          // Update cache\r\n          this.saveToCache(this.playerChats);\r\n\r\n          // Update UI\r\n          this.cdr.detectChanges();\r\n        } else {\r\n          this.toastr.error('لا يوجد رسائل');\r\n        }\r\n      },\r\n      error: (err) => {\r\n        this.toastr.error(err.message || 'فشل في تحديث الرسائل');\r\n      },\r\n    });\r\n  }\r\n\r\n  selectChat(chat: PlayerChat): void {\r\n    this.selectedChat = chat;\r\n    this.selectedPlayerId = chat.playerId;\r\n\r\n    // Use cached data directly (no new request)\r\n    if (this.selectedChat && this.selectedChat.messages) {\r\n      // Automatically mark unread messages as read\r\n      this.markUnreadMessagesAsRead(chat.playerId);\r\n\r\n      // Set flag to scroll to bottom on next view check\r\n      this.shouldScrollToBottom = true;\r\n    }\r\n  }\r\n\r\n  private loadChatMessages(playerId: string): void {\r\n    // Use cached messages instead of making new request\r\n    if (this.cachedMessages.length > 0) {\r\n      const playerMessages =\r\n        this.cachedMessages.find((chat) => chat.playerId === playerId)\r\n          ?.messages || [];\r\n\r\n      if (this.selectedChat) {\r\n        this.selectedChat.messages = playerMessages;\r\n\r\n        // Automatically mark unread messages as read\r\n        this.markUnreadMessagesAsRead(playerId);\r\n\r\n        // Scroll to bottom after messages load\r\n        setTimeout(() => {\r\n          this.scrollToBottom();\r\n        }, 100);\r\n      }\r\n    } else {\r\n      // Fallback: load from server if no cache\r\n      this.loadFromServer(false);\r\n    }\r\n  }\r\n\r\n  // New method to automatically mark unread messages as read\r\n  private markUnreadMessagesAsRead(playerId: string): void {\r\n    if (!this.selectedChat) return;\r\n\r\n    const unreadMessages = this.selectedChat.messages.filter(\r\n      (msg) => !msg.isFromAdmin && !msg.isRead\r\n    );\r\n\r\n    if (unreadMessages.length > 0) {\r\n      // Mark all unread messages as read\r\n      unreadMessages.forEach((message) => {\r\n        this.messageService.toggleMarkMessage(message.id, true).subscribe({\r\n          next: (response: any) => {\r\n            if (response.success) {\r\n              // Update local cache\r\n              message.isRead = true;\r\n\r\n              // Update unread count in chat list\r\n              const chatInList = this.playerChats.find(\r\n                (c) => c.playerId === playerId\r\n              );\r\n              if (chatInList) {\r\n                chatInList.unreadCount = Math.max(\r\n                  0,\r\n                  chatInList.unreadCount - 1\r\n                );\r\n              }\r\n\r\n              // Update cache with new read status\r\n              this.saveToCache(this.playerChats);\r\n\r\n              // Update UI\r\n              this.cdr.detectChanges();\r\n            }\r\n          },\r\n          error: (err: any) => {\r\n            console.error('Error marking message as read:', err);\r\n          },\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  private scrollToTop(): void {\r\n    const messagesContainer = document.querySelector('#messagesContainer');\r\n    if (messagesContainer) {\r\n      messagesContainer.scrollTop = 0;\r\n    }\r\n  }\r\n\r\n  private scrollToBottom(): void {\r\n    if (this.messagesContainer && this.messagesContainer.nativeElement) {\r\n      // Scroll to bottom to show latest messages\r\n      this.messagesContainer.nativeElement.scrollTop =\r\n        this.messagesContainer.nativeElement.scrollHeight;\r\n    }\r\n  }\r\n\r\n  private groupMessagesBySender(messages: any[]): PlayerChat[] {\r\n    const chatMap = new Map<string, PlayerChat>();\r\n\r\n    messages.forEach((message) => {\r\n      const senderId = message.senderId;\r\n      if (!chatMap.has(senderId)) {\r\n        chatMap.set(senderId, {\r\n          playerId: senderId,\r\n          playerFullName: message.senderFullName,\r\n          lastMessage: message.content,\r\n          lastMessageDate: message.sentAt,\r\n          unreadCount: message.isRead ? 0 : 1,\r\n          messages: [message],\r\n        });\r\n      } else {\r\n        const chat = chatMap.get(senderId)!;\r\n        chat.messages.push(message);\r\n\r\n        if (new Date(message.sentAt) > new Date(chat.lastMessageDate)) {\r\n          chat.lastMessage = message.content;\r\n          chat.lastMessageDate = message.sentAt;\r\n        }\r\n\r\n        if (!message.isRead) {\r\n          chat.unreadCount++;\r\n        }\r\n      }\r\n    });\r\n\r\n    // Sort messages within each chat from oldest to newest\r\n    Array.from(chatMap.values()).forEach((chat) => {\r\n      chat.messages.sort(\r\n        (a, b) => new Date(a.sentAt).getTime() - new Date(b.sentAt).getTime()\r\n      );\r\n    });\r\n\r\n    return Array.from(chatMap.values());\r\n  }\r\n\r\n  sendReply(playerId: string): void {\r\n    if (!this.replyText || this.replyText.trim() === '') {\r\n      this.toastr.error('يرجى كتابة رد');\r\n      return;\r\n    }\r\n\r\n    const replyContent = this.replyText; // Store before clearing\r\n    this.replyText = ''; // Clear the input\r\n\r\n    this.messageService.sendAdminReply(playerId, replyContent).subscribe({\r\n      next: (response: any) => {\r\n        if (response.success) {\r\n          this.toastr.success('تم إرسال الرد بنجاح');\r\n\r\n          // Add the new reply to local data immediately (like inbox.component)\r\n          // This ensures the UI updates instantly without waiting for server response\r\n          if (this.selectedChat) {\r\n            const newReply = {\r\n              id: response.messageId || Date.now(),\r\n              content: replyContent,\r\n              sentAt: new Date().toISOString(),\r\n              isFromAdmin: true,\r\n              isRead: true,\r\n              senderId: 'admin',\r\n              senderFullName: 'Admin',\r\n            };\r\n\r\n            // Add to selected chat\r\n            this.selectedChat.messages.push(newReply);\r\n\r\n            // Update last message in chat list\r\n            const chatInList = this.playerChats.find(\r\n              (c) => c.playerId === playerId\r\n            );\r\n            if (chatInList) {\r\n              chatInList.lastMessage = replyContent;\r\n              chatInList.lastMessageDate = newReply.sentAt;\r\n\r\n              // Re-sort chats by latest message\r\n              this.playerChats.sort(\r\n                (a, b) =>\r\n                  new Date(b.lastMessageDate).getTime() -\r\n                  new Date(a.lastMessageDate).getTime()\r\n              );\r\n            }\r\n\r\n            // Update cache\r\n            this.saveToCache(this.playerChats);\r\n\r\n            // Force UI update immediately to show the new message\r\n            this.cdr.detectChanges();\r\n\r\n            // Scroll to bottom after sending reply to show the new message\r\n            setTimeout(() => {\r\n              this.scrollToBottom();\r\n            }, 100);\r\n          }\r\n        } else {\r\n          this.toastr.error(response.message || 'فشل في إرسال الرد');\r\n        }\r\n      },\r\n      error: (err: any) => {\r\n        this.toastr.error(err.message || 'فشل في إرسال الرد');\r\n      },\r\n    });\r\n  }\r\n\r\n  markAsRead(messageId: number): void {\r\n    this.messageService.toggleMarkMessage(messageId, true).subscribe({\r\n      next: (response: any) => {\r\n        if (response.success) {\r\n          // Update local data immediately (like inbox.component)\r\n          if (this.selectedChat) {\r\n            const message = this.selectedChat.messages.find(\r\n              (msg) => msg.id === messageId\r\n            );\r\n            if (message) {\r\n              message.isRead = true;\r\n\r\n              // Update unread count in chat list\r\n              const chatInList = this.playerChats.find(\r\n                (c) => c.playerId === this.selectedChat?.playerId\r\n              );\r\n              if (chatInList) {\r\n                chatInList.unreadCount = Math.max(\r\n                  0,\r\n                  chatInList.unreadCount - 1\r\n                );\r\n              }\r\n\r\n              // Update cache\r\n              this.saveToCache(this.playerChats);\r\n            }\r\n          }\r\n\r\n          this.cdr.detectChanges();\r\n        }\r\n      },\r\n      error: (err: any) => {\r\n        console.error('Error marking message as read:', err);\r\n      },\r\n    });\r\n  }\r\n\r\n  goBack(): void {\r\n    this.selectedChat = null;\r\n    this.selectedPlayerId = null;\r\n  }\r\n\r\n  trackByMessageId(index: number, message: any): number {\r\n    return message.id;\r\n  }\r\n}\r\n","<div\r\n  #navbarContainer\r\n  class=\"fixed top-0 left-0 w-full z-50 bg-black backdrop-blur-sm transition-all duration-300\"\r\n>\r\n  <nav #navbarOnly>\r\n    <div\r\n      class=\"container mx-auto flex flex-col md:flex-row md:items-center md:justify-between p-2\"\r\n    >\r\n      <!-- Row with 3 sections: logo | menu | auth -->\r\n      <div class=\"w-full flex items-center justify-between md:gap-4\">\r\n        <!-- Left: Logo + Send Message (mobile) -->\r\n        <div class=\"flex items-center gap-4\">\r\n          <a\r\n            class=\"text-xl font-bold bg-gradient-to-r from-indigo-400 to-cyan-400 text-transparent bg-clip-text\"\r\n            *ngIf=\"!isAdmin\"\r\n          >\r\n            YuGi Tournament\r\n          </a>\r\n          <a\r\n            *ngIf=\"isAdmin\"\r\n            routerLink=\"/admin/players\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2 font-bold text-sm md:text-base\"\r\n          >\r\n            Dashboard\r\n          </a>\r\n          <a\r\n            *ngIf=\"isAdmin\"\r\n            routerLink=\"/admin/friendlies\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2 font-bold text-sm md:text-base\"\r\n          >\r\n            Friendlies\r\n          </a>\r\n          <a\r\n            *ngIf=\"isAdmin\"\r\n            routerLink=\"/admin/teams-dashboard\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2 font-bold text-sm md:text-base\"\r\n          >\r\n            Teams\r\n          </a>\r\n\r\n          <!-- Send Message (small screen only) -->\r\n          <a\r\n            *ngIf=\"isLoggedIn && !isAdmin\"\r\n            routerLink=\"/player/inbox\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"md:hidden font-bold text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2 cursor-pointer\"\r\n          >\r\n            Inbox\r\n          </a>\r\n        </div>\r\n\r\n        <!-- Center: Navigation links -->\r\n        <div class=\"hidden md:flex justify-center space-x-2 font-bold\">\r\n          <a\r\n            routerLink=\"/player/friendlies\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n          >\r\n            🎮 Friendlies\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/teams\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n          >\r\n            👥 Teams\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/forbidden\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n          >\r\n            Forbidden Cards\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/allLeagues\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n          >\r\n            All Leagues\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/league-table\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n          >\r\n            League Table\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/ranking\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n          >\r\n            Ranking\r\n          </a>\r\n        </div>\r\n\r\n        <!-- Right: Auth Buttons -->\r\n        <div class=\"hidden md:flex justify-end items-center space-x-4\">\r\n          <!-- Send Message (only on large screens) -->\r\n          <a\r\n            *ngIf=\"isLoggedIn && !isAdmin\"\r\n            routerLink=\"/player/inbox\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white font-bold hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2 cursor-pointer\"\r\n          >\r\n            Inbox\r\n          </a>\r\n\r\n          <ng-container *ngIf=\"!isLoggedIn\">\r\n            <a\r\n              routerLink=\"/auth/login\"\r\n              routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n              class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            >\r\n              Login\r\n            </a>\r\n            <a\r\n              routerLink=\"/auth/register\"\r\n              routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n              class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            >\r\n              Register\r\n            </a>\r\n          </ng-container>\r\n\r\n          <a\r\n            *ngIf=\"isLoggedIn\"\r\n            (click)=\"logout()\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2 cursor-pointer\"\r\n          >\r\n            Logout\r\n          </a>\r\n        </div>\r\n\r\n        <!-- Hamburger Button (small screen only) -->\r\n        <div class=\"md:hidden\">\r\n          <button (click)=\"toggleMenu()\" class=\"text-white ml-2\">\r\n            <svg\r\n              xmlns=\"http://www.w3.org/2000/svg\"\r\n              class=\"h-6 w-6\"\r\n              fill=\"none\"\r\n              viewBox=\"0 0 24 24\"\r\n              stroke=\"currentColor\"\r\n              stroke-width=\"2\"\r\n            >\r\n              <path\r\n                stroke-linecap=\"round\"\r\n                stroke-linejoin=\"round\"\r\n                d=\"M4 6h16M4 12h16M4 18h16\"\r\n              />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Mobile Menu (below full row) -->\r\n      <div\r\n        class=\"w-full mt-4 md:hidden\"\r\n        [ngClass]=\"{ block: isMenuOpen, hidden: !isMenuOpen }\"\r\n      >\r\n        <div class=\"flex flex-col space-y-2 font-bold text-center\">\r\n          <a\r\n            routerLink=\"/player/friendlies\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            (click)=\"closeMenu()\"\r\n          >\r\n            🎮 Friendlies\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/teams\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            (click)=\"closeMenu()\"\r\n          >\r\n            👥 Teams\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/forbidden\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            (click)=\"closeMenu()\"\r\n          >\r\n            Forbidden Cards\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/allLeagues\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            (click)=\"closeMenu()\"\r\n          >\r\n            All Leagues\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/league-table\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            (click)=\"closeMenu()\"\r\n          >\r\n            League Table\r\n          </a>\r\n          <a\r\n            routerLink=\"/player/ranking\"\r\n            routerLinkActive=\"!text-indigo-300 bg-white/10 border-b-2 border-white\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n            (click)=\"closeMenu()\"\r\n          >\r\n            Ranking\r\n          </a>\r\n\r\n          <ng-container *ngIf=\"!isLoggedIn\">\r\n            <a\r\n              routerLink=\"/auth/login\"\r\n              class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n              (click)=\"closeMenu()\"\r\n            >\r\n              Login\r\n            </a>\r\n            <a\r\n              routerLink=\"/auth/register\"\r\n              class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2\"\r\n              (click)=\"closeMenu()\"\r\n            >\r\n              Register\r\n            </a>\r\n          </ng-container>\r\n\r\n          <a\r\n            *ngIf=\"isLoggedIn\"\r\n            (click)=\"logout(); closeMenu()\"\r\n            class=\"text-white hover:text-gray-300 hover:bg-gray-700 transition rounded py-2 px-2 cursor-pointer\"\r\n          >\r\n            Logout\r\n          </a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </nav>\r\n</div>\r\n\r\n<!-- Notes Section - خارج النافبار الثابت -->\r\n<div\r\n  class=\"fixed w-full z-40 bg-black/10 backdrop-blur-sm\"\r\n  [style.top.px]=\"getNavbarOnlyHeight()\"\r\n  *ngIf=\"notes.length > 0\"\r\n>\r\n  <div class=\"min-h-[30px] w-full\">\r\n    <div *ngFor=\"let note of notes\" class=\"py-1\">\r\n      <h4 class=\"text-center text-[16px] text-white font-bold\">\r\n        {{ note.content }}\r\n      </h4>\r\n    </div>\r\n  </div>\r\n</div>\r\n","import {\r\n  Component,\r\n  HostListener,\r\n  OnInit,\r\n  ViewChild,\r\n  ElementRef,\r\n  AfterViewInit,\r\n  Output,\r\n  EventEmitter,\r\n} from '@angular/core';\r\nimport { AuthService } from '../../app/core/services/auth.service';\r\nimport { Router } from '@angular/router';\r\nimport { ToastrService } from 'ngx-toastr';\r\nimport { NoteService } from '../core/services/note.service';\r\nimport { Note } from '../models/interfaces';\r\n\r\n@Component({\r\n  selector: 'app-navbar',\r\n  templateUrl: './navbar.component.html',\r\n  styleUrls: ['./navbar.component.css'],\r\n})\r\nexport class NavbarComponent implements OnInit, AfterViewInit {\r\n  @ViewChild('navbarContainer', { static: false }) navbarContainer!: ElementRef;\r\n  @ViewChild('navbarOnly', { static: false }) navbarOnly!: ElementRef;\r\n  @Output() navbarHeightChange = new EventEmitter<number>();\r\n\r\n  isLoggedIn = false;\r\n  isAdmin = false;\r\n  notes: Note[] = [];\r\n  isMenuOpen = false;\r\n  navbarHeight = 80; // default height\r\n  navbarOnlyHeight = 60; // navbar without notes\r\n\r\n  constructor(\r\n    private authService: AuthService,\r\n    private router: Router,\r\n    private toastr: ToastrService,\r\n    private noteService: NoteService\r\n  ) {\r\n    this.authService.isLoggedIn$.subscribe((loggedIn) => {\r\n      this.isLoggedIn = loggedIn;\r\n      const role = this.authService.getRole();\r\n      this.isAdmin = role === 'Admin';\r\n    });\r\n  }\r\n  ngOnInit(): void {\r\n    this.getNotes();\r\n  }\r\n\r\n  ngAfterViewInit(): void {\r\n    this.calculateNavbarHeight();\r\n  }\r\n\r\n  calculateNavbarHeight(): void {\r\n    setTimeout(() => {\r\n      // Calculate navbar only height\r\n      if (this.navbarOnly) {\r\n        this.navbarOnlyHeight = this.navbarOnly.nativeElement.offsetHeight;\r\n      }\r\n\r\n      // Calculate total height including notes\r\n      const notesHeight = this.notes.length * 32; // approximate height per note\r\n      const totalHeight = this.navbarOnlyHeight + notesHeight;\r\n      this.navbarHeight = totalHeight;\r\n      this.navbarHeightChange.emit(totalHeight);\r\n    }, 150);\r\n  }\r\n\r\n  getNavbarOnlyHeight(): number {\r\n    return this.navbarOnlyHeight;\r\n  }\r\n\r\n  logout() {\r\n    this.authService.logout();\r\n    this.toastr.success('تم تسجيل الخروج بنجاح');\r\n    this.router.navigate(['/player']);\r\n  }\r\n\r\n  getNotes(): void {\r\n    this.noteService.getNotes().subscribe((response) => {\r\n      // Handle if response.notes is wrapped in an object or not an array\r\n      const notes = Array.isArray(response.notes)\r\n        ? response.notes\r\n        : (response.notes as any)?.data || [];\r\n      this.notes = notes.filter((n: Note) => n.isHidden == false);\r\n      // Recalculate height after notes change\r\n      setTimeout(() => this.calculateNavbarHeight(), 50);\r\n    });\r\n  }\r\n  toggleMenu() {\r\n    this.isMenuOpen = !this.isMenuOpen;\r\n  }\r\n\r\n  closeMenu() {\r\n    this.isMenuOpen = false;\r\n  }\r\n\r\n  @HostListener('window:resize', ['$event'])\r\n  onResize(event: any) {\r\n    this.calculateNavbarHeight();\r\n  }\r\n}\r\n","import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { TitleStrategyService } from './core/services/title-strategy.service';\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: './app.component.html',\r\n  styleUrls: ['./app.component.css'],\r\n})\r\nexport class AppComponent implements OnInit, OnDestroy {\r\n  title = 'Yugi-Oh Tournament';\r\n  navbarHeight = 80; // default height\r\n\r\n  constructor(\r\n    private titleStrategy: TitleStrategyService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    // Initialize title strategy with a small delay to ensure router is ready\r\n    setTimeout(() => {\r\n      this.titleStrategy.setTitle('');\r\n    }, 100);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    // Clean up\r\n  }\r\n\r\n  onNavbarHeightChange(height: number): void {\r\n    this.navbarHeight = height;\r\n  }\r\n}\r\n","<app-navbar (navbarHeightChange)=\"onNavbarHeightChange($event)\"></app-navbar>\r\n<div\r\n  [style.margin-top.px]=\"navbarHeight\"\r\n  [style.min-height]=\"'calc(100vh - ' + navbarHeight + 'px)'\"\r\n  class=\"relative\"\r\n>\r\n  <router-outlet></router-outlet>\r\n</div>\r\n\r\n<!-- Floating Inbox Component -->\r\n<app-floating-inbox></app-floating-inbox>\r\n\r\n<ngx-spinner\r\n  bdColor=\"rgba(0, 0, 0, 1)\"\r\n  size=\"medium\"\r\n  color=\"#fff\"\r\n  type=\"square-jelly-box\"\r\n  [fullScreen]=\"true\"\r\n  ><p style=\"color: white\">Loading...</p></ngx-spinner\r\n>\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  HttpInterceptor,\r\n  HttpRequest,\r\n  HttpHandler,\r\n  HttpEvent,\r\n} from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { finalize } from 'rxjs/operators';\r\nimport { NgxSpinnerService } from 'ngx-spinner';\r\n\r\n@Injectable()\r\nexport class AuthInterceptor implements HttpInterceptor {\r\n  constructor(private spinner: NgxSpinnerService) {}\r\n\r\n  intercept(\r\n    req: HttpRequest<any>,\r\n    next: HttpHandler\r\n  ): Observable<HttpEvent<any>> {\r\n    this.spinner.show();\r\n\r\n    const token = localStorage.getItem('token');\r\n    let clonedReq = req;\r\n\r\n    if (token) {\r\n      clonedReq = req.clone({\r\n        setHeaders: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n    }\r\n\r\n    return next.handle(clonedReq).pipe(\r\n      finalize(() => {\r\n        this.spinner.hide();\r\n      })\r\n    );\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n  HttpInterceptor,\r\n  HttpRequest,\r\n  HttpHandler,\r\n  HttpEvent,\r\n  HttpResponse,\r\n} from '@angular/common/http';\r\nimport { Observable, of } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { CacheService } from '../services/cache.service';\r\n\r\n@Injectable()\r\nexport class CacheInterceptor implements HttpInterceptor {\r\n  constructor(private cacheService: CacheService) {}\r\n\r\n  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\r\n\r\n    \r\n    // Check if this is a GET request and should be cached\r\n    if (request.method === 'GET' && this.shouldCache(request.url)) {\r\n      const cachedResponse = this.cacheService.get(request.url);\r\n      if (cachedResponse) {\r\n        return of(new HttpResponse({ body: cachedResponse }));\r\n      }\r\n    }\r\n    \r\n    return next.handle(request);\r\n  }\r\n\r\n  private shouldCache(url: string): boolean {\r\n    // Add URLs that should be cached\r\n    const cacheableUrls = [\r\n      '/player/ranking',\r\n      '/player',\r\n      '/match',\r\n      '/Message/inbox',\r\n      '/note/notes',\r\n      '/player/players/all',\r\n      '/league/getCurrentLeague'\r\n    ];\r\n    \r\n    return cacheableUrls.some(cacheableUrl => url.includes(cacheableUrl));\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { BrowserModule, Title } from '@angular/platform-browser';\r\nimport { AppRoutingModule } from './app-routing.module';\r\nimport { AppComponent } from './app.component';\r\nimport { HTTP_INTERCEPTORS, HttpClientModule } from '@angular/common/http';\r\nimport { ToastrModule } from 'ngx-toastr';\r\nimport { NoopAnimationsModule } from '@angular/platform-browser/animations';\r\nimport { NavbarComponent } from './navbar/navbar.component';\r\nimport { AuthInterceptor } from './interceptors/auth-interceptor.service';\r\nimport { CacheInterceptor } from './core/interceptors/cache-interceptor.service';\r\nimport { NgxSpinnerModule } from 'ngx-spinner';\r\nimport { TitleStrategyService } from './core/services/title-strategy.service';\r\nimport { SharedModule } from './shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [AppComponent, NavbarComponent],\r\n  imports: [\r\n    BrowserModule,\r\n    AppRoutingModule,\r\n    HttpClientModule,\r\n    NoopAnimationsModule,\r\n    ToastrModule.forRoot({\r\n      timeOut: 3000,\r\n      positionClass: 'toast-top-right',\r\n      preventDuplicates: true,\r\n    }),\r\n    NgxSpinnerModule.forRoot({ type: 'square-jelly-box' }),\r\n    SharedModule,\r\n  ],\r\n  providers: [\r\n    { provide: HTTP_INTERCEPTORS, useClass: AuthInterceptor, multi: true },\r\n    { provide: HTTP_INTERCEPTORS, useClass: CacheInterceptor, multi: true },\r\n    NgxSpinnerModule,\r\n    Title,\r\n    TitleStrategyService,\r\n  ],\r\n  bootstrap: [AppComponent],\r\n})\r\nexport class AppModule {}\r\n","import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\r\n\r\nimport { AppModule } from './app/app.module';\r\n\r\nplatformBrowserDynamic()\r\n  .bootstrapModule(AppModule)\r\n  .catch((err) => {});\r\n"],"x_google_ignoreList":[]}