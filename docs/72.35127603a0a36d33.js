"use strict";(self.webpackChunkYugiTournamnet=self.webpackChunkYugiTournamnet||[]).push([[72],{9072:(ve,_,c)=>{c.r(_),c.d(_,{AdminModule:()=>xe});var g=c(177),h=c(9834);function y(r,n,t,s,i,a,o){try{var l=r[a](o),u=l.value}catch(f){return void t(f)}l.done?n(u):Promise.resolve(u).then(s,i)}var e=c(2598),j=c(3665),w=c(9101),x=c(5794),S=c(7137),v=c(6375),T=c(5716),I=c(4412),F=c(605),E=c(5312),k=c(1626),p=c(5430);let m=(()=>{class r{constructor(t,s){this.http=t,this.cacheService=s,this.isUpdating=!1,this.baseUrl=E.c.apiUrl,this.updateStatusSubject=new I.t({isUpdating:!1,lastUpdateTime:new Date(this.getNextTwoMinuteTime().getTime()-12e4),nextUpdateTime:this.getNextTwoMinuteTime(),timeUntilNextUpdate:""}),this.updateStatus$=this.updateStatusSubject.asObservable();const i=this.getNextTwoMinuteTime(),a=new Date(i.getTime()-12e4);this.updateStatusSubject.next({isUpdating:!1,lastUpdateTime:a,nextUpdateTime:i,timeUntilNextUpdate:this.getTimeUntilNextUpdate()}),setTimeout(()=>{this.startAutoUpdate(),this.startStatusUpdates()},0)}getNextHalfHourTime(){const t=new Date,i=t.getMinutes()>=30?60:30;return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),i,0,0)}getNextTwoMinuteTime(){const t=new Date,s=t.getMinutes(),i=2*Math.ceil(s/2);return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),i,0,0)}startAutoUpdate(){const t=new Date,i=this.getNextTwoMinuteTime().getTime()-t.getTime();setTimeout(()=>{this.updateAdminData(),this.startTwoMinuteUpdates()},i)}startTwoMinuteUpdates(){this.updateInterval=setInterval(()=>{this.updateAdminData()},12e4)}updateAdminData(){this.isUpdating||(this.isUpdating=!0,this.updateStatusSubject.next({...this.updateStatusSubject.value,isUpdating:!0}),this.http.get(`${this.baseUrl}/player`).subscribe({next:t=>{this.cacheService.set("admin-players-list",t,18e5)},error:t=>{console.error("\u274c Failed to update players list:",t)}}),this.http.get(`${this.baseUrl}/match`).subscribe({next:t=>{this.cacheService.set("admin-matches-list",t,18e5)},error:t=>{console.error("\u274c Failed to update matches:",t)}}),this.http.get(`${this.baseUrl}/Message/inbox`).subscribe({next:t=>{this.cacheService.set("admin-messages-list",t,12e4)},error:t=>{console.error("\u274c Failed to update messages:",t)}}),this.http.get(`${this.baseUrl}/note/notes`).subscribe({next:t=>{this.cacheService.set("admin-notes-list",t,18e5)},error:t=>{console.error("\u274c Failed to update notes:",t)}}),this.http.get(`${this.baseUrl}/player/players/all`).subscribe({next:t=>{this.cacheService.set("admin-all-leagues-list",t,18e5)},error:t=>{console.error("\u274c Failed to update all leagues:",t)}}),this.http.get(`${this.baseUrl}/league/getCurrentLeague`).subscribe({next:t=>{this.cacheService.set("admin-current-league",t,18e5)},error:t=>{console.error("\u274c Failed to update current league:",t)}}),setTimeout(()=>{this.isUpdating=!1;const t=this.getNextTwoMinuteTime(),s=new Date(t.getTime()-12e4);this.updateStatusSubject.next({isUpdating:!1,lastUpdateTime:s,nextUpdateTime:t,timeUntilNextUpdate:this.getTimeUntilNextUpdate()})},5e3))}startStatusUpdates(){(0,F.Y)(6e4).subscribe(()=>{this.updateStatusSubject.next({...this.updateStatusSubject.value,timeUntilNextUpdate:this.getTimeUntilNextUpdate()})})}getTimeUntilNextUpdate(){const t=this.updateStatusSubject.value.nextUpdateTime,s=new Date,i=t.getTime()-s.getTime();return`${Math.floor(i/6e4)}:${Math.floor(i%6e4/1e3).toString().padStart(2,"0")}`}getUpdateStatus(){return this.updateStatusSubject.value}formatTime(t){return t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}stopAutoUpdate(){this.updateInterval&&clearInterval(this.updateInterval)}forceUpdate(){this.updateAdminData()}invalidateAdminCache(){this.cacheService.remove("admin-players-list"),this.cacheService.remove("admin-matches-list"),this.cacheService.remove("admin-messages-list"),this.cacheService.remove("admin-notes-list"),this.cacheService.remove("admin-all-leagues-list"),this.cacheService.remove("admin-current-league")}static{this.\u0275fac=function(s){return new(s||r)(e.KVO(k.Qq),e.KVO(p._))}}static{this.\u0275prov=e.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var d=c(4341);let N=(()=>{class r{constructor(t){this.injector=t,this.updateSubscription=null,this.adminBackgroundService=this.injector.get(m),this.updateStatus=this.adminBackgroundService.getUpdateStatus()}ngOnInit(){setTimeout(()=>{this.updateSubscription=this.adminBackgroundService.updateStatus$.subscribe(t=>{this.updateStatus=t})},100)}ngOnDestroy(){this.updateSubscription&&this.updateSubscription.unsubscribe()}formatTime(t){return this.adminBackgroundService.formatTime(t)}static{this.\u0275fac=function(s){return new(s||r)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-admin-update-status"]],decls:19,vars:3,consts:[[1,"bg-black","bg-opacity-30","backdrop-blur-sm","rounded-lg","p-3","mb-4","text-center"],[1,"text-sm","text-gray-300"],[1,"flex","justify-between","items-center","mb-2"],[1,"font-bold"],[1,"text-white"],[1,"flex","justify-between","items-center"],[1,"flex","justify-between","items-center","mt-1"],[1,"text-green-400","font-bold"],[1,"text-xs","text-blue-400","mt-1"]],template:function(s,i){1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),e.EFF(4,"\u0622\u062e\u0631 \u062a\u062d\u062f\u064a\u062b:"),e.k0s(),e.j41(5,"span",4),e.EFF(6),e.k0s()(),e.j41(7,"div",5)(8,"span",3),e.EFF(9,"\u0627\u0644\u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0642\u0627\u062f\u0645:"),e.k0s(),e.j41(10,"span",4),e.EFF(11),e.k0s()(),e.j41(12,"div",6)(13,"span",3),e.EFF(14,"\u0627\u0644\u0648\u0642\u062a \u0627\u0644\u0645\u062a\u0628\u0642\u064a:"),e.k0s(),e.j41(15,"span",7),e.EFF(16),e.k0s()(),e.j41(17,"div",8),e.EFF(18," \u{1f504} \u062a\u062d\u062f\u064a\u062b \u062a\u0644\u0642\u0627\u0626\u064a \u0643\u0644 30 \u062f\u0642\u064a\u0642\u0629 "),e.k0s()()()),2&s&&(e.R7$(6),e.JRh(i.formatTime(i.updateStatus.lastUpdateTime)),e.R7$(5),e.JRh(i.formatTime(i.updateStatus.nextUpdateTime)),e.R7$(5),e.JRh(i.updateStatus.timeUntilNextUpdate))}})}}return r})();function D(r,n){if(1&r){const t=e.RV6();e.j41(0,"li",36),e.bIt("click",function(){const a=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.selectPlayer(a))}),e.j41(1,"span",37),e.EFF(2),e.k0s(),e.j41(3,"button",38),e.bIt("click",function(i){const o=e.eBV(t).$implicit,l=e.XpG(2);return e.Njj(l.confirmDelete(o,i))}),e.EFF(4," X "),e.k0s()()}if(2&r){const t=n.$implicit,s=e.XpG(2);e.AVh("bg-blue-600",(null==s.selectedPlayer?null:s.selectedPlayer.playerId)===t.playerId),e.R7$(2),e.JRh(t.fullName)}}function P(r,n){if(1&r&&(e.j41(0,"ul"),e.DNE(1,D,5,3,"li",35),e.k0s()),2&r){const t=e.XpG();e.R7$(1),e.Y8G("ngForOf",t.players)}}function R(r,n){if(1&r){const t=e.RV6();e.j41(0,"button",39),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openModal())}),e.EFF(1," Add Player "),e.k0s()}}const b=function(r){return{"opacity-50 cursor-not-allowed":r}};function G(r,n){if(1&r){const t=e.RV6();e.j41(0,"tr",46)(1,"td",47),e.EFF(2),e.k0s(),e.j41(3,"td",47),e.EFF(4),e.k0s(),e.j41(5,"td",47),e.EFF(6),e.k0s(),e.j41(7,"td",48)(8,"button",49),e.bIt("click",function(){const a=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.updateMatch(a.matchId,a.player1Id))}),e.EFF(9),e.k0s(),e.j41(10,"button",50),e.bIt("click",function(){const a=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.updateMatch(a.matchId,a.player2Id))}),e.EFF(11),e.k0s(),e.j41(12,"button",51),e.bIt("click",function(){const a=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.updateMatch(a.matchId,null))}),e.EFF(13),e.k0s(),e.j41(14,"button",52),e.bIt("click",function(){const a=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.resetMatch(a.matchId))}),e.EFF(15),e.k0s()()()}if(2&r){const t=n.$implicit,s=n.index,i=e.XpG(2);e.Y8G("ngClass",s%2==0?"bg-gray-900":"bg-gray-950"),e.R7$(2),e.JRh(t.player1Name),e.R7$(2),e.JRh(t.player2Name),e.R7$(2),e.Lme(" ",t.score1," - ",t.score2," "),e.R7$(2),e.Y8G("disabled",t.isCompleted)("ngClass",e.eq3(15,b,t.isCompleted)),e.R7$(1),e.SpI(" ",i.loadingMatches[t.matchId]?"Load..":"Win P1"," "),e.R7$(1),e.Y8G("disabled",t.isCompleted)("ngClass",e.eq3(17,b,t.isCompleted)),e.R7$(1),e.SpI(" ",i.loadingMatches[t.matchId]?"Load..":"Win P2"," "),e.R7$(1),e.Y8G("disabled",t.isCompleted)("ngClass",e.eq3(19,b,t.isCompleted)),e.R7$(1),e.SpI(" ",i.loadingMatches[t.matchId]?"Load..":"Draw"," "),e.R7$(2),e.SpI(" ",i.loadingMatches[t.matchId]?"Load..":"Undo"," ")}}function $(r,n){if(1&r&&(e.j41(0,"div",40)(1,"h2",41),e.EFF(2),e.k0s(),e.j41(3,"table",42)(4,"thead")(5,"tr",43)(6,"th",44),e.EFF(7,"Player 1"),e.k0s(),e.j41(8,"th",44),e.EFF(9,"Player 2"),e.k0s(),e.j41(10,"th",44),e.EFF(11,"Result"),e.k0s(),e.j41(12,"th",44),e.EFF(13,"Actions"),e.k0s()()(),e.j41(14,"tbody"),e.DNE(15,G,16,21,"tr",45),e.k0s()()()),2&r){const t=e.XpG();e.R7$(2),e.SpI(" Matches for ",t.selectedPlayer.fullName," "),e.R7$(13),e.Y8G("ngForOf",t.displayMatches)}}function L(r,n){if(1&r&&(e.j41(0,"div",53)(1,"h2",54),e.EFF(2),e.k0s()()),2&r){const t=e.XpG();e.R7$(2),e.JRh(t.totalMessagesLeft)}}function A(r,n){if(1&r){const t=e.RV6();e.j41(0,"button",55),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.openStartLeagueModal())}),e.EFF(1," Start New League "),e.k0s()}}function U(r,n){if(1&r){const t=e.RV6();e.j41(0,"button",56),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.showEndLeagueModal=!0)}),e.EFF(1," End League "),e.k0s()}}function B(r,n){1&r&&(e.j41(0,"p",58),e.EFF(1," Single "),e.k0s())}function X(r,n){1&r&&(e.j41(0,"p",58),e.EFF(1," Multi "),e.k0s())}function V(r,n){if(1&r&&(e.j41(0,"div",57)(1,"div",19)(2,"h3",20),e.EFF(3," League Description "),e.k0s(),e.j41(4,"h2",58),e.EFF(5),e.k0s()(),e.j41(6,"div",19)(7,"h3",20),e.EFF(8,"League Type"),e.k0s(),e.DNE(9,B,2,0,"p",59),e.DNE(10,X,2,0,"p",59),e.k0s(),e.j41(11,"div",19)(12,"h3",20),e.EFF(13,"Start Date"),e.k0s(),e.j41(14,"p",58),e.EFF(15),e.nI1(16,"date"),e.k0s()(),e.j41(17,"div",19)(18,"h3",20),e.EFF(19,"League Name"),e.k0s(),e.j41(20,"p",58),e.EFF(21),e.k0s()()()),2&r){const t=e.XpG();e.R7$(5),e.JRh(t.leagueData.description),e.R7$(4),e.Y8G("ngIf",0===t.leagueData.typeOfLeague),e.R7$(1),e.Y8G("ngIf",1===t.leagueData.typeOfLeague),e.R7$(5),e.SpI(" ",e.i5U(16,5,t.leagueData.createdOn,"fullDate")," "),e.R7$(6),e.JRh(t.leagueData.name)}}const Y=function(r,n){return{"bg-gray-900":r,"bg-gray-950":n}};function O(r,n){if(1&r){const t=e.RV6();e.j41(0,"tr",60)(1,"td",61),e.EFF(2),e.k0s(),e.j41(3,"td",30),e.EFF(4),e.k0s(),e.j41(5,"td",61),e.EFF(6),e.k0s(),e.j41(7,"td",61),e.EFF(8),e.nI1(9,"date"),e.k0s(),e.j41(10,"td",61),e.EFF(11),e.k0s(),e.j41(12,"td",30)(13,"button",62),e.bIt("click",function(){const a=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.openDeleteLeagueModal(a.leagueId))}),e.EFF(14," Delete League "),e.k0s()()()}if(2&r){const t=n.$implicit,s=n.index;e.Y8G("ngClass",e.l_i(13,Y,s%2==0,s%2!=0)),e.R7$(2),e.SpI(" ",t.leagueName," "),e.R7$(1),e.AVh("text-green-500",!t.isFinished)("text-red-500",t.isFinished),e.R7$(1),e.SpI(" ",t.isFinished?"Finished":"Live Now!!"," "),e.R7$(2),e.SpI(" ",0===t.leagueType?"Single":"Multi"," "),e.R7$(2),e.SpI(" ",e.i5U(9,10,t.createdOn,"yyyy/MM/dd")," "),e.R7$(3),e.SpI(" ",t.players&&t.players.length>0?t.players[0].fullName:"No Winner Yet"," ")}}function H(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",63)(1,"div",64)(2,"h2",65),e.EFF(3,"Confirm Delete"),e.k0s(),e.j41(4,"p",66),e.EFF(5),e.k0s(),e.j41(6,"div",67)(7,"button",68),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.closeDeleteLeagueModal())}),e.EFF(8," Cancel "),e.k0s(),e.j41(9,"button",69),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.deleteConfirmedLeague())}),e.EFF(10," Delete "),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(5),e.SpI(' Are you sure you want to delete league "',null==t.selectedLeagueToDelete?null:t.selectedLeagueToDelete.leagueName,'"? ')}}function J(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",70)(1,"div",71)(2,"h2",72),e.EFF(3,"Confirm Delete"),e.k0s(),e.j41(4,"p",73),e.EFF(5," Are you sure you want to delete "),e.j41(6,"strong"),e.EFF(7),e.k0s(),e.EFF(8,"? "),e.k0s(),e.j41(9,"div",74)(10,"button",75),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.showDeleteModal=!1)}),e.EFF(11," Cancel "),e.k0s(),e.j41(12,"button",76),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.deleteConfirmedPlayer())}),e.EFF(13," Delete "),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(7),e.JRh(null==t.selectedPlayerToDelete?null:t.selectedPlayerToDelete.fullName)}}function Q(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",70)(1,"div",71)(2,"h2",72),e.EFF(3,"Add New Player"),e.k0s(),e.j41(4,"input",77),e.bIt("ngModelChange",function(i){e.eBV(t);const a=e.XpG();return e.Njj(a.newPlayerName=i)}),e.k0s(),e.j41(5,"div",74)(6,"button",78),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.closeModal())}),e.EFF(7," Cancel "),e.k0s(),e.j41(8,"button",79),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.addPlayer())}),e.EFF(9," Add "),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(4),e.Y8G("ngModel",t.newPlayerName)}}function z(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",70)(1,"div",80)(2,"h2",72),e.EFF(3,"Start New League"),e.k0s(),e.j41(4,"div",81)(5,"label",82),e.EFF(6,"League Name"),e.k0s(),e.j41(7,"input",83),e.bIt("ngModelChange",function(i){e.eBV(t);const a=e.XpG();return e.Njj(a.newLeague.Name=i)}),e.k0s()(),e.j41(8,"div",81)(9,"label",82),e.EFF(10,"League Description"),e.k0s(),e.j41(11,"textarea",84),e.bIt("ngModelChange",function(i){e.eBV(t);const a=e.XpG();return e.Njj(a.newLeague.Description=i)}),e.k0s()(),e.j41(12,"div",81)(13,"label",82),e.EFF(14,"League Type"),e.k0s(),e.j41(15,"select",85),e.bIt("ngModelChange",function(i){e.eBV(t);const a=e.XpG();return e.Njj(a.newLeague.TypeOfLeague=i)}),e.j41(16,"option",86),e.EFF(17,"Single"),e.k0s(),e.j41(18,"option",86),e.EFF(19,"Multi"),e.k0s()()(),e.j41(20,"div",74)(21,"button",75),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.closeStartLeagueModal())}),e.EFF(22," Cancel "),e.k0s(),e.j41(23,"button",79),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.startLeague())}),e.EFF(24," Start League "),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(7),e.Y8G("ngModel",t.newLeague.Name),e.R7$(4),e.Y8G("ngModel",t.newLeague.Description),e.R7$(4),e.Y8G("ngModel",t.newLeague.TypeOfLeague),e.R7$(1),e.Y8G("ngValue",0),e.R7$(2),e.Y8G("ngValue",1)}}function W(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",70)(1,"div",71)(2,"h2",72),e.EFF(3,"Confirm End League"),e.k0s(),e.j41(4,"p",73),e.EFF(5," Are you sure you want to end the current league? This action cannot be undone. "),e.k0s(),e.j41(6,"div",74)(7,"button",75),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.showEndLeagueModal=!1)}),e.EFF(8," Cancel "),e.k0s(),e.j41(9,"button",76),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.resetTournament(i.leagueData.id))}),e.EFF(10," Confirm End "),e.k0s()()()()}}function K(r,n){if(1&r){const t=e.RV6();e.j41(0,"button",79),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2).$implicit,a=e.XpG(2);return e.Njj(a.toggleHideNote(i))}),e.EFF(1," Show "),e.k0s()}}function Z(r,n){if(1&r){const t=e.RV6();e.j41(0,"button",103),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2).$implicit,a=e.XpG(2);return e.Njj(a.toggleHideNote(i))}),e.EFF(1," Hide "),e.k0s()}}function q(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",99)(1,"h2",100),e.EFF(2),e.k0s(),e.j41(3,"button",78),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,a=e.XpG(2);return e.Njj(a.toggleDeleteNote(i.id))}),e.EFF(4," Delete "),e.k0s(),e.DNE(5,K,2,0,"button",101),e.DNE(6,Z,2,0,"button",102),e.k0s()}if(2&r){const t=e.XpG().$implicit;e.R7$(2),e.SpI(" ",t.content," "),e.R7$(3),e.Y8G("ngIf",1==t.isHidden),e.R7$(1),e.Y8G("ngIf",0==t.isHidden)}}function ee(r,n){if(1&r&&(e.j41(0,"div"),e.DNE(1,q,7,3,"div",98),e.k0s()),2&r){const t=n.$implicit;e.R7$(1),e.Y8G("ngIf",0==t.isDeleted)}}function te(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",70)(1,"div",87)(2,"div")(3,"h2",88),e.EFF(4,"Add New Note"),e.k0s(),e.j41(5,"div")(6,"label",89)(7,"span",90),e.EFF(8,"Notes"),e.k0s(),e.j41(9,"div",91)(10,"textarea",92),e.bIt("ngModelChange",function(i){e.eBV(t);const a=e.XpG();return e.Njj(a.newNote=i)}),e.k0s(),e.j41(11,"div",93)(12,"button",94),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.sendNote())}),e.EFF(13," Save "),e.k0s()()()()()(),e.j41(14,"div",95),e.DNE(15,ee,2,1,"div",96),e.k0s(),e.j41(16,"button",97),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.closeNoteModal())}),e.EFF(17," Cancel "),e.k0s()()()}if(2&r){const t=e.XpG();e.R7$(10),e.Y8G("ngModel",t.newNote),e.R7$(5),e.Y8G("ngForOf",t.notes)}}const se=function(r,n){return{"w-64 p-4 sm:min-h-screen":r,"w-0 p-0":n}};let C=(()=>{class r{constructor(t,s,i,a,o,l,u,f){this.playerService=t,this.matchService=s,this.toastr=i,this.leagueService=a,this.messageService=o,this.noteService=l,this.adminBackgroundService=u,this.cacheService=f,this.players=[],this.playerOrder=[],this.selectedPlayer=null,this.playerMatches=[],this.displayMatches=[],this.notes=[],this.showModal=!1,this.newPlayerName="",this.isSidebarOpen=!1,this.showDeleteModal=!1,this.showNoteModal=!1,this.showDeleteLeagueModal=!1,this.showEndLeagueModal=!1,this.loadingMatches={},this.requestQueue=[],this.isProcessingQueue=!1,this.showResetModal=!1,this.leagueData=null,this.showStartLeagueModal=!1,this.newLeague={Name:"",Description:"",TypeOfLeague:0},this.totalMessagesLeft=0,this.totalPlayers=0,this.totalMatches=0,this.totalMatchesLeft=0,this.totalMessages=0,this.leagues=[],this.newNote="",this.selectedLeagueToDelete=null,this.selectedPlayerToDelete=null}ngOnInit(){this.loadAdminData(),this.subscribeToUpdates()}ngOnDestroy(){this.updateStatusSubscription&&this.updateStatusSubscription.unsubscribe()}loadAdminData(){this.cacheService.has("admin-players-list")&&this.cacheService.has("admin-matches-list")&&this.cacheService.has("admin-messages-list")&&this.cacheService.has("admin-notes-list")&&this.cacheService.has("admin-all-leagues-list")?this.loadFromCache():this.loadFromServer()}loadFromCache(){const t=this.cacheService.get("admin-players-list");t&&(this.players=t,this.totalPlayers=t.length);const s=this.cacheService.get("admin-matches-list");s&&(this.totalMatches=s.length,this.totalMatchesLeft=s.filter(u=>0==u.isCompleted).length);const i=this.cacheService.get("admin-messages-list");i&&(this.totalMessagesLeft=i.messages.filter(u=>0==u.isRead).length);const a=this.cacheService.get("admin-notes-list");a&&(this.notes=a.notes);const o=this.cacheService.get("admin-all-leagues-list");o&&(this.leagues=o);const l=this.cacheService.get("admin-current-league");l?this.leagueData=l.league:this.loadCurrentLeagueFromServer()}loadCurrentLeagueFromServer(){this.leagueService.GetCurrentLeague().subscribe({next:t=>{this.leagueData=t.league},error:t=>{console.error("\u274c Failed to load current league:",t),this.leagueData=null}})}loadFromServer(){this.getAdminPlayers(),this.getAdminMatches(),this.getAdminMessages(),this.getAdminAllLeagues(),this.getAdminNotes()}subscribeToUpdates(){this.updateStatusSubscription=this.adminBackgroundService.updateStatus$.subscribe(t=>{})}toggleSidebar(){this.isSidebarOpen=!this.isSidebarOpen,this.selectedPlayer=null}selectPlayer(t){this.selectedPlayer=t,this.loadMatches()}loadMatches(){this.selectedPlayer&&this.matchService.getMatches().subscribe(t=>{this.playerMatches=t.filter(s=>s.player1Id===this.selectedPlayer.playerId||s.player2Id===this.selectedPlayer.playerId).sort((s,i)=>{const a=(s.player1Id===this.selectedPlayer.playerId?s.player2Name:s.player1Name)?.toLowerCase()??"",o=(i.player1Id===this.selectedPlayer.playerId?i.player2Name:i.player1Name)?.toLowerCase()??"";return a.localeCompare(o)}),this.displayMatches=this.playerMatches.map(s=>s.player2Id===this.selectedPlayer.playerId?{...s,player1Name:s.player2Name,player2Name:s.player1Name,score1:s.score2,score2:s.score1,player1Id:s.player2Id,player2Id:s.player1Id}:{...s}),this.playerMatches.forEach(s=>{this.loadingMatches[s.matchId]=!1})})}addToQueue(t){this.requestQueue.push(t),this.processQueue()}processQueue(){var t=this;return function M(r){return function(){var n=this,t=arguments;return new Promise(function(s,i){var a=r.apply(n,t);function o(u){y(a,s,i,o,l,"next",u)}function l(u){y(a,s,i,o,l,"throw",u)}o(void 0)})}}(function*(){if(t.isProcessingQueue||0===t.requestQueue.length)return;t.isProcessingQueue=!0;const s=t.requestQueue.shift();if(s)try{yield s()}catch(i){console.error("Error processing request:",i)}t.isProcessingQueue=!1,t.processQueue()})()}updateMatch(t,s){this.loadingMatches[t]=!0,this.addToQueue(()=>new Promise((i,a)=>{this.matchService.updateMatch(t,s).subscribe({next:o=>{o.success?(this.toastr.success(o.message),this.adminBackgroundService.invalidateAdminCache(),this.loadMatches(),this.getAdminMatches()):this.toastr.error(o.message),this.loadingMatches[t]=!1,i()},error:o=>{this.toastr.error("Error updating match","Error"),this.loadingMatches[t]=!1,a(o)}})}))}resetMatch(t){this.loadingMatches[t]=!0,this.addToQueue(()=>new Promise((s,i)=>{this.matchService.resetMatch(t).subscribe({next:a=>{a.success?(this.toastr.success(a.message),this.loadMatches()):this.toastr.error(a.message,"Error"),this.loadingMatches[t]=!1,s()},error:a=>{this.toastr.error("Error resetting match","Error"),this.loadingMatches[t]=!1,i(a)}})}))}deletePlayer(t,s){s.stopPropagation(),this.playerService.deletePlayer(t).subscribe(()=>{this.toastr.warning("Player deleted!","Deleted"),this.adminBackgroundService.invalidateAdminCache(),this.getAdminPlayers(),this.selectedPlayer?.playerId===t&&(this.selectedPlayer=null,this.playerMatches=[],this.displayMatches=[])})}openModal(){this.showModal=!0}closeModal(){this.showModal=!1,this.newPlayerName=""}addPlayer(){this.newPlayerName.trim()&&this.playerService.addPlayer(this.newPlayerName).subscribe(t=>{t.success?(this.toastr.success(t.message),this.adminBackgroundService.invalidateAdminCache(),this.getAdminPlayers(),this.loadMatches(),this.closeModal()):this.toastr.warning(t.message)})}confirmDelete(t,s){s.stopPropagation(),this.selectedPlayerToDelete=t,this.showDeleteModal=!0}deleteConfirmedPlayer(){this.selectedPlayerToDelete&&(this.playerService.deletePlayer(this.selectedPlayerToDelete.playerId).subscribe(t=>{t.success?(this.players=this.players.filter(s=>s.playerId!==this.selectedPlayerToDelete?.playerId),this.toastr.success(t.message),this.getPlayers()):this.toastr.error(t.message,"Error")}),this.showDeleteModal=!1,this.selectedPlayerToDelete=null)}getPlayers(){this.playerOrder=this.players.map(t=>t.playerId),this.playerService.getPlayers().subscribe({next:t=>{const s=t;this.playerOrder.length&&s.sort((i,a)=>{const o=this.playerOrder.indexOf(i.playerId),l=this.playerOrder.indexOf(a.playerId);return(-1===o?Number.MAX_SAFE_INTEGER:o)-(-1===l?Number.MAX_SAFE_INTEGER:l)}),this.players=s,this.totalPlayers=s.length},error:t=>{this.toastr.error(t.message)}})}getMatches(){this.matchService.getMatches().subscribe({next:t=>{t&&(this.totalMatches=t.length,this.totalMatchesLeft=t.filter(s=>0==s.isCompleted).length)},error:t=>{this.toastr.error(t.message)}})}resetTournament(t){this.leagueService.resetLeague(t).subscribe({next:s=>{s.success?(this.toastr.success(s.message),this.showResetModal=!1,this.adminBackgroundService.invalidateAdminCache(),this.loadMatches(),this.getAdminPlayers(),this.showEndLeagueModal=!1):this.toastr.error(s.message)},error:s=>{this.toastr.error("\u0641\u0634\u0644 \u0641\u064a \u0625\u0639\u0627\u062f\u0629 \u062a\u0639\u064a\u064a\u0646 \u0627\u0644\u062f\u0648\u0631\u064a"),console.error(s)}})}openStartLeagueModal(){this.showStartLeagueModal=!0,this.newLeague={Name:"",Description:"",TypeOfLeague:0}}closeStartLeagueModal(){this.showStartLeagueModal=!1}startLeague(){this.newLeague.Name.trim()?this.leagueService.startLeague(this.newLeague).subscribe({next:t=>{t.success?(this.toastr.success(t.message),this.closeStartLeagueModal(),this.adminBackgroundService.invalidateAdminCache()):this.toastr.error(t.message,"Error")},error:t=>{this.toastr.error("Failed to start league"),console.error(t)}}):this.toastr.error("League name is required","Error")}getMessages(){this.messageService.getMessages().subscribe({next:t=>{t?this.totalMessagesLeft=t.messages.filter(s=>0==s.isRead).length:this.toastr.error("\u0644\u0627 \u064a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644")},error:t=>{this.toastr.error(t.message)}})}GetAllLeagyes(){this.leagueService.GetAllLeaguesRank().subscribe({next:t=>{t?this.leagues=t.reverse():this.toastr.error(t)},error:t=>{this.toastr.error(t.message)}})}DeleteLeague(t){this.leagueService.DeleteLeague(t).subscribe({next:s=>{s.success?(this.toastr.success(s.message),this.showDeleteLeagueModal=!1):this.toastr.error(s.message)},error:s=>{this.toastr.error(s.message)}})}openDeleteLeagueModal(t){this.selectedLeagueToDelete=this.leagues.find(s=>s.leagueId===t)||null,this.showDeleteLeagueModal=!0}closeDeleteLeagueModal(){this.showDeleteLeagueModal=!1,this.selectedLeagueToDelete=null}deleteConfirmedLeague(){this.selectedLeagueToDelete&&(this.DeleteLeague(this.selectedLeagueToDelete.leagueId),this.leagues=this.leagues.filter(t=>t.leagueId!==this.selectedLeagueToDelete?.leagueId),this.closeDeleteLeagueModal())}sendNote(){this.newNote.trim()&&this.noteService.sendNote(this.newNote).subscribe({next:t=>{this.toastr.success(t.message),this.newNote="",this.getNotes()},error:()=>this.toastr.error("\u062d\u0635\u0644 \u0645\u0634\u0643\u0644\u0629 \u0648\u0627\u0646\u062a \u0628\u062a\u0628\u0639\u062a \u0627\u0644\u0645\u0644\u0627\u062d\u0638\u0629")})}toggleHideNote(t){this.noteService.toggleMarHide(t.id,!t.isHidden).subscribe({next:s=>{this.toastr.success(s.message),this.getNotes()},error:()=>this.toastr.error("\u062d\u0635\u0644 \u0645\u0634\u0643\u0644\u0629 \u0648\u0627\u0646\u062a \u0628\u062a\u063a\u064a\u0631 \u0627\u0644\u0638\u0647\u0648\u0631")})}toggleDeleteNote(t){this.noteService.DeleteNote(t,!1).subscribe({next:s=>{this.toastr.warning(s.message),this.getNotes()},error:()=>this.toastr.error("\u062d\u0635\u0644 \u0645\u0634\u0643\u0644\u0629 \u0648\u0627\u0646\u062a \u0628\u062a\u062d\u0630\u0641 ")})}getNotes(){this.noteService.getNotes().subscribe(t=>{this.notes=t.notes})}getAdminPlayers(){this.playerService.getAdminPlayers().subscribe({next:t=>{const s=t;this.playerOrder.length&&s.sort((i,a)=>{const o=this.playerOrder.indexOf(i.playerId),l=this.playerOrder.indexOf(a.playerId);return(-1===o?Number.MAX_SAFE_INTEGER:o)-(-1===l?Number.MAX_SAFE_INTEGER:l)}),this.players=s,this.totalPlayers=s.length},error:t=>{this.toastr.error(t.message)}})}getAdminMatches(){this.matchService.getAdminMatches().subscribe({next:t=>{t&&(this.totalMatches=t.length,this.totalMatchesLeft=t.filter(s=>0==s.isCompleted).length)},error:t=>{this.toastr.error(t.message)}})}getAdminMessages(){this.messageService.getAdminMessages().subscribe({next:t=>{t?this.totalMessagesLeft=t.messages.filter(s=>0==s.isRead).length:this.toastr.error("\u0644\u0627 \u064a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644")},error:t=>{this.toastr.error(t.message)}})}getAdminAllLeagues(){this.leagueService.getAdminAllLeagues().subscribe({next:t=>{this.leagues=t},error:t=>{this.toastr.error(t.message)}})}getAdminNotes(){this.noteService.getAdminNotes().subscribe(t=>{this.notes=t.notes})}openNoteModal(){this.showNoteModal=!0}closeNoteModal(){this.showNoteModal=!1}static{this.\u0275fac=function(s){return new(s||r)(e.rXU(j.x),e.rXU(w.T),e.rXU(x.tw),e.rXU(S.N),e.rXU(v.b),e.rXU(T.i),e.rXU(m),e.rXU(p._))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-players"]],decls:68,vars:21,consts:[[1,"container","mx-auto"],[1,"block","sm:flex","transition-all","duration-600"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","text-white","transition-all","duration-600",3,"ngClass"],[1,"text-lg","font-bold","mb-4","flex","justify-between","overflow-hidden","text-white"],[1,"text-gray-300","text-3xl",3,"click"],[4,"ngIf"],["class","mt-4 w-full bg-green-600 p-2 rounded text-white hover:bg-green-700 transition",3,"click",4,"ngIf"],[1,"sm:flex-1","sm:p-2","transition-all","duration-600","sm:container","sm:mx-auto"],["class","sm:w-4/6 mx-auto",4,"ngIf"],[1,"my-3","border-gray-600"],[1,"flex","justify-evenly","pt-5"],[1,"bg-blue-600","text-white","px-3","py-2","rounded","mb-4","hover:bg-blue-700","transition",3,"click"],["routerLink","/admin/inbox",1,"bg-orange-600","hover:bg-orange-700","text-white","mb-4","px-3","py-2","rounded","transition-all","relative"],["class","absolute -top-2 -right-2 w-[30px] h-[30px] rounded-full bg-green-600 flex justify-center items-center",4,"ngIf"],["class","bg-green-600 text-white px-3 py-2 rounded mb-4 hover:bg-green-700 transition",3,"click",4,"ngIf"],["class","bg-red-600 text-white px-3 py-2 rounded mb-4 hover:bg-red-700 transition","s","",3,"click",4,"ngIf"],[1,"bg-indigo-600","text-white","px-3","py-2","rounded","mb-4","hover:bg-indigo-700","transition",3,"click"],["class","grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-8","container","mx-auto"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","shadow-md","rounded","p-6","text-center"],[1,"text-lg","font-semibold","mb-2","text-white"],[1,"text-3xl","font-bold","text-red-500"],[1,"text-3xl","font-bold","text-green-500"],[1,"text-3xl","font-bold","text-blue-500"],[1,"text-center"],[1,"mb-4","text-4xl","font-extrabold","leading-none","tracking-tight","md:text-4xl","lg:text-4xl","text-white"],[1,"max-h-[350px]","overflow-x-auto"],[1,"min-w-full","divide-y-2","divide-gray-600"],[1,"sticky","top-0","bg-black","bg-opacity-50","backdrop-blur-sm"],[1,"*:font-medium","*:text-white"],[1,"px-3","py-2","whitespace-nowrap"],[1,"divide-y","divide-gray-600"],["class","*:font-bold *:first:font-medium",3,"ngClass",4,"ngFor","ngForOf"],["class","fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",4,"ngIf"],["class","fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-50",4,"ngIf"],["class","flex items-center justify-between p-2 cursor-pointer rounded-md hover:bg-gray-700",3,"bg-blue-600","click",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-2","cursor-pointer","rounded-md","hover:bg-gray-700",3,"click"],[1,"text-white"],[1,"bg-red-600","px-2","py-1","text-sm","rounded","text-white","hover:bg-red-700","transition",3,"click"],[1,"mt-4","w-full","bg-green-600","p-2","rounded","text-white","hover:bg-green-700","transition",3,"click"],[1,"sm:w-4/6","mx-auto"],[1,"text-2xl","font-bold","mb-4","text-center","text-white"],[1,"w-full","border-collapse","border","border-gray-600","text-center"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","text-white"],[1,"border","border-gray-600","p-2"],["class","border border-gray-600",3,"ngClass",4,"ngFor","ngForOf"],[1,"border","border-gray-600",3,"ngClass"],[1,"p-2","font-bold","text-white"],[1,"p-2"],[1,"bg-blue-600","px-2","py-1","rounded","text-white","hover:bg-blue-700","transition-all",3,"disabled","ngClass","click"],[1,"bg-blue-600","px-2","py-1","rounded","text-white","mx-1","hover:bg-blue-700","transition-all",3,"disabled","ngClass","click"],[1,"bg-yellow-600","px-2","py-1","rounded","text-white","hover:bg-yellow-700","transition-all",3,"disabled","ngClass","click"],[1,"bg-gray-600","px-2","py-1","rounded","text-white","ml-2","hover:bg-gray-700","transition-all",3,"click"],[1,"absolute","-top-2","-right-2","w-[30px]","h-[30px]","rounded-full","bg-green-600","flex","justify-center","items-center"],[1,"text-white","font-bold"],[1,"bg-green-600","text-white","px-3","py-2","rounded","mb-4","hover:bg-green-700","transition",3,"click"],["s","",1,"bg-red-600","text-white","px-3","py-2","rounded","mb-4","hover:bg-red-700","transition",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4","mb-8"],[1,"font-bold","text-gray-300"],["class","font-bold text-gray-300",4,"ngIf"],[1,"*:font-bold","*:first:font-medium",3,"ngClass"],[1,"px-3","py-2","whitespace-nowrap","text-white"],[1,"bg-red-600","text-white","px-3","py-2","rounded","hover:bg-red-700","transition",3,"click"],[1,"fixed","inset-0","bg-black","bg-opacity-75","flex","items-center","justify-center","z-50"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","p-6","rounded-lg","shadow-lg","w-96"],[1,"text-xl","font-bold","text-white","mb-4"],[1,"text-gray-300","mb-6"],[1,"flex","justify-end","space-x-4"],[1,"bg-gray-600","text-white","px-4","py-2","rounded","hover:bg-gray-700","transition",3,"click"],[1,"bg-red-600","text-white","px-4","py-2","rounded","hover:bg-red-700","transition",3,"click"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-75","z-50"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","p-6","rounded-lg"],[1,"text-lg","font-bold","mb-4","text-white"],[1,"text-gray-300"],[1,"mt-4","flex","justify-end"],[1,"bg-gray-600","px-4","py-2","text-white","rounded","mr-2","hover:bg-gray-700","transition",3,"click"],[1,"bg-red-600","px-4","py-2","text-white","rounded","hover:bg-red-700","transition",3,"click"],["type","text","placeholder","Enter player name",1,"border","border-gray-600","p-2","w-full","bg-gray-800","text-white","rounded","placeholder-gray-400",3,"ngModel","ngModelChange"],[1,"bg-red-600","px-4","py-2","text-white","rounded","mr-2","hover:bg-red-700","transition",3,"click"],[1,"bg-green-600","px-4","py-2","text-white","rounded","hover:bg-green-700","transition",3,"click"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","p-6","rounded-lg","w-96"],[1,"mb-4"],[1,"block","text-sm","font-medium","mb-1","text-gray-300"],["type","text","placeholder","Enter league name",1,"border","border-gray-600","p-2","w-full","rounded","bg-gray-800","text-white","placeholder-gray-400",3,"ngModel","ngModelChange"],["placeholder","Enter league description","rows","3",1,"border","border-gray-600","p-2","w-full","rounded","bg-gray-800","text-white","placeholder-gray-400",3,"ngModel","ngModelChange"],[1,"border","border-gray-600","p-2","w-full","rounded","bg-gray-800","text-white",3,"ngModel","ngModelChange"],[3,"ngValue"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","p-4","rounded-lg"],[1,"font-bold","text-white","text-center"],["for","Notes"],[1,"text-sm","font-medium","text-gray-300"],[1,"relative","m-2","overflow-hidden","rounded","border-gray-600"],["id","Notes","rows","4",1,"w-full","resize-none","p-3","border","border-gray-600","bg-gray-800","text-white","placeholder-gray-400",3,"ngModel","ngModelChange"],[1,"flex","items-center","justify-end","gap-2","p-1.5"],["type","button",1,"rounded","p-2","font-bold","text-white","bg-green-600","hover:bg-green-700","transition",3,"click"],[1,"p-6"],[4,"ngFor","ngForOf"],[1,"bg-gray-600","px-4","py-2","text-white","rounded","hover:bg-gray-700","transition",3,"click"],["class","mt-4 flex items-center justify-end",4,"ngIf"],[1,"mt-4","flex","items-center","justify-end"],[1,"font-bold","px-3","text-white"],["class","bg-green-600 px-4 py-2 text-white rounded hover:bg-green-700 transition",3,"click",4,"ngIf"],["class","bg-purple-600 px-4 py-2 text-white rounded hover:bg-purple-700 transition",3,"click",4,"ngIf"],[1,"bg-purple-600","px-4","py-2","text-white","rounded","hover:bg-purple-700","transition",3,"click"]],template:function(s,i){1&s&&(e.j41(0,"div",0),e.nrm(1,"app-admin-update-status"),e.k0s(),e.j41(2,"div",1)(3,"div",2)(4,"h2",3),e.EFF(5," Players "),e.j41(6,"button",4),e.bIt("click",function(){return i.toggleSidebar()}),e.EFF(7," \xd7 "),e.k0s()(),e.DNE(8,P,2,1,"ul",5),e.DNE(9,R,2,0,"button",6),e.k0s(),e.j41(10,"div",7),e.DNE(11,$,16,2,"div",8),e.nrm(12,"hr",9),e.j41(13,"div")(14,"div",10)(15,"button",11),e.bIt("click",function(){return i.toggleSidebar()}),e.EFF(16," \u2630 Players "),e.k0s(),e.j41(17,"button",12),e.EFF(18," Inbox "),e.DNE(19,L,3,1,"div",13),e.k0s(),e.DNE(20,A,2,0,"button",14),e.DNE(21,U,2,0,"button",15),e.j41(22,"button",16),e.bIt("click",function(){return i.openNoteModal()}),e.EFF(23," Notes "),e.k0s()(),e.DNE(24,V,22,8,"div",17),e.j41(25,"div",18)(26,"div",19)(27,"h3",20),e.EFF(28," Remaining Matches "),e.k0s(),e.j41(29,"p",21),e.EFF(30),e.k0s()(),e.j41(31,"div",19)(32,"h3",20),e.EFF(33,"Total Matches"),e.k0s(),e.j41(34,"p",22),e.EFF(35),e.k0s()(),e.j41(36,"div",19)(37,"h3",20),e.EFF(38,"Total Players"),e.k0s(),e.j41(39,"p",23),e.EFF(40),e.k0s()()()(),e.j41(41,"div",24)(42,"h2",25),e.EFF(43," All Leagues "),e.k0s(),e.j41(44,"div",26)(45,"table",27)(46,"thead",28)(47,"tr",29)(48,"th",30),e.EFF(49,"League Name"),e.k0s(),e.j41(50,"th",30),e.EFF(51,"League Status"),e.k0s(),e.j41(52,"th",30),e.EFF(53,"League Type"),e.k0s(),e.j41(54,"th",30),e.EFF(55,"League Date"),e.k0s(),e.j41(56,"th",30),e.EFF(57,"Winner"),e.k0s(),e.j41(58,"th",30),e.EFF(59,"Delete"),e.k0s()()(),e.j41(60,"tbody",31),e.DNE(61,O,15,16,"tr",32),e.k0s()()()()(),e.DNE(62,H,11,1,"div",33),e.DNE(63,J,14,1,"div",34),e.DNE(64,Q,10,1,"div",34),e.DNE(65,z,25,5,"div",34),e.DNE(66,W,11,0,"div",34),e.DNE(67,te,18,2,"div",34),e.k0s()),2&s&&(e.R7$(3),e.Y8G("ngClass",e.l_i(18,se,i.isSidebarOpen,!i.isSidebarOpen)),e.R7$(5),e.Y8G("ngIf",i.isSidebarOpen),e.R7$(1),e.Y8G("ngIf",i.isSidebarOpen),e.R7$(2),e.Y8G("ngIf",i.selectedPlayer),e.R7$(8),e.Y8G("ngIf",i.totalMessagesLeft>0),e.R7$(1),e.Y8G("ngIf",null==i.leagueData),e.R7$(1),e.Y8G("ngIf",null!=i.leagueData),e.R7$(3),e.Y8G("ngIf",i.leagueData),e.R7$(6),e.JRh(i.totalMatchesLeft),e.R7$(5),e.JRh(i.totalMatches),e.R7$(5),e.JRh(i.totalPlayers),e.R7$(21),e.Y8G("ngForOf",i.leagues),e.R7$(1),e.Y8G("ngIf",i.showDeleteLeagueModal),e.R7$(1),e.Y8G("ngIf",i.showDeleteModal),e.R7$(1),e.Y8G("ngIf",i.showModal),e.R7$(1),e.Y8G("ngIf",i.showStartLeagueModal),e.R7$(1),e.Y8G("ngIf",i.showEndLeagueModal),e.R7$(1),e.Y8G("ngIf",i.showNoteModal))},dependencies:[g.YU,g.Sq,g.bT,h.Wk,d.xH,d.y7,d.me,d.wz,d.BC,d.vS,N,g.vh]})}}return r})();const ie=["messagesContainer"];function re(r,n){1&r&&(e.j41(0,"div",9),e.EFF(1," No messages here \u{1f4ed} "),e.k0s())}function ae(r,n){if(1&r&&(e.j41(0,"span",16),e.EFF(1),e.k0s()),2&r){const t=e.XpG().$implicit;e.R7$(1),e.SpI(" ",t.unreadCount," ")}}function ne(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",12),e.bIt("click",function(){const a=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.openChat(a.senderId))}),e.j41(1,"div")(2,"p",13),e.EFF(3),e.k0s(),e.j41(4,"p",14),e.EFF(5),e.k0s()(),e.DNE(6,ae,2,1,"span",15),e.k0s()}if(2&r){const t=n.$implicit;e.R7$(3),e.JRh(t.senderFullName),e.R7$(2),e.JRh(t.lastMessage),e.R7$(1),e.Y8G("ngIf",t.unreadCount>0)}}function oe(r,n){if(1&r&&(e.j41(0,"div",10),e.DNE(1,ne,7,3,"div",11),e.k0s()),2&r){const t=e.XpG();e.R7$(1),e.Y8G("ngForOf",t.playerChats)("ngForTrackBy",t.trackByPlayerId)}}const le=function(r,n){return{"text-right":r,"text-left":n}},ce=function(r,n){return{"bg-green-700":r,"bg-gray-700 ":n}};function de(r,n){if(1&r&&(e.j41(0,"div",28)(1,"div",29)(2,"p",30),e.EFF(3),e.k0s(),e.j41(4,"p",31),e.EFF(5),e.nI1(6,"date"),e.k0s()()()),2&r){const t=n.$implicit;e.Y8G("ngClass",e.l_i(7,le,!t.isFromAdmin,t.isFromAdmin)),e.R7$(1),e.Y8G("ngClass",e.l_i(10,ce,!t.isFromAdmin,t.isFromAdmin)),e.R7$(2),e.JRh(t.content),e.R7$(2),e.SpI(" ",e.i5U(6,4,t.sentAt,"MMM d, y, hh:mm a")," ")}}const ue=function(){return{standalone:!0}};function ge(r,n){if(1&r){const t=e.RV6();e.j41(0,"div")(1,"div",17)(2,"div",18)(3,"button",19),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.closeChat())}),e.nrm(4,"i",20),e.k0s(),e.j41(5,"p",13),e.EFF(6),e.k0s()()(),e.j41(7,"div",21,22),e.DNE(9,de,7,13,"div",23),e.k0s(),e.j41(10,"div",24)(11,"form",25),e.bIt("ngSubmit",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.sendReply())}),e.j41(12,"input",26),e.bIt("ngModelChange",function(i){e.eBV(t);const a=e.XpG();return e.Njj(a.replyMessages[a.selectedChat.messages[0].id]=i)})("ngModelChange",function(i){e.eBV(t);const a=e.XpG();return e.Njj(a.replyMessages[a.selectedChat.messages[0].id]=i)}),e.k0s(),e.j41(13,"button",27),e.EFF(14," Reply "),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(6),e.SpI(" ",t.selectedChat.senderFullName," "),e.R7$(3),e.Y8G("ngForOf",t.selectedChat.messages)("ngForTrackBy",t.trackByMessageId),e.R7$(3),e.Y8G("ngModel",t.replyMessages[t.selectedChat.messages[0].id])("ngModelOptions",e.lJ4(6,ue)),e.R7$(1),e.Y8G("disabled",!t.replyMessages[t.selectedChat.messages[0].id])}}function he(r,n){1&r&&(e.j41(0,"div",32),e.EFF(1," Select a chat to view messages \u{1f4e9} "),e.k0s())}const pe=function(r){return{hidden:r}},me=function(r,n){return{block:r,"hidden sm:flex":n}},be=[{path:"",component:C},{path:"players",component:C},{path:"inbox",component:(()=>{class r{constructor(t,s,i,a,o){this.messageService=t,this.toastr=s,this.cdr=i,this.cacheService=a,this.adminBackgroundService=o,this.playerChats=[],this.selectedPlayerId=null,this.selectedChat=null,this.replyMessages={}}ngOnInit(){this.loadAdminMessages(),this.subscribeToUpdates(),this.startPeriodicRefresh()}ngOnDestroy(){this.updateStatusSubscription&&this.updateStatusSubscription.unsubscribe(),this.refreshSubscription&&this.refreshSubscription.unsubscribe()}startPeriodicRefresh(){this.refreshSubscription=(0,F.Y)(3e4).subscribe(()=>{this.messageService.getAdminMessages().subscribe({next:t=>{if(t&&t.messages){const s=this.groupMessagesBySender(t.messages);this.playerChats=s.sort((i,a)=>new Date(a.lastMessageDate).getTime()-new Date(i.lastMessageDate).getTime())}},error:t=>{}})})}loadAdminMessages(){this.loadFromServer()}loadFromCache(){const t=this.cacheService.get("admin-messages-list");t&&t.messages?this.playerChats=this.groupMessagesBySender(t.messages):this.loadFromServer()}loadFromServer(){this.messageService.getAdminMessages().subscribe({next:t=>{if(t&&t.messages){const s=this.groupMessagesBySender(t.messages);this.playerChats=s.sort((i,a)=>new Date(a.lastMessageDate).getTime()-new Date(i.lastMessageDate).getTime())}else this.toastr.error("\u0644\u0627 \u064a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644")},error:t=>{this.toastr.error(t.message)}})}refreshMessages(){this.messageService.getAdminMessages().subscribe({next:t=>{if(t&&t.messages){const s=this.groupMessagesBySender(t.messages);this.playerChats=s.sort((i,a)=>new Date(a.lastMessageDate).getTime()-new Date(i.lastMessageDate).getTime())}else this.toastr.error("\u0644\u0627 \u064a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644")},error:t=>{this.toastr.error(t.message)}})}subscribeToUpdates(){this.updateStatusSubscription=this.adminBackgroundService.updateStatus$.subscribe(t=>{})}ngAfterViewChecked(){this.selectedChat&&this.messagesContainer&&this.scrollToBottom()}loadMessages(){this.messageService.getMessages().subscribe({next:t=>{t&&t.messages?this.processMessages(t.messages):this.toastr.error("\u0644\u0627 \u064a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644 \u0627\u0644\u0622\u0646")},error:t=>{this.toastr.error("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062c\u0644\u0628 \u0627\u0644\u0631\u0633\u0627\u0626\u0644")}})}processMessages(t){const s=this.groupMessagesBySender(t);this.playerChats=s.sort((i,a)=>new Date(a.lastMessageDate).getTime()-new Date(i.lastMessageDate).getTime()),this.cdr.detectChanges()}groupMessagesBySender(t){const s={};return t.filter(i=>!i.isDeleted).forEach(i=>{const a=i.senderId;s[a]||(s[a]={senderId:a,senderFullName:i.senderFullName,lastMessage:"",lastMessageDate:"",unreadCount:0,messages:[]}),s[a].messages.push(i),!i.isFromAdmin&&!i.isRead&&s[a].unreadCount++}),Object.values(s).map(i=>{i.messages=i.messages.sort((o,l)=>new Date(o.sentAt).getTime()-new Date(l.sentAt).getTime());const a=i.messages[i.messages.length-1];return i.lastMessage=a?.content??"",i.lastMessageDate=a?.sentAt??"",i})}openChat(t){this.selectedPlayerId=t,this.selectedChat=this.playerChats.find(s=>s.senderId===t)||null,this.selectedChat&&(this.selectedChat.messages.filter(s=>!s.isRead&&!s.isFromAdmin).forEach(s=>{this.messageService.toggleMarkMessage(s.id,!0).subscribe({next:i=>{i.success&&(s.isRead=!0,this.selectedChat.unreadCount=this.selectedChat.messages.filter(a=>!a.isRead&&!a.isFromAdmin).length,this.cdr.detectChanges())},error:i=>{this.toastr.error("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u062d\u062f\u064a\u062b \u062d\u0627\u0644\u0629 \u0627\u0644\u0631\u0633\u0627\u0644\u0629")}})}),this.cdr.detectChanges())}closeChat(){this.selectedPlayerId=null,this.selectedChat=null,this.replyMessages={},this.cdr.detectChanges()}sendReply(){if(!this.selectedChat)return void this.toastr.warning("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u0645\u062d\u0627\u062f\u062b\u0629");const t=this.replyMessages[this.selectedChat.messages[0].id]?.trim();t?this.messageService.sendAdminReply(this.selectedChat.senderId,t).subscribe({next:s=>{if(s.success){this.toastr.success("\u062a\u0645 \u0625\u0631\u0633\u0627\u0644 \u0627\u0644\u0631\u062f"),this.replyMessages[this.selectedChat.messages[0].id]="";const i={id:Math.random(),senderId:this.selectedChat.senderId,senderFullName:"Admin",senderPhoneNumber:"",content:t,isRead:!0,isDeleted:!1,sentAt:(new Date).toISOString(),isFromAdmin:!0};this.selectedChat.messages.push(i),this.selectedChat.messages.sort((a,o)=>new Date(a.sentAt).getTime()-new Date(o.sentAt).getTime()),this.cdr.detectChanges()}else this.toastr.error(s.message||"\u0641\u0634\u0644 \u0625\u0631\u0633\u0627\u0644 \u0627\u0644\u0631\u062f")},error:s=>{this.toastr.error("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u0625\u0631\u0633\u0627\u0644 \u0627\u0644\u0631\u062f")}}):this.toastr.warning("\u0627\u0644\u0631\u062c\u0627\u0621 \u0643\u062a\u0627\u0628\u0629 \u0631\u062f")}scrollToBottom(){if(this.messagesContainer){const t=this.messagesContainer.nativeElement;t.scrollTop=t.scrollHeight}}trackByPlayerId(t,s){return s.senderId}trackByMessageId(t,s){return s.id}static{this.\u0275fac=function(s){return new(s||r)(e.rXU(v.b),e.rXU(x.tw),e.rXU(e.gRc),e.rXU(p._),e.rXU(m))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-inbox"]],viewQuery:function(s,i){if(1&s&&e.GBs(ie,5),2&s){let a;e.mGM(a=e.lsd())&&(i.messagesContainer=a.first)}},decls:11,vars:11,consts:[[1,"container","mx-auto","p-4","flex","flex-col","sm:flex-row","overflow-hidden"],[1,"w-full","sm:w-1/3","border-r","border-gray-600","sm:block",3,"ngClass"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-white"],["class","text-center text-gray-300",4,"ngIf"],["class","space-y-2",4,"ngIf"],[1,"w-full","sm:w-2/3","flex","flex-col",3,"ngClass"],[4,"ngIf","ngIfElse"],["noChatSelected",""],[1,"text-center","text-gray-300"],[1,"space-y-2"],["class","p-4 backdrop-blur-sm border border-gray-600 rounded-lg hover:bg-gray-700 cursor-pointer flex items-center justify-between",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"p-4","backdrop-blur-sm","border","border-gray-600","rounded-lg","hover:bg-gray-700","cursor-pointer","flex","items-center","justify-between",3,"click"],[1,"font-bold","text-white"],[1,"text-sm","text-gray-300","truncate"],["class","bg-green-600 text-white text-xs font-bold rounded-full px-2 py-1",4,"ngIf"],[1,"bg-green-600","text-white","text-xs","font-bold","rounded-full","px-2","py-1"],[1,"p-4","backdrop-blur-sm","border-b","border-gray-600","flex","items-center","justify-between"],[1,"flex","items-center"],[1,"mr-4","text-gray-300","hover:text-white","transition",3,"click"],[1,"fa-solid","fa-arrow-left",2,"color","#ffffff"],[1,"flex-1","p-4","overflow-y-auto","max-h-[calc(100vh-200px)]","backdrop-blur-sm"],["messagesContainer",""],["class","mb-4",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"p-4","bg-black","bg-opacity-50","backdrop-blur-sm","border-t","border-gray-600"],[1,"flex","items-center","gap-2",3,"ngSubmit"],["type","text","placeholder","Write your reply...",1,"flex-1","p-2","border","border-gray-600","rounded-lg","bg-gray-800","text-white","focus:outline-none","focus:ring-2","focus:ring-blue-600","placeholder-gray-400",3,"ngModel","ngModelOptions","ngModelChange"],["type","submit",1,"bg-blue-600","text-white","p-2","rounded-lg","hover:bg-blue-700","transition","disabled:bg-gray-600",3,"disabled"],[1,"mb-4",3,"ngClass"],[1,"inline-block","p-3","rounded-lg","max-w-xs",3,"ngClass"],[1,"text-white"],[1,"text-xs","mt-1","text-gray-300"],[1,"w-full","flex","items-center","justify-center","text-gray-300"]],template:function(s,i){if(1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),e.EFF(4,"\u{1f4e5} Inbox"),e.k0s()(),e.DNE(5,re,2,0,"div",4),e.DNE(6,oe,2,2,"div",5),e.k0s(),e.j41(7,"div",6),e.DNE(8,ge,15,7,"div",7),e.DNE(9,he,2,0,"ng-template",null,8,e.C5r),e.k0s()()),2&s){const a=e.sdS(10);e.R7$(1),e.Y8G("ngClass",e.eq3(6,pe,i.selectedChat)),e.R7$(4),e.Y8G("ngIf",0===i.playerChats.length),e.R7$(1),e.Y8G("ngIf",i.playerChats.length>0),e.R7$(1),e.Y8G("ngClass",e.l_i(8,me,i.selectedChat,!i.selectedChat)),e.R7$(1),e.Y8G("ngIf",i.selectedChat)("ngIfElse",a)}},dependencies:[g.YU,g.Sq,g.bT,d.qT,d.me,d.BC,d.cb,d.vS,d.cV,g.vh]})}}return r})()}];let fe=(()=>{class r{static{this.\u0275fac=function(s){return new(s||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({imports:[h.iI.forChild(be),h.iI]})}}return r})();var _e=c(56),ye=c(3887);let xe=(()=>{class r{static{this.\u0275fac=function(s){return new(s||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({imports:[g.MD,fe,d.YN,k.q1,_e.PlayerModule,ye.G]})}}return r})()}}]);