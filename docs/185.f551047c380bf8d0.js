"use strict";(self.webpackChunkYugiTournamnet=self.webpackChunkYugiTournamnet||[]).push([[185],{3185:(mt,v,c)=>{c.r(v),c.d(v,{AdminModule:()=>pt});var u=c(316),b=c(4827),R=c(9204),_=c(4597),e=c(8450),C=c(3665),M=c(9101),F=c(4285),k=c(7137),I=c(5716),N=c(5797),p=c(9452),T=c(1873),G=c(1567),j=c(8764),y=c(1318),$=c(4205),A=c(5152);class L extends $.B{constructor(l=1/0,t=1/0,s=A.U){super(),this._bufferSize=l,this._windowTime=t,this._timestampProvider=s,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,l),this._windowTime=Math.max(1,t)}next(l){const{isStopped:t,_buffer:s,_infiniteTimeWindow:r,_timestampProvider:n,_windowTime:i}=this;t||(s.push(l),!r&&s.push(n.now()+i)),this._trimBuffer(),super.next(l)}_subscribe(l){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(l),{_infiniteTimeWindow:s,_buffer:r}=this,n=r.slice();for(let i=0;i<n.length&&!l.closed;i+=s?1:2)l.next(n[i]);return this._checkFinalizedStatuses(l),t}_trimBuffer(){const{_bufferSize:l,_timestampProvider:t,_buffer:s,_infiniteTimeWindow:r}=this,n=(r?1:2)*l;if(l<1/0&&n<s.length&&s.splice(0,s.length-n),!r){const i=t.now();let o=0;for(let g=1;g<s.length&&s[g]<=i;g+=2)o=g;o&&s.splice(0,o+1)}}}var B=c(1870),f=c(271),w=c(6375);let S=(()=>{class a{constructor(t,s,r,n,i){this.playerService=t,this.matchService=s,this.leagueService=r,this.messageService=n,this.noteService=i,this.essentialDataCache$=new N.t(null),this.secondaryDataCache=new Map,this.lastEssentialUpdate=0,this.lastSecondaryUpdate=new Map,this.CACHE_DURATION=9e5,this.SECONDARY_CACHE_DURATION=9e5}getEssentialData(t=!1){const s=Date.now();return!t&&this.essentialDataCache$.value&&s-this.lastEssentialUpdate<this.CACHE_DURATION?this.essentialDataCache$.asObservable().pipe((0,G.p)(n=>null!==n)):this.loadEssentialDataFromServer().pipe((0,j.M)(n=>{this.essentialDataCache$.next(n),this.lastEssentialUpdate=s}),(0,y.W)(n=>(0,p.of)(this.essentialDataCache$.value||this.getEmptyDashboardData())),function V(a,l,t){let s,r=!1;return a&&"object"==typeof a?({bufferSize:s=1/0,windowTime:l=1/0,refCount:r=!1,scheduler:t}=a):s=a??1/0,(0,B.u)({connector:()=>new L(s,l,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:r})}(1))}getSecondaryData(t,s=!1){const r=Date.now(),n=this.lastSecondaryUpdate.get(t)||0,i=this.secondaryDataCache.has(t)&&r-n<this.SECONDARY_CACHE_DURATION;return!s&&i?(0,p.of)(this.secondaryDataCache.get(t)):this.loadSecondaryDataFromServer(t).pipe((0,j.M)(o=>{this.secondaryDataCache.set(t,o),this.lastSecondaryUpdate.set(t,r)}),(0,y.W)(o=>(0,p.of)(this.secondaryDataCache.get(t)||[])))}loadEssentialDataFromServer(){return(0,T.p)({players:this.playerService.getAdminPlayers(),matches:this.matchService.getAdminMatches(),currentLeague:this.leagueService.getAdminCurrentLeague().pipe((0,f.T)(t=>t.league),(0,y.W)(()=>(0,p.of)(null))),allLeagues:this.leagueService.getAdminAllLeagues().pipe((0,y.W)(()=>(0,p.of)([]))),notes:this.noteService.getAdminNotes().pipe((0,f.T)(t=>t.notes),(0,y.W)(()=>(0,p.of)([]))),messages:this.messageService.getAdminMessages().pipe((0,f.T)(t=>t.messages||[]),(0,y.W)(()=>(0,p.of)([])))}).pipe((0,f.T)(({players:t,matches:s,currentLeague:r,allLeagues:n,notes:i,messages:o})=>{const g=Array.isArray(o)?o:[];return{players:t,matches:s,currentLeague:r,allLeagues:n,notes:i,messages:g,stats:{totalPlayers:t.length,totalMatches:s.length,totalMatchesLeft:s.filter(h=>!h.isCompleted).length,totalMessagesLeft:g.filter(h=>!h.isRead&&!h.isFromAdmin).length}}}))}loadSecondaryDataFromServer(t){switch(t){case"leagues":return this.leagueService.getAdminAllLeagues();case"notes":return this.noteService.getAdminNotes().pipe((0,f.T)(s=>s.notes));case"messages":return this.messageService.getAdminMessages().pipe((0,f.T)(s=>s.messages||[]));default:return(0,p.of)([])}}invalidateCache(t){switch(t){case"essential":this.lastEssentialUpdate=0;break;case"leagues":case"notes":case"messages":this.lastSecondaryUpdate.set(t,0),this.secondaryDataCache.delete(t);break;case"all":this.lastEssentialUpdate=0,this.lastSecondaryUpdate.clear(),this.secondaryDataCache.clear()}}getCurrentEssentialData(){return this.essentialDataCache$.value}updateMessageCount(t){const s=this.essentialDataCache$.value;s&&(s.stats.totalMessagesLeft=t,this.essentialDataCache$.next(s))}getEmptyDashboardData(){return{players:[],matches:[],currentLeague:null,allLeagues:[],notes:[],messages:[],stats:{totalPlayers:0,totalMatches:0,totalMatchesLeft:0,totalMessagesLeft:0}}}static{this.\u0275fac=function(s){return new(s||a)(e.KVO(C.x),e.KVO(M.T),e.KVO(k.N),e.KVO(w.b),e.KVO(I.i))}}static{this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var d=c(4456);function Y(a,l){if(1&a){const t=e.RV6();e.j41(0,"li",36),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.selectPlayer(n))}),e.j41(1,"span",37),e.EFF(2),e.k0s(),e.j41(3,"button",38),e.bIt("click",function(r){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.confirmDelete(i,r))}),e.EFF(4," X "),e.k0s()()}if(2&a){const t=l.$implicit,s=e.XpG(2);e.AVh("bg-blue-600",(null==s.selectedPlayer?null:s.selectedPlayer.playerId)===t.playerId),e.R7$(2),e.JRh(t.fullName)}}function O(a,l){if(1&a&&(e.j41(0,"ul"),e.DNE(1,Y,5,3,"li",35),e.k0s()),2&a){const t=e.XpG();e.R7$(1),e.Y8G("ngForOf",t.players)}}function X(a,l){if(1&a){const t=e.RV6();e.j41(0,"button",39),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.openModal())}),e.EFF(1," Add Player "),e.k0s()}}const x=function(a){return{"opacity-50 cursor-not-allowed":a}};function U(a,l){if(1&a){const t=e.RV6();e.j41(0,"tr",46)(1,"td",47),e.EFF(2),e.k0s(),e.j41(3,"td",47),e.EFF(4),e.k0s(),e.j41(5,"td",47),e.EFF(6),e.k0s(),e.j41(7,"td",48)(8,"button",49),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.updateMatch(n.matchId,n.player1Id))}),e.EFF(9),e.k0s(),e.j41(10,"button",50),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.updateMatch(n.matchId,n.player2Id))}),e.EFF(11),e.k0s(),e.j41(12,"button",51),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.updateMatch(n.matchId,null))}),e.EFF(13),e.k0s(),e.j41(14,"button",52),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.resetMatch(n.matchId))}),e.EFF(15),e.k0s()()()}if(2&a){const t=l.$implicit,s=l.index,r=e.XpG(2);e.Y8G("ngClass",s%2==0?"bg-gray-900":"bg-gray-950"),e.R7$(2),e.JRh(t.player1Name),e.R7$(2),e.JRh(t.player2Name),e.R7$(2),e.Lme(" ",t.score1," - ",t.score2," "),e.R7$(2),e.Y8G("disabled",t.isCompleted)("ngClass",e.eq3(15,x,t.isCompleted)),e.R7$(1),e.SpI(" ",r.loadingMatches[t.matchId]?"Load..":"Win P1"," "),e.R7$(1),e.Y8G("disabled",t.isCompleted)("ngClass",e.eq3(17,x,t.isCompleted)),e.R7$(1),e.SpI(" ",r.loadingMatches[t.matchId]?"Load..":"Win P2"," "),e.R7$(1),e.Y8G("disabled",t.isCompleted)("ngClass",e.eq3(19,x,t.isCompleted)),e.R7$(1),e.SpI(" ",r.loadingMatches[t.matchId]?"Load..":"Draw"," "),e.R7$(2),e.SpI(" ",r.loadingMatches[t.matchId]?"Load..":"Undo"," ")}}function Q(a,l){if(1&a&&(e.j41(0,"div",40)(1,"h2",41),e.EFF(2),e.k0s(),e.j41(3,"table",42)(4,"thead")(5,"tr",43)(6,"th",44),e.EFF(7,"Player 1"),e.k0s(),e.j41(8,"th",44),e.EFF(9,"Player 2"),e.k0s(),e.j41(10,"th",44),e.EFF(11,"Result"),e.k0s(),e.j41(12,"th",44),e.EFF(13,"Actions"),e.k0s()()(),e.j41(14,"tbody"),e.DNE(15,U,16,21,"tr",45),e.k0s()()()),2&a){const t=e.XpG();e.R7$(2),e.SpI(" Matches for ",t.selectedPlayer.fullName," "),e.R7$(13),e.Y8G("ngForOf",t.displayMatches)}}function H(a,l){if(1&a&&(e.j41(0,"div",53)(1,"h4",54),e.EFF(2),e.k0s()()),2&a){const t=e.XpG();e.R7$(2),e.JRh(t.totalMessagesLeft)}}function J(a,l){if(1&a){const t=e.RV6();e.j41(0,"button",55),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.openStartLeagueModal())}),e.EFF(1," Start New League "),e.k0s()}}function W(a,l){if(1&a){const t=e.RV6();e.j41(0,"button",56),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.showEndLeagueModal=!0)}),e.EFF(1," End League "),e.k0s()}}function z(a,l){if(1&a){const t=e.RV6();e.j41(0,"button",57),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.onTournamentStageButtonClick())}),e.EFF(1),e.k0s()}if(2&a){const t=e.XpG();e.R7$(1),e.SpI(" ",t.tournamentStageButtonText," ")}}function Z(a,l){1&a&&(e.j41(0,"p",59),e.EFF(1," Single "),e.k0s())}function K(a,l){1&a&&(e.j41(0,"p",59),e.EFF(1," Multi "),e.k0s())}function q(a,l){1&a&&(e.j41(0,"p",59),e.EFF(1," Groups "),e.k0s())}function ee(a,l){if(1&a&&(e.j41(0,"div",58)(1,"div",19)(2,"h3",20),e.EFF(3," League Description "),e.k0s(),e.j41(4,"p",59),e.EFF(5),e.k0s()(),e.j41(6,"div",19)(7,"h3",20),e.EFF(8,"League Type"),e.k0s(),e.DNE(9,Z,2,0,"p",60),e.DNE(10,K,2,0,"p",60),e.DNE(11,q,2,0,"p",60),e.k0s(),e.j41(12,"div",19)(13,"h3",20),e.EFF(14,"Start Date"),e.k0s(),e.j41(15,"p",59),e.EFF(16),e.nI1(17,"date"),e.k0s()(),e.j41(18,"div",19)(19,"h3",20),e.EFF(20,"League Name"),e.k0s(),e.j41(21,"p",59),e.EFF(22),e.k0s()()()),2&a){const t=e.XpG();e.R7$(5),e.JRh(t.leagueData.description),e.R7$(4),e.Y8G("ngIf",0===t.leagueData.typeOfLeague),e.R7$(1),e.Y8G("ngIf",1===t.leagueData.typeOfLeague),e.R7$(1),e.Y8G("ngIf",2===t.leagueData.typeOfLeague),e.R7$(5),e.SpI(" ",e.i5U(17,6,t.leagueData.createdOn,"fullDate")," "),e.R7$(6),e.JRh(t.leagueData.name)}}const te=function(a,l){return{"bg-gray-900":a,"bg-gray-950":l}};function se(a,l){if(1&a){const t=e.RV6();e.j41(0,"tr",61)(1,"td",62),e.EFF(2),e.k0s(),e.j41(3,"td",30),e.EFF(4),e.k0s(),e.j41(5,"td",62),e.EFF(6),e.k0s(),e.j41(7,"td",62),e.EFF(8),e.k0s(),e.j41(9,"td",62),e.EFF(10),e.nI1(11,"date"),e.k0s(),e.j41(12,"td",62),e.EFF(13),e.k0s(),e.j41(14,"td",30)(15,"button",63),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG();return e.Njj(i.openDeleteLeagueModal(n.leagueId))}),e.EFF(16," Delete League "),e.k0s()()()}if(2&a){const t=l.$implicit,s=l.index;e.Y8G("ngClass",e.l_i(14,te,s%2==0,s%2!=0)),e.R7$(2),e.SpI(" ",t.leagueName," "),e.R7$(1),e.AVh("text-green-500",!t.isFinished)("text-red-500",t.isFinished),e.R7$(1),e.SpI(" ",t.isFinished?"Finished":"Live Now!!"," "),e.R7$(2),e.SpI(" ",0===t.leagueType?"Single":1===t.leagueType?"Multi":2===t.leagueType?"Groups":"Unknown"," "),e.R7$(2),e.SpI(" ",0===t.systemOfLeague?"Points":1===t.systemOfLeague?"Classic":"Unknown"," "),e.R7$(2),e.SpI(" ",e.i5U(11,11,t.createdOn,"yyyy/MM/dd")," "),e.R7$(3),e.SpI(" ",t.players&&t.players.length>0?t.players[0].fullName:"No Winner Yet"," ")}}function re(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",64)(1,"div",65)(2,"h2",66),e.EFF(3,"Confirm Delete"),e.k0s(),e.j41(4,"p",67),e.EFF(5),e.k0s(),e.j41(6,"div",68)(7,"button",69),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.closeDeleteLeagueModal())}),e.EFF(8," Cancel "),e.k0s(),e.j41(9,"button",70),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.deleteConfirmedLeague())}),e.EFF(10," Delete "),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(5),e.SpI(' Are you sure you want to delete league "',null==t.selectedLeagueToDelete?null:t.selectedLeagueToDelete.leagueName,'"? ')}}function ae(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",71)(1,"div",72)(2,"h2",73),e.EFF(3,"Confirm Delete"),e.k0s(),e.j41(4,"p",74),e.EFF(5," Are you sure you want to delete "),e.j41(6,"strong"),e.EFF(7),e.k0s(),e.EFF(8,"? "),e.k0s(),e.j41(9,"div",75)(10,"button",76),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.showDeleteModal=!1)}),e.EFF(11," Cancel "),e.k0s(),e.j41(12,"button",77),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.deleteConfirmedPlayer())}),e.EFF(13," Delete "),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(7),e.JRh(null==t.selectedPlayerToDelete?null:t.selectedPlayerToDelete.fullName)}}function ne(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",71)(1,"div",72)(2,"h2",73),e.EFF(3,"Add New Player"),e.k0s(),e.j41(4,"input",78),e.bIt("ngModelChange",function(r){e.eBV(t);const n=e.XpG();return e.Njj(n.newPlayerName=r)}),e.k0s(),e.j41(5,"div",75)(6,"button",79),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.closeModal())}),e.EFF(7," Cancel "),e.k0s(),e.j41(8,"button",80),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.addPlayer())}),e.EFF(9," Add "),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(4),e.Y8G("ngModel",t.newPlayerName)}}function ie(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",71)(1,"div",81)(2,"h2",73),e.EFF(3,"Start New League"),e.k0s(),e.j41(4,"div",82)(5,"label",83),e.EFF(6,"League Name"),e.k0s(),e.j41(7,"input",84),e.bIt("ngModelChange",function(r){e.eBV(t);const n=e.XpG();return e.Njj(n.newLeague.name=r)}),e.k0s()(),e.j41(8,"div",82)(9,"label",83),e.EFF(10,"League Description"),e.k0s(),e.j41(11,"textarea",85),e.bIt("ngModelChange",function(r){e.eBV(t);const n=e.XpG();return e.Njj(n.newLeague.description=r)}),e.k0s()(),e.j41(12,"div",82)(13,"label",83),e.EFF(14,"League Type"),e.k0s(),e.j41(15,"select",86),e.bIt("ngModelChange",function(r){e.eBV(t);const n=e.XpG();return e.Njj(n.newLeague.typeOfLeague=r)}),e.j41(16,"option",87),e.EFF(17,"Single"),e.k0s(),e.j41(18,"option",87),e.EFF(19,"Multi"),e.k0s(),e.j41(20,"option",87),e.EFF(21,"Groups"),e.k0s()()(),e.j41(22,"div",82)(23,"label",83),e.EFF(24,"System Of League"),e.k0s(),e.j41(25,"select",86),e.bIt("ngModelChange",function(r){e.eBV(t);const n=e.XpG();return e.Njj(n.newLeague.systemOfLeague=r)}),e.j41(26,"option",87),e.EFF(27,"Points"),e.k0s(),e.j41(28,"option",87),e.EFF(29,"Classic"),e.k0s()()(),e.j41(30,"div",75)(31,"button",76),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.closeStartLeagueModal())}),e.EFF(32," Cancel "),e.k0s(),e.j41(33,"button",80),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.startLeague())}),e.EFF(34," Start League "),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(7),e.Y8G("ngModel",t.newLeague.name),e.R7$(4),e.Y8G("ngModel",t.newLeague.description),e.R7$(4),e.Y8G("ngModel",t.newLeague.typeOfLeague),e.R7$(1),e.Y8G("ngValue",0),e.R7$(2),e.Y8G("ngValue",1),e.R7$(2),e.Y8G("ngValue",2),e.R7$(5),e.Y8G("ngModel",t.newLeague.systemOfLeague),e.R7$(1),e.Y8G("ngValue",0),e.R7$(2),e.Y8G("ngValue",1)}}function le(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",71)(1,"div",72)(2,"h2",73),e.EFF(3,"Confirm End League"),e.k0s(),e.j41(4,"p",74),e.EFF(5," Are you sure you want to end the current league? This action cannot be undone. "),e.k0s(),e.j41(6,"div",75)(7,"button",76),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.showEndLeagueModal=!1)}),e.EFF(8," Cancel "),e.k0s(),e.j41(9,"button",77),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.resetTournament(r.leagueData.id))}),e.EFF(10," Confirm End "),e.k0s()()()()}}function oe(a,l){if(1&a){const t=e.RV6();e.j41(0,"button",80),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2).$implicit,n=e.XpG(2);return e.Njj(n.toggleHideNote(r))}),e.EFF(1," Show "),e.k0s()}}function ce(a,l){if(1&a){const t=e.RV6();e.j41(0,"button",104),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2).$implicit,n=e.XpG(2);return e.Njj(n.toggleHideNote(r))}),e.EFF(1," Hide "),e.k0s()}}function de(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",100)(1,"p",101),e.EFF(2),e.k0s(),e.j41(3,"button",79),e.bIt("click",function(){e.eBV(t);const r=e.XpG().$implicit,n=e.XpG(2);return e.Njj(n.toggleDeleteNote(r.id))}),e.EFF(4," Delete "),e.k0s(),e.DNE(5,oe,2,0,"button",102),e.DNE(6,ce,2,0,"button",103),e.k0s()}if(2&a){const t=e.XpG().$implicit;e.R7$(2),e.SpI(" ",t.content," "),e.R7$(3),e.Y8G("ngIf",1==t.isHidden),e.R7$(1),e.Y8G("ngIf",0==t.isHidden)}}function he(a,l){if(1&a&&(e.j41(0,"div"),e.DNE(1,de,7,3,"div",99),e.k0s()),2&a){const t=l.$implicit;e.R7$(1),e.Y8G("ngIf",0==t.isDeleted)}}function ue(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",71)(1,"div",88)(2,"div")(3,"h2",89),e.EFF(4,"Add New Note"),e.k0s(),e.j41(5,"div")(6,"label",90)(7,"span",91),e.EFF(8,"Notes"),e.k0s(),e.j41(9,"div",92)(10,"textarea",93),e.bIt("ngModelChange",function(r){e.eBV(t);const n=e.XpG();return e.Njj(n.newNote=r)}),e.k0s(),e.j41(11,"div",94)(12,"button",95),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.sendNote())}),e.EFF(13," Save "),e.k0s()()()()()(),e.j41(14,"div",96),e.DNE(15,he,2,1,"div",97),e.k0s(),e.j41(16,"button",98),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.closeNoteModal())}),e.EFF(17," Cancel "),e.k0s()()()}if(2&a){const t=e.XpG();e.R7$(10),e.Y8G("ngModel",t.newNote),e.R7$(5),e.Y8G("ngForOf",t.notes)}}const ge=function(a,l){return{"w-64 p-4 sm:min-h-screen":a,"w-0 p-0":l}};let P=(()=>{class a{constructor(t,s,r,n,i,o){this.playerService=t,this.matchService=s,this.toastr=r,this.leagueService=n,this.noteService=i,this.adminDashboardService=o,this.players=[],this.selectedPlayer=null,this.playerMatches=[],this.displayMatches=[],this.notes=[],this.showModal=!1,this.newPlayerName="",this.isSidebarOpen=!1,this.showDeleteModal=!1,this.showNoteModal=!1,this.showDeleteLeagueModal=!1,this.showEndLeagueModal=!1,this.loadingMatches={},this.requestQueue=[],this.isProcessingQueue=!1,this.showResetModal=!1,this.leagueData=null,this.showStartLeagueModal=!1,this.newLeague={name:"",description:"",typeOfLeague:0,systemOfLeague:0},this.totalMessagesLeft=0,this.totalPlayers=0,this.totalMatches=0,this.totalMatchesLeft=0,this.totalMessages=0,this.leagues=[],this.newNote="",this.selectedLeagueToDelete=null,this.currentMatches=[],this.showTournamentStageButton=!1,this.tournamentStageButtonText="",this.tournamentStageButtonAction=null,this.selectedPlayerToDelete=null}ngOnInit(){this.loadEssentialData()}ngOnDestroy(){}loadCurrentLeagueFromServer(){this.leagueService.getAdminCurrentLeague().subscribe({next:t=>{this.leagueData=t.league,this.updateTournamentStageButton()},error:t=>{this.leagueData=null,this.updateTournamentStageButton()}})}loadEssentialData(){this.adminDashboardService.getEssentialData().subscribe({next:t=>{this.players=t.players,this.currentMatches=t.matches,this.leagueData=t.currentLeague,this.leagues=t.allLeagues,this.notes=t.notes,this.totalPlayers=t.stats.totalPlayers,this.totalMatches=t.stats.totalMatches,this.totalMatchesLeft=t.stats.totalMatchesLeft,this.totalMessagesLeft=t.stats.totalMessagesLeft,this.updateTournamentStageButton()},error:t=>{this.toastr.error("\u062d\u062f\u062b \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0628\u064a\u0627\u0646\u0627\u062a")}})}toggleSidebar(){this.isSidebarOpen=!this.isSidebarOpen,this.selectedPlayer=null}selectPlayer(t){this.selectedPlayer=t,this.loadMatches()}loadMatches(){this.selectedPlayer&&this.matchService.getAdminMatches().subscribe(t=>{this.playerMatches=t.filter(s=>s.player1Id===this.selectedPlayer.playerId||s.player2Id===this.selectedPlayer.playerId).sort((s,r)=>{const n=(s.player1Id===this.selectedPlayer.playerId?s.player2Name:s.player1Name)?.toLowerCase()??"",i=(r.player1Id===this.selectedPlayer.playerId?r.player2Name:r.player1Name)?.toLowerCase()??"";return n.localeCompare(i)}),this.displayMatches=this.playerMatches.map(s=>s.player2Id===this.selectedPlayer.playerId?{...s,player1Name:s.player2Name,player2Name:s.player1Name,score1:s.score2,score2:s.score1,player1Id:s.player2Id,player2Id:s.player1Id}:{...s}),this.playerMatches.forEach(s=>{this.loadingMatches[s.matchId]=!1})})}addToQueue(t){this.requestQueue.push(t),this.processQueue()}processQueue(){var t=this;return(0,R.A)(function*(){if(t.isProcessingQueue||0===t.requestQueue.length)return;t.isProcessingQueue=!0;const s=t.requestQueue.shift();if(s)try{yield s()}catch{}t.isProcessingQueue=!1,t.processQueue()})()}updateMatch(t,s){this.loadingMatches[t]=!0,this.addToQueue(()=>new Promise((r,n)=>{this.matchService.updateMatch(t,s).subscribe({next:i=>{i.success?(this.toastr.success(i.message),this.adminDashboardService.invalidateCache("essential"),this.loadEssentialData(),this.loadMatches()):this.toastr.error(i.message),this.loadingMatches[t]=!1,r()},error:i=>{this.toastr.error(i.error.message),this.loadingMatches[t]=!1,n(i)}})}))}resetMatch(t){this.loadingMatches[t]=!0,this.addToQueue(()=>new Promise((s,r)=>{this.matchService.resetMatch(t).subscribe({next:n=>{n.success?(this.toastr.success(n.message),this.loadMatches()):this.toastr.error(n.message,"Error"),this.loadingMatches[t]=!1,s()},error:n=>{this.toastr.error(n.error.message),this.loadingMatches[t]=!1,r(n)}})}))}deletePlayer(t,s){s.stopPropagation(),this.playerService.deletePlayer(t).subscribe(()=>{this.toastr.warning("Player deleted!","Deleted"),this.loadMatches(),this.adminDashboardService.invalidateCache("essential"),this.loadEssentialData(),this.updateTournamentStageButton(),this.selectedPlayer?.playerId===t&&(this.selectedPlayer=null,this.playerMatches=[],this.displayMatches=[])})}openModal(){this.showModal=!0}closeModal(){this.showModal=!1,this.newPlayerName=""}addPlayer(){this.newPlayerName.trim()&&this.playerService.addPlayer(this.newPlayerName).subscribe(t=>{t.success?(this.toastr.success(t.message),this.adminDashboardService.invalidateCache("essential"),this.loadEssentialData(),this.loadMatches(),this.closeModal()):this.toastr.warning(t.message)})}confirmDelete(t,s){s.stopPropagation(),this.selectedPlayerToDelete=t,this.showDeleteModal=!0}deleteConfirmedPlayer(){this.selectedPlayerToDelete&&(this.playerService.deletePlayer(this.selectedPlayerToDelete.playerId).subscribe(t=>{t.success?(this.toastr.success(t.message),this.adminDashboardService.invalidateCache("essential"),this.loadEssentialData(),this.loadMatches()):this.toastr.error(t.message,"Error")}),this.showDeleteModal=!1,this.selectedPlayerToDelete=null)}resetTournament(t){this.leagueService.resetLeague(t).subscribe({next:s=>{s.success?(this.toastr.success(s.message),this.showResetModal=!1,this.loadMatches(),this.adminDashboardService.invalidateCache("essential"),this.loadEssentialData(),this.showEndLeagueModal=!1):this.toastr.error(s.message)},error:s=>{this.toastr.error(s.error.message)}})}openStartLeagueModal(){this.showStartLeagueModal=!0,this.newLeague={name:"",description:"",typeOfLeague:0,systemOfLeague:0}}closeStartLeagueModal(){this.showStartLeagueModal=!1}startLeague(){this.newLeague.name.trim()?this.leagueService.startLeague(this.newLeague).subscribe({next:t=>{t.success?(this.toastr.success(t.message),this.closeStartLeagueModal(),this.loadMatches(),this.adminDashboardService.invalidateCache("essential"),this.loadEssentialData()):this.toastr.error(t.message,"Error")},error:t=>{this.toastr.error(t.error.message)}}):this.toastr.error("League name is required","Error")}DeleteLeague(t){this.leagueService.DeleteLeague(t).subscribe({next:s=>{s.success?(this.toastr.success(s.message),this.showDeleteLeagueModal=!1):this.toastr.error(s.message)},error:s=>{this.toastr.error(s.error.message)}})}openDeleteLeagueModal(t){this.selectedLeagueToDelete=this.leagues.find(s=>s.leagueId===t)||null,this.showDeleteLeagueModal=!0}closeDeleteLeagueModal(){this.showDeleteLeagueModal=!1,this.selectedLeagueToDelete=null}deleteConfirmedLeague(){this.selectedLeagueToDelete&&(this.DeleteLeague(this.selectedLeagueToDelete.leagueId),this.leagues=this.leagues.filter(t=>t.leagueId!==this.selectedLeagueToDelete?.leagueId),this.closeDeleteLeagueModal())}sendNote(){this.newNote.trim()&&this.noteService.sendNote(this.newNote).subscribe({next:t=>{this.toastr.success(t.message),this.newNote="",this.adminDashboardService.invalidateCache("essential"),this.loadEssentialData()},error:()=>this.toastr.error("\u062d\u0635\u0644 \u0645\u0634\u0643\u0644\u0629 \u0648\u0627\u0646\u062a \u0628\u062a\u0628\u0639\u062a \u0627\u0644\u0645\u0644\u0627\u062d\u0638\u0629")})}toggleHideNote(t){this.noteService.toggleMarHide(t.id,!t.isHidden).subscribe({next:s=>{this.toastr.success(s.message),this.loadEssentialData()},error:()=>this.toastr.error("\u062d\u0635\u0644 \u0645\u0634\u0643\u0644\u0629 \u0648\u0627\u0646\u062a \u0628\u062a\u063a\u064a\u0631 \u0627\u0644\u0638\u0647\u0648\u0631")})}toggleDeleteNote(t){this.noteService.DeleteNote(t,!1).subscribe({next:s=>{this.toastr.warning(s.message),this.loadEssentialData()},error:()=>this.toastr.error("\u062d\u0635\u0644 \u0645\u0634\u0643\u0644\u0629 \u0648\u0627\u0646\u062a \u0628\u062a\u062d\u0630\u0641 ")})}openNoteModal(){this.showNoteModal=!0}closeNoteModal(){this.showNoteModal=!1}loadCurrentMatches(){this.matchService.getAdminMatches().subscribe({next:t=>{this.currentMatches=t,this.updateTournamentStageButton()},error:t=>{this.currentMatches=[],this.updateTournamentStageButton()}})}updateTournamentStageButton(){if(!this.leagueData||this.leagueData.typeOfLeague!==_.Ck.Groups)return void(this.showTournamentStageButton=!1);if(this.totalPlayers>0&&0===this.currentMatches.length)return this.showTournamentStageButton=!0,this.tournamentStageButtonText="Start Group Stage",void(this.tournamentStageButtonAction=()=>this.startGroupStage());const t=this.currentMatches.filter(h=>h.stage===_.gD.GroupStage||"GroupStage"===h.tournamentStage),s=this.currentMatches.filter(h=>h.stage===_.gD.QuarterFinals||"QuarterFinals"===h.tournamentStage),r=this.currentMatches.filter(h=>h.stage===_.gD.SemiFinals||"SemiFinals"===h.tournamentStage),n=this.currentMatches.filter(h=>h.stage===_.gD.Final||"Final"===h.tournamentStage),i=t.length>0&&t.every(h=>h.isCompleted),o=s.length>0&&s.every(h=>h.isCompleted),g=r.length>0&&r.every(h=>h.isCompleted);return t.length>0&&i&&0===s.length?(this.showTournamentStageButton=!0,this.tournamentStageButtonText="Start Quarter",void(this.tournamentStageButtonAction=()=>this.startQuarterStage())):s.length>0&&o&&0===r.length?(this.showTournamentStageButton=!0,this.tournamentStageButtonText="Start Semi Final",void(this.tournamentStageButtonAction=()=>this.startSemiFinalStage())):r.length>0&&g&&0===n.length?(this.showTournamentStageButton=!0,this.tournamentStageButtonText="Start Final",void(this.tournamentStageButtonAction=()=>this.startFinalStage())):void(this.showTournamentStageButton=!1)}startGroupStage(){this.leagueData&&this.leagueService.createGroupsAndMatches(this.leagueData.id).subscribe({next:t=>{t.success?(this.toastr.success(t.message),this.adminDashboardService.invalidateCache("essential"),this.loadEssentialData()):this.toastr.error(t.message)},error:t=>{this.toastr.error(t.error.message)}})}startQuarterStage(){this.leagueData&&this.leagueService.startKnockoutStage(this.leagueData.id).subscribe({next:t=>{t.success?(this.toastr.success(t.message),this.adminDashboardService.invalidateCache("essential"),this.loadEssentialData()):this.toastr.error(t.message)},error:t=>{this.toastr.error(t.error.message)}})}startSemiFinalStage(){this.leagueData&&this.leagueService.startSemiFinals(this.leagueData.id).subscribe({next:t=>{t.success?(this.toastr.success(t.message),this.adminDashboardService.invalidateCache("essential"),this.loadEssentialData()):this.toastr.error(t.message)},error:t=>{this.toastr.error(t.error.message)}})}startFinalStage(){this.leagueData&&this.leagueService.startFinal(this.leagueData.id).subscribe({next:t=>{t.success?(this.toastr.success(t.message),this.adminDashboardService.invalidateCache("essential"),this.loadEssentialData()):this.toastr.error(t.message)},error:t=>{this.toastr.error(t.error.message)}})}onTournamentStageButtonClick(){this.tournamentStageButtonAction&&this.tournamentStageButtonAction()}static{this.\u0275fac=function(s){return new(s||a)(e.rXU(C.x),e.rXU(M.T),e.rXU(F.tw),e.rXU(k.N),e.rXU(I.i),e.rXU(S))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-players"]],decls:69,vars:22,consts:[[1,"block","sm:flex","transition-all","duration-600"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","text-white","transition-all","duration-600",3,"ngClass"],[1,"text-lg","font-bold","mb-4","flex","justify-between","overflow-hidden","text-white"],[1,"text-gray-300","text-3xl",3,"click"],[4,"ngIf"],["class","mt-4 w-full bg-green-600 p-2 rounded text-white hover:bg-green-700 transition",3,"click",4,"ngIf"],[1,"sm:flex-1","sm:p-2","transition-all","duration-600","sm:container","sm:mx-auto"],["class","sm:w-4/6 mx-auto",4,"ngIf"],[1,"my-3","border-gray-600"],[1,"flex","justify-evenly","pt-5"],[1,"bg-blue-600","text-white","px-3","py-2","rounded","mb-4","hover:bg-blue-700","transition",3,"click"],["routerLink","/admin/inbox",1,"bg-orange-600","hover:bg-orange-700","text-white","mb-4","px-3","py-2","rounded","transition-all","relative"],["class","absolute -top-2 -right-2 w-[30px] h-[30px] rounded-full bg-green-600 flex justify-center items-center",4,"ngIf"],["class","bg-green-600 text-white px-3 py-2 rounded mb-4 hover:bg-green-700 transition",3,"click",4,"ngIf"],["class","bg-red-600 text-white px-3 py-2 rounded mb-4 hover:bg-red-700 transition","s","",3,"click",4,"ngIf"],["class","bg-purple-600 text-white px-3 py-2 rounded mb-4 hover:bg-purple-700 transition",3,"click",4,"ngIf"],[1,"bg-indigo-600","text-white","px-3","py-2","rounded","mb-4","hover:bg-indigo-700","transition",3,"click"],["class","grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-8","container","mx-auto"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","shadow-md","rounded","p-6","text-center"],[1,"text-lg","font-semibold","mb-2","text-white"],[1,"text-3xl","font-bold","text-red-500"],[1,"text-3xl","font-bold","text-green-500"],[1,"text-3xl","font-bold","text-blue-500"],[1,"text-center"],[1,"mb-4","text-4xl","font-extrabold","leading-none","tracking-tight","md:text-4xl","lg:text-4xl","text-white"],[1,"max-h-[350px]","overflow-x-auto"],[1,"min-w-full","divide-y-2","divide-gray-600"],[1,"sticky","top-0","bg-black","bg-opacity-50","backdrop-blur-sm"],[1,"*:font-medium","*:text-white"],[1,"px-3","py-2","whitespace-nowrap"],[1,"divide-y","divide-gray-600"],["class","*:font-bold *:first:font-medium",3,"ngClass",4,"ngFor","ngForOf"],["class","fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",4,"ngIf"],["class","fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-50",4,"ngIf"],["class","flex items-center justify-between p-2 cursor-pointer rounded-md hover:bg-gray-700",3,"bg-blue-600","click",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-2","cursor-pointer","rounded-md","hover:bg-gray-700",3,"click"],[1,"text-white"],[1,"bg-red-600","px-2","py-1","text-sm","rounded","text-white","hover:bg-red-700","transition",3,"click"],[1,"mt-4","w-full","bg-green-600","p-2","rounded","text-white","hover:bg-green-700","transition",3,"click"],[1,"sm:w-4/6","mx-auto"],[1,"text-2xl","font-bold","mb-4","text-center","text-white"],[1,"w-full","border-collapse","border","border-gray-600","text-center"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","text-white"],[1,"border","border-gray-600","p-2"],["class","border border-gray-600",3,"ngClass",4,"ngFor","ngForOf"],[1,"border","border-gray-600",3,"ngClass"],[1,"p-2","font-bold","text-white"],[1,"p-2"],[1,"bg-blue-600","px-2","py-1","rounded","text-white","hover:bg-blue-700","transition-all",3,"disabled","ngClass","click"],[1,"bg-blue-600","px-2","py-1","rounded","text-white","mx-1","hover:bg-blue-700","transition-all",3,"disabled","ngClass","click"],[1,"bg-yellow-600","px-2","py-1","rounded","text-white","hover:bg-yellow-700","transition-all",3,"disabled","ngClass","click"],[1,"bg-gray-600","px-2","py-1","rounded","text-white","ml-2","hover:bg-gray-700","transition-all",3,"click"],[1,"absolute","-top-2","-right-2","w-[30px]","h-[30px]","rounded-full","bg-green-600","flex","justify-center","items-center"],[1,"text-white","font-bold"],[1,"bg-green-600","text-white","px-3","py-2","rounded","mb-4","hover:bg-green-700","transition",3,"click"],["s","",1,"bg-red-600","text-white","px-3","py-2","rounded","mb-4","hover:bg-red-700","transition",3,"click"],[1,"bg-purple-600","text-white","px-3","py-2","rounded","mb-4","hover:bg-purple-700","transition",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4","mb-8"],[1,"font-bold","text-gray-300"],["class","font-bold text-gray-300",4,"ngIf"],[1,"*:font-bold","*:first:font-medium",3,"ngClass"],[1,"px-3","py-2","whitespace-nowrap","text-white"],[1,"bg-red-600","text-white","px-3","py-2","rounded","hover:bg-red-700","transition",3,"click"],[1,"fixed","inset-0","bg-black","bg-opacity-75","flex","items-center","justify-center","z-50"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","p-6","rounded-lg","shadow-lg","w-96"],[1,"text-xl","font-bold","text-white","mb-4"],[1,"text-gray-300","mb-6"],[1,"flex","justify-end","space-x-4"],[1,"bg-gray-600","text-white","px-4","py-2","rounded","hover:bg-gray-700","transition",3,"click"],[1,"bg-red-600","text-white","px-4","py-2","rounded","hover:bg-red-700","transition",3,"click"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-75","z-50"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","p-6","rounded-lg"],[1,"text-lg","font-bold","mb-4","text-white"],[1,"text-gray-300"],[1,"mt-4","flex","justify-end"],[1,"bg-gray-600","px-4","py-2","text-white","rounded","mr-2","hover:bg-gray-700","transition",3,"click"],[1,"bg-red-600","px-4","py-2","text-white","rounded","hover:bg-red-700","transition",3,"click"],["type","text","placeholder","Enter player name",1,"border","border-gray-600","p-2","w-full","bg-gray-800","text-white","rounded","placeholder-gray-400",3,"ngModel","ngModelChange"],[1,"bg-red-600","px-4","py-2","text-white","rounded","mr-2","hover:bg-red-700","transition",3,"click"],[1,"bg-green-600","px-4","py-2","text-white","rounded","hover:bg-green-700","transition",3,"click"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","p-6","rounded-lg","w-96"],[1,"mb-4"],[1,"block","text-sm","font-medium","mb-1","text-gray-300"],["type","text","placeholder","Enter league name",1,"border","border-gray-600","p-2","w-full","rounded","bg-gray-800","text-white","placeholder-gray-400",3,"ngModel","ngModelChange"],["placeholder","Enter league description","rows","3",1,"border","border-gray-600","p-2","w-full","rounded","bg-gray-800","text-white","placeholder-gray-400",3,"ngModel","ngModelChange"],[1,"border","border-gray-600","p-2","w-full","rounded","bg-gray-800","text-white",3,"ngModel","ngModelChange"],[3,"ngValue"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","p-4","rounded-lg"],[1,"font-bold","text-white","text-center"],["for","Notes"],[1,"text-sm","font-medium","text-gray-300"],[1,"relative","m-2","overflow-hidden","rounded","border-gray-600"],["id","Notes","rows","4",1,"w-full","resize-none","p-3","border","border-gray-600","bg-gray-800","text-white","placeholder-gray-400",3,"ngModel","ngModelChange"],[1,"flex","items-center","justify-end","gap-2","p-1.5"],["type","button",1,"rounded","p-2","font-bold","text-white","bg-green-600","hover:bg-green-700","transition",3,"click"],[1,"p-6"],[4,"ngFor","ngForOf"],[1,"bg-gray-600","px-4","py-2","text-white","rounded","hover:bg-gray-700","transition",3,"click"],["class","mt-4 flex items-center justify-end",4,"ngIf"],[1,"mt-4","flex","items-center","justify-end"],[1,"font-bold","px-3","text-white"],["class","bg-green-600 px-4 py-2 text-white rounded hover:bg-green-700 transition",3,"click",4,"ngIf"],["class","bg-purple-600 px-4 py-2 text-white rounded hover:bg-purple-700 transition",3,"click",4,"ngIf"],[1,"bg-purple-600","px-4","py-2","text-white","rounded","hover:bg-purple-700","transition",3,"click"]],template:function(s,r){1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"h2",2),e.EFF(3," Players "),e.j41(4,"button",3),e.bIt("click",function(){return r.toggleSidebar()}),e.EFF(5," \xd7 "),e.k0s()(),e.DNE(6,O,2,1,"ul",4),e.DNE(7,X,2,0,"button",5),e.k0s(),e.j41(8,"div",6),e.DNE(9,Q,16,2,"div",7),e.nrm(10,"hr",8),e.j41(11,"div")(12,"div",9)(13,"button",10),e.bIt("click",function(){return r.toggleSidebar()}),e.EFF(14," \u2630 Players "),e.k0s(),e.j41(15,"button",11),e.EFF(16," Inbox "),e.DNE(17,H,3,1,"div",12),e.k0s(),e.DNE(18,J,2,0,"button",13),e.DNE(19,W,2,0,"button",14),e.DNE(20,z,2,1,"button",15),e.j41(21,"button",16),e.bIt("click",function(){return r.openNoteModal()}),e.EFF(22," Notes "),e.k0s()(),e.DNE(23,ee,23,9,"div",17),e.j41(24,"div",18)(25,"div",19)(26,"h3",20),e.EFF(27," Remaining Matches "),e.k0s(),e.j41(28,"p",21),e.EFF(29),e.k0s()(),e.j41(30,"div",19)(31,"h3",20),e.EFF(32,"Total Matches"),e.k0s(),e.j41(33,"p",22),e.EFF(34),e.k0s()(),e.j41(35,"div",19)(36,"h3",20),e.EFF(37,"Total Players"),e.k0s(),e.j41(38,"p",23),e.EFF(39),e.k0s()()()(),e.j41(40,"div",24)(41,"h2",25),e.EFF(42," All Leagues "),e.k0s(),e.j41(43,"div",26)(44,"table",27)(45,"thead",28)(46,"tr",29)(47,"th",30),e.EFF(48,"League Name"),e.k0s(),e.j41(49,"th",30),e.EFF(50,"League Status"),e.k0s(),e.j41(51,"th",30),e.EFF(52,"League Type"),e.k0s(),e.j41(53,"th",30),e.EFF(54,"League System"),e.k0s(),e.j41(55,"th",30),e.EFF(56,"League Date"),e.k0s(),e.j41(57,"th",30),e.EFF(58,"Winner"),e.k0s(),e.j41(59,"th",30),e.EFF(60,"Delete"),e.k0s()()(),e.j41(61,"tbody",31),e.DNE(62,se,17,17,"tr",32),e.k0s()()()()(),e.DNE(63,re,11,1,"div",33),e.DNE(64,ae,14,1,"div",34),e.DNE(65,ne,10,1,"div",34),e.DNE(66,ie,35,9,"div",34),e.DNE(67,le,11,0,"div",34),e.DNE(68,ue,18,2,"div",34),e.k0s()),2&s&&(e.R7$(1),e.Y8G("ngClass",e.l_i(19,ge,r.isSidebarOpen,!r.isSidebarOpen)),e.R7$(5),e.Y8G("ngIf",r.isSidebarOpen),e.R7$(1),e.Y8G("ngIf",r.isSidebarOpen),e.R7$(2),e.Y8G("ngIf",r.selectedPlayer),e.R7$(8),e.Y8G("ngIf",r.totalMessagesLeft>0),e.R7$(1),e.Y8G("ngIf",null==r.leagueData),e.R7$(1),e.Y8G("ngIf",null!=r.leagueData),e.R7$(1),e.Y8G("ngIf",r.showTournamentStageButton&&null!=r.leagueData),e.R7$(3),e.Y8G("ngIf",r.leagueData),e.R7$(6),e.JRh(r.totalMatchesLeft),e.R7$(5),e.JRh(r.totalMatches),e.R7$(5),e.JRh(r.totalPlayers),e.R7$(23),e.Y8G("ngForOf",r.leagues),e.R7$(1),e.Y8G("ngIf",r.showDeleteLeagueModal),e.R7$(1),e.Y8G("ngIf",r.showDeleteModal),e.R7$(1),e.Y8G("ngIf",r.showModal),e.R7$(1),e.Y8G("ngIf",r.showStartLeagueModal),e.R7$(1),e.Y8G("ngIf",r.showEndLeagueModal),e.R7$(1),e.Y8G("ngIf",r.showNoteModal))},dependencies:[u.YU,u.Sq,u.bT,b.Wk,d.xH,d.y7,d.me,d.wz,d.BC,d.vS,u.vh]})}}return a})();const pe=["messagesContainer"];function me(a,l){1&a&&(e.j41(0,"div",9),e.EFF(1," No messages here \u{1f4ed} "),e.k0s())}function ye(a,l){if(1&a&&(e.j41(0,"span",16),e.EFF(1),e.k0s()),2&a){const t=e.XpG().$implicit;e.R7$(1),e.SpI(" ",t.unreadCount," ")}}function fe(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",12),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.openChat(n.senderId))}),e.j41(1,"div")(2,"p",13),e.EFF(3),e.k0s(),e.j41(4,"p",14),e.EFF(5),e.k0s()(),e.DNE(6,ye,2,1,"span",15),e.k0s()}if(2&a){const t=l.$implicit;e.R7$(3),e.JRh(t.senderFullName),e.R7$(2),e.JRh(t.lastMessage),e.R7$(1),e.Y8G("ngIf",t.unreadCount>0)}}function _e(a,l){if(1&a&&(e.j41(0,"div",10),e.DNE(1,fe,7,3,"div",11),e.k0s()),2&a){const t=e.XpG();e.R7$(1),e.Y8G("ngForOf",t.playerChats)("ngForTrackBy",t.trackByPlayerId)}}const be=function(a,l){return{"text-right":a,"text-left":l}},Fe=function(a,l){return{"bg-green-700":a,"bg-gray-700 ":l}};function xe(a,l){if(1&a&&(e.j41(0,"div",31)(1,"div",32)(2,"p",33),e.EFF(3),e.k0s(),e.j41(4,"p",34),e.EFF(5),e.nI1(6,"date"),e.k0s()()()),2&a){const t=l.$implicit;e.Y8G("ngClass",e.l_i(7,be,!t.isFromAdmin,t.isFromAdmin)),e.R7$(1),e.Y8G("ngClass",e.l_i(10,Fe,!t.isFromAdmin,t.isFromAdmin)),e.R7$(2),e.JRh(t.content),e.R7$(2),e.SpI(" ",e.i5U(6,4,t.sentAt,"MMM d, y, hh:mm a")," ")}}const D=function(a){return{"sm:left-1/3":a}},ve=function(){return{standalone:!0}};function Ce(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",17)(1,"div",18)(2,"div",19)(3,"button",20),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.closeChat())}),e.nrm(4,"i",21),e.k0s(),e.j41(5,"div")(6,"p",22),e.EFF(7),e.k0s(),e.j41(8,"p",23),e.EFF(9),e.k0s()()()(),e.j41(10,"div",24,25),e.DNE(12,xe,7,13,"div",26),e.k0s(),e.j41(13,"div",27)(14,"form",28),e.bIt("ngSubmit",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.sendReply())}),e.j41(15,"input",29),e.bIt("ngModelChange",function(r){e.eBV(t);const n=e.XpG();return e.Njj(n.replyMessages[n.selectedChat.messages[0].id]=r)})("ngModelChange",function(r){e.eBV(t);const n=e.XpG();return e.Njj(n.replyMessages[n.selectedChat.messages[0].id]=r)}),e.k0s(),e.j41(16,"button",30),e.EFF(17," Reply "),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(1),e.xc7("top",t.navbarHeight,"px"),e.Y8G("ngClass",e.eq3(13,D,t.selectedChat)),e.R7$(6),e.SpI(" ",t.selectedChat.senderFullName," "),e.R7$(2),e.SpI(" ",t.selectedChat.senderPhoneNumber," "),e.R7$(1),e.xc7("margin-top",t.navbarHeight+80,"px"),e.R7$(2),e.Y8G("ngForOf",t.selectedChat.messages)("ngForTrackBy",t.trackByMessageId),e.R7$(1),e.Y8G("ngClass",e.eq3(15,D,t.selectedChat)),e.R7$(2),e.Y8G("ngModel",t.replyMessages[t.selectedChat.messages[0].id])("ngModelOptions",e.lJ4(17,ve)),e.R7$(1),e.Y8G("disabled",!t.replyMessages[t.selectedChat.messages[0].id])}}function Me(a,l){1&a&&(e.j41(0,"div",35),e.EFF(1," Select a chat to view messages \u{1f4e9} "),e.k0s())}const ke=function(a){return{hidden:a}},Ie=function(a,l){return{block:a,"hidden sm:flex":l}};let je=(()=>{class a{constructor(t,s,r,n){this.messageService=t,this.toastr=s,this.cdr=r,this.adminDashboardService=n,this.playerChats=[],this.selectedPlayerId=null,this.selectedChat=null,this.replyMessages={},this.navbarHeight=60}ngOnInit(){this.loadAdminMessages()}ngOnDestroy(){this.updateStatusSubscription&&this.updateStatusSubscription.unsubscribe(),this.refreshSubscription&&this.refreshSubscription.unsubscribe()}loadAdminMessages(){this.loadFromServer()}loadFromCache(){this.loadFromServer()}loadFromServer(){this.adminDashboardService.getSecondaryData("messages").subscribe({next:t=>{if(t&&t.length>0){const s=this.groupMessagesBySender(t);this.playerChats=s.sort((r,n)=>new Date(n.lastMessageDate).getTime()-new Date(r.lastMessageDate).getTime())}else this.toastr.error("\u0644\u0627 \u064a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644")},error:t=>{this.toastr.error(t.message)}})}refreshMessages(){this.messageService.getAdminMessages().subscribe({next:t=>{if(t&&t.messages){const s=this.groupMessagesBySender(t.messages);this.playerChats=s.sort((r,n)=>new Date(n.lastMessageDate).getTime()-new Date(r.lastMessageDate).getTime())}else this.toastr.error("\u0644\u0627 \u064a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644")},error:t=>{this.toastr.error(t.message)}})}ngAfterViewChecked(){this.selectedChat&&this.messagesContainer&&this.scrollToBottom()}loadMessages(){this.messageService.getMessages().subscribe({next:t=>{t&&t.messages?this.processMessages(t.messages):this.toastr.error("\u0644\u0627 \u064a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644 \u0627\u0644\u0622\u0646")},error:t=>{this.toastr.error("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062c\u0644\u0628 \u0627\u0644\u0631\u0633\u0627\u0626\u0644")}})}processMessages(t){const s=this.groupMessagesBySender(t);this.playerChats=s.sort((r,n)=>new Date(n.lastMessageDate).getTime()-new Date(r.lastMessageDate).getTime()),this.cdr.detectChanges()}groupMessagesBySender(t){const s={};return t.filter(r=>!r.isDeleted).forEach(r=>{const n=r.senderId;s[n]||(s[n]={senderId:n,senderFullName:r.senderFullName,senderPhoneNumber:r.senderPhoneNumber,lastMessage:"",lastMessageDate:"",unreadCount:0,messages:[]}),s[n].messages.push(r),!r.isFromAdmin&&!r.isRead&&s[n].unreadCount++}),Object.values(s).map(r=>{r.messages=r.messages.sort((i,o)=>new Date(i.sentAt).getTime()-new Date(o.sentAt).getTime());const n=r.messages[r.messages.length-1];return r.lastMessage=n?.content??"",r.lastMessageDate=n?.sentAt??"",r})}openChat(t){this.selectedPlayerId=t,this.selectedChat=this.playerChats.find(s=>s.senderId===t)||null,this.selectedChat&&(this.selectedChat.messages.filter(s=>!s.isRead&&!s.isFromAdmin).forEach(s=>{this.messageService.toggleMarkMessage(s.id,!0).subscribe({next:r=>{r.success&&(s.isRead=!0,this.selectedChat.unreadCount=this.selectedChat.messages.filter(n=>!n.isRead&&!n.isFromAdmin).length,this.cdr.detectChanges())},error:r=>{this.toastr.error("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u062d\u062f\u064a\u062b \u062d\u0627\u0644\u0629 \u0627\u0644\u0631\u0633\u0627\u0644\u0629")}})}),this.cdr.detectChanges())}closeChat(){this.selectedPlayerId=null,this.selectedChat=null,this.replyMessages={},this.cdr.detectChanges()}sendReply(){if(!this.selectedChat)return void this.toastr.warning("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u0645\u062d\u0627\u062f\u062b\u0629");const t=this.replyMessages[this.selectedChat.messages[0].id]?.trim();t?this.messageService.sendAdminReply(this.selectedChat.senderId,t).subscribe({next:s=>{if(s.success){this.toastr.success("\u062a\u0645 \u0625\u0631\u0633\u0627\u0644 \u0627\u0644\u0631\u062f"),this.replyMessages[this.selectedChat.messages[0].id]="";const r={id:Math.random(),senderId:this.selectedChat.senderId,senderFullName:"Admin",senderPhoneNumber:"",content:t,isRead:!0,isDeleted:!1,sentAt:(new Date).toISOString(),isFromAdmin:!0};this.selectedChat.messages.push(r),this.selectedChat.messages.sort((n,i)=>new Date(n.sentAt).getTime()-new Date(i.sentAt).getTime()),this.selectedChat.lastMessage=t,this.selectedChat.lastMessageDate=r.sentAt,this.playerChats.sort((n,i)=>new Date(i.lastMessageDate).getTime()-new Date(n.lastMessageDate).getTime()),this.selectedChat=this.playerChats.find(n=>n.senderId===this.selectedPlayerId)||null,this.cdr.detectChanges()}else this.toastr.error(s.message||"\u0641\u0634\u0644 \u0625\u0631\u0633\u0627\u0644 \u0627\u0644\u0631\u062f")},error:s=>{this.toastr.error("\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u0625\u0631\u0633\u0627\u0644 \u0627\u0644\u0631\u062f")}}):this.toastr.warning("\u0627\u0644\u0631\u062c\u0627\u0621 \u0643\u062a\u0627\u0628\u0629 \u0631\u062f")}scrollToBottom(){if(this.messagesContainer){const t=this.messagesContainer.nativeElement;t.scrollTop=t.scrollHeight}}trackByPlayerId(t,s){return s.senderId}trackByMessageId(t,s){return s.id}static{this.\u0275fac=function(s){return new(s||a)(e.rXU(w.b),e.rXU(F.tw),e.rXU(e.gRc),e.rXU(S))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-inbox"]],viewQuery:function(s,r){if(1&s&&e.GBs(pe,5),2&s){let n;e.mGM(n=e.lsd())&&(r.messagesContainer=n.first)}},decls:11,vars:11,consts:[[1,"container","mx-auto","p-4","flex","flex-col","sm:flex-row","overflow-hidden","h-screen"],[1,"w-full","sm:w-1/3","border-r","border-gray-600","sm:block",3,"ngClass"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-white"],["class","text-center text-gray-300",4,"ngIf"],["class","space-y-2 overflow-y-auto max-h-[calc(100vh-120px)]",4,"ngIf"],[1,"w-full","sm:w-2/3","flex","flex-col","h-full","relative",3,"ngClass"],["class","flex flex-col h-full",4,"ngIf","ngIfElse"],["noChatSelected",""],[1,"text-center","text-gray-300"],[1,"space-y-2","overflow-y-auto","max-h-[calc(100vh-120px)]"],["class","p-4 backdrop-blur-sm border border-gray-600 rounded-lg hover:bg-gray-700 cursor-pointer flex items-center justify-between",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"p-4","backdrop-blur-sm","border","border-gray-600","rounded-lg","hover:bg-gray-700","cursor-pointer","flex","items-center","justify-between",3,"click"],[1,"font-bold","text-white"],[1,"text-sm","text-gray-300","truncate"],["class","bg-green-600 text-white text-xs font-bold rounded-full px-2 py-1",4,"ngIf"],[1,"bg-green-600","text-white","text-xs","font-bold","rounded-full","px-2","py-1"],[1,"flex","flex-col","h-full"],[1,"fixed","left-0","right-0","z-40","p-2","backdrop-blur-sm","border-b","border-gray-600","flex","items-center","justify-between","bg-black","bg-opacity-90",3,"ngClass"],[1,"flex","items-center"],[1,"mr-4","text-gray-300","hover:text-white","transition",3,"click"],[1,"fa-solid","fa-arrow-left",2,"color","#ffffff"],[1,"font-bold","text-white","text-sm","p-0"],[1,"text-xs","text-gray-400","p-0"],[1,"flex-1","p-4","overflow-y-auto","backdrop-blur-sm",2,"margin-bottom","80px"],["messagesContainer",""],["class","mb-4",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"fixed","bottom-0","left-0","right-0","z-50","p-4","bg-black","bg-opacity-90","backdrop-blur-sm","border-t","border-gray-600",3,"ngClass"],[1,"flex","items-center","gap-2",3,"ngSubmit"],["type","text","placeholder","Write your reply...",1,"flex-1","p-2","border","border-gray-600","rounded-lg","bg-gray-800","text-white","focus:outline-none","focus:ring-2","focus:ring-blue-600","placeholder-gray-400",3,"ngModel","ngModelOptions","ngModelChange"],["type","submit",1,"bg-blue-600","text-white","p-2","rounded-lg","hover:bg-blue-700","transition","disabled:bg-gray-600",3,"disabled"],[1,"mb-4",3,"ngClass"],[1,"inline-block","p-3","rounded-lg","max-w-xs",3,"ngClass"],[1,"text-white"],[1,"text-xs","mt-1","text-gray-300"],[1,"w-full","flex","items-center","justify-center","text-gray-300"]],template:function(s,r){if(1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),e.EFF(4,"\u{1f4e5} Inbox"),e.k0s()(),e.DNE(5,me,2,0,"div",4),e.DNE(6,_e,2,2,"div",5),e.k0s(),e.j41(7,"div",6),e.DNE(8,Ce,18,18,"div",7),e.DNE(9,Me,2,0,"ng-template",null,8,e.C5r),e.k0s()()),2&s){const n=e.sdS(10);e.R7$(1),e.Y8G("ngClass",e.eq3(6,ke,r.selectedChat)),e.R7$(4),e.Y8G("ngIf",0===r.playerChats.length),e.R7$(1),e.Y8G("ngIf",r.playerChats.length>0),e.R7$(1),e.Y8G("ngClass",e.l_i(8,Ie,r.selectedChat,!r.selectedChat)),e.R7$(1),e.Y8G("ngIf",r.selectedChat)("ngIfElse",n)}},dependencies:[u.YU,u.Sq,u.bT,d.qT,d.me,d.BC,d.cb,d.vS,d.cV,u.vh]})}}return a})();var m=c(8416),we=c(7791);function Se(a,l){if(1&a){const t=e.RV6();e.j41(0,"li",40),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.selectPlayer(n))}),e.j41(1,"span",41),e.bIt("click",function(){e.eBV(t);const r=e.XpG(2);return e.Njj(r.openRecordMatchModal())}),e.EFF(2),e.k0s(),e.j41(3,"button",42),e.bIt("click",function(r){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.confirmDelete(i,r))}),e.EFF(4," X "),e.k0s()()}if(2&a){const t=l.$implicit,s=e.XpG(2);e.AVh("bg-blue-600",(null==s.selectedPlayer?null:s.selectedPlayer.playerId)===t.playerId),e.R7$(2),e.JRh(t.fullName)}}function Pe(a,l){if(1&a&&(e.j41(0,"ul"),e.DNE(1,Se,5,3,"li",39),e.k0s()),2&a){const t=e.XpG();e.R7$(1),e.Y8G("ngForOf",t.players)}}function De(a,l){if(1&a){const t=e.RV6();e.j41(0,"button",43),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.openModal())}),e.EFF(1," Add Player "),e.k0s()}}function Ee(a,l){if(1&a&&(e.j41(0,"div",44)(1,"h2",45),e.EFF(2),e.k0s()()),2&a){const t=e.XpG();e.R7$(2),e.SpI(" Friendly Matches for ",t.selectedPlayer.fullName," ")}}function Re(a,l){if(1&a&&(e.j41(0,"option",26),e.EFF(1),e.k0s()),2&a){const t=l.$implicit;e.Y8G("ngValue",t.playerId),e.R7$(1),e.SpI(" ",t.fullName," ")}}function Ne(a,l){if(1&a){const t=e.RV6();e.j41(0,"tr",46)(1,"td",34),e.EFF(2),e.nI1(3,"date"),e.k0s(),e.j41(4,"td",34),e.EFF(5),e.k0s(),e.j41(6,"td",47)(7,"span",48),e.EFF(8),e.k0s()(),e.j41(9,"td",34),e.EFF(10),e.k0s(),e.j41(11,"td",47)(12,"div",49)(13,"button",50),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG();return e.Njj(i.editMatch(n))}),e.EFF(14," Edit "),e.k0s(),e.j41(15,"button",51),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG();return e.Njj(i.deleteMatchFromList(n.matchId))}),e.EFF(16," Delete "),e.k0s()()()()}if(2&a){const t=l.$implicit,s=e.XpG();e.R7$(2),e.SpI(" ",e.i5U(3,5,t.playedOn,"shortDate")," "),e.R7$(3),e.SpI(" ",t.player1Name||s.getPlayerName(t.player1Id)," "),e.R7$(3),e.Lme(" ",t.player1Score," - ",t.player2Score," "),e.R7$(2),e.SpI(" ",t.player2Name||s.getPlayerName(t.player2Id)," ")}}function Te(a,l){if(1&a){const t=e.RV6();e.j41(0,"span",56)(1,"button",57),e.bIt("click",function(){const n=e.eBV(t).index,i=e.XpG(2);return e.Njj(i.changePage(n+1))}),e.EFF(2),e.k0s()()}if(2&a){const t=l.index,s=e.XpG(2);e.R7$(1),e.AVh("bg-blue-600",s.currentPage===t+1)("bg-gray-600",s.currentPage!==t+1)("hover:bg-blue-700",s.currentPage===t+1)("hover:bg-gray-700",s.currentPage!==t+1),e.R7$(1),e.SpI(" ",t+1," ")}}const Ge=function(){return[]};function $e(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",52)(1,"div",53)(2,"button",54),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.changePage(r.currentPage-1))}),e.EFF(3," Previous "),e.k0s(),e.DNE(4,Te,3,9,"span",55),e.j41(5,"button",54),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.changePage(r.currentPage+1))}),e.EFF(6," Next "),e.k0s()()()}if(2&a){const t=e.XpG();e.R7$(2),e.Y8G("disabled",1===t.currentPage),e.R7$(2),e.Y8G("ngForOf",e.lJ4(3,Ge).constructor(t.totalPages)),e.R7$(1),e.Y8G("disabled",t.currentPage===t.totalPages)}}function Ae(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",58)(1,"div",59)(2,"h2",60),e.EFF(3,"Confirm Delete"),e.k0s(),e.j41(4,"p",61),e.EFF(5," Are you sure you want to delete "),e.j41(6,"strong"),e.EFF(7),e.k0s(),e.EFF(8,"? "),e.k0s(),e.j41(9,"div",62)(10,"button",63),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.showDeleteModal=!1)}),e.EFF(11," Cancel "),e.k0s(),e.j41(12,"button",64),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.deleteConfirmedPlayer())}),e.EFF(13," Delete "),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(7),e.JRh(null==t.selectedPlayerToDelete?null:t.selectedPlayerToDelete.fullName)}}function Le(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",58)(1,"div",59)(2,"h2",60),e.EFF(3,"Add New Friendly Player"),e.k0s(),e.j41(4,"input",65),e.bIt("ngModelChange",function(r){e.eBV(t);const n=e.XpG();return e.Njj(n.newPlayerName=r)}),e.k0s(),e.j41(5,"div",62)(6,"button",66),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.closeModal())}),e.EFF(7," Cancel "),e.k0s(),e.j41(8,"button",67),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.addPlayer())}),e.EFF(9," Add "),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(4),e.Y8G("ngModel",t.newPlayerName)}}function Be(a,l){if(1&a&&(e.j41(0,"option",26),e.EFF(1),e.k0s()),2&a){const t=l.$implicit;e.Y8G("ngValue",t.playerId),e.R7$(1),e.SpI(" ",t.fullName," ")}}function Ve(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",21)(1,"label",24),e.EFF(2,"Player 1"),e.k0s(),e.j41(3,"select",25),e.bIt("ngModelChange",function(r){e.eBV(t);const n=e.XpG(2);return e.Njj(n.matchForm.player1Id=r)}),e.j41(4,"option",26),e.EFF(5,"Select Player 1..."),e.k0s(),e.DNE(6,Be,2,2,"option",27),e.k0s()()}if(2&a){const t=e.XpG(2);e.R7$(3),e.Y8G("ngModel",t.matchForm.player1Id),e.R7$(1),e.Y8G("ngValue",0),e.R7$(2),e.Y8G("ngForOf",t.getAllActivePlayers())}}function Ye(a,l){if(1&a&&(e.j41(0,"option",26),e.EFF(1),e.k0s()),2&a){const t=l.$implicit;e.Y8G("ngValue",t.playerId),e.R7$(1),e.SpI(" ",t.fullName," ")}}function Oe(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",21)(1,"label",24),e.EFF(2,"Player 2"),e.k0s(),e.j41(3,"select",25),e.bIt("ngModelChange",function(r){e.eBV(t);const n=e.XpG(2);return e.Njj(n.matchForm.player2Id=r)}),e.j41(4,"option",26),e.EFF(5,"Select Player 2..."),e.k0s(),e.DNE(6,Ye,2,2,"option",27),e.k0s()()}if(2&a){const t=e.XpG(2);e.R7$(3),e.Y8G("ngModel",t.matchForm.player2Id),e.R7$(1),e.Y8G("ngValue",0),e.R7$(2),e.Y8G("ngForOf",t.getOpponentsForPlayer(t.matchForm.player1Id))}}function Xe(a,l){if(1&a&&(e.j41(0,"div",21)(1,"label",24),e.EFF(2,"Player 1"),e.k0s(),e.j41(3,"div",74),e.EFF(4),e.k0s()()),2&a){const t=e.XpG(2);e.R7$(4),e.SpI(" ",t.selectedPlayerForMatch.player1Name||t.getPlayerName(t.matchForm.player1Id)," ")}}function Ue(a,l){if(1&a&&(e.j41(0,"div",21)(1,"label",24),e.EFF(2,"Player 2"),e.k0s(),e.j41(3,"div",74),e.EFF(4),e.k0s()()),2&a){const t=e.XpG(2);e.R7$(4),e.SpI(" ",t.selectedPlayerForMatch.player2Name||t.getPlayerName(t.matchForm.player2Id)," ")}}function Qe(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",58)(1,"div",68)(2,"h2",60),e.EFF(3),e.k0s(),e.DNE(4,Ve,7,3,"div",69),e.DNE(5,Oe,7,3,"div",69),e.DNE(6,Xe,5,1,"div",69),e.DNE(7,Ue,5,1,"div",69),e.j41(8,"div",70)(9,"div")(10,"label",24),e.EFF(11,"Player 1 Score"),e.k0s(),e.j41(12,"input",71),e.bIt("ngModelChange",function(r){e.eBV(t);const n=e.XpG();return e.Njj(n.matchForm.player1Score=r)})("input",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.validateScore("player1"))}),e.k0s()(),e.j41(13,"div")(14,"label",24),e.EFF(15,"Player 2 Score"),e.k0s(),e.j41(16,"input",71),e.bIt("ngModelChange",function(r){e.eBV(t);const n=e.XpG();return e.Njj(n.matchForm.player2Score=r)})("input",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.validateScore("player2"))}),e.k0s()()(),e.j41(17,"div",72)(18,"button",29),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.closeRecordMatchModal())}),e.EFF(19," Cancel "),e.k0s(),e.j41(20,"button",73),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.selectedPlayerForMatch?r.updateMatch():r.recordNewMatch())}),e.EFF(21),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(3),e.SpI(" ",t.selectedPlayerForMatch?"Edit Match":"Record New Match"," "),e.R7$(1),e.Y8G("ngIf",!t.selectedPlayerForMatch),e.R7$(1),e.Y8G("ngIf",!t.selectedPlayerForMatch),e.R7$(1),e.Y8G("ngIf",t.selectedPlayerForMatch),e.R7$(1),e.Y8G("ngIf",t.selectedPlayerForMatch),e.R7$(5),e.Y8G("ngModel",t.matchForm.player1Score),e.R7$(4),e.Y8G("ngModel",t.matchForm.player2Score),e.R7$(4),e.Y8G("disabled",!t.matchForm.player1Id||!t.matchForm.player2Id||!t.selectedPlayerForMatch&&t.matchForm.player1Id===t.matchForm.player2Id||0===t.matchForm.player1Score&&0===t.matchForm.player2Score||t.isRecordingMatch),e.R7$(1),e.SpI(" ",t.isRecordingMatch?"Processing...":t.selectedPlayerForMatch?"Update Match":"Record Match"," ")}}const He=function(a,l){return{"w-64 p-4 sm:min-h-screen":a,"w-0 p-0":l}};let Je=(()=>{class a{constructor(t,s){this.friendlyMatchService=t,this.toastr=s,this.isSidebarOpen=!1,this.players=[],this.selectedPlayer=null,this.displayMatches=[],this.showModal=!1,this.showDeleteModal=!1,this.showRecordMatchModal=!1,this.selectedPlayerToDelete=null,this.selectedPlayerForMatch=null,this.newPlayerName="",this.matchForm={player1Id:0,player2Id:0,player1Score:null,player2Score:null,playedOn:new Date},this.isRecordingMatch=!1,this.totalPlayers=0,this.totalMatches=0,this.allMatches=[],this.currentPage=1,this.itemsPerPage=10,this.totalPages=0,this.Math=Math,this.filterForm={playerId:0,opponentIds:[],dateFilter:m.Zv.AllTime},this.DateFilter=m.Zv}ngOnInit(){this.loadPlayers(),this.loadAllMatches()}toggleSidebar(){this.isSidebarOpen=!this.isSidebarOpen}loadPlayers(){this.friendlyMatchService.getAllFriendlyPlayers().subscribe({next:t=>{this.players=t,this.totalPlayers=t.length,this.calculateStatistics()},error:t=>{this.toastr.error(t.error?.message||t.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0644\u0627\u0639\u0628\u064a\u0646","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644")}})}selectPlayer(t){this.selectedPlayer=t,this.loadPlayerMatches(t.playerId)}loadPlayerMatches(t){this.friendlyMatchService.getAllFriendlyMatches().subscribe({next:s=>{const n=this.players.find(i=>i.playerId===t)?.fullName;this.displayMatches=s.filter(i=>i.player1Name===n||i.player2Name===n)},error:s=>{this.toastr.error(s.error?.message||s.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u062d\u0645\u064a\u0644 \u0645\u0628\u0627\u0631\u064a\u0627\u062a \u0627\u0644\u0644\u0627\u0639\u0628","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644")}})}calculateStatistics(){this.friendlyMatchService.getAllFriendlyMatches().subscribe({next:t=>{this.totalMatches=t.length},error:t=>{this.toastr.error(t.error?.message||t.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0625\u062d\u0635\u0627\u0626\u064a\u0627\u062a","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644")}})}openModal(){this.showModal=!0,this.newPlayerName=""}closeModal(){this.showModal=!1,this.newPlayerName=""}addPlayer(){this.newPlayerName.trim()?this.friendlyMatchService.addFriendlyPlayerAsync(this.newPlayerName).subscribe({next:t=>{t.success?(this.toastr.success(`\u062a\u0645 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0644\u0627\u0639\u0628 ${this.newPlayerName} \u0628\u0646\u062c\u0627\u062d`,"\u062a\u0645 \u0627\u0644\u0625\u0636\u0627\u0641\u0629"),this.friendlyMatchService.refreshFriendlyPlayers(),this.loadPlayers(),this.closeModal()):this.toastr.error(t.message||"\u0641\u0634\u0644 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0644\u0627\u0639\u0628","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u0625\u0636\u0627\u0641\u0629")},error:t=>{this.toastr.error(t.error?.message||t.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0644\u0627\u0639\u0628","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u0625\u0636\u0627\u0641\u0629")}}):this.toastr.warning("\u0627\u0644\u0631\u062c\u0627\u0621 \u0625\u062f\u062e\u0627\u0644 \u0627\u0633\u0645 \u0627\u0644\u0644\u0627\u0639\u0628","\u062a\u062d\u0630\u064a\u0631")}confirmDelete(t,s){s.stopPropagation(),this.selectedPlayerToDelete=t,this.showDeleteModal=!0}deleteConfirmedPlayer(){this.selectedPlayerToDelete&&(this.friendlyMatchService.deleteFriendlyPlayerAsync(this.selectedPlayerToDelete.playerId).subscribe({next:t=>{t.success?(this.toastr.success(`\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0644\u0627\u0639\u0628 ${this.selectedPlayerToDelete.fullName} \u0628\u0646\u062c\u0627\u062d`,"\u062a\u0645 \u0627\u0644\u062d\u0630\u0641"),this.friendlyMatchService.refreshFriendlyPlayers(),this.loadPlayers(),this.selectedPlayer?.playerId===this.selectedPlayerToDelete.playerId&&(this.selectedPlayer=null,this.displayMatches=[])):this.toastr.error(t.message||"\u0641\u0634\u0644 \u062d\u0630\u0641 \u0627\u0644\u0644\u0627\u0639\u0628","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062d\u0630\u0641")},error:t=>{this.toastr.error(t.error?.message||t.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0630\u0641 \u0627\u0644\u0644\u0627\u0639\u0628","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062d\u0630\u0641")}}),this.showDeleteModal=!1,this.selectedPlayerToDelete=null)}getActivePlayersCount(){return this.players.filter(t=>t.isActive).length}getRecentMatches(){return this.displayMatches.slice(0,10)}openRecordMatchModal(t){this.selectedPlayerForMatch=t||null,this.matchForm.player1Id=t?.playerId||0,this.matchForm.player2Id=0,this.matchForm.player1Score=null,this.matchForm.player2Score=null,this.matchForm.playedOn=new Date,this.showRecordMatchModal=!0}closeRecordMatchModal(){this.showRecordMatchModal=!1,this.selectedPlayerForMatch=null,this.matchForm={player1Id:0,player2Id:0,player1Score:0,player2Score:0,playedOn:new Date}}recordNewMatch(){if(!this.matchForm.player1Id||!this.matchForm.player2Id)return void this.toastr.warning("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u0643\u0644\u0627 \u0627\u0644\u0644\u0627\u0639\u0628\u064a\u0646","\u062a\u062d\u0630\u064a\u0631");if(!this.selectedPlayerForMatch&&this.matchForm.player1Id===this.matchForm.player2Id)return void this.toastr.warning("\u0644\u0627 \u064a\u0645\u0643\u0646 \u0623\u0646 \u064a\u0643\u0648\u0646 \u0627\u0644\u0644\u0627\u0639\u0628 \u0627\u0644\u0623\u0648\u0644 \u0648\u0627\u0644\u062b\u0627\u0646\u064a \u0646\u0641\u0633 \u0627\u0644\u0634\u062e\u0635","\u062a\u062d\u0630\u064a\u0631");if(null===this.matchForm.player1Score||null===this.matchForm.player2Score)return void this.toastr.warning("\u0627\u0644\u0631\u062c\u0627\u0621 \u0625\u062f\u062e\u0627\u0644 \u0627\u0644\u0646\u0642\u0627\u0637 \u0644\u0643\u0644\u0627 \u0627\u0644\u0644\u0627\u0639\u0628\u064a\u0646","\u062a\u062d\u0630\u064a\u0631");if(this.matchForm.player1Score<0||this.matchForm.player2Score<0)return void this.toastr.warning("\u0644\u0627 \u064a\u0645\u0643\u0646 \u0623\u0646 \u062a\u0643\u0648\u0646 \u0627\u0644\u0646\u0642\u0627\u0637 \u0633\u0627\u0644\u0628\u0629","\u062a\u062d\u0630\u064a\u0631");if(0===this.matchForm.player1Score&&0===this.matchForm.player2Score)return void this.toastr.warning("\u064a\u062c\u0628 \u0623\u0646 \u064a\u0643\u0648\u0646 \u0644\u062f\u0649 \u0644\u0627\u0639\u0628 \u0648\u0627\u062d\u062f \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644 \u0646\u0642\u0627\u0637 \u0625\u064a\u062c\u0627\u0628\u064a\u0629 (0-0 \u063a\u064a\u0631 \u0645\u0633\u0645\u0648\u062d)","\u062a\u062d\u0630\u064a\u0631");const t={player1Id:this.matchForm.player1Id,player2Id:this.matchForm.player2Id,player1Score:this.matchForm.player1Score,player2Score:this.matchForm.player2Score,playedOn:this.matchForm.playedOn};this.isRecordingMatch=!0,this.friendlyMatchService.recordFriendlyMatchAsync(t).subscribe({next:s=>{if(s.success){const r=this.players.find(i=>i.playerId===this.matchForm.player1Id),n=this.players.find(i=>i.playerId===this.matchForm.player2Id);this.toastr.success(`\u062a\u0645 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u0645\u0628\u0627\u0631\u0627\u0629 \u0628\u0646\u062c\u0627\u062d: ${r?.fullName} (${this.matchForm.player1Score}) - ${n?.fullName} (${this.matchForm.player2Score})`,"\u062a\u0645 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u0645\u0628\u0627\u0631\u0627\u0629"),this.friendlyMatchService.refreshFriendlyMatches(),this.friendlyMatchService.refreshFriendlyPlayers(),this.loadPlayers(),this.calculateStatistics(),this.selectedPlayer&&this.loadPlayerMatches(this.selectedPlayer.playerId),this.loadAllMatches(),this.closeRecordMatchModal()}else this.toastr.error(s.message||"\u0641\u0634\u0644 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u0645\u0628\u0627\u0631\u0627\u0629","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u0633\u062c\u064a\u0644");this.isRecordingMatch=!1},error:s=>{this.toastr.error(s.error?.message||s.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u0633\u062c\u064a\u0644 \u0627\u0644\u0645\u0628\u0627\u0631\u0627\u0629","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u0633\u062c\u064a\u0644"),this.isRecordingMatch=!1}})}getOpponentsForPlayer(t){return this.players.filter(s=>s.playerId!==t&&!1!==s.isActive)}getAllActivePlayers(){return this.players.filter(t=>!1!==t.isActive)}validateScore(t){"player1"===t?null!==this.matchForm.player1Score&&this.matchForm.player1Score<0&&(this.matchForm.player1Score=0):null!==this.matchForm.player2Score&&this.matchForm.player2Score<0&&(this.matchForm.player2Score=0)}loadAllMatches(){this.friendlyMatchService.getAllFriendlyMatches().subscribe({next:t=>{this.allMatches=t.sort((s,r)=>new Date(r.playedOn).getTime()-new Date(s.playedOn).getTime()),this.totalMatches=t.length,this.totalPages=Math.ceil(this.allMatches.length/this.itemsPerPage)},error:t=>{this.toastr.error(t.error?.message||t.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0645\u0628\u0627\u0631\u064a\u0627\u062a","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644")}})}loadFilteredMatchesFromCache(){this.friendlyMatchService.getAllFriendlyMatches().subscribe({next:t=>{let s=[...t];if(this.filterForm.dateFilter!==m.Zv.AllTime){const r=new Date;let n;switch(this.filterForm.dateFilter){case m.Zv.Today:n=new Date(r.getFullYear(),r.getMonth(),r.getDate());break;case m.Zv.Last3Days:n=new Date(r.getTime()-2592e5);break;case m.Zv.LastWeek:n=new Date(r.getTime()-6048e5);break;case m.Zv.LastMonth:n=new Date(r.getTime()-2592e6);break;default:n=new Date(0)}s=s.filter(i=>new Date(i.playedOn)>=n)}if(this.filterForm.playerId){const n=this.players.find(i=>i.playerId===this.filterForm.playerId)?.fullName;s=s.filter(i=>i.player1Name===n||i.player2Name===n),s=this.reorderMatchesForSelectedPlayer(s,n)}if(this.filterForm.opponentIds&&this.filterForm.opponentIds.length>0){const r=this.filterForm.opponentIds.map(n=>this.players.find(o=>o.playerId===n)?.fullName).filter(n=>n);s=s.filter(n=>r.includes(n.player1Name)||r.includes(n.player2Name))}s.sort((r,n)=>new Date(n.playedOn).getTime()-new Date(r.playedOn).getTime()),this.allMatches=s,this.totalMatches=s.length,this.totalPages=Math.ceil(this.allMatches.length/this.itemsPerPage)},error:t=>{this.toastr.error(t.error?.message||t.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0645\u0628\u0627\u0631\u064a\u0627\u062a \u0627\u0644\u0645\u0641\u0644\u062a\u0631\u0629","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644")}})}reorderMatchesForSelectedPlayer(t,s){return t.map(r=>r.player1Name===s?r:r.player2Name===s?{...r,player1Name:r.player2Name,player2Name:r.player1Name,player1Score:r.player2Score,player2Score:r.player1Score,player1Id:r.player2Id,player2Id:r.player1Id}:r)}loadFilteredMatches(){const t={page:this.currentPage,pageSize:this.itemsPerPage,dateFilter:this.filterForm.dateFilter};this.filterForm.playerId&&(t.playerId=this.filterForm.playerId),this.filterForm.opponentIds&&this.filterForm.opponentIds.length>0&&(t.opponentIds=this.filterForm.opponentIds),this.friendlyMatchService.getFilteredMatches(t).subscribe({next:s=>{this.allMatches=s.matches,this.totalMatches=s.totalCount,this.totalPages=s.totalPages},error:s=>{this.toastr.error(s.error?.message||s.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u062d\u0645\u064a\u0644 \u0627\u0644\u0645\u0628\u0627\u0631\u064a\u0627\u062a \u0627\u0644\u0645\u0641\u0644\u062a\u0631\u0629","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644")}})}onFilterChange(){this.currentPage=1,this.loadFilteredMatchesFromCache()}clearFilters(){this.filterForm={playerId:0,opponentIds:[],dateFilter:m.Zv.AllTime},this.currentPage=1,this.loadAllMatches()}getPaginatedMatches(){const t=(this.currentPage-1)*this.itemsPerPage;return this.allMatches.slice(t,t+this.itemsPerPage)}changePage(t){t>=1&&t<=this.totalPages&&(this.currentPage=t)}getPlayerName(t){const s=this.players.find(r=>r.playerId===t);return s?s.fullName:"Unknown Player"}editMatch(t){const s=this.players.find(n=>n.fullName===t.player1Name),r=this.players.find(n=>n.fullName===t.player2Name);this.matchForm={player1Id:s?.playerId||0,player2Id:r?.playerId||0,player1Score:t.player1Score,player2Score:t.player2Score,playedOn:new Date(t.playedOn)},this.selectedPlayerForMatch=t,this.showRecordMatchModal=!0}updateMatch(){if(this.selectedPlayerForMatch){if(!this.matchForm.player1Id||!this.matchForm.player2Id)return void this.toastr.warning("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u0643\u0644\u0627 \u0627\u0644\u0644\u0627\u0639\u0628\u064a\u0646","\u062a\u062d\u0630\u064a\u0631");if(null===this.matchForm.player1Score||null===this.matchForm.player2Score)return void this.toastr.warning("\u0627\u0644\u0631\u062c\u0627\u0621 \u0625\u062f\u062e\u0627\u0644 \u0627\u0644\u0646\u0642\u0627\u0637 \u0644\u0643\u0644\u0627 \u0627\u0644\u0644\u0627\u0639\u0628\u064a\u0646","\u062a\u062d\u0630\u064a\u0631");if(this.matchForm.player1Score<0||this.matchForm.player2Score<0)return void this.toastr.warning("\u0644\u0627 \u064a\u0645\u0643\u0646 \u0623\u0646 \u062a\u0643\u0648\u0646 \u0627\u0644\u0646\u0642\u0627\u0637 \u0633\u0627\u0644\u0628\u0629","\u062a\u062d\u0630\u064a\u0631");if(0===this.matchForm.player1Score&&0===this.matchForm.player2Score)return void this.toastr.warning("\u064a\u062c\u0628 \u0623\u0646 \u064a\u0643\u0648\u0646 \u0644\u062f\u0649 \u0644\u0627\u0639\u0628 \u0648\u0627\u062d\u062f \u0639\u0644\u0649 \u0627\u0644\u0623\u0642\u0644 \u0646\u0642\u0627\u0637 \u0625\u064a\u062c\u0627\u0628\u064a\u0629 (0-0 \u063a\u064a\u0631 \u0645\u0633\u0645\u0648\u062d)","\u062a\u062d\u0630\u064a\u0631");this.isRecordingMatch=!0,this.friendlyMatchService.updateFriendlyMatchAsync(this.selectedPlayerForMatch.matchId,{player1Id:this.matchForm.player1Id,player2Id:this.matchForm.player2Id,player1Score:this.matchForm.player1Score,player2Score:this.matchForm.player2Score}).subscribe({next:t=>{if(t.success){const s=this.players.find(n=>n.playerId===this.matchForm.player1Id),r=this.players.find(n=>n.playerId===this.matchForm.player2Id);this.toastr.success(`\u062a\u0645 \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0645\u0628\u0627\u0631\u0627\u0629 \u0628\u0646\u062c\u0627\u062d: ${s?.fullName} (${this.matchForm.player1Score}) - ${r?.fullName} (${this.matchForm.player2Score})`,"\u062a\u0645 \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0645\u0628\u0627\u0631\u0627\u0629"),this.friendlyMatchService.refreshFriendlyMatches(),this.loadAllMatches(),this.calculateStatistics(),this.selectedPlayer&&this.loadPlayerMatches(this.selectedPlayer.playerId),this.closeRecordMatchModal()}else this.toastr.error(t.message||"\u0641\u0634\u0644 \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0645\u0628\u0627\u0631\u0627\u0629","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u062d\u062f\u064a\u062b");this.isRecordingMatch=!1},error:t=>{this.toastr.error(t.error?.message||t.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0645\u0628\u0627\u0631\u0627\u0629","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u062d\u062f\u064a\u062b"),this.isRecordingMatch=!1}})}}deleteMatchFromList(t){confirm("\u0647\u0644 \u0623\u0646\u062a \u0645\u062a\u0623\u0643\u062f \u0645\u0646 \u062d\u0630\u0641 \u0647\u0630\u0647 \u0627\u0644\u0645\u0628\u0627\u0631\u0627\u0629\u061f")&&this.friendlyMatchService.deleteFriendlyMatchAsync(t).subscribe({next:s=>{s.success?(this.toastr.success("\u062a\u0645 \u062d\u0630\u0641 \u0627\u0644\u0645\u0628\u0627\u0631\u0627\u0629 \u0628\u0646\u062c\u0627\u062d","\u062a\u0645 \u0627\u0644\u062d\u0630\u0641"),this.friendlyMatchService.refreshFriendlyMatches(),this.loadAllMatches(),this.calculateStatistics(),this.selectedPlayer&&this.loadPlayerMatches(this.selectedPlayer.playerId)):this.toastr.error(s.message||"\u0641\u0634\u0644 \u062d\u0630\u0641 \u0627\u0644\u0645\u0628\u0627\u0631\u0627\u0629","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062d\u0630\u0641")},error:s=>{this.toastr.error(s.error?.message||s.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062d\u0630\u0641 \u0627\u0644\u0645\u0628\u0627\u0631\u0627\u0629","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062d\u0630\u0641")}})}static{this.\u0275fac=function(s){return new(s||a)(e.rXU(we.w),e.rXU(F.tw))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-friendlies"]],decls:83,vars:25,consts:[[1,"block","sm:flex","transition-all","duration-600"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","text-white","transition-all","duration-600",3,"ngClass"],[1,"text-lg","font-bold","mb-4","flex","justify-between","overflow-hidden","text-white"],[1,"text-gray-300","text-3xl",3,"click"],[4,"ngIf"],["class","mt-4 w-full bg-green-600 p-2 rounded text-white hover:bg-green-700 transition",3,"click",4,"ngIf"],[1,"sm:flex-1","sm:p-2","transition-all","duration-600","sm:container","sm:mx-auto"],["class","sm:w-4/6 mx-auto",4,"ngIf"],[1,"my-3","border-gray-600"],[1,"flex","justify-evenly","pt-5"],[1,"bg-blue-600","text-white","px-3","py-2","rounded","mb-4","hover:bg-blue-700","transition",3,"click"],["routerLink","/admin/friendly-inbox",1,"bg-purple-600","hover:bg-purple-700","text-white","mb-4","px-3","py-2","rounded","transition-all"],[1,"text-center","mb-8"],[1,"mb-4","text-4xl","font-extrabold","leading-none","tracking-tight","md:text-4xl","lg:text-4xl","text-white"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-2","gap-4"],[1,"bg-teal-600","text-white","p-4","rounded-lg","hover:bg-teal-700","transition-all",3,"disabled","click"],[1,"text-lg","font-bold"],[1,"text-sm"],[1,"bg-green-600","text-white","p-4","rounded-lg","hover:bg-green-700","transition-all",3,"click"],[1,"mt-8"],[1,"mb-6","p-2","bg-gray-800","rounded-lg"],[1,"mb-4"],[1,"text-lg","font-semibold","text-white"],[1,"grid","grid-cols-2","md:grid-cols-2","gap-4"],[1,"block","text-sm","font-medium","mb-1","text-gray-300"],[1,"border","border-gray-600","p-2","w-full","rounded","bg-gray-800","text-white",3,"ngModel","ngModelChange"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"flex","justify-center","mt-4"],[1,"bg-gray-600","px-4","py-2","text-white","rounded","hover:bg-gray-700","transition",3,"click"],[1,"overflow-x-auto"],[1,"w-full","text-white"],[1,"text-center"],[1,"border-b","border-gray-600","text-center"],[1,"p-3"],["class","border-b border-gray-700 hover:bg-gray-800",4,"ngFor","ngForOf"],["class","flex justify-center mt-6",4,"ngIf"],[1,"text-center","mt-4","text-gray-300"],["class","fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-50",4,"ngIf"],["class","flex items-center justify-between p-2 cursor-pointer rounded-md hover:bg-gray-700",3,"bg-blue-600","click",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-2","cursor-pointer","rounded-md","hover:bg-gray-700",3,"click"],[1,"text-white","cursor-pointer","hover:text-blue-300",3,"click"],[1,"bg-red-600","px-2","py-1","text-sm","rounded","text-white","hover:bg-red-700","transition",3,"click"],[1,"mt-4","w-full","bg-green-600","p-2","rounded","text-white","hover:bg-green-700","transition",3,"click"],[1,"sm:w-4/6","mx-auto"],[1,"text-2xl","font-bold","mb-4","text-center","text-white"],[1,"border-b","border-gray-700","hover:bg-gray-800"],[1,"p-3","text-center"],[1,"font-bold","text-lg"],[1,"flex","justify-center","space-x-2"],[1,"bg-blue-600","px-3","py-1","text-white","rounded","hover:bg-blue-700","transition","text-sm",3,"click"],[1,"bg-red-600","px-3","py-1","text-white","rounded","hover:bg-red-700","transition","text-sm",3,"click"],[1,"flex","justify-center","mt-6"],[1,"flex","space-x-2"],[1,"bg-gray-600","px-3","py-2","text-white","rounded","hover:bg-gray-700","transition",3,"disabled","click"],["class","flex",4,"ngFor","ngForOf"],[1,"flex"],[1,"px-3","py-2","text-white","rounded","transition",3,"click"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-75","z-50"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","p-6","rounded-lg"],[1,"text-lg","font-bold","mb-4","text-white"],[1,"text-gray-300"],[1,"mt-4","flex","justify-end"],[1,"bg-gray-600","px-4","py-2","text-white","rounded","mr-2","hover:bg-gray-700","transition",3,"click"],[1,"bg-red-600","px-4","py-2","text-white","rounded","hover:bg-red-700","transition",3,"click"],["type","text","placeholder","Enter player name",1,"border","border-gray-600","p-2","w-full","bg-gray-800","text-white","rounded","placeholder-gray-400",3,"ngModel","ngModelChange"],[1,"bg-red-600","px-4","py-2","text-white","rounded","mr-2","hover:bg-red-700","transition",3,"click"],[1,"bg-green-600","px-4","py-2","text-white","rounded","hover:bg-green-700","transition",3,"click"],[1,"bg-black","bg-opacity-50","backdrop-blur-sm","p-6","rounded-lg","w-96","max-h-[90vh]","overflow-y-auto"],["class","mb-4",4,"ngIf"],[1,"grid","grid-cols-2","gap-4","mb-4"],["type","number","min","0","placeholder","Enter score",1,"border","border-gray-600","p-2","w-full","rounded","bg-gray-800","text-white","placeholder-gray-400",3,"ngModel","ngModelChange","input"],[1,"flex","justify-end","space-x-4"],[1,"bg-green-600","px-4","py-2","text-white","rounded","hover:bg-green-700","transition",3,"disabled","click"],[1,"border","border-gray-600","p-2","w-full","rounded","bg-gray-700","text-white"]],template:function(s,r){1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"h2",2),e.EFF(3," Friendly Players "),e.j41(4,"button",3),e.bIt("click",function(){return r.toggleSidebar()}),e.EFF(5," \xd7 "),e.k0s()(),e.DNE(6,Pe,2,1,"ul",4),e.DNE(7,De,2,0,"button",5),e.k0s(),e.j41(8,"div",6),e.DNE(9,Ee,3,1,"div",7),e.nrm(10,"hr",8),e.j41(11,"div")(12,"div",9)(13,"button",10),e.bIt("click",function(){return r.toggleSidebar()}),e.EFF(14," \u2630 Players "),e.k0s(),e.j41(15,"button",11),e.EFF(16," \u{1f4ec} Friendly Inbox "),e.k0s()(),e.j41(17,"div",12)(18,"h2",13),e.EFF(19," Quick Actions "),e.k0s(),e.j41(20,"div",14)(21,"button",15),e.bIt("click",function(){return r.openRecordMatchModal()}),e.j41(22,"h3",16),e.EFF(23,"Record Match"),e.k0s(),e.j41(24,"p",17),e.EFF(25,"Record a new friendly match"),e.k0s()(),e.j41(26,"button",18),e.bIt("click",function(){return r.openModal()}),e.j41(27,"h3",16),e.EFF(28,"Add New Player"),e.k0s(),e.j41(29,"p",17),e.EFF(30,"Register a new friendly player"),e.k0s()()()()(),e.j41(31,"div",19)(32,"div",20)(33,"div",21)(34,"h4",22),e.EFF(35,"Filter Matches"),e.k0s()(),e.j41(36,"div",23)(37,"div")(38,"label",24),e.EFF(39,"Date Range"),e.k0s(),e.j41(40,"select",25),e.bIt("ngModelChange",function(i){return r.filterForm.dateFilter=i})("ngModelChange",function(){return r.onFilterChange()}),e.j41(41,"option",26),e.EFF(42,"All Time"),e.k0s(),e.j41(43,"option",26),e.EFF(44,"Today"),e.k0s(),e.j41(45,"option",26),e.EFF(46,"Last 3 Days"),e.k0s(),e.j41(47,"option",26),e.EFF(48,"Last Week"),e.k0s(),e.j41(49,"option",26),e.EFF(50,"Last Month"),e.k0s()()(),e.j41(51,"div")(52,"label",24),e.EFF(53,"Player"),e.k0s(),e.j41(54,"select",25),e.bIt("ngModelChange",function(i){return r.filterForm.playerId=i})("ngModelChange",function(){return r.onFilterChange()}),e.j41(55,"option",26),e.EFF(56,"All Players"),e.k0s(),e.DNE(57,Re,2,2,"option",27),e.k0s()()(),e.j41(58,"div",28)(59,"button",29),e.bIt("click",function(){return r.clearFilters()}),e.EFF(60," Clear Filters "),e.k0s()()(),e.j41(61,"div",30)(62,"table",31)(63,"thead",32)(64,"tr",33)(65,"th",34),e.EFF(66,"Date"),e.k0s(),e.j41(67,"th",34),e.EFF(68,"Player 1"),e.k0s(),e.j41(69,"th",34),e.EFF(70,"Score"),e.k0s(),e.j41(71,"th",34),e.EFF(72,"Player 2"),e.k0s(),e.j41(73,"th",34),e.EFF(74,"Actions"),e.k0s()()(),e.j41(75,"tbody"),e.DNE(76,Ne,17,8,"tr",35),e.k0s()()(),e.DNE(77,$e,7,4,"div",36),e.j41(78,"div",37),e.EFF(79),e.k0s()()(),e.DNE(80,Ae,14,1,"div",38),e.DNE(81,Le,10,1,"div",38),e.DNE(82,Qe,22,9,"div",38),e.k0s()),2&s&&(e.R7$(1),e.Y8G("ngClass",e.l_i(22,He,r.isSidebarOpen,!r.isSidebarOpen)),e.R7$(5),e.Y8G("ngIf",r.isSidebarOpen),e.R7$(1),e.Y8G("ngIf",r.isSidebarOpen),e.R7$(2),e.Y8G("ngIf",r.selectedPlayer),e.R7$(12),e.Y8G("disabled",0===r.players.length),e.R7$(19),e.Y8G("ngModel",r.filterForm.dateFilter),e.R7$(1),e.Y8G("ngValue",r.DateFilter.AllTime),e.R7$(2),e.Y8G("ngValue",r.DateFilter.Today),e.R7$(2),e.Y8G("ngValue",r.DateFilter.Last3Days),e.R7$(2),e.Y8G("ngValue",r.DateFilter.LastWeek),e.R7$(2),e.Y8G("ngValue",r.DateFilter.LastMonth),e.R7$(5),e.Y8G("ngModel",r.filterForm.playerId),e.R7$(1),e.Y8G("ngValue",0),e.R7$(2),e.Y8G("ngForOf",r.getAllActivePlayers()),e.R7$(19),e.Y8G("ngForOf",r.getPaginatedMatches()),e.R7$(1),e.Y8G("ngIf",r.totalPages>1),e.R7$(2),e.E5c(" Showing ",(r.currentPage-1)*r.itemsPerPage+1," - ",r.Math.min(r.currentPage*r.itemsPerPage,r.allMatches.length)," of ",r.allMatches.length," matches "),e.R7$(1),e.Y8G("ngIf",r.showDeleteModal),e.R7$(1),e.Y8G("ngIf",r.showModal),e.R7$(1),e.Y8G("ngIf",r.showRecordMatchModal))},dependencies:[u.YU,u.Sq,u.bT,b.Wk,d.xH,d.y7,d.me,d.Q0,d.wz,d.BC,d.VZ,d.vS,u.vh],styles:["[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#1f2937}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#4b5563;border-radius:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#6b7280}*[_ngcontent-%COMP%]{transition:all .3s ease}button[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 8px #0003}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#3b82f61a!important}.modal-backdrop[_ngcontent-%COMP%]{-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}.loading[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}@media (max-width: 768px){.sidebar[_ngcontent-%COMP%]{position:fixed;z-index:1000}}input[_ngcontent-%COMP%]:focus, button[_ngcontent-%COMP%]:focus{outline:2px solid #3b82f6;outline-offset:2px}.status-active[_ngcontent-%COMP%]{color:#10b981}.status-inactive[_ngcontent-%COMP%]{color:#ef4444}.score-winner[_ngcontent-%COMP%]{color:#10b981;font-weight:700}.score-loser[_ngcontent-%COMP%]{color:#ef4444}.score-draw[_ngcontent-%COMP%]{color:#f59e0b}\n\n/*# sourceMappingURL=friendlies.component.css.map*/"]})}}return a})();var We=c(4551);const ze=["messagesContainer"];function Ze(a,l){1&a&&(e.j41(0,"div",9),e.EFF(1," No friendly messages here \u{1f4ed} "),e.k0s())}function Ke(a,l){if(1&a&&(e.j41(0,"span",16),e.EFF(1),e.k0s()),2&a){const t=e.XpG().$implicit;e.R7$(1),e.SpI(" ",t.unreadCount," ")}}function qe(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",12),e.bIt("click",function(){const n=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.openChat(n.senderId))}),e.j41(1,"div")(2,"p",13),e.EFF(3),e.k0s(),e.j41(4,"p",14),e.EFF(5),e.k0s()(),e.DNE(6,Ke,2,1,"span",15),e.k0s()}if(2&a){const t=l.$implicit;e.R7$(3),e.JRh(t.senderFullName),e.R7$(2),e.JRh(t.lastMessage),e.R7$(1),e.Y8G("ngIf",t.unreadCount>0)}}function et(a,l){if(1&a&&(e.j41(0,"div",10),e.DNE(1,qe,7,3,"div",11),e.k0s()),2&a){const t=e.XpG();e.R7$(1),e.Y8G("ngForOf",t.playerChats)("ngForTrackBy",t.trackByPlayerId)}}const tt=function(a,l){return{"text-right":a,"text-left":l}},st=function(a,l){return{"bg-green-700":a,"bg-gray-700 ":l}};function rt(a,l){if(1&a&&(e.j41(0,"div",31)(1,"div",32)(2,"p",33),e.EFF(3),e.k0s(),e.j41(4,"p",34),e.EFF(5),e.nI1(6,"date"),e.k0s()()()),2&a){const t=l.$implicit;e.Y8G("ngClass",e.l_i(7,tt,!t.isFromAdmin,t.isFromAdmin)),e.R7$(1),e.Y8G("ngClass",e.l_i(10,st,!t.isFromAdmin,t.isFromAdmin)),e.R7$(2),e.JRh(t.content),e.R7$(2),e.SpI(" ",e.i5U(6,4,t.sentAt,"MMM d, y, hh:mm a")," ")}}const E=function(a){return{"sm:left-1/3":a}},at=function(){return{standalone:!0}};function nt(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",17)(1,"div",18)(2,"div",19)(3,"button",20),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.closeChat())}),e.nrm(4,"i",21),e.k0s(),e.j41(5,"div")(6,"p",22),e.EFF(7),e.k0s(),e.j41(8,"p",23),e.EFF(9),e.k0s()()()(),e.j41(10,"div",24,25),e.DNE(12,rt,7,13,"div",26),e.k0s(),e.j41(13,"div",27)(14,"form",28),e.bIt("ngSubmit",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.sendReply())}),e.j41(15,"input",29),e.bIt("ngModelChange",function(r){e.eBV(t);const n=e.XpG();return e.Njj(n.replyMessages[n.selectedChat.messages[0].id]=r)})("ngModelChange",function(r){e.eBV(t);const n=e.XpG();return e.Njj(n.replyMessages[n.selectedChat.messages[0].id]=r)}),e.k0s(),e.j41(16,"button",30),e.EFF(17," Reply "),e.k0s()()()()}if(2&a){const t=e.XpG();e.R7$(1),e.xc7("top",t.navbarHeight,"px"),e.Y8G("ngClass",e.eq3(13,E,t.selectedChat)),e.R7$(6),e.SpI(" ",t.selectedChat.senderFullName," "),e.R7$(2),e.SpI(" ",t.selectedChat.senderPhoneNumber," "),e.R7$(1),e.xc7("margin-top",t.navbarHeight+80,"px"),e.R7$(2),e.Y8G("ngForOf",t.selectedChat.messages)("ngForTrackBy",t.trackByMessageId),e.R7$(1),e.Y8G("ngClass",e.eq3(15,E,t.selectedChat)),e.R7$(2),e.Y8G("ngModel",t.replyMessages[t.selectedChat.messages[0].id])("ngModelOptions",e.lJ4(17,at)),e.R7$(1),e.Y8G("disabled",!t.replyMessages[t.selectedChat.messages[0].id])}}function it(a,l){1&a&&(e.j41(0,"div",35),e.EFF(1," Select a friendly chat to view messages \u{1f4e9} "),e.k0s())}const lt=function(a){return{hidden:a}},ot=function(a,l){return{block:a,"hidden sm:flex":l}},ct=[{path:"",component:P},{path:"players",component:P},{path:"inbox",component:je},{path:"friendlies",component:Je},{path:"friendly-inbox",component:(()=>{class a{constructor(t,s,r){this.friendlyMessageService=t,this.toastr=s,this.cdr=r,this.playerChats=[],this.selectedPlayerId=null,this.selectedChat=null,this.replyMessages={},this.navbarHeight=60}ngOnInit(){this.loadFriendlyMessages()}ngOnDestroy(){this.updateStatusSubscription&&this.updateStatusSubscription.unsubscribe(),this.refreshSubscription&&this.refreshSubscription.unsubscribe()}loadFriendlyMessages(){this.friendlyMessageService.getAllMessages().subscribe({next:t=>{if(t.success&&t.messages){const s=this.groupMessagesBySender(t.messages);this.playerChats=s.sort((i,o)=>new Date(o.lastMessageDate).getTime()-new Date(i.lastMessageDate).getTime()),t.messages.filter(i=>!i.isRead&&!i.isFromAdmin)}else this.toastr.error(t.message||"\u0644\u0627 \u064a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644 \u0648\u062f\u064a\u0629")},error:t=>{this.toastr.error(t.error?.message||t.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062c\u0644\u0628 \u0627\u0644\u0631\u0633\u0627\u0626\u0644")}})}refreshMessages(){this.friendlyMessageService.getAllMessages().subscribe({next:t=>{if(t.success&&t.messages){const s=this.groupMessagesBySender(t.messages);this.playerChats=s.sort((i,o)=>new Date(o.lastMessageDate).getTime()-new Date(i.lastMessageDate).getTime());const r=t.messages.length,n=t.messages.filter(i=>!i.isRead&&!i.isFromAdmin).length;r>0?this.toastr.info(`\u062a\u0645 \u062a\u062d\u062f\u064a\u062b ${r} \u0631\u0633\u0627\u0644\u0629${n>0?` (${n} \u0631\u0633\u0627\u0644\u0629 \u063a\u064a\u0631 \u0645\u0642\u0631\u0648\u0621\u0629)`:""}`,"\u062a\u0645 \u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0631\u0633\u0627\u0626\u0644"):this.toastr.info("\u0644\u0627 \u062a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644 \u0648\u062f\u064a\u0629 \u062d\u0627\u0644\u064a\u0627\u064b","\u0645\u0639\u0644\u0648\u0645\u0627\u062a")}else this.toastr.error(t.message||"\u0644\u0627 \u064a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644 \u0648\u062f\u064a\u0629")},error:t=>{this.toastr.error(t.error?.message||t.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062c\u0644\u0628 \u0627\u0644\u0631\u0633\u0627\u0626\u0644")}})}ngAfterViewChecked(){this.selectedChat&&this.messagesContainer&&this.scrollToBottom()}groupMessagesBySender(t){const s={};return t.forEach(n=>{let i=n.senderId||n.playerId;if(("string"!=typeof i||!i.includes("-"))&&"string"==typeof i){const o=parseInt(i,10);!isNaN(o)&&o>0&&(i=o)}i&&(s[i]||(s[i]={senderId:String(i),senderFullName:n.senderFullName||n.playerFullName||`\u0627\u0644\u0644\u0627\u0639\u0628 ${i}`,senderPhoneNumber:n.senderPhoneNumber||"\u063a\u064a\u0631 \u0645\u062a\u0648\u0641\u0631",lastMessage:"",lastMessageDate:"",unreadCount:0,messages:[]}),s[i].messages.push(n),!n.isFromAdmin&&!n.isRead&&s[i].unreadCount++)}),Object.values(s).map(n=>{n.messages=n.messages.sort((o,g)=>new Date(o.sentAt).getTime()-new Date(g.sentAt).getTime());const i=n.messages[n.messages.length-1];return n.lastMessage=i?.content??"",n.lastMessageDate=i?.sentAt??"",n})}openChat(t){this.selectedPlayerId=t,this.selectedChat=this.playerChats.find(s=>s.senderId===t)||null,this.selectedChat&&(this.selectedChat.senderFullName||(this.selectedChat.senderFullName=`\u0627\u0644\u0644\u0627\u0639\u0628 ${this.selectedChat.senderId}`),this.selectedChat.messages.filter(s=>!s.isRead&&!s.isFromAdmin).forEach(s=>{this.friendlyMessageService.markMessageAsRead(s.id).subscribe({next:r=>{r.success&&(s.isRead=!0,this.selectedChat.unreadCount=this.selectedChat.messages.filter(n=>!n.isRead&&!n.isFromAdmin).length,this.cdr.detectChanges())},error:r=>{this.toastr.error(r.error?.message||r.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u062a\u062d\u062f\u064a\u062b \u062d\u0627\u0644\u0629 \u0627\u0644\u0631\u0633\u0627\u0644\u0629","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u062a\u062d\u062f\u064a\u062b")}})}),this.cdr.detectChanges())}closeChat(){this.selectedPlayerId=null,this.selectedChat=null,this.replyMessages={},this.cdr.detectChanges()}sendReply(){if(!this.selectedChat)return void this.toastr.warning("\u0627\u0644\u0631\u062c\u0627\u0621 \u0627\u062e\u062a\u064a\u0627\u0631 \u0645\u062d\u0627\u062f\u062b\u0629");if(!this.selectedChat.senderId)return void this.toastr.error("\u062e\u0637\u0623: \u0645\u0639\u0631\u0641 \u0627\u0644\u0644\u0627\u0639\u0628 \u063a\u064a\u0631 \u0635\u062d\u064a\u062d");if(!this.selectedChat.messages||0===this.selectedChat.messages.length)return void this.toastr.error("\u062e\u0637\u0623: \u0644\u0627 \u062a\u0648\u062c\u062f \u0631\u0633\u0627\u0626\u0644 \u0641\u064a \u0647\u0630\u0647 \u0627\u0644\u0645\u062d\u0627\u062f\u062b\u0629");const t=this.replyMessages[this.selectedChat.messages[0].id]?.trim();t?this.friendlyMessageService.sendAdminReply(this.selectedChat.senderId,t).subscribe({next:s=>{if(s.success){this.toastr.success(`\u062a\u0645 \u0625\u0631\u0633\u0627\u0644 \u0627\u0644\u0631\u062f \u0628\u0646\u062c\u0627\u062d \u0625\u0644\u0649 ${this.selectedChat.senderFullName||`\u0627\u0644\u0644\u0627\u0639\u0628 ${this.selectedChat.senderId}`}`,"\u062a\u0645 \u0627\u0644\u0625\u0631\u0633\u0627\u0644"),this.replyMessages[this.selectedChat.messages[0].id]="";const n={id:Math.random(),senderId:this.selectedChat.senderId,senderFullName:this.selectedChat.senderFullName||`\u0627\u0644\u0644\u0627\u0639\u0628 ${this.selectedChat.senderId}`,senderPhoneNumber:this.selectedChat.senderPhoneNumber||"\u063a\u064a\u0631 \u0645\u062a\u0648\u0641\u0631",content:t,isRead:!0,sentAt:(new Date).toISOString(),isFromAdmin:!0,messageType:"admin_reply"};this.selectedChat.messages.push(n),this.selectedChat.messages.sort((i,o)=>new Date(i.sentAt).getTime()-new Date(o.sentAt).getTime()),this.selectedChat.lastMessage=t,this.selectedChat.lastMessageDate=n.sentAt,this.selectedChat.senderFullName||(this.selectedChat.senderFullName=`\u0627\u0644\u0644\u0627\u0639\u0628 ${this.selectedChat.senderId}`),this.playerChats.sort((i,o)=>new Date(o.lastMessageDate).getTime()-new Date(i.lastMessageDate).getTime()),this.selectedChat=this.playerChats.find(i=>i.senderId===this.selectedPlayerId)||null,this.cdr.detectChanges()}else this.toastr.error(s.message||"\u0641\u0634\u0644 \u0625\u0631\u0633\u0627\u0644 \u0627\u0644\u0631\u062f","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u0625\u0631\u0633\u0627\u0644")},error:s=>{this.toastr.error(s.error?.message||s.message||"\u062d\u0635\u0644 \u062e\u0637\u0623 \u0623\u062b\u0646\u0627\u0621 \u0625\u0631\u0633\u0627\u0644 \u0627\u0644\u0631\u062f","\u062e\u0637\u0623 \u0641\u064a \u0627\u0644\u0625\u0631\u0633\u0627\u0644")}}):this.toastr.warning("\u0627\u0644\u0631\u062c\u0627\u0621 \u0643\u062a\u0627\u0628\u0629 \u0631\u062f")}scrollToBottom(){if(this.messagesContainer){const t=this.messagesContainer.nativeElement;t.scrollTop=t.scrollHeight}}trackByPlayerId(t,s){return s.senderId}trackByMessageId(t,s){return s.id}static{this.\u0275fac=function(s){return new(s||a)(e.rXU(We.G),e.rXU(F.tw),e.rXU(e.gRc))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["app-friendly-inbox"]],viewQuery:function(s,r){if(1&s&&e.GBs(ze,5),2&s){let n;e.mGM(n=e.lsd())&&(r.messagesContainer=n.first)}},decls:11,vars:11,consts:[[1,"container","mx-auto","p-4","flex","flex-col","sm:flex-row","overflow-hidden","h-screen"],[1,"w-full","sm:w-1/3","border-r","border-gray-600","sm:block",3,"ngClass"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-2xl","font-bold","text-white"],["class","text-center text-gray-300",4,"ngIf"],["class","space-y-2 overflow-y-auto max-h-[calc(100vh-120px)]",4,"ngIf"],[1,"w-full","sm:w-2/3","flex","flex-col","h-full","relative",3,"ngClass"],["class","flex flex-col h-full",4,"ngIf","ngIfElse"],["noChatSelected",""],[1,"text-center","text-gray-300"],[1,"space-y-2","overflow-y-auto","max-h-[calc(100vh-120px)]"],["class","p-4 backdrop-blur-sm border border-gray-600 rounded-lg hover:bg-gray-700 cursor-pointer flex items-center justify-between",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"p-4","backdrop-blur-sm","border","border-gray-600","rounded-lg","hover:bg-gray-700","cursor-pointer","flex","items-center","justify-between",3,"click"],[1,"font-bold","text-white"],[1,"text-sm","text-gray-300","truncate"],["class","bg-green-600 text-white text-xs font-bold rounded-full px-2 py-1",4,"ngIf"],[1,"bg-green-600","text-white","text-xs","font-bold","rounded-full","px-2","py-1"],[1,"flex","flex-col","h-full"],[1,"fixed","left-0","right-0","z-40","p-2","backdrop-blur-sm","border-b","border-gray-600","flex","items-center","justify-between","bg-black","bg-opacity-90",3,"ngClass"],[1,"flex","items-center"],[1,"mr-4","text-gray-300","hover:text-white","transition",3,"click"],[1,"fa-solid","fa-arrow-left",2,"color","#ffffff"],[1,"font-bold","text-white","text-sm","p-0"],[1,"text-xs","text-gray-400","p-0"],[1,"flex-1","p-4","overflow-y-auto","backdrop-blur-sm",2,"margin-bottom","80px"],["messagesContainer",""],["class","mb-4",3,"ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"fixed","bottom-0","left-0","right-0","z-50","p-4","bg-black","bg-opacity-90","backdrop-blur-sm","border-t","border-gray-600",3,"ngClass"],[1,"flex","items-center","gap-2",3,"ngSubmit"],["type","text","placeholder","Write your reply...",1,"flex-1","p-2","border","border-gray-600","rounded-lg","bg-gray-800","text-white","focus:outline-none","focus:ring-2","focus:ring-blue-600","placeholder-gray-400",3,"ngModel","ngModelOptions","ngModelChange"],["type","submit",1,"bg-blue-600","text-white","p-2","rounded-lg","hover:bg-blue-700","transition","disabled:bg-gray-600",3,"disabled"],[1,"mb-4",3,"ngClass"],[1,"inline-block","p-3","rounded-lg","max-w-xs",3,"ngClass"],[1,"text-white"],[1,"text-xs","mt-1","text-gray-300"],[1,"w-full","flex","items-center","justify-center","text-gray-300"]],template:function(s,r){if(1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),e.EFF(4,"\u{1f4ec} Friendly Inbox"),e.k0s()(),e.DNE(5,Ze,2,0,"div",4),e.DNE(6,et,2,2,"div",5),e.k0s(),e.j41(7,"div",6),e.DNE(8,nt,18,18,"div",7),e.DNE(9,it,2,0,"ng-template",null,8,e.C5r),e.k0s()()),2&s){const n=e.sdS(10);e.R7$(1),e.Y8G("ngClass",e.eq3(6,lt,r.selectedChat)),e.R7$(4),e.Y8G("ngIf",0===r.playerChats.length),e.R7$(1),e.Y8G("ngIf",r.playerChats.length>0),e.R7$(1),e.Y8G("ngClass",e.l_i(8,ot,r.selectedChat,!r.selectedChat)),e.R7$(1),e.Y8G("ngIf",r.selectedChat)("ngIfElse",n)}},dependencies:[u.YU,u.Sq,u.bT,d.qT,d.me,d.BC,d.cb,d.vS,d.cV,u.vh]})}}return a})()}];let dt=(()=>{class a{static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[b.iI.forChild(ct),b.iI]})}}return a})();var ht=c(6443),ut=c(8902),gt=c(3887);let pt=(()=>{class a{static{this.\u0275fac=function(s){return new(s||a)}}static{this.\u0275mod=e.$C({type:a})}static{this.\u0275inj=e.G2t({imports:[u.MD,dt,d.YN,ht.q1,ut.PlayerModule,gt.G]})}}return a})()}}]);
//# sourceMappingURL=185.f551047c380bf8d0.js.map