<div class="container mx-auto p-4 max-w-7xl">
  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-white mb-2">👥 Teams Tournament</h1>
    <p class="text-gray-400">View teams standings and tournament progress</p>
  </div>

  <!-- Tabs Navigation -->
  <div class="mb-6">
    <div class="border-b border-gray-700">
      <nav class="-mb-px flex space-x-8">
        <button
          (click)="activeTab = 'current'"
          [class]="
            activeTab === 'current'
              ? 'border-blue-500 text-blue-400 border-b-2 py-2 px-1 text-sm font-medium'
              : 'border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300 border-b-2 py-2 px-1 text-sm font-medium'
          "
        >
          🏆 البطولة الحالية
        </button>
        <button
          (click)="activeTab = 'archive'"
          [class]="
            activeTab === 'archive'
              ? 'border-blue-500 text-blue-400 border-b-2 py-2 px-1 text-sm font-medium'
              : 'border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300 border-b-2 py-2 px-1 text-sm font-medium'
          "
        >
          📚 الأرشيف
        </button>
      </nav>
    </div>
  </div>

  <!-- Current Tournament Tab -->
  <div *ngIf="activeTab === 'current'">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="flex justify-center py-12">
      <div
        class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"
      ></div>
    </div>

    <!-- Error State -->
    <div
      *ngIf="errorMessage && !isLoading"
      class="bg-red-900 text-white p-4 rounded-lg mb-6"
    >
      <h3 class="font-bold mb-2">Error</h3>
      <p>{{ errorMessage }}</p>
      <button
        (click)="loadActiveTournament()"
        class="mt-3 bg-red-700 hover:bg-red-600 px-4 py-2 rounded transition-colors"
      >
        Try Again
      </button>
    </div>

    <!-- No Active Tournament -->
    <div
      *ngIf="!isLoading && !errorMessage && !activeTournament"
      class="text-center py-12"
    >
      <div class="bg-gray-800 rounded-lg p-8 max-w-md mx-auto">
        <h2 class="text-2xl font-bold text-white mb-4">
          📅 No Active Tournament
        </h2>
        <p class="text-gray-400 mb-4">
          There is currently no active teams tournament.
        </p>
        <p class="text-gray-500 text-sm">
          Check back later or contact the administrator.
        </p>
      </div>
    </div>

    <!-- Tournament Content -->
    <div *ngIf="!isLoading && !errorMessage && activeTournament">
      <!-- Tournament Info Card -->
      <div class="bg-gray-800 rounded-lg p-6 mb-6">
        <div
          class="flex flex-col lg:flex-row lg:items-center lg:justify-between"
        >
          <div>
            <h2 class="text-2xl font-bold text-white mb-3">
              {{ activeTournament.name }}
            </h2>
            <div class="flex flex-wrap gap-4 text-sm">
              <span class="bg-gray-700 px-3 py-1 rounded-full">
                <strong>Status:</strong>
                <span [class]="getStatusColor(activeTournament.status)">
                  {{ activeTournament.status }}
                </span>
              </span>
              <span class="bg-gray-700 px-3 py-1 rounded-full">
                <strong>System:</strong> {{ activeTournament.systemOfScoring }}
              </span>
              <span class="bg-gray-700 px-3 py-1 rounded-full">
                <strong>Teams:</strong> {{ activeTournament.teamCount }}
              </span>
              <span class="bg-gray-700 px-3 py-1 rounded-full">
                <strong>Players per Team:</strong>
                {{ activeTournament.playersPerTeam }}
              </span>
            </div>
          </div>

          <!-- Champion Badge -->
          <div
            *ngIf="
              activeTournament.status === 'Finished' &&
              activeTournament.championTeamName
            "
            class="mt-4 lg:mt-0"
          >
            <div
              class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-black px-6 py-3 rounded-lg font-bold text-center"
            >
              🏆 Champion: {{ activeTournament.championTeamName }}
            </div>
          </div>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="bg-blue-600 rounded-lg p-4 text-center text-white">
          <div class="text-2xl font-bold">
            {{ activeTournament.teams.length }}
          </div>
          <div class="text-blue-100 text-sm">Teams</div>
        </div>
        <div class="bg-green-600 rounded-lg p-4 text-center text-white">
          <div class="text-2xl font-bold">{{ getTotalPlayersCount() }}</div>
          <div class="text-green-100 text-sm">Players</div>
        </div>
        <div class="bg-purple-600 rounded-lg p-4 text-center text-white">
          <div class="text-2xl font-bold">{{ getCompletedMatchesCount() }}</div>
          <div class="text-purple-100 text-sm">Completed</div>
        </div>
        <div class="bg-orange-600 rounded-lg p-4 text-center text-white">
          <div class="text-2xl font-bold">{{ getTotalMatchesCount() }}</div>
          <div class="text-orange-100 text-sm">Total Matches</div>
        </div>
      </div>

      <!-- Teams Grid -->
      <div class="bg-black bg-opacity-50 rounded-lg p-6 mb-6">
        <h3 class="text-xl font-bold text-white mb-4">👥 Teams & Players</h3>

        <div
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"
        >
          <div
            *ngFor="let team of activeTournament.teams"
            class="bg-black/90 rounded-lg p-4 transition-colors"
          >
            <!-- Team Header -->
            <div class="text-center mb-4">
              <h4 class="text-lg font-bold text-white mb-2">
                {{ team.teamName }}
              </h4>
              <div
                class="inline-block bg-blue-600 text-white px-3 py-1 rounded-full font-bold"
              >
                {{ team.totalPoints }} pts
              </div>
            </div>

            <!-- Team Stats -->
            <div class="grid grid-cols-3 gap-2 mb-4 text-center text-sm">
              <div>
                <div class="text-green-400 font-bold">{{ team.wins }}</div>
                <div class="text-gray-400">Wins</div>
              </div>
              <div>
                <div class="text-yellow-400 font-bold">{{ team.draws }}</div>
                <div class="text-gray-400">Draws</div>
              </div>
              <div>
                <div class="text-red-400 font-bold">{{ team.losses }}</div>
                <div class="text-gray-400">Losses</div>
              </div>
            </div>

            <!-- Players List -->
            <div>
              <div class="space-y-2">
                <div
                  *ngFor="let player of team.players"
                  class="bg-gray-800 text-gray-100 px-8 py-2 rounded flex items-center justify-between"
                >
                  <!-- Player Points (Left - Green) -->
                  <div class="text-green-400 font-bold text-lg">
                    {{ getPlayerStats(player.playerId).totalPoints }}
                  </div>

                  <!-- Player Name (Center) -->
                  <div class="text-center font-medium text-white">
                    {{ player.fullName }}
                  </div>

                  <!-- Player Points Against (Right - Red) -->
                  <div class="text-red-400 font-bold text-lg">
                    {{ getPlayerStats(player.playerId).totalPointsAgainst }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Team Matches Buttons -->
            <div class="mt-4">
              <h6
                class="text-xs font-semibold text-gray-300 mb-2 text-center border-b border-gray-600 pb-1"
              >
                Matches vs:
              </h6>
              <div class="space-y-2">
                <button
                  *ngFor="let opponent of getTeamOpponents(team)"
                  (click)="showTeamMatches(team, opponent)"
                  class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1.5 rounded text-xs transition-colors font-medium"
                >
                  vs {{ opponent.teamName }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Archive Tab -->
  <div *ngIf="activeTab === 'archive'">
    <h2 class="text-2xl font-bold text-white mb-6">🏆 Tournament Archive</h2>

    <!-- Loading Archive -->
    <div *ngIf="isLoadingArchive" class="flex justify-center py-8">
      <div
        class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"
      ></div>
    </div>

    <!-- Archive Content -->
    <div *ngIf="!isLoadingArchive">
      <!-- Players Statistics -->
      <div class="bg-gray-800 rounded-lg p-6 mb-6">
        <h3 class="text-xl font-bold text-white mb-4">👥 Players Statistics</h3>

        <div *ngIf="isLoadingPlayers" class="flex justify-center py-4">
          <div
            class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"
          ></div>
        </div>

        <div
          *ngIf="!isLoadingPlayers && allPlayers.length > 0"
          class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-2"
        >
          <div
            *ngFor="let player of allPlayers"
            class="bg-gray-700 p-2 rounded text-center hover:bg-gray-600 transition-colors cursor-pointer"
          >
            <div
              class="text-xs font-semibold text-white mb-1 truncate"
              [title]="player.fullName"
            >
              {{ player.fullName }}
            </div>
            <div class="text-xs text-gray-300 flex justify-center gap-2">
              <div class="flex items-center">
                <span class="bg-blue-600 text-white px-1 py-0.5 rounded">
                  {{ player.multiParticipations }}
                </span>
                <span class="text-gray-400 text-xs ml-1">مشاركات</span>
              </div>
              <div class="flex items-center">
                <span class="bg-green-600 text-white px-1 py-0.5 rounded">
                  {{ player.multiTitlesWon }}
                </span>
                <span class="text-gray-400 text-xs ml-1">ألقاب</span>
              </div>
            </div>
          </div>
        </div>

        <div
          *ngIf="!isLoadingPlayers && allPlayers.length === 0"
          class="text-center py-8"
        >
          <p class="text-gray-400">No players found.</p>
        </div>
      </div>

      <!-- Past Tournaments -->
      <div class="bg-gray-800 rounded-lg p-6">
        <h3 class="text-xl font-bold text-white mb-4">📚 Past Tournaments</h3>

        <div *ngIf="isLoadingPastTournaments" class="flex justify-center py-4">
          <div
            class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"
          ></div>
        </div>

        <div
          *ngIf="!isLoadingPastTournaments && pastTournaments.length > 0"
          class="space-y-6"
        >
          <div
            *ngFor="let tournament of pastTournaments"
            class="bg-gray-700 rounded-lg p-4"
          >
            <div class="flex justify-between items-center mb-4">
              <h4 class="text-lg font-bold text-white">
                {{ tournament.name }}
              </h4>
              <div class="flex items-center gap-2">
                <span class="bg-blue-600 text-white px-3 py-1 rounded text-sm">
                  {{ tournament.systemOfScoring }}
                </span>
                <span class="bg-green-600 text-white px-3 py-1 rounded text-sm">
                  {{ tournament.status }}
                </span>
                <span
                  *ngIf="tournament.championTeamName"
                  class="bg-yellow-600 text-black px-3 py-1 rounded text-sm font-bold"
                >
                  🏆 {{ tournament.championTeamName }}
                </span>
              </div>
            </div>

            <!-- Tournament Standings -->
            <div
              *ngIf="tournament.standings && tournament.standings.length > 0"
              class="overflow-x-auto"
            >
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-gray-600">
                    <th class="text-left text-gray-300 py-2">Pos</th>
                    <th class="text-left text-gray-300 py-2">Team</th>
                    <th class="text-center text-gray-300 py-2">Pts</th>
                    <th class="text-center text-gray-300 py-2">W</th>
                    <th class="text-center text-gray-300 py-2">D</th>
                    <th class="text-center text-gray-300 py-2">L</th>
                    <th class="text-center text-gray-300 py-2">MP</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="let standing of tournament.standings; let i = index"
                    class="border-b border-gray-600 hover:bg-gray-600"
                  >
                    <td class="py-2 text-white font-bold">
                      {{ getTrophyIcon(i + 1) }} {{ i + 1 }}
                    </td>
                    <td class="py-2 text-white">{{ standing.teamName }}</td>
                    <td class="py-2 text-center text-white font-bold">
                      {{ standing.totalPoints }}
                    </td>
                    <td class="py-2 text-center text-green-400">
                      {{ standing.wins }}
                    </td>
                    <td class="py-2 text-center text-yellow-400">
                      {{ standing.draws }}
                    </td>
                    <td class="py-2 text-center text-red-400">
                      {{ standing.losses }}
                    </td>
                    <td class="py-2 text-center text-white">
                      {{ standing.matchesPlayed }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div
              *ngIf="!tournament.standings || tournament.standings.length === 0"
              class="text-center py-4"
            >
              <p class="text-gray-400">
                No standings available for this tournament.
              </p>
            </div>
          </div>
        </div>

        <div
          *ngIf="!isLoadingPastTournaments && pastTournaments.length === 0"
          class="text-center py-8"
        >
          <p class="text-gray-400">No past tournaments found.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Team Matches Modal -->
<div
  *ngIf="showTeamMatchesModal"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
>
  <div
    class="bg-black bg-opacity-50 rounded-lg w-full max-w-6xl max-h-[90vh] relative"
  >
    <!-- Fixed Close Button -->
    <button
      (click)="closeTeamMatchesModal()"
      class="absolute top-4 right-5 z-10 text-gray-100 hover:text-white text-2xl font-bold transition-colors bg-black bg-opacity-70 rounded-full w-8 h-8 flex items-center justify-center"
    >
      ×
    </button>

    <!-- Modal Content with Padding -->
    <div class="p-6 overflow-y-auto max-h-[90vh]">
      <!-- Loading State -->
      <div *ngIf="isLoadingMatches" class="flex justify-center py-8">
        <div
          class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"
        ></div>
      </div>

      <!-- Matches List -->
      <div
        *ngIf="!isLoadingMatches && teamMatches.length > 0"
        class="space-y-6"
      >
        <div
          *ngFor="let fixture of teamMatches"
          class="bg-black bg-opacity-80 rounded-lg p-4"
        >
          <div class="flex justify-between px-3">
            <h4
              class="text-lg font-bold text-white mb-3 bg-black bg-opacity-50 pb-2"
            >
              {{ fixture.team1Name }}
            </h4>
            <h4
              class="text-lg font-bold text-white mb-3 bg-black bg-opacity-50 pb-2"
            >
              vs
            </h4>
            <h4
              class="text-lg font-bold text-white mb-3 bg-black bg-opacity-50 pb-2"
            >
              {{ fixture.team2Name }}
            </h4>
          </div>

          <div class="grid gap-3">
            <div
              *ngFor="let match of fixture.matches"
              class="bg-black bg-opacity-50 p-3 rounded flex justify-between items-center"
            >
              <div class="flex-1">
                <span class="text-white font-semibold">{{
                  match.player1Name
                }}</span>
              </div>

              <div class="px-4 text-center">
                <div *ngIf="match.isCompleted" class="font-bold text-lg">
                  <span
                    [class]="
                      (match.score1 || 0) > (match.score2 || 0)
                        ? 'text-green-400'
                        : (match.score1 || 0) < (match.score2 || 0)
                        ? 'text-red-400'
                        : 'text-yellow-400'
                    "
                  >
                    {{ match.score1 || 0 }}
                  </span>
                  <span class="text-white mx-2">-</span>
                  <span
                    [class]="
                      (match.score2 || 0) > (match.score1 || 0)
                        ? 'text-green-400'
                        : (match.score2 || 0) < (match.score1 || 0)
                        ? 'text-red-400'
                        : 'text-yellow-400'
                    "
                  >
                    {{ match.score2 || 0 }}
                  </span>
                </div>
                <div *ngIf="!match.isCompleted" class="text-gray-400 text-sm">
                  Pending
                </div>
              </div>

              <div class="flex-1 text-right">
                <span class="text-white font-semibold">{{
                  match.player2Name
                }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- No Matches Message -->
      <div
        *ngIf="!isLoadingMatches && teamMatches.length === 0"
        class="text-center py-8"
      >
        <p class="text-gray-400">No matches found for this team.</p>
      </div>
    </div>
  </div>
</div>
